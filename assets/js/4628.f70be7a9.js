"use strict";(self.webpackChunkproject_website=self.webpackChunkproject_website||[]).push([[4628],{8521:(e,t,n)=>{n.d(t,{Gv:()=>i,H1:()=>f,Pe:()=>h,Sv:()=>c,Td:()=>u,aC:()=>o,qf:()=>l,xZ:()=>a});const r=e=>"boolean"==typeof e,s=e=>"function"==typeof e,i=e=>null!==e&&"object"==typeof e,o=e=>i(e)&&e.constructor==={}.constructor,a=e=>Boolean(e)&&"function"==typeof e[Symbol.iterator],u=e=>e&&"function"==typeof e[Symbol.asyncIterator],c=e=>"undefined"!=typeof Response&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,l=e=>"undefined"!=typeof Blob&&e instanceof Blob,h=e=>e&&"object"==typeof e&&e.isBuffer,f=e=>(e=>"undefined"!=typeof ReadableStream&&e instanceof ReadableStream||i(e)&&s(e.tee)&&s(e.cancel)&&s(e.getReader))(e)||(e=>i(e)&&s(e.read)&&s(e.pipe)&&r(e.readable))(e)},327:(e,t,n)=>{n.d(t,{H:()=>a});var r=n(8521),s=n(90405),i=n(73968),o=n(3361);async function a(e,t,n,a){let u,c;Array.isArray(t)||(0,s.l)(t)?(u=t,c=n):(u=[],c=t);const l=(0,i.z)(c);let h=e;return"string"==typeof e&&(h=await l(e)),(0,r.qf)(e)&&(h=await l(e)),Array.isArray(u),await(0,o.q)(h,u,c)}},3361:(e,t,n)=>{n.d(t,{q:()=>Q});var r=n(38503);class s{terminate(){}}var i=n(5993);const o=new Map;function a(e){(0,i.v)(e.source&&!e.url||!e.source&&e.url);let t=o.get(e.source||e.url);return t||(e.url&&(t=function(e){if(!e.startsWith("http"))return e;return u((t=e,`try {\n  importScripts('${t}');\n} catch (error) {\n  console.error(error);\n  throw error;\n}`));var t}(e.url),o.set(e.url,t)),e.source&&(t=u(e.source),o.set(e.source,t))),(0,i.v)(t),t}function u(e){const t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function c(e,t=!0,n){const r=n||new Set;if(e){if(l(e))r.add(e);else if(l(e.buffer))r.add(e.buffer);else if(ArrayBuffer.isView(e));else if(t&&"object"==typeof e)for(const s in e)c(e[s],t,r)}else;return void 0===n?Array.from(r):[]}function l(e){return!!e&&(e instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&e instanceof MessagePort||("undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)))}const h=()=>{};class f{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return"undefined"!=typeof Worker&&r.Bd||void 0!==s&&!r.Bd}constructor(e){const{name:t,source:n,url:s}=e;(0,i.v)(n||s),this.name=t,this.source=n,this.url=s,this.onMessage=h,this.onError=e=>console.log(e),this.worker=r.Bd?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=h,this.onError=h,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(e,t){t=t||c(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=a({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(new Error("No data received"))},e.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},e.onmessageerror=e=>console.error(e),e}_createNodeWorker(){let e;if(this.url){const t=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new s(t,{eval:!1})}else{if(!this.source)throw new Error("no worker");e=new s(this.source,{eval:!0})}return e.on("message",(e=>{this.onMessage(e)})),e.on("error",(e=>{this.onError(e)})),e.on("exit",(e=>{})),e}}class d{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(e,t){this.name=e,this.workerThread=t,this.result=new Promise(((e,t)=>{this._resolve=e,this._reject=t}))}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){(0,i.v)(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){(0,i.v)(this.isRunning),this.isRunning=!1,this._reject(e)}}class p{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return f.isSupported()}constructor(e){this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach((e=>e.destroy())),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},void 0!==e.name&&(this.name=e.name),void 0!==e.maxConcurrency&&(this.maxConcurrency=e.maxConcurrency),void 0!==e.maxMobileConcurrency&&(this.maxMobileConcurrency=e.maxMobileConcurrency),void 0!==e.reuseWorkers&&(this.reuseWorkers=e.reuseWorkers),void 0!==e.onDebug&&(this.onDebug=e.onDebug)}async startJob(e,t=(e,t,n)=>e.done(n),n=(e,t)=>e.error(t)){const r=new Promise((r=>(this.jobQueue.push({name:e,onMessage:t,onError:n,onStart:r}),this)));return this._startQueuedJob(),await r}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const r=new d(t.name,e);e.onMessage=e=>t.onMessage(r,e.type,e.payload),e.onError=e=>t.onError(r,e),t.onStart(r);try{await r.result}catch(n){console.error(`Worker exception: ${n}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!r.Bd||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new f({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return r.Fr?this.maxMobileConcurrency:this.maxConcurrency}}const m={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class g{props;workerPools=new Map;static _workerFarm;static isSupported(){return f.isSupported()}static getWorkerFarm(e={}){return g._workerFarm=g._workerFarm||new g({}),g._workerFarm.setProps(e),g._workerFarm}constructor(e){this.props={...m},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:n,url:r}=e;let s=this.workerPools.get(t);return s||(s=new p({name:t,source:n,url:r}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}var y=n(55607);async function _(e,t,n,s,o){const a=e.id,u=function(e,t={}){const n=t[e.id]||{},s=r.Bd?`${e.id}-worker.js`:`${e.id}-worker-node.js`;let o=n.workerUrl;if(o||"compression"!==e.id||(o=t.workerUrl),"test"===t._workerType&&(o=r.Bd?`modules/${e.module}/dist/${s}`:`modules/${e.module}/src/workers/${e.id}-worker-node.ts`),!o){let t=e.version;"latest"===t&&(t=y.x);const n=t?`@${t}`:"";o=`https://unpkg.com/@loaders.gl/${e.module}${n}/dist/${s}`}return(0,i.v)(o),o}(e,n),c=g.getWorkerFarm(n).getWorkerPool({name:a,url:u});n=JSON.parse(JSON.stringify(n)),s=JSON.parse(JSON.stringify(s||{}));const l=await c.startJob("process-on-worker",b.bind(null,o));l.postMessage("process",{input:t,options:n,context:s});const h=await l.result;return await h.result}async function b(e,t,n,r){switch(n){case"done":t.done(r);break;case"error":t.error(new Error(r.error));break;case"process":const{id:i,input:o,options:a}=r;try{const n=await e(o,a);t.postMessage("done",{id:i,result:n})}catch(s){const e=s instanceof Error?s.message:"unknown error";t.postMessage("error",{id:i,error:e})}break;default:console.warn(`parse-with-worker unknown message ${n}`)}}var v=n(90405),x=n(8521),w=n(99027),k=n(94133),I=n(92214);const T=262144;const E=262144;const A=1048576;var S=n(47612),L=n(47069);function O(e,t){return S.Bd?async function*(e,t){const n=e.getReader();let r;try{for(;;){const e=r||n.read();t?._streamReadAhead&&(r=n.read());const{done:s,value:i}=await e;if(s)return;yield(0,L.XA)(i)}}catch(s){n.releaseLock()}}(e,t):async function*(e){for await(const t of e)yield(0,L.XA)(t)}(e)}function $(e,t){if("string"==typeof e)return function*(e,t){const n=t?.chunkSize||T;let r=0;const s=new TextEncoder;for(;r<e.length;){const t=Math.min(e.length-r,n),i=e.slice(r,r+t);r+=t,yield s.encode(i)}}(e,t);if(e instanceof ArrayBuffer)return function*(e,t={}){const{chunkSize:n=E}=t;let r=0;for(;r<e.byteLength;){const t=Math.min(e.byteLength-r,n),s=new ArrayBuffer(t),i=new Uint8Array(e,r,t);new Uint8Array(s).set(i),r+=t,yield s}}(e,t);if((0,x.qf)(e))return async function*(e,t){const n=t?.chunkSize||A;let r=0;for(;r<e.size;){const t=r+n,s=await e.slice(r,t).arrayBuffer();r=t,yield s}}(e,t);if((0,x.H1)(e))return O(e,t);if((0,x.Sv)(e)){return O(e.body,t)}throw new Error("makeIterator")}var M=n(80815);const C="Cannot convert supplied data type";async function N(e,t,n){const r=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if("string"==typeof e||r)return function(e,t){if(t.text&&"string"==typeof e)return e;if((0,x.Pe)(e)&&(e=e.buffer),e instanceof ArrayBuffer){const n=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);let n=e.buffer;const r=e.byteLength||e.length;return 0===e.byteOffset&&r===n.byteLength||(n=n.slice(e.byteOffset,e.byteOffset+r)),n}throw new Error(C)}(e,t);if((0,x.qf)(e)&&(e=await(0,M.wv)(e)),(0,x.Sv)(e)){const n=e;return await(0,M.Mz)(n),t.binary?await n.arrayBuffer():await n.text()}if((0,x.H1)(e)&&(e=$(e,n)),(0,x.xZ)(e)||(0,x.Td)(e))return(0,I.cy)(e);throw new Error(C)}var D=n(73968),B=n(28071),P=n(86428);var F=n(72548),U=n(10048);const R=new(n(85335).t)({id:"loaders.gl"});var V=n(42221),W=n(5223);const z=/\.([^.]+)$/;function q(e,t=[],n,r){if(!j(e))return null;if(t&&!Array.isArray(t))return(0,v.D)(t);let s=[];t&&(s=s.concat(t)),n?.ignoreRegisteredLoaders||s.push(...(0,W.Ph)()),function(e){for(const t of e)(0,v.D)(t)}(s);const i=function(e,t,n,r){const s=(0,F.Al)(e),i=(0,F.z4)(e),o=(0,B.S3)(s)||r?.url;let a=null,u="";n?.mimeType&&(a=G(t,n?.mimeType),u=`match forced by supplied MIME type ${n?.mimeType}`);a=a||function(e,t){const n=t&&z.exec(t),r=n&&n[1];return r?function(e,t){t=t.toLowerCase();for(const n of e)for(const e of n.extensions)if(e.toLowerCase()===t)return n;return null}(e,r):null}(t,o),u=u||(a?`matched url ${o}`:""),a=a||G(t,i),u=u||(a?`matched MIME type ${i}`:""),a=a||function(e,t){if(!t)return null;for(const n of e)if("string"==typeof t){if(X(t,n))return n}else if(ArrayBuffer.isView(t)){if(Y(t.buffer,t.byteOffset,n))return n}else if(t instanceof ArrayBuffer){if(Y(t,0,n))return n}return null}(t,e),u=u||(a?`matched initial data ${Z(e)}`:""),n?.fallbackMimeType&&(a=a||G(t,n?.fallbackMimeType),u=u||(a?`matched fallback MIME type ${i}`:""));u&&R.log(1,`selectLoader selected ${a?.name}: ${u}.`);return a}(e,s,n,r);if(!i&&!n?.nothrow)throw new Error(H(e));return i}function j(e){return!(e instanceof Response&&204===e.status)}function H(e){const t=(0,F.Al)(e),n=(0,F.z4)(e);let r="No valid loader found (";r+=t?`${P.iW(t)}, `:"no url provided, ",r+=`MIME type: ${n?`"${n}"`:"not provided"}, `;const s=e?Z(e):"";return r+=s?` first bytes: "${s}"`:"first bytes: not available",r+=")",r}function G(e,t){for(const n of e){if(n.mimeTypes?.some((e=>(0,V.JQ)(t,e))))return n;if((0,V.JQ)(t,`application/x.${n.id}`))return n}return null}function X(e,t){if(t.testText)return t.testText(e);return(Array.isArray(t.tests)?t.tests:[t.tests]).some((t=>e.startsWith(t)))}function Y(e,t,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some((n=>function(e,t,n,r){if(r instanceof ArrayBuffer)return(0,U.YV)(r,e,r.byteLength);switch(typeof r){case"function":return r(e);case"string":return r===K(e,t,r.length);default:return!1}}(e,t,0,n)))}function Z(e,t=5){if("string"==typeof e)return e.slice(0,t);if(ArrayBuffer.isView(e))return K(e.buffer,e.byteOffset,t);if(e instanceof ArrayBuffer){return K(e,0,t)}return""}function K(e,t,n){if(e.byteLength<t+n)return"";const r=new DataView(e);let s="";for(let i=0;i<n;i++)s+=String.fromCharCode(r.getUint8(t+i));return s}async function Q(e,t,n,s){!t||Array.isArray(t)||(0,v.l)(t)||(s=void 0,n=t,t=void 0),e=await e,n=n||{};const o=(0,F.Al)(e),a=function(e,t){if(e&&!Array.isArray(e))return e;let n;if(e&&(n=Array.isArray(e)?e:[e]),t&&t.loaders){const e=Array.isArray(t.loaders)?t.loaders:[t.loaders];n=n?[...n,...e]:e}return n&&n.length?n:void 0}(t,s),u=await async function(e,t=[],n,r){if(!j(e))return null;let s=q(e,t,{...n,nothrow:!0},r);if(s)return s;if((0,x.qf)(e)&&(s=q(e=await e.slice(0,10).arrayBuffer(),t,n,r)),!s&&!n?.nothrow)throw new Error(H(e));return s}(e,a,n);return u?(s=function(e,t,n){if(n)return n;const r={fetch:(0,D.z)(t,e),...e};if(r.url){const e=(0,B.S3)(r.url);r.baseUrl=e,r.queryString=(0,B.by)(r.url),r.filename=P.iW(e),r.baseUrl=P.pD(e)}return Array.isArray(r.loaders)||(r.loaders=null),r}({url:o,_parse:Q,loaders:a},n=(0,w.a5)(n,u,a,o),s||null),await async function(e,t,n,s){if(function(e){(0,i.v)(e,"no worker provided");const t=e.version}(e),n=(0,k.y)(e.options,n),(0,x.Sv)(t)){const e=t,{ok:n,redirected:r,status:i,statusText:o,type:a,url:u}=e,c=Object.fromEntries(e.headers.entries());s.response={headers:c,ok:n,redirected:r,status:i,statusText:o,type:a,url:u}}t=await N(t,e,n);const o=e;if(o.parseTextSync&&"string"==typeof t)return o.parseTextSync(t,n,s);if(function(e,t){return!!g.isSupported()&&!(!r.Bd&&!t?._nodeWorkers)&&e.worker&&t?.worker}(e,n))return await _(e,t,n,s,Q);if(o.parseText&&"string"==typeof t)return await o.parseText(t,n,s);if(o.parse)return await o.parse(t,n,s);throw(0,i.v)(!o.parseSync),new Error(`${e.id} loader - no parser found and worker is disabled`)}(u,e,n,s)):null}},5223:(e,t,n)=>{n.d(t,{Ph:()=>a,mk:()=>o});var r=n(90405),s=n(99027);const i=()=>{const e=(0,s.K2)();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry};function o(e){const t=i();e=Array.isArray(e)?e:[e];for(const n of e){const e=(0,r.D)(n);t.find((t=>e===t))||t.unshift(e)}}function a(){return i()}},38658:(e,t,n)=>{n.d(t,{t2:()=>o});let r="";const s={};var i=n(80815);async function o(e,t){if("string"==typeof e){const n=function(e){for(const t in s)if(e.startsWith(t)){const n=s[t];e=e.replace(t,n)}return e.startsWith("http://")||e.startsWith("https://")||(e=`${r}${e}`),e}(e);return function(e){return!function(e){return e.startsWith("http:")||e.startsWith("https:")}(e)&&!function(e){return e.startsWith("data:")}(e)}(n)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(n,t):await fetch(n,t)}return await(0,i.wv)(e)}},73968:(e,t,n)=>{n.d(t,{z:()=>o});var r=n(8521),s=n(38658),i=n(99027);function o(e,t){const n=(0,i.pp)(),o=e||n;return"function"==typeof o.fetch?o.fetch:(0,r.Gv)(o.fetch)?e=>(0,s.t2)(e,o.fetch):t?.fetch?t?.fetch:s.t2}},90405:(e,t,n)=>{n.d(t,{D:()=>i,l:()=>s});var r=n(94976);function s(e){if(!e)return!1;Array.isArray(e)&&(e=e[0]);return Array.isArray(e?.extensions)}function i(e){let t;return(0,r.v)(e,"null loader"),(0,r.v)(s(e),"invalid loader"),Array.isArray(e)&&(t=e[1],e=e[0],e={...e,options:{...e.options,...t}}),(e?.parseTextSync||e?.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}},99027:(e,t,n)=>{n.d(t,{pp:()=>l,K2:()=>c,a5:()=>h});var r=n(8521);const s=new(n(85335).t)({id:"loaders.gl"});class i{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}var o=n(47612);const a={fetch:null,mimeType:void 0,nothrow:!1,log:new class{console;constructor(){this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}},useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:o.Bd,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},u={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function c(){globalThis.loaders=globalThis.loaders||{};const{loaders:e}=globalThis;return e._state||(e._state={}),e._state}function l(){const e=c();return e.globalOptions=e.globalOptions||{...a},e.globalOptions}function h(e,t,n,r){return n=n||[],function(e,t){f(e,null,a,u,t);for(const n of t){const r=e&&e[n.id]||{},s=n.options&&n.options[n.id]||{},i=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};f(r,n.id,s,i,t)}}(e,n=Array.isArray(n)?n:[n]),p(t,e,r)}function f(e,t,n,i,o){const a=t||"Top level",u=t?`${t}.`:"";for(const c in e){const l=!t&&(0,r.Gv)(e[c]);if(!(c in n)&&!("baseUri"===c&&!t)&&!("workerUrl"===c&&t))if(c in i)s.warn(`${a} loader option '${u}${c}' no longer supported, use '${i[c]}'`)();else if(!l){const e=d(c,o);s.warn(`${a} loader option '${u}${c}' not recognized. ${e}`)()}}}function d(e,t){const n=e.toLowerCase();let r="";for(const s of t)for(const t in s.options){if(e===t)return`Did you mean '${s.id}.${t}'?`;const i=t.toLowerCase();(n.startsWith(i)||i.startsWith(n))&&(r=r||`Did you mean '${s.id}.${t}'?`)}return r}function p(e,t,n){const r={...e.options||{}};return function(e,t){t&&!("baseUri"in e)&&(e.baseUri=t)}(r,n),null===r.log&&(r.log=new i),m(r,l()),m(r,t),r}function m(e,t){for(const n in t)if(n in t){const s=t[n];(0,r.aC)(s)&&(0,r.aC)(e[n])?e[n]={...e[n],...t[n]}:e[n]=t[n]}}},42221:(e,t,n)=>{n.d(t,{JQ:()=>i,OA:()=>o,d_:()=>a});const r=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,s=/^([-\w.]+\/[-\w.+]+)/;function i(e,t){return e.toLowerCase()===t.toLowerCase()}function o(e){const t=s.exec(e);return t?t[1]:e}function a(e){const t=r.exec(e);return t?t[1]:""}},72548:(e,t,n)=>{n.d(t,{Al:()=>o,_E:()=>u,z4:()=>a});var r=n(8521),s=n(42221),i=n(28071);function o(e){if((0,r.Sv)(e)){return e.url}if((0,r.qf)(e)){return e.name||""}return"string"==typeof e?e:""}function a(e){if((0,r.Sv)(e)){const t=e,n=t.headers.get("content-type")||"",r=(0,i.S3)(t.url);return(0,s.OA)(n)||(0,s.d_)(r)}if((0,r.qf)(e)){return e.type||""}return"string"==typeof e?(0,s.d_)(e):""}function u(e){if((0,r.Sv)(e)){return e.headers["content-length"]||-1}if((0,r.qf)(e)){return e.size}return"string"==typeof e?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}},80815:(e,t,n)=>{n.d(t,{Mz:()=>u,wv:()=>a});var r=n(8521);class s extends Error{constructor(e,t){super(e),this.reason=t.reason,this.url=t.url,this.response=t.response}reason;url;response}var i=n(72548),o=n(28071);async function a(e){if((0,r.Sv)(e))return e;const t={},n=(0,i._E)(e);n>=0&&(t["content-length"]=String(n));const s=(0,i.Al)(e),o=(0,i.z4)(e);o&&(t["content-type"]=o);const a=await async function(e){const t=5;if("string"==typeof e)return`data:,${e.slice(0,t)}`;if(e instanceof Blob){const t=e.slice(0,5);return await new Promise((e=>{const n=new FileReader;n.onload=t=>e(t?.target?.result),n.readAsDataURL(t)}))}if(e instanceof ArrayBuffer){return`data:base64,${function(e){let t="";const n=new Uint8Array(e);for(let r=0;r<n.byteLength;r++)t+=String.fromCharCode(n[r]);return btoa(t)}(e.slice(0,t))}`}return null}(e);a&&(t["x-first-bytes"]=a),"string"==typeof e&&(e=(new TextEncoder).encode(e));const u=new Response(e,{headers:t});return Object.defineProperty(u,"url",{value:s}),u}async function u(e){if(!e.ok){const t=await async function(e){const n=(0,o.E1)(e.url);let r=`Failed to fetch resource (${e.status}) ${e.statusText}: ${n}`;r=r.length>100?`${r.slice(0,100)}...`:r;const i={reason:e.statusText,url:e.url,response:e};try{const t=e.headers.get("Content-Type");i.reason=t?.includes("application/json")?await e.json():e.text()}catch(t){}return new s(r,i)}(e);throw t}}},28071:(e,t,n)=>{n.d(t,{E1:()=>o,S3:()=>i,by:()=>s});const r=/\?.*/;function s(e){const t=e.match(r);return t&&t[0]}function i(e){return e.replace(r,"")}function o(e){if(e.length<50)return e;const t=e.slice(e.length-15);return`${e.substr(0,32)}...${t}`}},8045:(e,t,n)=>{n.d(t,{$:()=>v});var r=n(94976),s=n(47612);const i=globalThis.loaders?.parseImageNode,o="undefined"!=typeof Image,a="undefined"!=typeof ImageBitmap,u=Boolean(i),c=!!s.Bd||u;var l=n(53905);const h=/^data:image\/svg\+xml/,f=/\.svg((\?|#).*)?$/;function d(e){return e&&(h.test(e)||f.test(e))}function p(e,t){if(d(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function m(e,t,n){const r=function(e,t){if(d(t)){let t=(new TextDecoder).decode(e);try{"function"==typeof unescape&&"function"==typeof encodeURIComponent&&(t=unescape(encodeURIComponent(t)))}catch(n){throw new Error(n.message)}return`data:image/svg+xml;base64,${btoa(t)}`}return p(e,t)}(e,n),s=self.URL||self.webkitURL,i="string"!=typeof r&&s.createObjectURL(r);try{return await async function(e,t){const n=new Image;if(n.src=e,t.image&&t.image.decode&&n.decode)return await n.decode(),n;return await new Promise(((e,t)=>{try{n.onload=()=>e(n),n.onerror=e=>{const n=e instanceof Error?e.message:"error";t(new Error(n))}}catch(r){t(r)}}))}(i||r,t)}finally{i&&s.revokeObjectURL(i)}}const g={};let y=!0;async function _(e,t,n){let r;if(d(n)){r=await m(e,t,n)}else r=p(e,n);const s=t&&t.imagebitmap;return await async function(e,t=null){!function(e){for(const t in e||g)return!1;return!0}(t)&&y||(t=null);if(t)try{return await createImageBitmap(e,t)}catch(n){console.warn(n),y=!1}return await createImageBitmap(e)}(r,s)}var b=n(72501);const v={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:"4.2.1",mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],parse:async function(e,t,n){const s=((t=t||{}).image||{}).type||"auto",{url:i}=n||{};let u;switch(function(e){switch(e){case"auto":case"data":return function(){if(a)return"imagebitmap";if(o)return"image";if(c)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}();default:return function(e){switch(e){case"auto":return a||o||c;case"imagebitmap":return a;case"image":return o;case"data":return c;default:throw new Error(`@loaders.gl/images: image ${e} not supported in this environment`)}}(e),e}}(s)){case"imagebitmap":u=await _(e,t,i);break;case"image":u=await m(e,t,i);break;case"data":u=await async function(e){const{mimeType:t}=(0,b.m)(e)||{},n=globalThis.loaders?.parseImageNode;return(0,r.v)(n),await n(e,t)}(e);break;default:(0,r.v)(!1)}return"data"===s&&(u=(0,l.M5)(u)),u},tests:[e=>Boolean((0,b.m)(new DataView(e)))],options:{image:{type:"auto",decode:!0}}}},72501:(e,t,n)=>{function r(e){return function(e,t,n=0){const r=(s=t,[...s].map((e=>e.charCodeAt(0))));var s;for(let i=0;i<r.length;++i)if(r[i]!==e[i+n])return!1;return!0}(e,"ftyp",4)&&96&e[8]?function(e){switch((t=e,n=8,r=12,String.fromCharCode(...t.slice(n,r))).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}var t,n,r}(e):null}n.d(t,{m:()=>o});const s=!1,i=!0;function o(e){const t=a(e);return function(e){const t=a(e),n=t.byteLength>=24&&2303741511===t.getUint32(0,s);if(!n)return null;return{mimeType:"image/png",width:t.getUint32(16,s),height:t.getUint32(20,s)}}(t)||function(e){const t=a(e),n=t.byteLength>=3&&65496===t.getUint16(0,s)&&255===t.getUint8(2);if(!n)return null;const{tableMarkers:r,sofMarkers:i}=function(){const e=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)e.add(n);const t=new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502]);return{tableMarkers:e,sofMarkers:t}}();let o=2;for(;o+9<t.byteLength;){const e=t.getUint16(o,s);if(i.has(e))return{mimeType:"image/jpeg",height:t.getUint16(o+5,s),width:t.getUint16(o+7,s)};if(!r.has(e))return null;o+=2,o+=t.getUint16(o,s)}return null}(t)||function(e){const t=a(e),n=t.byteLength>=10&&1195984440===t.getUint32(0,s);if(!n)return null;return{mimeType:"image/gif",width:t.getUint16(6,i),height:t.getUint16(8,i)}}(t)||function(e){const t=a(e),n=t.byteLength>=14&&16973===t.getUint16(0,s)&&t.getUint32(2,i)===t.byteLength;if(!n)return null;return{mimeType:"image/bmp",width:t.getUint32(18,i),height:t.getUint32(22,i)}}(t)||function(e){const t=new Uint8Array(e instanceof DataView?e.buffer:e),n=r(t);if(!n)return null;return{mimeType:n.mimeType,width:0,height:0}}(t)}function a(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}},53905:(e,t,n)=>{function r(e){const t=i(e);if(!t)throw new Error("Not an image");return t}function s(e){switch(r(e)){case"data":return e;case"image":case"imagebitmap":const t=document.createElement("canvas"),n=t.getContext("2d");if(!n)throw new Error("getImageData");return t.width=e.width,t.height=e.height,n.drawImage(e,0,0),n.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}function i(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?"imagebitmap":"undefined"!=typeof Image&&e instanceof Image?"image":e&&"object"==typeof e&&e.data&&e.width&&e.height?"data":null}n.d(t,{M5:()=>s})},10048:(e,t,n)=>{function r(e,t,n){if(n=n||e.byteLength,e.byteLength<n||t.byteLength<n)return!1;const r=new Uint8Array(e),s=new Uint8Array(t);for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}function s(...e){return function(e){const t=e.map((e=>e instanceof ArrayBuffer?new Uint8Array(e):e)),n=t.reduce(((e,t)=>e+t.byteLength),0),r=new Uint8Array(n);let s=0;for(const i of t)r.set(i,s),s+=i.byteLength;return r.buffer}(e)}function i(e,t,n){const r=void 0!==n?new Uint8Array(e).subarray(t,t+n):new Uint8Array(e).subarray(t);return new Uint8Array(r).buffer}n.d(t,{AQ:()=>s,YV:()=>r,_m:()=>i})},47069:(e,t,n)=>{function r(e){if((t=e)&&"object"==typeof t&&t.isBuffer)return e;var t;if(e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return 0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if("string"==typeof e){const t=e;return(new TextEncoder).encode(t).buffer}if(e&&"object"==typeof e&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}n.d(t,{XA:()=>r})},94976:(e,t,n)=>{function r(e,t){if(!e)throw new Error(t||"loader assertion failed.")}n.d(t,{v:()=>r})},47612:(e,t,n)=>{n.d(t,{Bd:()=>r});"undefined"!=typeof self&&self,"undefined"!=typeof window&&window,"undefined"!=typeof global&&global,"undefined"!=typeof document&&document;const r=Boolean("object"!=typeof process||"[object process]"!==String(process)||process.browser),s="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);s&&parseFloat(s[1])},92214:(e,t,n)=>{n.d(t,{cy:()=>s});var r=n(10048);async function s(e){const t=[];for await(const n of e)t.push(n);return(0,r.AQ)(...t)}},94133:(e,t,n)=>{function r(e,t){return s(e||{},t)}function s(e,t,n=0){if(n>3)return t;const r={...e};for(const[i,o]of Object.entries(t))o&&"object"==typeof o&&!Array.isArray(o)?r[i]=s(r[i]||{},t[i],n+1):r[i]=t[i];return r}n.d(t,{y:()=>r})},86428:(e,t,n)=>{function r(){if("undefined"!=typeof process&&void 0!==process.cwd)return process.cwd();const e=window.location?.pathname;return e?.slice(0,e.lastIndexOf("/")+1)||""}function s(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(t+1):""}function i(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(0,t):""}function o(...e){const t=[];for(let r=0;r<e.length;r++)t[r]=e[r];let n,s="",i=!1;for(let o=t.length-1;o>=-1&&!i;o--){let e;o>=0?e=t[o]:(void 0===n&&(n=r()),e=n),0!==e.length&&(s=`${e}/${s}`,i=e.charCodeAt(0)===a)}return s=function(e,t){let n,r="",s=-1,i=0,o=!1;for(let c=0;c<=e.length;++c){if(c<e.length)n=e.charCodeAt(c);else{if(n===a)break;n=a}if(n===a){if(s===c-1||1===i);else if(s!==c-1&&2===i){if(r.length<2||!o||r.charCodeAt(r.length-1)!==u||r.charCodeAt(r.length-2)!==u)if(r.length>2){const e=r.length-1;let t=e;for(;t>=0&&r.charCodeAt(t)!==a;--t);if(t!==e){r=-1===t?"":r.slice(0,t),s=c,i=0,o=!1;continue}}else if(2===r.length||1===r.length){r="",s=c,i=0,o=!1;continue}t&&(r.length>0?r+="/..":r="..",o=!0)}else{const t=e.slice(s+1,c);r.length>0?r+=`/${t}`:r=t,o=!1}s=c,i=0}else n===u&&-1!==i?++i:i=-1}return r}(s,!i),i?`/${s}`:s.length>0?s:"."}n.d(t,{pD:()=>i,iW:()=>s,hd:()=>o});const a=47,u=46},5993:(e,t,n)=>{function r(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}n.d(t,{v:()=>r})},38503:(e,t,n)=>{n.d(t,{Bd:()=>r,Fr:()=>i,xD:()=>s});"undefined"!=typeof self&&self,"undefined"!=typeof window&&window,"undefined"!=typeof global&&global,"undefined"!=typeof document&&document;const r="object"!=typeof process||"[object process]"!==String(process)||process.browser,s="function"==typeof importScripts,i="undefined"!=typeof window&&void 0!==window.orientation,o="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);o&&parseFloat(o[1])},55607:(e,t,n)=>{n.d(t,{Q:()=>s,x:()=>r});const r="latest";const s=(globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.2.1"),globalThis._loadersgl_.version)},69499:(e,t,n)=>{n.d(t,{C:()=>s});var r=n(5153);class s extends r.F{get[Symbol.toStringTag](){return"ComputePipeline"}hash="";shaderLayout;constructor(e,t){super(e,t,s.defaultProps),this.shaderLayout=t.shaderLayout}static defaultProps={...r.F.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0}}},59658:(e,t,n)=>{n.d(t,{F:()=>o});var r=n(95850);var s=n(97983);let i=0;class o{static defaultAnimationLoopProps={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:e=>console.error(e),stats:r.a.stats.get("animation-loop-"+i++),autoResizeViewport:!1};device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;_error=null;constructor(e){if(this.props={...o.defaultAnimationLoopProps,...e},!(e=this.props).device)throw new Error("No device provided");this.stats=e.stats||new s.A({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}reportError(e){this.props.onError(e),this._error=e}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(!1!==e&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const t=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(t),t}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost||this._error||(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers()),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise((e=>{this._resolveNextFrame=e}))),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){var e;this._running&&(this._animationFrameId=(e=this._animationFrame.bind(this),"undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,1e3/60)))}_cancelAnimationFrame(){var e;null!==this._animationFrameId&&(e=this._animationFrameId,"undefined"!=typeof window&&window.cancelAnimationFrame?window.cancelAnimationFrame(e):clearTimeout(e),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){this.display?this.display._renderFrame(e):(this.props.onRender(this._getAnimationProps()),this.device?.submit())}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeViewport()}_initializeAnimationProps(){const e=this.device?.getDefaultCanvasContext();if(!this.device||!e)throw new Error("loop");const t=e?.canvas,n=e.props.useDevicePixels;this.animationProps={animationLoop:this,device:this.device,canvasContext:e,canvas:t,useDevicePixels:n,timeline:this.timeline,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:t,aspect:n}=this._getSizeAndAspect();e===this.animationProps.width&&t===this.animationProps.height||this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.getDefaultCanvasContext().canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);const n=this.props.onAddHTML(t);n&&(t.innerHTML=n)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};const[e,t]=this.device?.getDefaultCanvasContext().getDevicePixelSize()||[1,1];let n=1;const r=this.device?.getDefaultCanvasContext().canvas;return r&&r.clientHeight?n=r.clientWidth/r.clientHeight:e>0&&t>0&&(n=e/t),{width:e,height:t,aspect:n}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}},3726:(e,t,n)=>{n.d(t,{K:()=>i});let r=1,s=1;class i{time=0;channels=new Map;animations=new Map;playing=!1;lastEngineTime=-1;constructor(){}addChannel(e){const{delay:t=0,duration:n=Number.POSITIVE_INFINITY,rate:s=1,repeat:i=1}=e,o=r++,a={time:0,delay:t,duration:n,rate:s,repeat:i};return this._setChannelTime(a,this.time),this.channels.set(o,a),o}removeChannel(e){this.channels.delete(e);for(const[t,n]of this.animations)n.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return void 0!==t&&this.time>=t.delay+t.duration*t.repeat}getTime(e){if(void 0===e)return this.time;const t=this.channels.get(e);return void 0===t?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const r of t)this._setChannelTime(r,this.time);const n=this.animations.values();for(const r of n){const{animation:e,channel:t}=r;e.setTime(this.getTime(t))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const n=s++;return this.animations.set(n,{animation:e,channel:t}),e.setTime(this.getTime(t)),n}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(-1===this.lastEngineTime&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const n=t-e.delay;n>=e.duration*e.repeat?e.time=e.duration*e.rate:(e.time=Math.max(0,n)%e.duration,e.time*=e.rate)}}},68475:(e,t,n)=>{n.d(t,{p:()=>o});var r=n(26839),s=n(73288),i=n(8274);class o{device;model;transformFeedback;static defaultProps={...i.K.defaultProps,outputs:void 0,feedbackBuffers:void 0};static isSupported(e){return"webgl"===e?.info?.type}constructor(e,t=o.defaultProps){if(!o.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new i.K(this.device,{id:t.id||"buffer-transform-model",fs:t.fs||(0,s.Wk)(),topology:t.topology||"point-list",varyings:t.outputs||t.varyings,...t}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:t.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e?.inputBuffers&&this.model.setAttributes(e.inputBuffers),e?.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const t=this.getBuffer(e);if(!t)throw new Error("BufferTransform#getBuffer");if(t instanceof r.h)return t.readAsync();const{buffer:n,byteOffset:s=0,byteLength:i=n.byteLength}=t;return n.readAsync(s,i)}}},8274:(e,t,n)=>{n.d(t,{K:()=>en});var r=n(22512),s=n(29651),i=n(26839);function o(e){return Array.isArray(e)?0===e.length||"number"==typeof e[0]:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}(e)}class a{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(e){if(this.name=e?.name||"unnamed",e?.name&&e?.shaderLayout){const t=e?.shaderLayout.bindings?.find((t=>"uniform"===t.type&&t.name===e?.name));if(!t)throw new Error(e?.name);const n=t;for(const e of n.uniforms||[])this.bindingLayout[e.name]=e}}setUniforms(e){for(const[t,n]of Object.entries(e))this._setUniform(t,n),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${n}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){(function(e,t){if(e!==t)return!1;const n=e,r=t;if(!o(n))return!1;if(o(r)&&n.length===r.length)for(let s=0;s<n.length;++s)if(r[s]!==n[s])return!1;return!0})(this.uniforms[e],t)||(this.uniforms[e]=function(e){return o(e)?e.slice():e}(t),this.modifiedUniforms[e]=!0,this.modified=!0)}}var u=n(72246),c=n(86231),l=n(73390);class h{layout={};byteLength;constructor(e,t={}){let n=0;for(const[s,i]of Object.entries(e)){const e=(0,c.k0)(i),{type:r,components:o}=e,a=o*(t?.[s]??1);n=(0,u.JP)(n,a);const l=n;n+=a,this.layout[s]={type:r,size:a,offset:l}}n+=(4-n%4)%4;const r=4*n;this.byteLength=Math.max(r,1024)}getData(e){const t=(0,l.o)(this.byteLength),n={i32:new Int32Array(t),u32:new Uint32Array(t),f32:new Float32Array(t),f16:new Uint16Array(t)};for(const[r,i]of Object.entries(e)){const e=this.layout[r];if(!e){s.R.warn(`Supplied uniform value ${r} not present in uniform block layout`)();continue}const{type:t,size:a,offset:u}=e,c=n[t];if(1===a){if("number"!=typeof i&&"boolean"!=typeof i){s.R.warn(`Supplied value for single component uniform ${r} is not a number: ${i}`)();continue}c[u]=Number(i)}else{if(!o(i)){s.R.warn(`Supplied value for multi component / array uniform ${r} is not a numeric array: ${i}`)();continue}c.set(i,u)}}return new Uint8Array(t,0,this.byteLength)}has(e){return Boolean(this.layout[e])}get(e){return this.layout[e]}}class f{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(e){for(const[t,n]of Object.entries(e)){const e=t,r=new h(n.uniformTypes??{},n.uniformSizes??{});this.uniformBufferLayouts.set(e,r);const s=new a({name:t});s.setUniforms(n.defaultUniforms||{}),this.uniformBlocks.set(e,s)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[t,n]of Object.entries(e))this.uniformBlocks.get(t)?.setUniforms(n);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e)?.byteLength||0}getUniformBufferData(e){const t=this.uniformBlocks.get(e)?.getAllUniforms()||{};return this.uniformBufferLayouts.get(e)?.getData(t)}createUniformBuffer(e,t,n){n&&this.setUniforms(n);const r=this.getUniformBufferByteLength(t),s=e.createBuffer({usage:i.h.UNIFORM|i.h.COPY_DST,byteLength:r}),o=this.getUniformBufferData(t);return s.write(o),s}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){const n=this.getUniformBufferByteLength(t),r=e.createBuffer({usage:i.h.UNIFORM|i.h.COPY_DST,byteLength:n});this.uniformBuffers.set(t,r)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(const t of this.uniformBlocks.keys()){const n=this.updateUniformBuffer(t);e||=n}return e&&s.R.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const t=this.uniformBlocks.get(e);let n=this.uniformBuffers.get(e),r=!1;if(n&&t?.needsRedraw){r||=t.needsRedraw;const i=this.getUniformBufferData(e);n=this.uniformBuffers.get(e),n?.write(i);const o=this.uniformBlocks.get(e)?.getAllUniforms();s.R.log(4,`Writing to uniform buffer ${String(e)}`,i,o)()}return r}}var d,p=n(75638),m=n(80698),g=n(89277),y=n(2021),_=n(3189);class b{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}getTypeName(){return this.name}}class v{constructor(e,t,n){this.name=e,this.type=t,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class x extends b{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class w extends b{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}}class k extends b{constructor(e,t,n,r){super(e,n),this.format=t,this.access=r}get isTemplate(){return!0}getTypeName(){let e=this.name;if(null!==this.format){if("vec2"===e||"vec3"===e||"vec4"===e||"mat2x2"===e||"mat2x3"===e||"mat2x4"===e||"mat3x2"===e||"mat3x3"===e||"mat3x4"===e||"mat4x2"===e||"mat4x3"===e||"mat4x4"===e){if("f32"===this.format.name)return e+="f",e;if("i32"===this.format.name)return e+="i",e;if("u32"===this.format.name)return e+="u",e;if("bool"===this.format.name)return e+="b",e;if("f16"===this.format.name)return e+="h",e}e+=`<${this.format.name}>`}else if("vec2"===e||"vec3"===e||"vec4"===e)return e;return e}}(e=>{e[e.Uniform=0]="Uniform",e[e.Storage=1]="Storage",e[e.Texture=2]="Texture",e[e.Sampler=3]="Sampler",e[e.StorageTexture=4]="StorageTexture"})(d||(d={}));class I{constructor(e,t,n,r,s,i,o){this.name=e,this.type=t,this.group=n,this.binding=r,this.attributes=s,this.resourceType=i,this.access=o}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class T{constructor(e,t){this.name=e,this.type=t}}class E{constructor(e,t,n,r){this.name=e,this.type=t,this.locationType=n,this.location=r,this.interpolation=null}}class A{constructor(e,t,n,r){this.name=e,this.type=t,this.locationType=n,this.location=r}}class S{constructor(e,t,n,r){this.name=e,this.type=t,this.attributes=n,this.id=r}}class L{constructor(e,t,n){this.name=e,this.type=t,this.attributes=n}}class O{constructor(e,t=null,n){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t,this.attributes=n}}class ${constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}const M=new Float32Array(1),C=new Int32Array(M.buffer),N=new Uint16Array(1);function D(e){M[0]=e;const t=C[0],n=t>>31&1;let r=t>>23&255,s=8388607&t;if(255===r)return N[0]=n<<15|31744|(0!==s?512:0),N[0];if(0===r){if(0===s)return N[0]=n<<15,N[0];s|=8388608;let e=113;for(;!(8388608&s);)s<<=1,e--;return r=127-e,s&=8388607,r>0?(s=(s>>126-r)+(s>>127-r&1),N[0]=n<<15|r<<10|s>>13,N[0]):(N[0]=n<<15,N[0])}return r=r-127+15,r>=31?(N[0]=n<<15|31744,N[0]):r<=0?r<-10?(N[0]=n<<15,N[0]):(s=(8388608|s)>>1-r,N[0]=n<<15|s>>13,N[0]):(s>>=13,N[0]=n<<15|r<<10|s,N[0])}const B=new Uint32Array(1),P=new Float32Array(B.buffer,0,1);function F(e){const t=112+(e>>6&31)<<23|(63&e)<<17;return B[0]=t,P[0]}function U(e,t,n,r){const s=[0,0,0,0];for(let c=0;c<r;++c)switch(n){case"8unorm":s[c]=e[t]/255,t++;break;case"8snorm":s[c]=e[t]/255*2-1,t++;break;case"8uint":s[c]=e[t],t++;break;case"8sint":s[c]=e[t]-127,t++;break;case"16uint":s[c]=e[t]|e[t+1]<<8,t+=2;break;case"16sint":s[c]=(e[t]|e[t+1]<<8)-32768,t+=2;break;case"16float":s[c]=(void 0,void 0,void 0,o=(32768&(i=e[t]|e[t+1]<<8))>>15,u=1023&i,0==(a=(31744&i)>>10)?(o?-1:1)*Math.pow(2,-14)*(u/Math.pow(2,10)):31==a?u?NaN:1/0*(o?-1:1):(o?-1:1)*Math.pow(2,a-15)*(1+u/Math.pow(2,10))),t+=2;break;case"32uint":case"32sint":s[c]=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24,t+=4;break;case"32float":s[c]=new Float32Array(e.buffer,t,1)[0],t+=4}var i,o,a,u;return s}function R(e,t,n,r,s){for(let i=0;i<r;++i)switch(n){case"8unorm":e[t]=255*s[i],t++;break;case"8snorm":e[t]=.5*(s[i]+1)*255,t++;break;case"8uint":e[t]=s[i],t++;break;case"8sint":e[t]=s[i]+127,t++;break;case"16uint":new Uint16Array(e.buffer,t,1)[0]=s[i],t+=2;break;case"16sint":new Int16Array(e.buffer,t,1)[0]=s[i],t+=2;break;case"16float":{const n=D(s[i]);new Uint16Array(e.buffer,t,1)[0]=n,t+=2;break}case"32uint":new Uint32Array(e.buffer,t,1)[0]=s[i],t+=4;break;case"32sint":new Int32Array(e.buffer,t,1)[0]=s[i],t+=4;break;case"32float":new Float32Array(e.buffer,t,1)[0]=s[i],t+=4}return s}const V={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class W{constructor(){this.id=W._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,t){if(e){t(z.instance);for(const n of e)n instanceof Array?this.searchBlock(n,t):n.search(t);t(q.instance)}}constEvaluate(e,t){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}W._id=0;class z extends W{}z.instance=new z;class q extends W{}q.instance=new q;const j=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class H extends W{constructor(){super()}}class G extends H{constructor(e,t,n,r,s,i){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=n,this.body=r,this.startLine=s,this.endLine=i}get astNodeType(){return"function"}search(e){if(this.attributes)for(const t of this.attributes)e(t);e(this);for(const t of this.args)e(t);this.searchBlock(this.body,e)}}class X extends H{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class Y extends H{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class Z extends H{constructor(e,t){super(),this.body=e,this.loopId=t}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class K extends H{constructor(e,t,n,r){super(),this.init=e,this.condition=t,this.increment=n,this.body=r}get astNodeType(){return"for"}search(e){var t,n,r;null===(t=this.init)||void 0===t||t.search(e),null===(n=this.condition)||void 0===n||n.search(e),null===(r=this.increment)||void 0===r||r.search(e),this.searchBlock(this.body,e)}}class Q extends H{constructor(e,t,n,r,s){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=r,this.value=s}get astNodeType(){return"var"}search(e){var t;e(this),null===(t=this.value)||void 0===t||t.search(e)}}class J extends H{constructor(e,t,n){super(),this.attributes=null,this.name=e,this.type=t,this.value=n}get astNodeType(){return"override"}search(e){var t;null===(t=this.value)||void 0===t||t.search(e)}}class ee extends H{constructor(e,t,n,r,s){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=r,this.value=s}get astNodeType(){return"let"}search(e){var t;e(this),null===(t=this.value)||void 0===t||t.search(e)}}class te extends H{constructor(e,t,n,r,s){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=r,this.value=s}get astNodeType(){return"const"}constEvaluate(e,t){return this.value.constEvaluate(e,t)}search(e){var t;e(this),null===(t=this.value)||void 0===t||t.search(e)}}var ne,re,se,ie;(e=>{e.increment="++",e.decrement="--"})(ne||(ne={})),(e=>{e.parse=function(t){const n=t;if("parse"==n)throw new Error("Invalid value for IncrementOperator");return e[n]}})(ne||(ne={}));class oe extends H{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(e=>{e.assign="=",e.addAssign="+=",e.subtractAssin="-=",e.multiplyAssign="*=",e.divideAssign="/=",e.moduloAssign="%=",e.andAssign="&=",e.orAssign="|=",e.xorAssign="^=",e.shiftLeftAssign="<<=",e.shiftRightAssign=">>="})(re||(re={})),(e=>{e.parse=function(e){const t=e;if("parse"==t)throw new Error("Invalid value for AssignOperator");return t}})(re||(re={}));class ae extends H{constructor(e,t,n){super(),this.operator=e,this.variable=t,this.value=n}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class ue extends H{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}isBuiltin(){return j.has(this.name)}search(e){for(const t of this.args)t.search(e);e(this)}}class ce extends H{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}}class le extends H{constructor(e,t){super(),this.condition=e,this.cases=t}get astNodeType(){return"switch"}}class he extends H{constructor(e,t,n,r){super(),this.condition=e,this.body=t,this.elseif=n,this.else=r}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class fe extends H{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;null===(t=this.value)||void 0===t||t.search(e)}}class de extends H{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class pe extends H{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class me extends H{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}}class ge extends H{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class ye extends H{constructor(){super()}get astNodeType(){return"discard"}}class _e extends H{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class be extends H{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class ve extends H{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let t=e[0];if("f32"===t.name)return t;for(let n=1;n<e.length;++n){const r=ve._priority.get(t.name);ve._priority.get(e[n].name)<r&&(t=e[n])}return"x32"===t.name?ve.i32:t}getTypeName(){return this.name}}ve.x32=new ve("x32"),ve.f32=new ve("f32"),ve.i32=new ve("i32"),ve.u32=new ve("u32"),ve.f16=new ve("f16"),ve.bool=new ve("bool"),ve.void=new ve("void"),ve._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class xe extends ve{constructor(e){super(e)}}class we extends ve{constructor(e,t,n,r){super(e),this.members=t,this.startLine=n,this.endLine=r}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}search(e){for(const t of this.members)e(t)}}class ke extends ve{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(null!==this.format){if("vec2"===e||"vec3"===e||"vec4"===e||"mat2x2"===e||"mat2x3"===e||"mat2x4"===e||"mat3x2"===e||"mat3x3"===e||"mat3x4"===e||"mat4x2"===e||"mat4x3"===e||"mat4x4"===e){if("f32"===this.format.name)return e+="f",e;if("i32"===this.format.name)return e+="i",e;if("u32"===this.format.name)return e+="u",e;if("bool"===this.format.name)return e+="b",e;if("f16"===this.format.name)return e+="h",e}e+=`<${this.format.name}>`}else if("vec2"===e||"vec3"===e||"vec4"===e)return e;return e}}ke.vec2f=new ke("vec2",ve.f32,null),ke.vec3f=new ke("vec3",ve.f32,null),ke.vec4f=new ke("vec4",ve.f32,null),ke.vec2i=new ke("vec2",ve.i32,null),ke.vec3i=new ke("vec3",ve.i32,null),ke.vec4i=new ke("vec4",ve.i32,null),ke.vec2u=new ke("vec2",ve.u32,null),ke.vec3u=new ke("vec3",ve.u32,null),ke.vec4u=new ke("vec4",ve.u32,null),ke.vec2h=new ke("vec2",ve.f16,null),ke.vec3h=new ke("vec3",ve.f16,null),ke.vec4h=new ke("vec4",ve.f16,null),ke.vec2b=new ke("vec2",ve.bool,null),ke.vec3b=new ke("vec3",ve.bool,null),ke.vec4b=new ke("vec4",ve.bool,null),ke.mat2x2f=new ke("mat2x2",ve.f32,null),ke.mat2x3f=new ke("mat2x3",ve.f32,null),ke.mat2x4f=new ke("mat2x4",ve.f32,null),ke.mat3x2f=new ke("mat3x2",ve.f32,null),ke.mat3x3f=new ke("mat3x3",ve.f32,null),ke.mat3x4f=new ke("mat3x4",ve.f32,null),ke.mat4x2f=new ke("mat4x2",ve.f32,null),ke.mat4x3f=new ke("mat4x3",ve.f32,null),ke.mat4x4f=new ke("mat4x4",ve.f32,null),ke.mat2x2h=new ke("mat2x2",ve.f16,null),ke.mat2x3h=new ke("mat2x3",ve.f16,null),ke.mat2x4h=new ke("mat2x4",ve.f16,null),ke.mat3x2h=new ke("mat3x2",ve.f16,null),ke.mat3x3h=new ke("mat3x3",ve.f16,null),ke.mat3x4h=new ke("mat3x4",ve.f16,null),ke.mat4x2h=new ke("mat4x2",ve.f16,null),ke.mat4x3h=new ke("mat4x3",ve.f16,null),ke.mat4x4h=new ke("mat4x4",ve.f16,null),ke.mat2x2i=new ke("mat2x2",ve.i32,null),ke.mat2x3i=new ke("mat2x3",ve.i32,null),ke.mat2x4i=new ke("mat2x4",ve.i32,null),ke.mat3x2i=new ke("mat3x2",ve.i32,null),ke.mat3x3i=new ke("mat3x3",ve.i32,null),ke.mat3x4i=new ke("mat3x4",ve.i32,null),ke.mat4x2i=new ke("mat4x2",ve.i32,null),ke.mat4x3i=new ke("mat4x3",ve.i32,null),ke.mat4x4i=new ke("mat4x4",ve.i32,null),ke.mat2x2u=new ke("mat2x2",ve.u32,null),ke.mat2x3u=new ke("mat2x3",ve.u32,null),ke.mat2x4u=new ke("mat2x4",ve.u32,null),ke.mat3x2u=new ke("mat3x2",ve.u32,null),ke.mat3x3u=new ke("mat3x3",ve.u32,null),ke.mat3x4u=new ke("mat3x4",ve.u32,null),ke.mat4x2u=new ke("mat4x2",ve.u32,null),ke.mat4x3u=new ke("mat4x3",ve.u32,null),ke.mat4x4u=new ke("mat4x4",ve.u32,null);class Ie extends ve{constructor(e,t,n,r){super(e),this.storage=t,this.type=n,this.access=r}get astNodeType(){return"pointer"}}class Te extends ve{constructor(e,t,n,r){super(e),this.attributes=t,this.format=n,this.count=r}get astNodeType(){return"array"}get isArray(){return!0}}class Ee extends ve{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"sampler"}}class Ae extends W{constructor(){super(),this.postfix=null}}class Se extends Ae{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class Le extends Ae{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const t of this.args)t.search(e)}constEvaluate(e,t){return t&&(t[0]=this.type),e.evalExpression(this,e.context)}}class Oe extends Ae{constructor(e,t){super(),this.cachedReturnValue=null,this.name=e,this.args=t}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return j.has(this.name)}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){for(const t of this.args)t.search(e);e(this)}}class $e extends Ae{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,t){return e.evalExpression(this,e.context)}}class Me extends Ae{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}constEvaluate(e,t){if(this.initializer){const t=e.evalExpression(this.initializer,e.context);return null!==t&&this.postfix?t.getSubData(e,this.postfix,e.context):t}return null}search(e){this.initializer.search(e)}}class Ce extends Ae{constructor(e,t){super(),this.value=e,this.type=t}get astNodeType(){return"literalExpr"}constEvaluate(e,t){return void 0!==t&&(t[0]=this.type),this.value}get isScalar(){return this.value instanceof Ze}get isVector(){return this.value instanceof Qe||this.value instanceof Je}get scalarValue(){return this.value instanceof Ze?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof Qe||this.value instanceof Je?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class Ne extends Ae{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class De extends Ae{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class Be extends Ae{constructor(){super()}}class Pe extends Be{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class Fe extends Be{constructor(e,t,n){super(),this.operator=e,this.left=t,this.right=n}get astNodeType(){return"binaryOp"}_getPromotedType(e,t){return e.name===t.name?e:"f32"===e.name||"f32"===t.name?ve.f32:"u32"===e.name||"u32"===t.name?ve.u32:ve.i32}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class Ue extends W{constructor(e){super(),this.body=e}}class Re extends Ae{constructor(){super()}get astNodeType(){return"default"}}class Ve extends Ue{constructor(e,t){super(t),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class We extends Ue{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class ze extends W{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"argument"}}class qe extends W{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class je extends W{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"member"}}class He extends W{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}}class Ge{constructor(e,t){this.parent=null,this.typeInfo=e,this.parent=t,this.id=Ge._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,t,n,r){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,t,n){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.name}>`}}Ge._id=0;class Xe extends Ge{constructor(){super(new b("void",null),null)}toString(){return"void"}}Xe.void=new Xe;class Ye extends Ge{constructor(e){super(new b("pointer",null),null),this.reference=e}clone(){return this}setDataValue(e,t,n,r){this.reference.setDataValue(e,t,n,r)}getSubData(e,t,n){return t?this.reference.getSubData(e,t,n):this}}class Ze extends Ge{constructor(e,t,n=null){super(t,n),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:"x32"===this.typeInfo.name?e-Math.floor(e)!=0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):"i32"===this.typeInfo.name||"bool"===this.typeInfo.name?this.data=new Int32Array([e]):"u32"===this.typeInfo.name?this.data=new Uint32Array([e]):"f32"===this.typeInfo.name||"f16"===this.typeInfo.name?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",t)}clone(){if(this.data instanceof Float32Array)return new Ze(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new Ze(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new Ze(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,t,n,r){if(n)return void console.error("SetDataValue: Scalar data does not support postfix",n);if(!(t instanceof Ze))return void console.error("SetDataValue: Invalid value",t);let s=t.data[0];"i32"===this.typeInfo.name||"u32"===this.typeInfo.name?s=Math.floor(s):"bool"===this.typeInfo.name&&(s=s?1:0),this.data[0]=s}getSubData(e,t,n){return t?(console.error("getSubData: Scalar data does not support postfix",t),null):this}toString(){return`${this.value}`}}function Ke(e,t,n){const r=t.length;return 2===r?"f32"===n?new Qe(new Float32Array(t),e.getTypeInfo("vec2f")):"i32"===n||"bool"===n?new Qe(new Int32Array(t),e.getTypeInfo("vec2i")):"u32"===n?new Qe(new Uint32Array(t),e.getTypeInfo("vec2u")):"f16"===n?new Qe(new Float32Array(t),e.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${n}`),null):3===r?"f32"===n?new Qe(new Float32Array(t),e.getTypeInfo("vec3f")):"i32"===n||"bool"===n?new Qe(new Int32Array(t),e.getTypeInfo("vec3i")):"u32"===n?new Qe(new Uint32Array(t),e.getTypeInfo("vec3u")):"f16"===n?new Qe(new Float32Array(t),e.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${n}`),null):4===r?"f32"===n?new Qe(new Float32Array(t),e.getTypeInfo("vec4f")):"i32"===n||"bool"===n?new Qe(new Int32Array(t),e.getTypeInfo("vec4i")):"u32"===n?new Qe(new Uint32Array(t),e.getTypeInfo("vec4u")):"f16"===n?new Qe(new Float32Array(t),e.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${n}`),null):(console.error(`getSubData: Invalid vector size ${t.length}`),null)}class Qe extends Ge{constructor(e,t,n=null){if(super(t,n),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const t=this.typeInfo.name;"vec2f"===t||"vec3f"===t||"vec4f"===t?this.data=new Float32Array(e):"vec2i"===t||"vec3i"===t||"vec4i"===t?this.data=new Int32Array(e):"vec2u"===t||"vec3u"===t||"vec4u"===t?this.data=new Uint32Array(e):"vec2h"===t||"vec3h"===t||"vec4h"===t?this.data=new Float32Array(e):"vec2b"===t||"vec3b"===t||"vec4b"===t?this.data=new Int32Array(e):"vec2"===t||"vec3"===t||"vec4"===t?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${t}`)}}clone(){if(this.data instanceof Float32Array)return new Qe(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new Qe(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new Qe(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,t,n,r){n instanceof Se?console.error("TODO: Set vector postfix"):t instanceof Qe?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,n){if(null===t)return this;let r=e.getTypeInfo("f32");if(this.typeInfo instanceof k)r=this.typeInfo.format||r;else{const t=this.typeInfo.name;"vec2f"===t||"vec3f"===t||"vec4f"===t?r=e.getTypeInfo("f32"):"vec2i"===t||"vec3i"===t||"vec4i"===t?r=e.getTypeInfo("i32"):"vec2b"===t||"vec3b"===t||"vec4b"===t?r=e.getTypeInfo("bool"):"vec2u"===t||"vec3u"===t||"vec4u"===t?r=e.getTypeInfo("u32"):"vec2h"===t||"vec3h"===t||"vec4h"===t?r=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${t}`)}let s=this;for(;null!==t&&null!==s;){if(t instanceof De){const i=t.index;let o=-1;if(i instanceof Ce){if(!(i.value instanceof Ze))return console.error(`GetSubData: Invalid array index ${i.value}`),null;o=i.value.value}else{const t=e.evalExpression(i,n);if(!(t instanceof Ze))return console.error("GetSubData: Unknown index type",i),null;o=t.value}if(o<0||o>=s.data.length)return console.error("GetSubData: Index out of range",o),null;if(s.data instanceof Float32Array){const e=new Float32Array(s.data.buffer,s.data.byteOffset+4*o,1);return new Ze(e,r)}if(s.data instanceof Int32Array){const e=new Int32Array(s.data.buffer,s.data.byteOffset+4*o,1);return new Ze(e,r)}if(s.data instanceof Uint32Array){const e=new Uint32Array(s.data.buffer,s.data.byteOffset+4*o,1);return new Ze(e,r)}throw"GetSubData: Invalid data type"}if(!(t instanceof Se))return console.error("GetSubData: Unknown postfix",t),null;{const n=t.value.toLowerCase();if(1===n.length){let e=0;if("x"===n||"r"===n)e=0;else if("y"===n||"g"===n)e=1;else if("z"===n||"b"===n)e=2;else{if("w"!==n&&"a"!==n)return console.error(`GetSubData: Unknown member ${n}`),null;e=3}if(this.data instanceof Float32Array){let t=new Float32Array(this.data.buffer,this.data.byteOffset+4*e,1);return new Ze(t,r,this)}if(this.data instanceof Int32Array){let t=new Int32Array(this.data.buffer,this.data.byteOffset+4*e,1);return new Ze(t,r,this)}if(this.data instanceof Uint32Array){let t=new Uint32Array(this.data.buffer,this.data.byteOffset+4*e,1);return new Ze(t,r,this)}}const i=[];for(const e of n)"x"===e||"r"===e?i.push(this.data[0]):"y"===e||"g"===e?i.push(this.data[1]):"z"===e||"b"===e?i.push(this.data[2]):"w"===e||"a"===e?i.push(this.data[3]):console.error(`GetDataValue: Unknown member ${e}`);s=Ke(e,i,r.name)}t=t.postfix}return s}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class Je extends Ge{constructor(e,t,n=null){super(t,n),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new Je(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,t,n,r){n instanceof Se?console.error("TODO: Set matrix postfix"):t instanceof Je?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,n){if(null===t)return this;const r=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof k)this.typeInfo.format;else if(r.endsWith("f"))e.getTypeInfo("f32");else if(r.endsWith("i"))e.getTypeInfo("i32");else if(r.endsWith("u"))e.getTypeInfo("u32");else{if(!r.endsWith("h"))return console.error(`GetDataValue: Unknown type ${r}`),null;e.getTypeInfo("f16")}if(t instanceof De){const s=t.index;let i=-1;if(s instanceof Ce){if(!(s.value instanceof Ze))return console.error(`GetDataValue: Invalid array index ${s.value}`),null;i=s.value.value}else{const t=e.evalExpression(s,n);if(!(t instanceof Ze))return console.error("GetDataValue: Unknown index type",s),null;i=t.value}if(i<0||i>=this.data.length)return console.error("GetDataValue: Index out of range",i),null;const o=r.endsWith("h")?"h":"f";let a;if("mat2x2"===r||"mat2x2f"===r||"mat2x2h"===r||"mat3x2"===r||"mat3x2f"===r||"mat3x2h"===r||"mat4x2"===r||"mat4x2f"===r||"mat4x2h"===r)a=new Qe(new Float32Array(this.data.buffer,this.data.byteOffset+2*i*4,2),e.getTypeInfo(`vec2${o}`));else if("mat2x3"===r||"mat2x3f"===r||"mat2x3h"===r||"mat3x3"===r||"mat3x3f"===r||"mat3x3h"===r||"mat4x3"===r||"mat4x3f"===r||"mat4x3h"===r)a=new Qe(new Float32Array(this.data.buffer,this.data.byteOffset+3*i*4,3),e.getTypeInfo(`vec3${o}`));else{if("mat2x4"!==r&&"mat2x4f"!==r&&"mat2x4h"!==r&&"mat3x4"!==r&&"mat3x4f"!==r&&"mat3x4h"!==r&&"mat4x4"!==r&&"mat4x4f"!==r&&"mat4x4h"!==r)return console.error(`GetDataValue: Unknown type ${r}`),null;a=new Qe(new Float32Array(this.data.buffer,this.data.byteOffset+4*i*4,4),e.getTypeInfo(`vec4${o}`))}return t.postfix?a.getSubData(e,t.postfix,n):a}return console.error("GetDataValue: Invalid postfix",t),null}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class et extends Ge{constructor(e,t,n=0,r=null){super(t,r),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=n}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new et(e.buffer,this.typeInfo,0,null)}setDataValue(e,t,n,r){if(null===t)return void console.log("setDataValue: NULL data.");let s=this.offset,i=this.typeInfo;for(;n;){if(n instanceof De)if(i instanceof w){const t=n.index;if(t instanceof Ce){if(!(t.value instanceof Ze))return void console.error(`SetDataValue: Invalid index type ${t.value}`);s+=t.value.value*i.stride}else{const n=e.evalExpression(t,r);if(!(n instanceof Ze))return void console.error("SetDataValue: Unknown index type",t);s+=n.value*i.stride}i=i.format}else console.error(`SetDataValue: Type ${i.getTypeName()} is not an array`);else{if(!(n instanceof Se))return void console.error("SetDataValue: Unknown postfix type",n);{const e=n.value;if(i instanceof x){let t=!1;for(const n of i.members)if(n.name===e){s+=n.offset,i=n.type,t=!0;break}if(!t)return void console.error(`SetDataValue: Member ${e} not found`)}else if(i instanceof b){const n=i.getTypeName();let r=0;if("x"===e||"r"===e)r=0;else if("y"===e||"g"===e)r=1;else if("z"===e||"b"===e)r=2;else{if("w"!==e&&"a"!==e)return void console.error(`SetDataValue: Unknown member ${e}`);r=3}if(!(t instanceof Ze))return void console.error("SetDataValue: Invalid value",t);const o=t.value;return"vec2f"===n?void(new Float32Array(this.buffer,s,2)[r]=o):"vec3f"===n?void(new Float32Array(this.buffer,s,3)[r]=o):"vec4f"===n?void(new Float32Array(this.buffer,s,4)[r]=o):"vec2i"===n?void(new Int32Array(this.buffer,s,2)[r]=o):"vec3i"===n?void(new Int32Array(this.buffer,s,3)[r]=o):"vec4i"===n?void(new Int32Array(this.buffer,s,4)[r]=o):"vec2u"===n?void(new Uint32Array(this.buffer,s,2)[r]=o):"vec3u"===n?void(new Uint32Array(this.buffer,s,3)[r]=o):"vec4u"===n?void(new Uint32Array(this.buffer,s,4)[r]=o):void console.error(`SetDataValue: Type ${n} is not a struct`)}}}n=n.postfix}this.setData(e,t,i,s,r)}setData(e,t,n,r,s){const i=n.getTypeName();if("f32"!==i&&"f16"!==i)if("i32"!==i&&"atomic<i32>"!==i&&"x32"!==i)if("u32"!==i&&"atomic<u32>"!==i)if("bool"!==i)if("vec2f"!==i&&"vec2h"!==i)if("vec3f"!==i&&"vec3h"!==i)if("vec4f"!==i&&"vec4h"!==i)if("vec2i"!==i)if("vec3i"!==i)if("vec4i"!==i)if("vec2u"!==i)if("vec3u"!==i)if("vec4u"!==i)if("vec2b"!==i)if("vec3b"!==i)if("vec4b"!==i)if("mat2x2f"!==i&&"mat2x2h"!==i)if("mat2x3f"!==i&&"mat2x3h"!==i)if("mat2x4f"!==i&&"mat2x4h"!==i)if("mat3x2f"!==i&&"mat3x2h"!==i)if("mat3x3f"!==i&&"mat3x3h"!==i)if("mat3x4f"!==i&&"mat3x4h"!==i)if("mat4x2f"!==i&&"mat4x2h"!==i)if("mat4x3f"!==i&&"mat4x3h"!==i)if("mat4x4f"!==i&&"mat4x4h"!==i)if(t instanceof et){if(n===t.typeInfo)return void new Uint8Array(this.buffer,r,t.buffer.byteLength).set(new Uint8Array(t.buffer));console.error("SetDataValue: Type mismatch",i,t.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${i}`);else{const e=new Float32Array(this.buffer,r,16);t instanceof Je?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8],e[9]=t.data[9],e[10]=t.data[10],e[11]=t.data[11],e[12]=t.data[12],e[13]=t.data[13],e[14]=t.data[14],e[15]=t.data[15]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15])}else{const e=new Float32Array(this.buffer,r,12);t instanceof Je?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8],e[9]=t.data[9],e[10]=t.data[10],e[11]=t.data[11]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11])}else{const e=new Float32Array(this.buffer,r,8);t instanceof Je?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7])}else{const e=new Float32Array(this.buffer,r,12);t instanceof Je?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8],e[9]=t.data[9],e[10]=t.data[10],e[11]=t.data[11]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11])}else{const e=new Float32Array(this.buffer,r,9);t instanceof Je?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8])}else{const e=new Float32Array(this.buffer,r,6);t instanceof Je?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5])}else{const e=new Float32Array(this.buffer,r,8);t instanceof Je?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7])}else{const e=new Float32Array(this.buffer,r,6);t instanceof Je?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5])}else{const e=new Float32Array(this.buffer,r,4);t instanceof Je?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3])}else{const e=new Uint32Array(this.buffer,r,4);t instanceof Qe?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3])}else{const e=new Uint32Array(this.buffer,r,3);t instanceof Qe?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2])}else{const e=new Uint32Array(this.buffer,r,2);t instanceof Qe?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1])}else{const e=new Uint32Array(this.buffer,r,4);t instanceof Qe?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3])}else{const e=new Uint32Array(this.buffer,r,3);t instanceof Qe?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2])}else{const e=new Uint32Array(this.buffer,r,2);t instanceof Qe?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1])}else{const e=new Int32Array(this.buffer,r,4);t instanceof Qe?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3])}else{const e=new Int32Array(this.buffer,r,3);t instanceof Qe?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2])}else{const e=new Int32Array(this.buffer,r,2);t instanceof Qe?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1])}else{const e=new Float32Array(this.buffer,r,4);t instanceof Qe?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3])}else{const e=new Float32Array(this.buffer,r,3);t instanceof Qe?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2])}else{const e=new Float32Array(this.buffer,r,2);t instanceof Qe?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1])}else t instanceof Ze&&(new Int32Array(this.buffer,r,1)[0]=t.value);else t instanceof Ze&&(new Uint32Array(this.buffer,r,1)[0]=t.value);else t instanceof Ze&&(new Int32Array(this.buffer,r,1)[0]=t.value);else t instanceof Ze&&(new Float32Array(this.buffer,r,1)[0]=t.value)}getSubData(e,t,n){var r,s,i;if(null===t)return this;let o=this.offset,a=this.typeInfo;for(;t;){if(t instanceof De){const r=t.index,s=e.evalExpression(r,n);let i=0;if(s instanceof Ze?i=s.value:console.error("GetDataValue: Invalid index type",r),a instanceof w)o+=i*a.stride,a=a.format;else{const t=a.getTypeName();"mat4x4"===t||"mat4x4f"===t||"mat4x4h"===t?(o+=16*i,a=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${a.getTypeName()} is not an array`)}}else{if(!(t instanceof Se))return console.error("GetDataValue: Unknown postfix type",t),null;{const n=t.value;if(a instanceof x){let e=!1;for(const t of a.members)if(t.name===n){o+=t.offset,a=t.type,e=!0;break}if(!e)return console.error(`GetDataValue: Member ${n} not found`),null}else if(a instanceof b){const t=a.getTypeName();if("vec2f"===t||"vec3f"===t||"vec4f"===t||"vec2i"===t||"vec3i"===t||"vec4i"===t||"vec2u"===t||"vec3u"===t||"vec4u"===t||"vec2b"===t||"vec3b"===t||"vec4b"===t||"vec2h"===t||"vec3h"===t||"vec4h"===t||"vec2"===t||"vec3"===t||"vec4"===t){if(n.length>0&&n.length<5){let r="f";const s=[];for(let i=0;i<n.length;++i){const a=n[i].toLowerCase();let u=0;if("x"===a||"r"===a)u=0;else if("y"===a||"g"===a)u=1;else if("z"===a||"b"===a)u=2;else{if("w"!==a&&"a"!==a)return console.error(`Unknown member ${n}`),null;u=3}if(1===n.length){if(t.endsWith("f"))return this.buffer.byteLength<o+4*u+4?(console.log("Insufficient buffer data"),null):new Ze(new Float32Array(this.buffer,o+4*u,1),e.getTypeInfo("f32"),this);if(t.endsWith("h"))return new Ze(new Float32Array(this.buffer,o+4*u,1),e.getTypeInfo("f16"),this);if(t.endsWith("i"))return new Ze(new Int32Array(this.buffer,o+4*u,1),e.getTypeInfo("i32"),this);if(t.endsWith("b"))return new Ze(new Int32Array(this.buffer,o+4*u,1),e.getTypeInfo("bool"),this);if(t.endsWith("u"))return new Ze(new Uint32Array(this.buffer,o+4*u,1),e.getTypeInfo("i32"),this)}if("vec2f"===t)s.push(new Float32Array(this.buffer,o,2)[u]);else if("vec3f"===t){if(o+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const e=new Float32Array(this.buffer,o,3);s.push(e[u])}else if("vec4f"===t)s.push(new Float32Array(this.buffer,o,4)[u]);else if("vec2i"===t)r="i",s.push(new Int32Array(this.buffer,o,2)[u]);else if("vec3i"===t)r="i",s.push(new Int32Array(this.buffer,o,3)[u]);else if("vec4i"===t)r="i",s.push(new Int32Array(this.buffer,o,4)[u]);else if("vec2u"===t){r="u";const e=new Uint32Array(this.buffer,o,2);s.push(e[u])}else"vec3u"===t?(r="u",s.push(new Uint32Array(this.buffer,o,3)[u])):"vec4u"===t&&(r="u",s.push(new Uint32Array(this.buffer,o,4)[u]))}return 2===s.length?a=e.getTypeInfo(`vec2${r}`):3===s.length?a=e.getTypeInfo(`vec3${r}`):4===s.length?a=e.getTypeInfo(`vec4${r}`):console.error(`GetDataValue: Invalid vector length ${s.length}`),new Qe(s,a,null)}return console.error(`GetDataValue: Unknown member ${n}`),null}return console.error(`GetDataValue: Type ${t} is not a struct`),null}}}t=t.postfix}const u=a.getTypeName();return"f32"===u?new Ze(new Float32Array(this.buffer,o,1),a,this):"i32"===u?new Ze(new Int32Array(this.buffer,o,1),a,this):"u32"===u?new Ze(new Uint32Array(this.buffer,o,1),a,this):"vec2f"===u?new Qe(new Float32Array(this.buffer,o,2),a,this):"vec3f"===u?new Qe(new Float32Array(this.buffer,o,3),a,this):"vec4f"===u?new Qe(new Float32Array(this.buffer,o,4),a,this):"vec2i"===u?new Qe(new Int32Array(this.buffer,o,2),a,this):"vec3i"===u?new Qe(new Int32Array(this.buffer,o,3),a,this):"vec4i"===u?new Qe(new Int32Array(this.buffer,o,4),a,this):"vec2u"===u?new Qe(new Uint32Array(this.buffer,o,2),a,this):"vec3u"===u?new Qe(new Uint32Array(this.buffer,o,3),a,this):"vec4u"===u?new Qe(new Uint32Array(this.buffer,o,4),a,this):a instanceof k&&"atomic"===a.name?"u32"===(null===(r=a.format)||void 0===r?void 0:r.name)?new Ze(new Uint32Array(this.buffer,o,1)[0],a.format,this):"i32"===(null===(s=a.format)||void 0===s?void 0:s.name)?new Ze(new Int32Array(this.buffer,o,1)[0],a.format,this):(console.error(`GetDataValue: Invalid atomic format ${null===(i=a.format)||void 0===i?void 0:i.name}`),null):new et(this.buffer,a,o,this)}toString(){let e="";if(this.typeInfo instanceof w)if("f32"===this.typeInfo.format.name){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if("i32"===this.typeInfo.format.name){const t=new Int32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if("u32"===this.typeInfo.format.name){const t=new Uint32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if("vec2f"===this.typeInfo.format.name){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}]`;for(let n=1;n<t.length/2;++n)e+=`, [${t[2*n]}, ${t[2*n+1]}]`}else if("vec3f"===this.typeInfo.format.name){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}]`;for(let n=4;n<t.length;n+=4)e+=`, [${t[n]}, ${t[n+1]}, ${t[n+2]}]`}else if("vec4f"===this.typeInfo.format.name){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`;for(let n=4;n<t.length;n+=4)e+=`, [${t[n]}, ${t[n+1]}, ${t[n+2]}, ${t[n+3]}]`}else e="[...]";else this.typeInfo instanceof x?e+="{...}":e="[...]";return e}}class tt extends Ge{constructor(e,t,n,r){super(t,null),this.data=e,this.descriptor=n,this.view=r}clone(){return new tt(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,t;const n=this.descriptor.size;return n instanceof Array&&n.length>0?null!==(e=n[0])&&void 0!==e?e:0:n instanceof Object&&null!==(t=n.width)&&void 0!==t?t:0}get height(){var e,t;const n=this.descriptor.size;return n instanceof Array&&n.length>1?null!==(e=n[1])&&void 0!==e?e:0:n instanceof Object&&null!==(t=n.height)&&void 0!==t?t:0}get depthOrArrayLayers(){var e,t;const n=this.descriptor.size;return n instanceof Array&&n.length>2?null!==(e=n[2])&&void 0!==e?e:0:n instanceof Object&&null!==(t=n.depthOrArrayLayers)&&void 0!==t?t:0}get format(){var e;return this.descriptor&&null!==(e=this.descriptor.format)&&void 0!==e?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&null!==(e=this.descriptor.sampleCount)&&void 0!==e?e:1}get mipLevelCount(){var e;return this.descriptor&&null!==(e=this.descriptor.mipLevelCount)&&void 0!==e?e:1}get dimension(){var e;return this.descriptor&&null!==(e=this.descriptor.dimension)&&void 0!==e?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const t=[this.width,this.height,this.depthOrArrayLayers];for(let n=0;n<t.length;++n)t[n]=Math.max(1,t[n]>>e);return t}get texelByteSize(){const e=this.format,t=V[e];return t?t.isDepthStencil?4:t.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,t=V[e];return!!t&&t.isDepthStencil}getGpuSize(){const e=this.format,t=V[e],n=this.width;if(!e||n<=0||!t)return-1;const r=this.height,s=this.depthOrArrayLayers,i=this.dimension;return n/t.blockWidth*("1d"===i?1:r/t.blockHeight)*t.bytesPerBlock*s}getPixel(e,t,n=0,r=0){const s=this.texelByteSize,i=this.bytesPerRow,o=this.height,a=this.data[r];return function(e,t,n,r,s,i,o,a,u){const c=r*(o>>=s)*(i>>=s)+n*o+t*a;switch(u){case"r8unorm":return[U(e,c,"8unorm",1)[0]];case"r8snorm":return[U(e,c,"8snorm",1)[0]];case"r8uint":return[U(e,c,"8uint",1)[0]];case"r8sint":return[U(e,c,"8sint",1)[0]];case"rg8unorm":{const t=U(e,c,"8unorm",2);return[t[0],t[1]]}case"rg8snorm":{const t=U(e,c,"8snorm",2);return[t[0],t[1]]}case"rg8uint":{const t=U(e,c,"8uint",2);return[t[0],t[1]]}case"rg8sint":{const t=U(e,c,"8sint",2);return[t[0],t[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const t=U(e,c,"8unorm",4);return[t[0],t[1],t[2],t[3]]}case"rgba8snorm":{const t=U(e,c,"8snorm",4);return[t[0],t[1],t[2],t[3]]}case"rgba8uint":{const t=U(e,c,"8uint",4);return[t[0],t[1],t[2],t[3]]}case"rgba8sint":{const t=U(e,c,"8sint",4);return[t[0],t[1],t[2],t[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const t=U(e,c,"8unorm",4);return[t[2],t[1],t[0],t[3]]}case"r16uint":return[U(e,c,"16uint",1)[0]];case"r16sint":return[U(e,c,"16sint",1)[0]];case"r16float":return[U(e,c,"16float",1)[0]];case"rg16uint":{const t=U(e,c,"16uint",2);return[t[0],t[1]]}case"rg16sint":{const t=U(e,c,"16sint",2);return[t[0],t[1]]}case"rg16float":{const t=U(e,c,"16float",2);return[t[0],t[1]]}case"rgba16uint":{const t=U(e,c,"16uint",4);return[t[0],t[1],t[2],t[3]]}case"rgba16sint":{const t=U(e,c,"16sint",4);return[t[0],t[1],t[2],t[3]]}case"rgba16float":{const t=U(e,c,"16float",4);return[t[0],t[1],t[2],t[3]]}case"r32uint":return[U(e,c,"32uint",1)[0]];case"r32sint":return[U(e,c,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[U(e,c,"32float",1)[0]];case"rg32uint":{const t=U(e,c,"32uint",2);return[t[0],t[1]]}case"rg32sint":{const t=U(e,c,"32sint",2);return[t[0],t[1]]}case"rg32float":{const t=U(e,c,"32float",2);return[t[0],t[1]]}case"rgba32uint":{const t=U(e,c,"32uint",4);return[t[0],t[1],t[2],t[3]]}case"rgba32sint":{const t=U(e,c,"32sint",4);return[t[0],t[1],t[2],t[3]]}case"rgba32float":{const t=U(e,c,"32float",4);return[t[0],t[1],t[2],t[3]]}case"rg11b10ufloat":{const t=new Uint32Array(e.buffer,c,1)[0],n=(4192256&t)>>11,r=(4290772992&t)>>22;return[F(2047&t),F(n),function(e){const t=112+(e>>5&31)<<23|(31&e)<<18;return B[0]=t,P[0]}(r),1]}}return null}(new Uint8Array(a),e,t,n,r,o,i,s,this.format)}setPixel(e,t,n,r,s){const i=this.texelByteSize,o=this.bytesPerRow,a=this.height,u=this.data[r];!function(e,t,n,r,s,i,o,a,u,c){const l=r*(o>>=s)*(i>>=s)+n*o+t*a;switch(u){case"r8unorm":return void R(e,l,"8unorm",1,c);case"r8snorm":return void R(e,l,"8snorm",1,c);case"r8uint":return void R(e,l,"8uint",1,c);case"r8sint":return void R(e,l,"8sint",1,c);case"rg8unorm":return void R(e,l,"8unorm",2,c);case"rg8snorm":return void R(e,l,"8snorm",2,c);case"rg8uint":return void R(e,l,"8uint",2,c);case"rg8sint":return void R(e,l,"8sint",2,c);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void R(e,l,"8unorm",4,c);case"rgba8snorm":return void R(e,l,"8snorm",4,c);case"rgba8uint":return void R(e,l,"8uint",4,c);case"rgba8sint":return void R(e,l,"8sint",4,c);case"r16uint":return void R(e,l,"16uint",1,c);case"r16sint":return void R(e,l,"16sint",1,c);case"r16float":return void R(e,l,"16float",1,c);case"rg16uint":return void R(e,l,"16uint",2,c);case"rg16sint":return void R(e,l,"16sint",2,c);case"rg16float":return void R(e,l,"16float",2,c);case"rgba16uint":return void R(e,l,"16uint",4,c);case"rgba16sint":return void R(e,l,"16sint",4,c);case"rgba16float":return void R(e,l,"16float",4,c);case"r32uint":return void R(e,l,"32uint",1,c);case"r32sint":return void R(e,l,"32sint",1,c);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void R(e,l,"32float",1,c);case"rg32uint":return void R(e,l,"32uint",2,c);case"rg32sint":return void R(e,l,"32sint",2,c);case"rg32float":return void R(e,l,"32float",2,c);case"rgba32uint":return void R(e,l,"32uint",4,c);case"rgba32sint":return void R(e,l,"32sint",4,c);case"rgba32float":return void R(e,l,"32float",4,c);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}}(new Uint8Array(u),e,t,n,r,a,o,i,this.format,s)}}(e=>{e[e.token=0]="token",e[e.keyword=1]="keyword",e[e.reserved=2]="reserved"})(ie||(ie={}));class nt{constructor(e,t,n){this.name=e,this.type=t,this.rule=n}toString(){return this.name}}class rt{}se=rt,rt.none=new nt("",ie.reserved,""),rt.eof=new nt("EOF",ie.token,""),rt.reserved={asm:new nt("asm",ie.reserved,"asm"),bf16:new nt("bf16",ie.reserved,"bf16"),do:new nt("do",ie.reserved,"do"),enum:new nt("enum",ie.reserved,"enum"),f16:new nt("f16",ie.reserved,"f16"),f64:new nt("f64",ie.reserved,"f64"),handle:new nt("handle",ie.reserved,"handle"),i8:new nt("i8",ie.reserved,"i8"),i16:new nt("i16",ie.reserved,"i16"),i64:new nt("i64",ie.reserved,"i64"),mat:new nt("mat",ie.reserved,"mat"),premerge:new nt("premerge",ie.reserved,"premerge"),regardless:new nt("regardless",ie.reserved,"regardless"),typedef:new nt("typedef",ie.reserved,"typedef"),u8:new nt("u8",ie.reserved,"u8"),u16:new nt("u16",ie.reserved,"u16"),u64:new nt("u64",ie.reserved,"u64"),unless:new nt("unless",ie.reserved,"unless"),using:new nt("using",ie.reserved,"using"),vec:new nt("vec",ie.reserved,"vec"),void:new nt("void",ie.reserved,"void")},rt.keywords={array:new nt("array",ie.keyword,"array"),atomic:new nt("atomic",ie.keyword,"atomic"),bool:new nt("bool",ie.keyword,"bool"),f32:new nt("f32",ie.keyword,"f32"),i32:new nt("i32",ie.keyword,"i32"),mat2x2:new nt("mat2x2",ie.keyword,"mat2x2"),mat2x3:new nt("mat2x3",ie.keyword,"mat2x3"),mat2x4:new nt("mat2x4",ie.keyword,"mat2x4"),mat3x2:new nt("mat3x2",ie.keyword,"mat3x2"),mat3x3:new nt("mat3x3",ie.keyword,"mat3x3"),mat3x4:new nt("mat3x4",ie.keyword,"mat3x4"),mat4x2:new nt("mat4x2",ie.keyword,"mat4x2"),mat4x3:new nt("mat4x3",ie.keyword,"mat4x3"),mat4x4:new nt("mat4x4",ie.keyword,"mat4x4"),ptr:new nt("ptr",ie.keyword,"ptr"),sampler:new nt("sampler",ie.keyword,"sampler"),sampler_comparison:new nt("sampler_comparison",ie.keyword,"sampler_comparison"),struct:new nt("struct",ie.keyword,"struct"),texture_1d:new nt("texture_1d",ie.keyword,"texture_1d"),texture_2d:new nt("texture_2d",ie.keyword,"texture_2d"),texture_2d_array:new nt("texture_2d_array",ie.keyword,"texture_2d_array"),texture_3d:new nt("texture_3d",ie.keyword,"texture_3d"),texture_cube:new nt("texture_cube",ie.keyword,"texture_cube"),texture_cube_array:new nt("texture_cube_array",ie.keyword,"texture_cube_array"),texture_multisampled_2d:new nt("texture_multisampled_2d",ie.keyword,"texture_multisampled_2d"),texture_storage_1d:new nt("texture_storage_1d",ie.keyword,"texture_storage_1d"),texture_storage_2d:new nt("texture_storage_2d",ie.keyword,"texture_storage_2d"),texture_storage_2d_array:new nt("texture_storage_2d_array",ie.keyword,"texture_storage_2d_array"),texture_storage_3d:new nt("texture_storage_3d",ie.keyword,"texture_storage_3d"),texture_depth_2d:new nt("texture_depth_2d",ie.keyword,"texture_depth_2d"),texture_depth_2d_array:new nt("texture_depth_2d_array",ie.keyword,"texture_depth_2d_array"),texture_depth_cube:new nt("texture_depth_cube",ie.keyword,"texture_depth_cube"),texture_depth_cube_array:new nt("texture_depth_cube_array",ie.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new nt("texture_depth_multisampled_2d",ie.keyword,"texture_depth_multisampled_2d"),texture_external:new nt("texture_external",ie.keyword,"texture_external"),u32:new nt("u32",ie.keyword,"u32"),vec2:new nt("vec2",ie.keyword,"vec2"),vec3:new nt("vec3",ie.keyword,"vec3"),vec4:new nt("vec4",ie.keyword,"vec4"),bitcast:new nt("bitcast",ie.keyword,"bitcast"),block:new nt("block",ie.keyword,"block"),break:new nt("break",ie.keyword,"break"),case:new nt("case",ie.keyword,"case"),continue:new nt("continue",ie.keyword,"continue"),continuing:new nt("continuing",ie.keyword,"continuing"),default:new nt("default",ie.keyword,"default"),diagnostic:new nt("diagnostic",ie.keyword,"diagnostic"),discard:new nt("discard",ie.keyword,"discard"),else:new nt("else",ie.keyword,"else"),enable:new nt("enable",ie.keyword,"enable"),fallthrough:new nt("fallthrough",ie.keyword,"fallthrough"),false:new nt("false",ie.keyword,"false"),fn:new nt("fn",ie.keyword,"fn"),for:new nt("for",ie.keyword,"for"),function:new nt("function",ie.keyword,"function"),if:new nt("if",ie.keyword,"if"),let:new nt("let",ie.keyword,"let"),const:new nt("const",ie.keyword,"const"),loop:new nt("loop",ie.keyword,"loop"),while:new nt("while",ie.keyword,"while"),private:new nt("private",ie.keyword,"private"),read:new nt("read",ie.keyword,"read"),read_write:new nt("read_write",ie.keyword,"read_write"),return:new nt("return",ie.keyword,"return"),requires:new nt("requires",ie.keyword,"requires"),storage:new nt("storage",ie.keyword,"storage"),switch:new nt("switch",ie.keyword,"switch"),true:new nt("true",ie.keyword,"true"),alias:new nt("alias",ie.keyword,"alias"),type:new nt("type",ie.keyword,"type"),uniform:new nt("uniform",ie.keyword,"uniform"),var:new nt("var",ie.keyword,"var"),override:new nt("override",ie.keyword,"override"),workgroup:new nt("workgroup",ie.keyword,"workgroup"),write:new nt("write",ie.keyword,"write"),r8unorm:new nt("r8unorm",ie.keyword,"r8unorm"),r8snorm:new nt("r8snorm",ie.keyword,"r8snorm"),r8uint:new nt("r8uint",ie.keyword,"r8uint"),r8sint:new nt("r8sint",ie.keyword,"r8sint"),r16uint:new nt("r16uint",ie.keyword,"r16uint"),r16sint:new nt("r16sint",ie.keyword,"r16sint"),r16float:new nt("r16float",ie.keyword,"r16float"),rg8unorm:new nt("rg8unorm",ie.keyword,"rg8unorm"),rg8snorm:new nt("rg8snorm",ie.keyword,"rg8snorm"),rg8uint:new nt("rg8uint",ie.keyword,"rg8uint"),rg8sint:new nt("rg8sint",ie.keyword,"rg8sint"),r32uint:new nt("r32uint",ie.keyword,"r32uint"),r32sint:new nt("r32sint",ie.keyword,"r32sint"),r32float:new nt("r32float",ie.keyword,"r32float"),rg16uint:new nt("rg16uint",ie.keyword,"rg16uint"),rg16sint:new nt("rg16sint",ie.keyword,"rg16sint"),rg16float:new nt("rg16float",ie.keyword,"rg16float"),rgba8unorm:new nt("rgba8unorm",ie.keyword,"rgba8unorm"),rgba8unorm_srgb:new nt("rgba8unorm_srgb",ie.keyword,"rgba8unorm_srgb"),rgba8snorm:new nt("rgba8snorm",ie.keyword,"rgba8snorm"),rgba8uint:new nt("rgba8uint",ie.keyword,"rgba8uint"),rgba8sint:new nt("rgba8sint",ie.keyword,"rgba8sint"),bgra8unorm:new nt("bgra8unorm",ie.keyword,"bgra8unorm"),bgra8unorm_srgb:new nt("bgra8unorm_srgb",ie.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new nt("rgb10a2unorm",ie.keyword,"rgb10a2unorm"),rg11b10float:new nt("rg11b10float",ie.keyword,"rg11b10float"),rg32uint:new nt("rg32uint",ie.keyword,"rg32uint"),rg32sint:new nt("rg32sint",ie.keyword,"rg32sint"),rg32float:new nt("rg32float",ie.keyword,"rg32float"),rgba16uint:new nt("rgba16uint",ie.keyword,"rgba16uint"),rgba16sint:new nt("rgba16sint",ie.keyword,"rgba16sint"),rgba16float:new nt("rgba16float",ie.keyword,"rgba16float"),rgba32uint:new nt("rgba32uint",ie.keyword,"rgba32uint"),rgba32sint:new nt("rgba32sint",ie.keyword,"rgba32sint"),rgba32float:new nt("rgba32float",ie.keyword,"rgba32float"),static_assert:new nt("static_assert",ie.keyword,"static_assert")},rt.tokens={decimal_float_literal:new nt("decimal_float_literal",ie.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new nt("hex_float_literal",ie.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new nt("int_literal",ie.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new nt("uint_literal",ie.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new nt("name",ie.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new nt("ident",ie.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new nt("and",ie.token,"&"),and_and:new nt("and_and",ie.token,"&&"),arrow:new nt("arrow ",ie.token,"->"),attr:new nt("attr",ie.token,"@"),forward_slash:new nt("forward_slash",ie.token,"/"),bang:new nt("bang",ie.token,"!"),bracket_left:new nt("bracket_left",ie.token,"["),bracket_right:new nt("bracket_right",ie.token,"]"),brace_left:new nt("brace_left",ie.token,"{"),brace_right:new nt("brace_right",ie.token,"}"),colon:new nt("colon",ie.token,":"),comma:new nt("comma",ie.token,","),equal:new nt("equal",ie.token,"="),equal_equal:new nt("equal_equal",ie.token,"=="),not_equal:new nt("not_equal",ie.token,"!="),greater_than:new nt("greater_than",ie.token,">"),greater_than_equal:new nt("greater_than_equal",ie.token,">="),shift_right:new nt("shift_right",ie.token,">>"),less_than:new nt("less_than",ie.token,"<"),less_than_equal:new nt("less_than_equal",ie.token,"<="),shift_left:new nt("shift_left",ie.token,"<<"),modulo:new nt("modulo",ie.token,"%"),minus:new nt("minus",ie.token,"-"),minus_minus:new nt("minus_minus",ie.token,"--"),period:new nt("period",ie.token,"."),plus:new nt("plus",ie.token,"+"),plus_plus:new nt("plus_plus",ie.token,"++"),or:new nt("or",ie.token,"|"),or_or:new nt("or_or",ie.token,"||"),paren_left:new nt("paren_left",ie.token,"("),paren_right:new nt("paren_right",ie.token,")"),semicolon:new nt("semicolon",ie.token,";"),star:new nt("star",ie.token,"*"),tilde:new nt("tilde",ie.token,"~"),underscore:new nt("underscore",ie.token,"_"),xor:new nt("xor",ie.token,"^"),plus_equal:new nt("plus_equal",ie.token,"+="),minus_equal:new nt("minus_equal",ie.token,"-="),times_equal:new nt("times_equal",ie.token,"*="),division_equal:new nt("division_equal",ie.token,"/="),modulo_equal:new nt("modulo_equal",ie.token,"%="),and_equal:new nt("and_equal",ie.token,"&="),or_equal:new nt("or_equal",ie.token,"|="),xor_equal:new nt("xor_equal",ie.token,"^="),shift_right_equal:new nt("shift_right_equal",ie.token,">>="),shift_left_equal:new nt("shift_left_equal",ie.token,"<<=")},rt.simpleTokens={"@":se.tokens.attr,"{":se.tokens.brace_left,"}":se.tokens.brace_right,":":se.tokens.colon,",":se.tokens.comma,"(":se.tokens.paren_left,")":se.tokens.paren_right,";":se.tokens.semicolon},rt.literalTokens={"&":se.tokens.and,"&&":se.tokens.and_and,"->":se.tokens.arrow,"/":se.tokens.forward_slash,"!":se.tokens.bang,"[":se.tokens.bracket_left,"]":se.tokens.bracket_right,"=":se.tokens.equal,"==":se.tokens.equal_equal,"!=":se.tokens.not_equal,">":se.tokens.greater_than,">=":se.tokens.greater_than_equal,">>":se.tokens.shift_right,"<":se.tokens.less_than,"<=":se.tokens.less_than_equal,"<<":se.tokens.shift_left,"%":se.tokens.modulo,"-":se.tokens.minus,"--":se.tokens.minus_minus,".":se.tokens.period,"+":se.tokens.plus,"++":se.tokens.plus_plus,"|":se.tokens.or,"||":se.tokens.or_or,"*":se.tokens.star,"~":se.tokens.tilde,_:se.tokens.underscore,"^":se.tokens.xor,"+=":se.tokens.plus_equal,"-=":se.tokens.minus_equal,"*=":se.tokens.times_equal,"/=":se.tokens.division_equal,"%=":se.tokens.modulo_equal,"&=":se.tokens.and_equal,"|=":se.tokens.or_equal,"^=":se.tokens.xor_equal,">>=":se.tokens.shift_right_equal,"<<=":se.tokens.shift_left_equal},rt.regexTokens={decimal_float_literal:se.tokens.decimal_float_literal,hex_float_literal:se.tokens.hex_float_literal,int_literal:se.tokens.int_literal,uint_literal:se.tokens.uint_literal,ident:se.tokens.ident},rt.storage_class=[se.keywords.function,se.keywords.private,se.keywords.workgroup,se.keywords.uniform,se.keywords.storage],rt.access_mode=[se.keywords.read,se.keywords.write,se.keywords.read_write],rt.sampler_type=[se.keywords.sampler,se.keywords.sampler_comparison],rt.sampled_texture_type=[se.keywords.texture_1d,se.keywords.texture_2d,se.keywords.texture_2d_array,se.keywords.texture_3d,se.keywords.texture_cube,se.keywords.texture_cube_array],rt.multisampled_texture_type=[se.keywords.texture_multisampled_2d],rt.storage_texture_type=[se.keywords.texture_storage_1d,se.keywords.texture_storage_2d,se.keywords.texture_storage_2d_array,se.keywords.texture_storage_3d],rt.depth_texture_type=[se.keywords.texture_depth_2d,se.keywords.texture_depth_2d_array,se.keywords.texture_depth_cube,se.keywords.texture_depth_cube_array,se.keywords.texture_depth_multisampled_2d],rt.texture_external_type=[se.keywords.texture_external],rt.any_texture_type=[...se.sampled_texture_type,...se.multisampled_texture_type,...se.storage_texture_type,...se.depth_texture_type,...se.texture_external_type],rt.texel_format=[se.keywords.r8unorm,se.keywords.r8snorm,se.keywords.r8uint,se.keywords.r8sint,se.keywords.r16uint,se.keywords.r16sint,se.keywords.r16float,se.keywords.rg8unorm,se.keywords.rg8snorm,se.keywords.rg8uint,se.keywords.rg8sint,se.keywords.r32uint,se.keywords.r32sint,se.keywords.r32float,se.keywords.rg16uint,se.keywords.rg16sint,se.keywords.rg16float,se.keywords.rgba8unorm,se.keywords.rgba8unorm_srgb,se.keywords.rgba8snorm,se.keywords.rgba8uint,se.keywords.rgba8sint,se.keywords.bgra8unorm,se.keywords.bgra8unorm_srgb,se.keywords.rgb10a2unorm,se.keywords.rg11b10float,se.keywords.rg32uint,se.keywords.rg32sint,se.keywords.rg32float,se.keywords.rgba16uint,se.keywords.rgba16sint,se.keywords.rgba16float,se.keywords.rgba32uint,se.keywords.rgba32sint,se.keywords.rgba32float],rt.const_literal=[se.tokens.int_literal,se.tokens.uint_literal,se.tokens.decimal_float_literal,se.tokens.hex_float_literal,se.keywords.true,se.keywords.false],rt.literal_or_ident=[se.tokens.ident,se.tokens.int_literal,se.tokens.uint_literal,se.tokens.decimal_float_literal,se.tokens.hex_float_literal,se.tokens.name],rt.element_count_expression=[se.tokens.int_literal,se.tokens.uint_literal,se.tokens.ident],rt.template_types=[se.keywords.vec2,se.keywords.vec3,se.keywords.vec4,se.keywords.mat2x2,se.keywords.mat2x3,se.keywords.mat2x4,se.keywords.mat3x2,se.keywords.mat3x3,se.keywords.mat3x4,se.keywords.mat4x2,se.keywords.mat4x3,se.keywords.mat4x4,se.keywords.atomic,se.keywords.bitcast,...se.any_texture_type],rt.attribute_name=[se.tokens.ident,se.keywords.block,se.keywords.diagnostic],rt.assignment_operators=[se.tokens.equal,se.tokens.plus_equal,se.tokens.minus_equal,se.tokens.times_equal,se.tokens.division_equal,se.tokens.modulo_equal,se.tokens.and_equal,se.tokens.or_equal,se.tokens.xor_equal,se.tokens.shift_right_equal,se.tokens.shift_left_equal],rt.increment_operators=[se.tokens.plus_plus,se.tokens.minus_minus];class st{constructor(e,t,n,r,s){this.type=e,this.lexeme=t,this.line=n,this.start=r,this.end=s}toString(){return this.lexeme}isTemplateType(){return-1!=rt.template_types.indexOf(this.type)}isArrayType(){return this.type==rt.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class it{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=null!=e?e:""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new st(rt.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if("\n"==e)return this._line++,!0;if(this._isWhitespace(e))return!0;if("/"==e){if("/"==this._peekAhead()){for(;"\n"!=e;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if("*"==this._peekAhead()){this._advance();let t=1;for(;t>0;){if(this._isAtEnd())return!0;if(e=this._advance(),"\n"==e)this._line++;else if("*"==e){if("/"==this._peekAhead()&&(this._advance(),t--,0==t))return!0}else"/"==e&&"*"==this._peekAhead()&&(this._advance(),t++)}return!0}}const t=rt.simpleTokens[e];if(t)return this._addToken(t),!0;let n=rt.none;const r=this._isAlpha(e),s="_"===e;if(this._isAlphaNumeric(e)){let t=this._peekAhead();for(;this._isAlphaNumeric(t);)e+=this._advance(),t=this._peekAhead()}if(r){const t=rt.keywords[e];if(t)return this._addToken(t),!0}if(r||s)return this._addToken(rt.tokens.ident),!0;for(;;){let t=this._findType(e);const r=this._peekAhead();if("-"==e&&this._tokens.length>0){if("="==r)return this._current++,e+=r,this._addToken(rt.tokens.minus_equal),!0;if("-"==r)return this._current++,e+=r,this._addToken(rt.tokens.minus_minus),!0;const n=this._tokens.length-1;if((-1!=rt.literal_or_ident.indexOf(this._tokens[n].type)||this._tokens[n].type==rt.tokens.paren_right)&&">"!=r)return this._addToken(t),!0}if(">"==e&&(">"==r||"="==r)){let e=!1,n=this._tokens.length-1;for(let t=0;t<5&&n>=0&&-1===rt.assignment_operators.indexOf(this._tokens[n].type);++t,--n)if(this._tokens[n].type===rt.tokens.less_than){n>0&&this._tokens[n-1].isArrayOrTemplateType()&&(e=!0);break}if(e)return this._addToken(t),!0}if(t===rt.none){let r=e,s=0;const i=2;for(let e=0;e<i;++e)if(r+=this._peekAhead(e),t=this._findType(r),t!==rt.none){s=e;break}if(t===rt.none)return n!==rt.none&&(this._current--,this._addToken(n),!0);e=r,this._current+=s+1}if(n=t,this._isAtEnd())break;e+=this._advance()}return n!==rt.none&&(this._addToken(n),!0)}_findType(e){for(const t in rt.regexTokens){const n=rt.regexTokens[t];if(this._match(e,n.rule))return n}return rt.literalTokens[e]||rt.none}_match(e,t){const n=t.exec(e);return n&&0==n.index&&n[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&"_"!==e&&"."!==e&&"("!==e&&")"!==e&&"["!==e&&"]"!==e&&"{"!==e&&"}"!==e&&","!==e&&";"!==e&&":"!==e&&"="!==e&&"!"!==e&&"<"!==e&&">"!==e&&"+"!==e&&"-"!==e&&"*"!==e&&"/"!==e&&"%"!==e&&"&"!==e&&"|"!==e&&"^"!==e&&"~"!==e&&"@"!==e&&"#"!==e&&"?"!==e&&"'"!==e&&"`"!==e&&'"'!==e&&"\\"!==e&&"\n"!==e&&"\r"!==e&&"\t"!==e&&"\0"!==e}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||"_"===e}_isWhitespace(e){return" "==e||"\t"==e||"\r"==e}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new st(e,t,this._line,this._start,this._current))}}function ot(e){return Array.isArray(e)||(null==e?void 0:e.buffer)instanceof ArrayBuffer}const at=new Float32Array(1),ut=new Uint32Array(at.buffer),ct=new Uint32Array(at.buffer),lt=new Int32Array(1),ht=new Float32Array(lt.buffer),ft=new Uint32Array(lt.buffer),dt=new Uint32Array(1),pt=new Float32Array(dt.buffer),mt=new Int32Array(dt.buffer);function gt(e,t,n){if(t===n)return e;if("f32"===t){if("i32"===n||"x32"===n)return at[0]=e,ut[0];if("u32"===n)return at[0]=e,ct[0]}else if("i32"===t||"x32"===t){if("f32"===n)return lt[0]=e,ht[0];if("u32"===n)return lt[0]=e,ft[0]}else if("u32"===t){if("f32"===n)return dt[0]=e,pt[0];if("i32"===n||"x32"===n)return dt[0]=e,mt[0]}return console.error(`Unsupported cast from ${t} to ${n}`),e}class yt{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class _t{constructor(e,t){this.align=e,this.size=t}}class bt{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new $,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return"texture_storage_1d"==e.name||"texture_storage_2d"==e.name||"texture_storage_2d_array"==e.name||"texture_storage_3d"==e.name}updateAST(e){for(const t of e)t instanceof G&&this._functions.set(t.name,new yt(t));for(const t of e)if(t instanceof we){const e=this.getTypeInfo(t,null);e instanceof x&&this.structs.push(e)}for(const t of e)if(t instanceof ge)this.aliases.push(this._getAliasInfo(t));else if(t instanceof J){const e=t,n=this._getAttributeNum(e.attributes,"id",0),r=null!=e.type?this.getTypeInfo(e.type,e.attributes):null;this.overrides.push(new S(e.name,r,e.attributes,n))}else if(this._isUniformVar(t)){const e=t,n=this._getAttributeNum(e.attributes,"group",0),r=this._getAttributeNum(e.attributes,"binding",0),s=this.getTypeInfo(e.type,e.attributes),i=new I(e.name,s,n,r,e.attributes,d.Uniform,e.access);i.access||(i.access="read"),this.uniforms.push(i)}else if(this._isStorageVar(t)){const e=t,n=this._getAttributeNum(e.attributes,"group",0),r=this._getAttributeNum(e.attributes,"binding",0),s=this.getTypeInfo(e.type,e.attributes),i=this._isStorageTexture(s),o=new I(e.name,s,n,r,e.attributes,i?d.StorageTexture:d.Storage,e.access);o.access||(o.access="read"),this.storage.push(o)}else if(this._isTextureVar(t)){const e=t,n=this._getAttributeNum(e.attributes,"group",0),r=this._getAttributeNum(e.attributes,"binding",0),s=this.getTypeInfo(e.type,e.attributes),i=this._isStorageTexture(s),o=new I(e.name,s,n,r,e.attributes,i?d.StorageTexture:d.Texture,e.access);o.access||(o.access="read"),i?this.storage.push(o):this.textures.push(o)}else if(this._isSamplerVar(t)){const e=t,n=this._getAttributeNum(e.attributes,"group",0),r=this._getAttributeNum(e.attributes,"binding",0),s=this.getTypeInfo(e.type,e.attributes),i=new I(e.name,s,n,r,e.attributes,d.Sampler,e.access);this.samplers.push(i)}else if(t instanceof G){const e=this._getAttribute(t,"vertex"),n=this._getAttribute(t,"fragment"),r=this._getAttribute(t,"compute"),s=e||n||r,i=new O(t.name,null==s?void 0:s.name,t.attributes);i.attributes=t.attributes,i.startLine=t.startLine,i.endLine=t.endLine,this.functions.push(i),this._functions.get(t.name).info=i,s&&(this._functions.get(t.name).inUse=!0,i.inUse=!0,i.resources=this._findResources(t,!!s),i.inputs=this._getInputs(t.args),i.outputs=this._getOutputs(t.returnType),this.entry[s.name].push(i)),i.arguments=t.args.map((e=>new L(e.name,this.getTypeInfo(e.type,e.attributes),e.attributes))),i.returnType=t.returnType?this.getTypeInfo(t.returnType,t.attributes):null}for(const t of this._functions.values())t.info&&(t.info.inUse=t.inUse,this._addCalls(t.node,t.info.calls));for(const t of this._functions.values())t.node.search((e=>{var n,r,s;if(e instanceof He){if(e.value)if(ot(e.value))for(const i of e.value)for(const e of this.overrides)i===e.name&&(null===(n=t.info)||void 0===n||n.overrides.push(e));else for(const i of this.overrides)e.value===i.name&&(null===(r=t.info)||void 0===r||r.overrides.push(i))}else if(e instanceof $e)for(const i of this.overrides)e.name===i.name&&(null===(s=t.info)||void 0===s||s.overrides.push(i))}));for(const t of this.uniforms)this._markStructsInUse(t.type);for(const t of this.storage)this._markStructsInUse(t.type)}getStructInfo(e){for(const t of this.structs)if(t.name==e)return t;return null}getOverrideInfo(e){for(const t of this.overrides)if(t.name==e)return t;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var n;for(const r of e.calls){const e=null===(n=this._functions.get(r.name))||void 0===n?void 0:n.info;e&&t.add(e)}}findResource(e,t,n){if(n){for(const r of this.entry.compute)if(r.name===n)for(const n of r.resources)if(n.group==e&&n.binding==t)return n;for(const r of this.entry.vertex)if(r.name===n)for(const n of r.resources)if(n.group==e&&n.binding==t)return n;for(const r of this.entry.fragment)if(r.name===n)for(const n of r.resources)if(n.group==e&&n.binding==t)return n}for(const r of this.uniforms)if(r.group==e&&r.binding==t)return r;for(const r of this.storage)if(r.group==e&&r.binding==t)return r;for(const r of this.textures)if(r.group==e&&r.binding==t)return r;for(const r of this.samplers)if(r.group==e&&r.binding==t)return r;return null}_findResource(e){for(const t of this.uniforms)if(t.name==e)return t;for(const t of this.storage)if(t.name==e)return t;for(const t of this.textures)if(t.name==e)return t;for(const t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){const t=this.getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){const n=[],r=this,s=[];return e.search((i=>{if(i instanceof z)s.push({});else if(i instanceof q)s.pop();else if(i instanceof Q){const e=i;t&&null!==e.type&&this._markStructsFromAST(e.type),s.length>0&&(s[s.length-1][e.name]=e)}else if(i instanceof Le){const e=i;t&&null!==e.type&&this._markStructsFromAST(e.type)}else if(i instanceof ee){const e=i;t&&null!==e.type&&this._markStructsFromAST(e.type),s.length>0&&(s[s.length-1][e.name]=e)}else if(i instanceof $e){const e=i;if(s.length>0&&s[s.length-1][e.name])return;const t=r._findResource(e.name);t&&n.push(t)}else if(i instanceof Oe){const s=i,o=r._functions.get(s.name);o&&(t&&(o.inUse=!0),e.calls.add(o.node),null===o.resources&&(o.resources=r._findResources(o.node,t)),n.push(...o.resources))}else if(i instanceof ue){const s=i,o=r._functions.get(s.name);o&&(t&&(o.inUse=!0),e.calls.add(o.node),null===o.resources&&(o.resources=r._findResources(o.node,t)),n.push(...o.resources))}})),[...new Map(n.map((e=>[e.name,e]))).values()]}getBindGroups(){const e=[];function t(t,n){t>=e.length&&(e.length=t+1),void 0===e[t]&&(e[t]=[]),n>=e[t].length&&(e[t].length=n+1)}for(const n of this.uniforms)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.storage)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.textures)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.samplers)t(n.group,n.binding),e[n.group][n.binding]=n;return e}_getOutputs(e,t=void 0){if(void 0===t&&(t=[]),e instanceof we)this._getStructOutputs(e,t);else{const n=this._getOutputInfo(e);null!==n&&t.push(n)}return t}_getStructOutputs(e,t){for(const n of e.members)if(n.type instanceof we)this._getStructOutputs(n.type,t);else{const e=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(null!==e){const r=this.getTypeInfo(n.type,n.type.attributes),s=this._parseInt(e.value),i=new A(n.name,r,e.name,s);t.push(i)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(null!==t){const n=this.getTypeInfo(e,e.attributes),r=this._parseInt(t.value);return new A("",n,t.name,r)}return null}_getInputs(e,t=void 0){void 0===t&&(t=[]);for(const n of e)if(n.type instanceof we)this._getStructInputs(n.type,t);else{const e=this._getInputInfo(n);null!==e&&t.push(e)}return t}_getStructInputs(e,t){for(const n of e.members)if(n.type instanceof we)this._getStructInputs(n.type,t);else{const e=this._getInputInfo(n);null!==e&&t.push(e)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(null!==t){const n=this._getAttribute(e,"interpolation"),r=this.getTypeInfo(e.type,e.attributes),s=this._parseInt(t.value),i=new E(e.name,r,t.name,s);return null!==n&&(i.interpolation=this._parseString(n.value)),i}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new T(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const t of this.structs)if(t.name==e)return t;for(const t of this.aliases)if(t.name==e)return t.type;return null}getTypeInfo(e,t=null){if(this._types.has(e))return this._types.get(e);if(e instanceof Te){const n=e,r=n.format?this.getTypeInfo(n.format,n.attributes):null,s=new w(n.name,t);return s.format=r,s.count=n.count,this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof we){const n=e,r=new x(n.name,t);r.startLine=n.startLine,r.endLine=n.endLine;for(const e of n.members){const t=this.getTypeInfo(e.type,e.attributes);r.members.push(new v(e.name,t,e.attributes))}return this._types.set(e,r),this._updateTypeInfo(r),r}if(e instanceof Ee){const n=e,r=n.format instanceof ve,s=n.format?r?this.getTypeInfo(n.format,null):new b(n.format,null):null,i=new k(n.name,s,t,n.access);return this._types.set(e,i),this._updateTypeInfo(i),i}if(e instanceof ke){const n=e,r=n.format?this.getTypeInfo(n.format,null):null,s=new k(n.name,r,t,n.access);return this._types.set(e,s),this._updateTypeInfo(s),s}const n=new b(e.name,t);return this._types.set(e,n),this._updateTypeInfo(n),n}_updateTypeInfo(e){var t,n,r;const s=this._getTypeSize(e);if(e.size=null!==(t=null==s?void 0:s.size)&&void 0!==t?t:0,e instanceof w&&e.format){const t=this._getTypeSize(e.format);e.stride=Math.max(null!==(n=null==t?void 0:t.size)&&void 0!==n?n:0,null!==(r=null==t?void 0:t.align)&&void 0!==r?r:0),this._updateTypeInfo(e.format)}e instanceof x&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let n=0,r=0,s=0,i=0;for(let o=0,a=e.members.length;o<a;++o){const a=e.members[o],u=this._getTypeSize(a);if(!u)continue;null!==(t=this._getAlias(a.type.name))&&void 0!==t||a.type;const c=u.align,l=u.size;n=this._roundUp(c,n+r),r=l,s=n,i=Math.max(i,c),a.offset=n,a.size=l,this._updateTypeInfo(a.type)}e.size=this._roundUp(i,s+r),e.align=i}_getTypeSize(e){var t,n;if(null==e)return null;const r=this._getAttributeNum(e.attributes,"size",0),s=this._getAttributeNum(e.attributes,"align",0);if(e instanceof v&&(e=e.type),e instanceof b){const t=this._getAlias(e.name);null!==t&&(e=t)}{const n=bt._typeInfo[e.name];if(void 0!==n){const i="f16"===(null===(t=e.format)||void 0===t?void 0:t.name)?2:1;return new _t(Math.max(s,n.align/i),Math.max(r,n.size/i))}}{const t=bt._typeInfo[e.name.substring(0,e.name.length-1)];if(t){const n="h"===e.name[e.name.length-1]?2:1;return new _t(Math.max(s,t.align/n),Math.max(r,t.size/n))}}if(e instanceof w){let t=e,i=8,o=8;const a=this._getTypeSize(t.format);return null!==a&&(o=a.size,i=a.align),o=t.count*this._getAttributeNum(null!==(n=null==e?void 0:e.attributes)&&void 0!==n?n:null,"stride",this._roundUp(i,o)),r&&(o=r),new _t(Math.max(s,i),Math.max(r,o))}if(e instanceof x){let t=0,n=0,i=0,o=0,a=0;for(const r of e.members){const e=this._getTypeSize(r.type);null!==e&&(t=Math.max(e.align,t),i=this._roundUp(e.align,i+o),o=e.size,a=i)}return n=this._roundUp(t,a+o),new _t(Math.max(s,t),Math.max(r,n))}return null}_isUniformVar(e){return e instanceof Q&&"uniform"==e.storage}_isStorageVar(e){return e instanceof Q&&"storage"==e.storage}_isTextureVar(e){return e instanceof Q&&null!==e.type&&-1!=bt._textureTypes.indexOf(e.type.name)}_isSamplerVar(e){return e instanceof Q&&null!==e.type&&-1!=bt._samplerTypes.indexOf(e.type.name)}_getAttribute(e,t){const n=e;if(!n||!n.attributes)return null;const r=n.attributes;for(let s of r)if(s.name==t)return s;return null}_getAttributeNum(e,t,n){if(null===e)return n;for(let r of e)if(r.name==t){let e=null!==r&&null!==r.value?r.value:n;return e instanceof Array&&(e=e[0]),"number"==typeof e?e:"string"==typeof e?parseInt(e):n}return n}_roundUp(e,t){return Math.ceil(t/e)*e}}bt._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},bt._textureTypes=rt.any_texture_type.map((e=>e.name)),bt._samplerTypes=rt.sampler_type.map((e=>e.name));class vt{constructor(e,t,n){this.name=e,this.value=t,this.node=n}clone(){return new vt(this.name,this.value,this.node)}}class xt{constructor(e){this.name=e.name,this.node=e}clone(){return new xt(this.node)}}class wt{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var t;return this.variables.has(e)?null!==(t=this.variables.get(e))&&void 0!==t?t:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var t;return this.functions.has(e)?null!==(t=this.functions.get(e))&&void 0!==t?t:null:this.parent?this.parent.getFunction(e):null}createVariable(e,t,n){this.variables.set(e,new vt(e,t,null!=n?n:null))}setVariable(e,t,n){const r=this.getVariable(e);null!==r?r.value=t:this.createVariable(e,t,n)}getVariableValue(e){var t;const n=this.getVariable(e);return null!==(t=null==n?void 0:n.value)&&void 0!==t?t:null}clone(){return new wt(this)}}class kt{evalExpression(e,t){return null}getTypeInfo(e){return null}getVariableName(e,t){return""}}class It{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,t){const n=this.exec.evalExpression(e.args[0],t);let r=!0;if(n instanceof Qe)return n.data.forEach((e=>{e||(r=!1)})),new Ze(r?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Qe){const e=n.data.some((e=>e));return new Ze(e?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,t){const n=this.exec.evalExpression(e.args[2],t);if(!(n instanceof Ze))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return n.value?this.exec.evalExpression(e.args[1],t):this.exec.evalExpression(e.args[0],t)}ArrayLength(e,t){let n=e.args[0];n instanceof Pe&&(n=n.right);const r=this.exec.evalExpression(n,t);if(r instanceof et&&0===r.typeInfo.size){const e=r.typeInfo,t=r.buffer.byteLength/e.stride;return new Ze(t,this.getTypeInfo("u32"))}return new Ze(r.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Qe)return new Qe(n.data.map((e=>Math.abs(e))),n.typeInfo);const r=n;return new Ze(Math.abs(r.value),r.typeInfo)}Acos(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Qe)return new Qe(n.data.map((e=>Math.acos(e))),n.typeInfo);const r=n;return new Ze(Math.acos(r.value),n.typeInfo)}Acosh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Qe)return new Qe(n.data.map((e=>Math.acosh(e))),n.typeInfo);const r=n;return new Ze(Math.acosh(r.value),n.typeInfo)}Asin(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Qe)return new Qe(n.data.map((e=>Math.asin(e))),n.typeInfo);const r=n;return new Ze(Math.asin(r.value),n.typeInfo)}Asinh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Qe)return new Qe(n.data.map((e=>Math.asinh(e))),n.typeInfo);const r=n;return new Ze(Math.asinh(r.value),n.typeInfo)}Atan(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Qe)return new Qe(n.data.map((e=>Math.atan(e))),n.typeInfo);const r=n;return new Ze(Math.atan(r.value),n.typeInfo)}Atanh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Qe)return new Qe(n.data.map((e=>Math.atanh(e))),n.typeInfo);const r=n;return new Ze(Math.atanh(r.value),n.typeInfo)}Atan2(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(n instanceof Qe&&r instanceof Qe)return new Qe(n.data.map(((e,t)=>Math.atan2(e,r.data[t]))),n.typeInfo);const s=n,i=r;return new Ze(Math.atan2(s.value,i.value),n.typeInfo)}Ceil(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Qe)return new Qe(n.data.map((e=>Math.ceil(e))),n.typeInfo);const r=n;return new Ze(Math.ceil(r.value),n.typeInfo)}_clamp(e,t,n){return Math.min(Math.max(e,t),n)}Clamp(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(n instanceof Qe&&r instanceof Qe&&s instanceof Qe)return new Qe(n.data.map(((e,t)=>this._clamp(e,r.data[t],s.data[t]))),n.typeInfo);const i=n,o=r,a=s;return new Ze(this._clamp(i.value,o.value,a.value),n.typeInfo)}Cos(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Qe)return new Qe(n.data.map((e=>Math.cos(e))),n.typeInfo);const r=n;return new Ze(Math.cos(r.value),n.typeInfo)}Cosh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Qe)return new Qe(n.data.map((e=>Math.cosh(e))),n.typeInfo);const r=n;return new Ze(Math.cos(r.value),n.typeInfo)}CountLeadingZeros(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Qe)return new Qe(n.data.map((e=>Math.clz32(e))),n.typeInfo);const r=n;return new Ze(Math.clz32(r.value),n.typeInfo)}_countOneBits(e){let t=0;for(;0!==e;)1&e&&t++,e>>=1;return t}CountOneBits(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Qe)return new Qe(n.data.map((e=>this._countOneBits(e))),n.typeInfo);const r=n;return new Ze(this._countOneBits(r.value),n.typeInfo)}_countTrailingZeros(e){if(0===e)return 32;let t=0;for(;!(1&e);)e>>=1,t++;return t}CountTrailingZeros(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Qe)return new Qe(n.data.map((e=>this._countTrailingZeros(e))),n.typeInfo);const r=n;return new Ze(this._countTrailingZeros(r.value),n.typeInfo)}Cross(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(n instanceof Qe&&r instanceof Qe){if(3!==n.data.length||3!==r.data.length)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const t=n.data,s=r.data;return new Qe([t[1]*s[2]-s[1]*t[2],t[2]*s[0]-s[2]*t[0],t[0]*s[1]-s[0]*t[1]],n.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,t){const n=this.exec.evalExpression(e.args[0],t),r=180/Math.PI;return n instanceof Qe?new Qe(n.data.map((e=>e*r)),n.typeInfo):new Ze(n.value*r,this.getTypeInfo("f32"))}Determinant(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Je){const e=n.data,t=n.typeInfo.getTypeName(),r=t.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if("mat2x2"===t||"mat2x2f"===t||"mat2x2h"===t)return new Ze(e[0]*e[3]-e[1]*e[2],r);if("mat2x3"===t||"mat2x3f"===t||"mat2x3h"===t)return new Ze(e[0]*(e[4]*e[8]-e[5]*e[7])-e[1]*(e[3]*e[8]-e[5]*e[6])+e[2]*(e[3]*e[7]-e[4]*e[6]),r);if("mat2x4"===t||"mat2x4f"===t||"mat2x4h"===t)console.error(`TODO: Determinant for ${t}`);else if("mat3x2"===t||"mat3x2f"===t||"mat3x2h"===t)console.error(`TODO: Determinant for ${t}`);else{if("mat3x3"===t||"mat3x3f"===t||"mat3x3h"===t)return new Ze(e[0]*(e[4]*e[8]-e[5]*e[7])-e[1]*(e[3]*e[8]-e[5]*e[6])+e[2]*(e[3]*e[7]-e[4]*e[6]),r);"mat3x4"===t||"mat3x4f"===t||"mat3x4h"===t||"mat4x2"===t||"mat4x2f"===t||"mat4x2h"===t||"mat4x3"===t||"mat4x3f"===t||"mat4x3h"===t?console.error(`TODO: Determinant for ${t}`):"mat4x4"!==t&&"mat4x4f"!==t&&"mat4x4h"!==t||console.error(`TODO: Determinant for ${t}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(n instanceof Qe&&r instanceof Qe){let e=0;for(let t=0;t<n.data.length;++t)e+=(n.data[t]-r.data[t])*(n.data[t]-r.data[t]);return new Ze(Math.sqrt(e),this.getTypeInfo("f32"))}const s=n,i=r;return new Ze(Math.abs(s.value-i.value),n.typeInfo)}_dot(e,t){let n=0;for(let r=0;r<e.length;++r)n+=t[r]*e[r];return n}Dot(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);return n instanceof Qe&&r instanceof Qe?new Ze(this._dot(n.data,r.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,t){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,t){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Qe)return new Qe(n.data.map((e=>Math.exp(e))),n.typeInfo);const r=n;return new Ze(Math.exp(r.value),n.typeInfo)}Exp2(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Qe)return new Qe(n.data.map((e=>Math.pow(2,e))),n.typeInfo);const r=n;return new Ze(Math.pow(2,r.value),n.typeInfo)}ExtractBits(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if("u32"!==r.typeInfo.name&&"x32"!==r.typeInfo.name)return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if("u32"!==s.typeInfo.name&&"x32"!==s.typeInfo.name)return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const i=r.value,o=s.value;if(n instanceof Qe)return new Qe(n.data.map((e=>e>>i&(1<<o)-1)),n.typeInfo);if("i32"!==n.typeInfo.name&&"x32"!==n.typeInfo.name)return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const a=n.value;return new Ze(a>>i&(1<<o)-1,this.getTypeInfo("i32"))}FaceForward(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(n instanceof Qe&&r instanceof Qe&&s instanceof Qe){const e=this._dot(r.data,s.data);return new Qe(e<0?Array.from(n.data):n.data.map((e=>-e)),n.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return 0===e?-1:31-Math.clz32(e)}FirstLeadingBit(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Qe)return new Qe(n.data.map((e=>this._firstLeadingBit(e))),n.typeInfo);const r=n;return new Ze(this._firstLeadingBit(r.value),n.typeInfo)}_firstTrailingBit(e){return 0===e?-1:Math.log2(e&-e)}FirstTrailingBit(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Qe)return new Qe(n.data.map((e=>this._firstTrailingBit(e))),n.typeInfo);const r=n;return new Ze(this._firstTrailingBit(r.value),n.typeInfo)}Floor(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Qe)return new Qe(n.data.map((e=>Math.floor(e))),n.typeInfo);const r=n;return new Ze(Math.floor(r.value),n.typeInfo)}Fma(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(n instanceof Qe&&r instanceof Qe&&s instanceof Qe)return n.data.length!==r.data.length||n.data.length!==s.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new Qe(n.data.map(((e,t)=>e*r.data[t]+s.data[t])),n.typeInfo);const i=n,o=r,a=s;return new Ze(i.value*o.value+a.value,i.typeInfo)}Fract(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Qe)return new Qe(n.data.map((e=>e-Math.floor(e))),n.typeInfo);const r=n;return new Ze(r.value-Math.floor(r.value),n.typeInfo)}Frexp(e,t){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t),i=this.exec.evalExpression(e.args[3],t);if("u32"!==s.typeInfo.name&&"x32"!==s.typeInfo.name)return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const o=s.value,a=(1<<i.value)-1<<o,u=~a;if(n instanceof Qe&&r instanceof Qe)return new Qe(n.data.map(((e,t)=>e&u|r.data[t]<<o&a)),n.typeInfo);const c=n.value,l=r.value;return new Ze(c&u|l<<o&a,n.typeInfo)}InverseSqrt(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Qe)return new Qe(n.data.map((e=>1/Math.sqrt(e))),n.typeInfo);const r=n;return new Ze(1/Math.sqrt(r.value),n.typeInfo)}Ldexp(e,t){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Qe){let e=0;return n.data.forEach((t=>{e+=t*t})),new Ze(Math.sqrt(e),this.getTypeInfo("f32"))}const r=n;return new Ze(Math.abs(r.value),n.typeInfo)}Log(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Qe)return new Qe(n.data.map((e=>Math.log(e))),n.typeInfo);const r=n;return new Ze(Math.log(r.value),n.typeInfo)}Log2(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Qe)return new Qe(n.data.map((e=>Math.log2(e))),n.typeInfo);const r=n;return new Ze(Math.log2(r.value),n.typeInfo)}Max(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(n instanceof Qe&&r instanceof Qe)return new Qe(n.data.map(((e,t)=>Math.max(e,r.data[t]))),n.typeInfo);const s=n,i=r;return new Ze(Math.max(s.value,i.value),n.typeInfo)}Min(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(n instanceof Qe&&r instanceof Qe)return new Qe(n.data.map(((e,t)=>Math.min(e,r.data[t]))),n.typeInfo);const s=n,i=r;return new Ze(Math.min(s.value,i.value),n.typeInfo)}Mix(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(n instanceof Qe&&r instanceof Qe&&s instanceof Qe)return new Qe(n.data.map(((e,t)=>n.data[t]*(1-s.data[t])+r.data[t]*s.data[t])),n.typeInfo);const i=r,o=s;return new Ze(n.value*(1-o.value)+i.value*o.value,n.typeInfo)}Modf(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(n instanceof Qe&&r instanceof Qe)return new Qe(n.data.map(((e,t)=>e%r.data[t])),n.typeInfo);const s=r;return new Ze(n.value%s.value,n.typeInfo)}Normalize(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Qe){const r=this.Length(e,t).value;return new Qe(n.data.map((e=>e/r)),n.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(n instanceof Qe&&r instanceof Qe)return new Qe(n.data.map(((e,t)=>Math.pow(e,r.data[t]))),n.typeInfo);const s=n,i=r;return new Ze(Math.pow(s.value,i.value),n.typeInfo)}QuantizeToF16(e,t){const n=this.exec.evalExpression(e.args[0],t);return n instanceof Qe?new Qe(n.data.map((e=>e)),n.typeInfo):new Ze(n.value,n.typeInfo)}Radians(e,t){const n=this.exec.evalExpression(e.args[0],t);return n instanceof Qe?new Qe(n.data.map((e=>e*Math.PI/180)),n.typeInfo):new Ze(n.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,t){let n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(n instanceof Qe&&r instanceof Qe){const e=this._dot(n.data,r.data);return new Qe(n.data.map(((t,n)=>t-2*e*r.data[n])),n.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,t){let n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(n instanceof Qe&&r instanceof Qe&&s instanceof Ze){const e=this._dot(r.data,n.data);return new Qe(n.data.map(((t,n)=>{const i=1-s.value*s.value*(1-e*e);if(i<0)return 0;const o=Math.sqrt(i);return s.value*t-(s.value*e+o)*r.data[n]})),n.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,t){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Qe)return new Qe(n.data.map((e=>Math.round(e))),n.typeInfo);const r=n;return new Ze(Math.round(r.value),n.typeInfo)}Saturate(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Qe)return new Qe(n.data.map((e=>Math.min(Math.max(e,0),1))),n.typeInfo);const r=n;return new Ze(Math.min(Math.max(r.value,0),1),n.typeInfo)}Sign(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Qe)return new Qe(n.data.map((e=>Math.sign(e))),n.typeInfo);const r=n;return new Ze(Math.sign(r.value),n.typeInfo)}Sin(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Qe)return new Qe(n.data.map((e=>Math.sin(e))),n.typeInfo);const r=n;return new Ze(Math.sin(r.value),n.typeInfo)}Sinh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Qe)return new Qe(n.data.map((e=>Math.sinh(e))),n.typeInfo);const r=n;return new Ze(Math.sinh(r.value),n.typeInfo)}_smoothstep(e,t,n){const r=Math.min(Math.max((n-e)/(t-e),0),1);return r*r*(3-2*r)}SmoothStep(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(s instanceof Qe&&n instanceof Qe&&r instanceof Qe)return new Qe(s.data.map(((e,t)=>this._smoothstep(n.data[t],r.data[t],e))),s.typeInfo);const i=n,o=r,a=s;return new Ze(this._smoothstep(i.value,o.value,a.value),s.typeInfo)}Sqrt(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Qe)return new Qe(n.data.map((e=>Math.sqrt(e))),n.typeInfo);const r=n;return new Ze(Math.sqrt(r.value),n.typeInfo)}Step(e,t){const n=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(r instanceof Qe&&n instanceof Qe)return new Qe(r.data.map(((e,t)=>e<n.data[t]?0:1)),r.typeInfo);const s=n;return new Ze(r.value<s.value?0:1,s.typeInfo)}Tan(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Qe)return new Qe(n.data.map((e=>Math.tan(e))),n.typeInfo);const r=n;return new Ze(Math.tan(r.value),n.typeInfo)}Tanh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Qe)return new Qe(n.data.map((e=>Math.tanh(e))),n.typeInfo);const r=n;return new Ze(Math.tanh(r.value),n.typeInfo)}_getTransposeType(e){const t=e.getTypeName();return"mat2x2f"===t||"mat2x2h"===t?e:"mat2x3f"===t?this.getTypeInfo("mat3x2f"):"mat2x3h"===t?this.getTypeInfo("mat3x2h"):"mat2x4f"===t?this.getTypeInfo("mat4x2f"):"mat2x4h"===t?this.getTypeInfo("mat4x2h"):"mat3x2f"===t?this.getTypeInfo("mat2x3f"):"mat3x2h"===t?this.getTypeInfo("mat2x3h"):"mat3x3f"===t||"mat3x3h"===t?e:"mat3x4f"===t?this.getTypeInfo("mat4x3f"):"mat3x4h"===t?this.getTypeInfo("mat4x3h"):"mat4x2f"===t?this.getTypeInfo("mat2x4f"):"mat4x2h"===t?this.getTypeInfo("mat2x4h"):"mat4x3f"===t?this.getTypeInfo("mat3x4f"):"mat4x3h"===t?this.getTypeInfo("mat3x4h"):("mat4x4f"===t||"mat4x4h"===t||console.error(`Invalid matrix type ${t}`),e)}Transpose(e,t){const n=this.exec.evalExpression(e.args[0],t);if(!(n instanceof Je))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const r=this._getTransposeType(n.typeInfo);if("mat2x2"===n.typeInfo.name||"mat2x2f"===n.typeInfo.name||"mat2x2h"===n.typeInfo.name){const e=n.data;return new Je([e[0],e[2],e[1],e[3]],r)}if("mat2x3"===n.typeInfo.name||"mat2x3f"===n.typeInfo.name||"mat2x3h"===n.typeInfo.name){const e=n.data;return new Je([e[0],e[3],e[6],e[1],e[4],e[7]],r)}if("mat2x4"===n.typeInfo.name||"mat2x4f"===n.typeInfo.name||"mat2x4h"===n.typeInfo.name){const e=n.data;return new Je([e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13]],r)}if("mat3x2"===n.typeInfo.name||"mat3x2f"===n.typeInfo.name||"mat3x2h"===n.typeInfo.name){const e=n.data;return new Je([e[0],e[3],e[1],e[4],e[2],e[5]],r)}if("mat3x3"===n.typeInfo.name||"mat3x3f"===n.typeInfo.name||"mat3x3h"===n.typeInfo.name){const e=n.data;return new Je([e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8]],r)}if("mat3x4"===n.typeInfo.name||"mat3x4f"===n.typeInfo.name||"mat3x4h"===n.typeInfo.name){const e=n.data;return new Je([e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14]],r)}if("mat4x2"===n.typeInfo.name||"mat4x2f"===n.typeInfo.name||"mat4x2h"===n.typeInfo.name){const e=n.data;return new Je([e[0],e[4],e[1],e[5],e[2],e[6]],r)}if("mat4x3"===n.typeInfo.name||"mat4x3f"===n.typeInfo.name||"mat4x3h"===n.typeInfo.name){const e=n.data;return new Je([e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]],r)}if("mat4x4"===n.typeInfo.name||"mat4x4f"===n.typeInfo.name||"mat4x4h"===n.typeInfo.name){const e=n.data;return new Je([e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]],r)}return console.error(`Invalid matrix type ${n.typeInfo.name}`),null}Trunc(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof Qe)return new Qe(n.data.map((e=>Math.trunc(e))),n.typeInfo);const r=n;return new Ze(Math.trunc(r.value),n.typeInfo)}Dpdx(e,t){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,t){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,t){return console.error("TODO: dpdxFine"),null}Dpdy(e,t){return console.error("TODO: dpdy"),null}DpdyCoarse(e,t){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,t){return console.error("TODO: dpdyFine"),null}Fwidth(e,t){return console.error("TODO: fwidth"),null}FwidthCoarse(e,t){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,t){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,t){const n=e.args[0],r=e.args.length>1?this.exec.evalExpression(e.args[1],t).value:0;if(n instanceof $e){const s=n.name,i=t.getVariableValue(s);if(i instanceof tt){if(r<0||r>=i.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const t=i.getMipLevelSize(r),n=i.dimension;return"1d"===n?new Ze(t[0],this.getTypeInfo("u32")):"3d"===n?new Qe(t,this.getTypeInfo("vec3u")):"2d"===n?new Qe(t.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${n} not found. Line ${e.line}`),null)}return console.error(`Texture ${s} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,t){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,t){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,t){const n=e.args[0],r=this.exec.evalExpression(e.args[1],t),s=e.args.length>2?this.exec.evalExpression(e.args[2],t).value:0;if(!(r instanceof Qe)||2!==r.data.length)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(n instanceof $e){const i=n.name,o=t.getVariableValue(i);if(o instanceof tt){const t=Math.floor(r.data[0]),n=Math.floor(r.data[1]);if(t<0||t>=o.width||n<0||n>=o.height)return console.error(`Texture ${i} out of bounds. Line ${e.line}`),null;const a=o.getPixel(t,n,0,s);return null===a?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new Qe(a,this.getTypeInfo("vec4f"))}return console.error(`Texture ${i} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,t){const n=e.args[0];if(n instanceof $e){const r=n.name,s=t.getVariableValue(r);return s instanceof tt?new Ze(s.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${r} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,t){const n=e.args[0];if(n instanceof $e){const r=n.name,s=t.getVariableValue(r);return s instanceof tt?new Ze(s.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${r} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,t){const n=e.args[0];if(n instanceof $e){const r=n.name,s=t.getVariableValue(r);return s instanceof tt?new Ze(s.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${r} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,t){return console.error("TODO: textureSample"),null}TextureSampleBias(e,t){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,t){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,t){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,t){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,t){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,t){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,t){const n=e.args[0],r=this.exec.evalExpression(e.args[1],t),s=4===e.args.length?this.exec.evalExpression(e.args[2],t).value:0,i=4===e.args.length?this.exec.evalExpression(e.args[3],t).data:this.exec.evalExpression(e.args[2],t).data;if(4!==i.length)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(r instanceof Qe)||2!==r.data.length)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(n instanceof $e){const o=n.name,a=t.getVariableValue(o);if(a instanceof tt){const t=a.getMipLevelSize(0),n=Math.floor(r.data[0]),u=Math.floor(r.data[1]);return n<0||n>=t[0]||u<0||u>=t[1]?(console.error(`Texture ${o} out of bounds. Line ${e.line}`),null):(a.setPixel(n,u,0,s,Array.from(i)),null)}return console.error(`Texture ${o} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,t){let n=e.args[0];n instanceof Pe&&(n=n.right);const r=this.exec.getVariableName(n,t);return t.getVariable(r).value.getSubData(this.exec,n.postfix,t)}AtomicStore(e,t){let n=e.args[0];n instanceof Pe&&(n=n.right);const r=this.exec.getVariableName(n,t),s=t.getVariable(r);let i=e.args[1];const o=this.exec.evalExpression(i,t),a=s.value.getSubData(this.exec,n.postfix,t);return a instanceof Ze&&o instanceof Ze&&(a.value=o.value),s.value instanceof et&&s.value.setDataValue(this.exec,a,n.postfix,t),null}AtomicAdd(e,t){let n=e.args[0];n instanceof Pe&&(n=n.right);const r=this.exec.getVariableName(n,t),s=t.getVariable(r);let i=e.args[1];const o=this.exec.evalExpression(i,t),a=s.value.getSubData(this.exec,n.postfix,t),u=new Ze(a.value,a.typeInfo);return a instanceof Ze&&o instanceof Ze&&(a.value+=o.value),s.value instanceof et&&s.value.setDataValue(this.exec,a,n.postfix,t),u}AtomicSub(e,t){let n=e.args[0];n instanceof Pe&&(n=n.right);const r=this.exec.getVariableName(n,t),s=t.getVariable(r);let i=e.args[1];const o=this.exec.evalExpression(i,t),a=s.value.getSubData(this.exec,n.postfix,t),u=new Ze(a.value,a.typeInfo);return a instanceof Ze&&o instanceof Ze&&(a.value-=o.value),s.value instanceof et&&s.value.setDataValue(this.exec,a,n.postfix,t),u}AtomicMax(e,t){let n=e.args[0];n instanceof Pe&&(n=n.right);const r=this.exec.getVariableName(n,t),s=t.getVariable(r);let i=e.args[1];const o=this.exec.evalExpression(i,t),a=s.value.getSubData(this.exec,n.postfix,t),u=new Ze(a.value,a.typeInfo);return a instanceof Ze&&o instanceof Ze&&(a.value=Math.max(a.value,o.value)),s.value instanceof et&&s.value.setDataValue(this.exec,a,n.postfix,t),u}AtomicMin(e,t){let n=e.args[0];n instanceof Pe&&(n=n.right);const r=this.exec.getVariableName(n,t),s=t.getVariable(r);let i=e.args[1];const o=this.exec.evalExpression(i,t),a=s.value.getSubData(this.exec,n.postfix,t),u=new Ze(a.value,a.typeInfo);return a instanceof Ze&&o instanceof Ze&&(a.value=Math.min(a.value,o.value)),s.value instanceof et&&s.value.setDataValue(this.exec,a,n.postfix,t),u}AtomicAnd(e,t){let n=e.args[0];n instanceof Pe&&(n=n.right);const r=this.exec.getVariableName(n,t),s=t.getVariable(r);let i=e.args[1];const o=this.exec.evalExpression(i,t),a=s.value.getSubData(this.exec,n.postfix,t),u=new Ze(a.value,a.typeInfo);return a instanceof Ze&&o instanceof Ze&&(a.value=a.value&o.value),s.value instanceof et&&s.value.setDataValue(this.exec,a,n.postfix,t),u}AtomicOr(e,t){let n=e.args[0];n instanceof Pe&&(n=n.right);const r=this.exec.getVariableName(n,t),s=t.getVariable(r);let i=e.args[1];const o=this.exec.evalExpression(i,t),a=s.value.getSubData(this.exec,n.postfix,t),u=new Ze(a.value,a.typeInfo);return a instanceof Ze&&o instanceof Ze&&(a.value=a.value|o.value),s.value instanceof et&&s.value.setDataValue(this.exec,a,n.postfix,t),u}AtomicXor(e,t){let n=e.args[0];n instanceof Pe&&(n=n.right);const r=this.exec.getVariableName(n,t),s=t.getVariable(r);let i=e.args[1];const o=this.exec.evalExpression(i,t),a=s.value.getSubData(this.exec,n.postfix,t),u=new Ze(a.value,a.typeInfo);return a instanceof Ze&&o instanceof Ze&&(a.value=a.value^o.value),s.value instanceof et&&s.value.setDataValue(this.exec,a,n.postfix,t),u}AtomicExchange(e,t){let n=e.args[0];n instanceof Pe&&(n=n.right);const r=this.exec.getVariableName(n,t),s=t.getVariable(r);let i=e.args[1];const o=this.exec.evalExpression(i,t),a=s.value.getSubData(this.exec,n.postfix,t),u=new Ze(a.value,a.typeInfo);return a instanceof Ze&&o instanceof Ze&&(a.value=o.value),s.value instanceof et&&s.value.setDataValue(this.exec,a,n.postfix,t),u}AtomicCompareExchangeWeak(e,t){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,t){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,t){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,t){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,t){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,t){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,t){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,t){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,t){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,t){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,t){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,t){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,t){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,t){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,t){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,t){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,t){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,t){return null}TextureBarrier(e,t){return null}WorkgroupBarrier(e,t){return null}WorkgroupUniformLoad(e,t){return null}SubgroupAdd(e,t){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,t){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,t){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,t){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,t){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,t){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,t){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,t){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,t){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,t){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,t){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,t){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,t){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,t){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,t){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,t){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,t){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,t){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,t){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,t){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,t){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,t){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,t){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,t){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,t){return console.error("TODO: quadSwapY"),null}}const Tt={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},Et={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class At extends kt{constructor(e,t){var n;super(),this.ast=null!=e?e:[],this.reflection=new bt,this.reflection.updateAST(this.ast),this.context=null!==(n=null==t?void 0:t.clone())&&void 0!==n?n:new wt,this.builtins=new It(this),this.typeInfo={bool:this.getTypeInfo(ve.bool),i32:this.getTypeInfo(ve.i32),u32:this.getTypeInfo(ve.u32),f32:this.getTypeInfo(ve.f32),f16:this.getTypeInfo(ve.f16),vec2f:this.getTypeInfo(ke.vec2f),vec2u:this.getTypeInfo(ke.vec2u),vec2i:this.getTypeInfo(ke.vec2i),vec2h:this.getTypeInfo(ke.vec2h),vec3f:this.getTypeInfo(ke.vec3f),vec3u:this.getTypeInfo(ke.vec3u),vec3i:this.getTypeInfo(ke.vec3i),vec3h:this.getTypeInfo(ke.vec3h),vec4f:this.getTypeInfo(ke.vec4f),vec4u:this.getTypeInfo(ke.vec4u),vec4i:this.getTypeInfo(ke.vec4i),vec4h:this.getTypeInfo(ke.vec4h),mat2x2f:this.getTypeInfo(ke.mat2x2f),mat2x3f:this.getTypeInfo(ke.mat2x3f),mat2x4f:this.getTypeInfo(ke.mat2x4f),mat3x2f:this.getTypeInfo(ke.mat3x2f),mat3x3f:this.getTypeInfo(ke.mat3x3f),mat3x4f:this.getTypeInfo(ke.mat3x4f),mat4x2f:this.getTypeInfo(ke.mat4x2f),mat4x3f:this.getTypeInfo(ke.mat4x3f),mat4x4f:this.getTypeInfo(ke.mat4x4f)}}getVariableValue(e){var t,n;const r=null!==(n=null===(t=this.context.getVariable(e))||void 0===t?void 0:t.value)&&void 0!==n?n:null;if(null===r)return null;if(r instanceof Ze)return r.value;if(r instanceof Qe)return Array.from(r.data);if(r instanceof Je)return Array.from(r.data);if(r instanceof et&&r.typeInfo instanceof w){if("u32"===r.typeInfo.format.name)return Array.from(new Uint32Array(r.buffer,r.offset,r.typeInfo.count));if("i32"===r.typeInfo.format.name)return Array.from(new Int32Array(r.buffer,r.offset,r.typeInfo.count));if("f32"===r.typeInfo.format.name)return Array.from(new Float32Array(r.buffer,r.offset,r.typeInfo.count))}return console.error(`Unsupported return variable type ${r.typeInfo.name}`),null}execute(e){(e=null!=e?e:{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,t,n,r){const s=this.context.clone();(r=null!=r?r:{}).constants&&this._setOverrides(r.constants,s),this._execStatements(this.ast,s);const i=s.getFunction(e);if(!i)return void console.error(`Function ${e} not found`);if("number"==typeof t)t=[t,1,1];else{if(0===t.length)return void console.error("Invalid dispatch count");1===t.length?t=[t[0],1,1]:2===t.length?t=[t[0],t[1],1]:t.length>3&&(t=[t[0],t[1],t[2]])}const o=t[0],a=t[1],u=t[2],c=this.getTypeInfo("vec3u");s.setVariable("@num_workgroups",new Qe(t,c));for(const l in n)for(const e in n[l]){const t=n[l][e];s.variables.forEach((n=>{var r;const s=n.node;if(null==s?void 0:s.attributes){let i=null,o=null;for(const e of s.attributes)"binding"===e.name?i=e.value:"group"===e.name&&(o=e.value);if(e==i&&l==o)if(void 0!==t.texture&&void 0!==t.descriptor){const e=new tt(t.texture,this.getTypeInfo(s.type),t.descriptor,null!==(r=t.texture.view)&&void 0!==r?r:null);n.value=e}else void 0!==t.uniform?n.value=new et(t.uniform,this.getTypeInfo(s.type)):n.value=new et(t,this.getTypeInfo(s.type))}}))}for(let l=0;l<u;++l)for(let e=0;e<a;++e)for(let t=0;t<o;++t)s.setVariable("@workgroup_id",new Qe([t,e,l],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(i,[t,e,l],s)}execStatement(e,t){if(e instanceof fe)return this.evalExpression(e.value,t);if(e instanceof _e){if(e.condition){const n=this.evalExpression(e.condition,t);if(!(n instanceof Ze))throw new Error("Invalid break-if condition");if(!n.value)return null}return At._breakObj}if(e instanceof be)return At._continueObj;if(e instanceof ee)this._let(e,t);else if(e instanceof Q)this._var(e,t);else if(e instanceof te)this._const(e,t);else if(e instanceof G)this._function(e,t);else{if(e instanceof he)return this._if(e,t);if(e instanceof le)return this._switch(e,t);if(e instanceof K)return this._for(e,t);if(e instanceof Y)return this._while(e,t);if(e instanceof ce)return this._loop(e,t);if(e instanceof Z){const n=t.clone();return n.currentFunctionName=t.currentFunctionName,this._execStatements(e.body,n)}if(e instanceof ae)this._assign(e,t);else if(e instanceof oe)this._increment(e,t);else{if(e instanceof we)return null;if(e instanceof J){const n=e.name;null===t.getVariable(n)&&t.setVariable(n,new Ze(0,this.getTypeInfo("u32")))}else if(e instanceof ue)this._call(e,t);else{if(e instanceof me)return null;if(e instanceof ge)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,t){return e instanceof Fe?this._evalBinaryOp(e,t):e instanceof Ce?this._evalLiteral(e,t):e instanceof $e?this._evalVariable(e,t):e instanceof Oe?this._evalCall(e,t):e instanceof Le?this._evalCreate(e,t):e instanceof Me?this._evalConst(e,t):e instanceof Ne?this._evalBitcast(e,t):e instanceof Pe?this._evalUnaryOp(e,t):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var t;if(e instanceof ve){const t=this.reflection.getTypeInfo(e);if(null!==t)return t}let n=null!==(t=this.typeInfo[e])&&void 0!==t?t:null;return null!==n||(n=this.reflection.getTypeInfoByName(e)),n}_setOverrides(e,t){for(const n in e){const r=e[n],s=this.reflection.getOverrideInfo(n);null!==s?(null===s.type&&(s.type=this.getTypeInfo("u32")),"u32"===s.type.name||"i32"===s.type.name||"f32"===s.type.name||"f16"===s.type.name?t.setVariable(n,new Ze(r,s.type)):"bool"===s.type.name?t.setVariable(n,new Ze(r?1:0,s.type)):"vec2"===s.type.name||"vec3"===s.type.name||"vec4"===s.type.name||"vec2f"===s.type.name||"vec3f"===s.type.name||"vec4f"===s.type.name||"vec2i"===s.type.name||"vec3i"===s.type.name||"vec4i"===s.type.name||"vec2u"===s.type.name||"vec3u"===s.type.name||"vec4u"===s.type.name||"vec2h"===s.type.name||"vec3h"===s.type.name||"vec4h"===s.type.name?t.setVariable(n,new Qe(r,s.type)):console.error(`Invalid constant type for ${n}`)):console.error(`Override ${n} does not exist in the shader.`)}}_dispatchWorkgroup(e,t,n){const r=[1,1,1];for(const c of e.node.attributes)if("workgroup_size"===c.name){if(c.value.length>0){const e=n.getVariableValue(c.value[0]);r[0]=e instanceof Ze?e.value:parseInt(c.value[0])}if(c.value.length>1){const e=n.getVariableValue(c.value[1]);r[1]=e instanceof Ze?e.value:parseInt(c.value[1])}if(c.value.length>2){const e=n.getVariableValue(c.value[2]);r[2]=e instanceof Ze?e.value:parseInt(c.value[2])}}const s=this.getTypeInfo("vec3u"),i=this.getTypeInfo("u32");n.setVariable("@workgroup_size",new Qe(r,s));const o=r[0],a=r[1],u=r[2];for(let c=0,l=0;c<u;++c)for(let u=0;u<a;++u)for(let a=0;a<o;++a,++l){const o=[a,u,c],h=[a+t[0]*r[0],u+t[1]*r[1],c+t[2]*r[2]];n.setVariable("@local_invocation_id",new Qe(o,s)),n.setVariable("@global_invocation_id",new Qe(h,s)),n.setVariable("@local_invocation_index",new Ze(l,i)),this._dispatchExec(e,n)}}_dispatchExec(e,t){for(const n of e.node.args)for(const e of n.attributes)if("builtin"===e.name){const r=`@${e.value}`,s=t.getVariable(r);void 0!==s&&t.variables.set(n.name,s)}this._execStatements(e.node.body,t)}getVariableName(e,t){for(;e instanceof Pe;)e=e.right;return e instanceof $e?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,t){for(const n of e){if(n instanceof Array){const e=t.clone(),r=this._execStatements(n,e);if(r)return r;continue}const e=this.execStatement(n,t);if(e)return e}return null}_call(e,t){const n=t.clone();n.currentFunctionName=e.name;const r=t.getFunction(e.name);if(r){for(let t=0;t<r.node.args.length;++t){const s=r.node.args[t],i=this.evalExpression(e.args[t],n);n.setVariable(s.name,i,s)}this._execStatements(r.node.body,n)}else e.isBuiltin?this._callBuiltinFunction(e,n):this.getTypeInfo(e.name)&&this._evalCreate(e,t)}_increment(e,t){const n=this.getVariableName(e.variable,t),r=t.getVariable(n);r?"++"===e.operator?r.value instanceof Ze?r.value.value++:console.error(`Variable ${n} is not a scalar. Line ${e.line}`):"--"===e.operator?r.value instanceof Ze?r.value.value--:console.error(`Variable ${n} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${n} not found. Line ${e.line}`)}_getVariableData(e,t){if(e instanceof $e){const n=this.getVariableName(e,t),r=t.getVariable(n);return null===r?(console.error(`Variable ${n} not found. Line ${e.line}`),null):r.value.getSubData(this,e.postfix,t)}if(e instanceof Pe){if("*"===e.operator){const n=this._getVariableData(e.right,t);return n instanceof Ye?n.reference.getSubData(this,e.postfix,t):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if("&"===e.operator){const n=this._getVariableData(e.right,t);return new Ye(n)}}return null}_assign(e,t){let n=null,r="<var>",s=null;if(e.variable instanceof Pe){const n=this._getVariableData(e.variable,t),r=this.evalExpression(e.value,t),s=e.operator;if("="===s){if(n instanceof Ze||n instanceof Qe||n instanceof Je){if(r instanceof Ze||r instanceof Qe||r instanceof Je&&n.data.length===r.data.length)return void n.data.set(r.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(n instanceof et&&r instanceof et&&n.buffer.byteLength-n.offset>=r.buffer.byteLength-r.offset)return void(n.buffer.byteLength%4==0?new Uint32Array(n.buffer,n.offset,n.typeInfo.size/4).set(new Uint32Array(r.buffer,r.offset,r.typeInfo.size/4)):new Uint8Array(n.buffer,n.offset,n.typeInfo.size).set(new Uint8Array(r.buffer,r.offset,r.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if("+="===s)return n instanceof Ze||n instanceof Qe||n instanceof Je?r instanceof Ze||r instanceof Qe||r instanceof Je?void n.data.set(r.data.map(((e,t)=>n.data[t]+e))):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if("-="===s)return(n instanceof Ze||n instanceof Qe||n instanceof Je)&&(r instanceof Ze||r instanceof Qe||r instanceof Je)?void n.data.set(r.data.map(((e,t)=>n.data[t]-e))):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof Pe){if("*"===e.variable.operator){r=this.getVariableName(e.variable.right,t);const s=t.getVariable(r);if(!(s&&s.value instanceof Ye))return void console.error(`Variable ${r} is not a pointer. Line ${e.line}`);n=s.value.reference;let i=e.variable.postfix;if(!i){let t=e.variable.right;for(;t instanceof Pe;){if(t.postfix){i=t.postfix;break}t=t.right}}i&&(n=n.getSubData(this,i,t))}}else{s=e.variable.postfix,r=this.getVariableName(e.variable,t);const i=t.getVariable(r);if(null===i)return void console.error(`Variable ${r} not found. Line ${e.line}`);n=i.value}if(n instanceof Ye&&(n=n.reference),null===n)return void console.error(`Variable ${r} not found. Line ${e.line}`);const i=this.evalExpression(e.value,t),o=e.operator;if("="===o)if(n instanceof et)n.setDataValue(this,i,s,t);else if(s){if(!(n instanceof Qe||n instanceof Je))return void console.error(`Variable ${r} is not a vector or matrix. Line ${e.line}`);if(s instanceof De){const o=this.evalExpression(s.index,t).value;if(n instanceof Qe){if(!(i instanceof Ze))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);n.data[o]=i.value}else{if(!(n instanceof Je))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);{const o=this.evalExpression(s.index,t).value;if(o<0)return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);if(!(i instanceof Qe))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);{const t=n.typeInfo.getTypeName();if("mat2x2"===t||"mat2x2f"===t||"mat2x2h"===t){if(!(o<2&&2===i.data.length))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);n.data[2*o]=i.data[0],n.data[2*o+1]=i.data[1]}else if("mat2x3"===t||"mat2x3f"===t||"mat2x3h"===t){if(!(o<2&&3===i.data.length))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);n.data[3*o]=i.data[0],n.data[3*o+1]=i.data[1],n.data[3*o+2]=i.data[2]}else if("mat2x4"===t||"mat2x4f"===t||"mat2x4h"===t){if(!(o<2&&4===i.data.length))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);n.data[4*o]=i.data[0],n.data[4*o+1]=i.data[1],n.data[4*o+2]=i.data[2],n.data[4*o+3]=i.data[3]}else if("mat3x2"===t||"mat3x2f"===t||"mat3x2h"===t){if(!(o<3&&2===i.data.length))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);n.data[2*o]=i.data[0],n.data[2*o+1]=i.data[1]}else if("mat3x3"===t||"mat3x3f"===t||"mat3x3h"===t){if(!(o<3&&3===i.data.length))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);n.data[3*o]=i.data[0],n.data[3*o+1]=i.data[1],n.data[3*o+2]=i.data[2]}else if("mat3x4"===t||"mat3x4f"===t||"mat3x4h"===t){if(!(o<3&&4===i.data.length))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);n.data[4*o]=i.data[0],n.data[4*o+1]=i.data[1],n.data[4*o+2]=i.data[2],n.data[4*o+3]=i.data[3]}else if("mat4x2"===t||"mat4x2f"===t||"mat4x2h"===t){if(!(o<4&&2===i.data.length))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);n.data[2*o]=i.data[0],n.data[2*o+1]=i.data[1]}else if("mat4x3"===t||"mat4x3f"===t||"mat4x3h"===t){if(!(o<4&&3===i.data.length))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);n.data[3*o]=i.data[0],n.data[3*o+1]=i.data[1],n.data[3*o+2]=i.data[2]}else{if("mat4x4"!==t&&"mat4x4f"!==t&&"mat4x4h"!==t)return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);if(!(o<4&&4===i.data.length))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);n.data[4*o]=i.data[0],n.data[4*o+1]=i.data[1],n.data[4*o+2]=i.data[2],n.data[4*o+3]=i.data[3]}}}}}else if(s instanceof Se){const t=s.value;if(!(n instanceof Qe))return void console.error(`Invalid assignment to ${t}. Variable ${r} is not a vector. Line ${e.line}`);if(i instanceof Ze){if(t.length>1)return void console.error(`Invalid assignment to ${t} for variable ${r}. Line ${e.line}`);if("x"===t)n.data[0]=i.value;else if("y"===t){if(n.data.length<2)return void console.error(`Invalid assignment to ${t} for variable ${r}. Line ${e.line}`);n.data[1]=i.value}else if("z"===t){if(n.data.length<3)return void console.error(`Invalid assignment to ${t} for variable ${r}. Line ${e.line}`);n.data[2]=i.value}else if("w"===t){if(n.data.length<4)return void console.error(`Invalid assignment to ${t} for variable ${r}. Line ${e.line}`);n.data[3]=i.value}}else{if(!(i instanceof Qe))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);if(t.length!==i.data.length)return void console.error(`Invalid assignment to ${t} for variable ${r}. Line ${e.line}`);for(let s=0;s<t.length;++s){const o=t[s];if("x"===o||"r"===o)n.data[0]=i.data[s];else if("y"===o||"g"===o){if(i.data.length<2)return void console.error(`Invalid assignment to ${o} for variable ${r}. Line ${e.line}`);n.data[1]=i.data[s]}else if("z"===o||"b"===o){if(i.data.length<3)return void console.error(`Invalid assignment to ${o} for variable ${r}. Line ${e.line}`);n.data[2]=i.data[s]}else{if("w"!==o&&"a"!==o)return void console.error(`Invalid assignment to ${o} for variable ${r}. Line ${e.line}`);if(i.data.length<4)return void console.error(`Invalid assignment to ${o} for variable ${r}. Line ${e.line}`);n.data[3]=i.data[s]}}}}}else n instanceof Ze&&i instanceof Ze?n.value=i.value:n instanceof Qe&&i instanceof Qe||n instanceof Je&&i instanceof Je?n.data.set(i.data):console.error(`Invalid assignment to ${r}. Line ${e.line}`);else{const r=n.getSubData(this,s,t);if(r instanceof Qe&&i instanceof Ze){const t=r.data,n=i.value;if("+="===o)for(let e=0;e<t.length;++e)t[e]+=n;else if("-="===o)for(let e=0;e<t.length;++e)t[e]-=n;else if("*="===o)for(let e=0;e<t.length;++e)t[e]*=n;else if("/="===o)for(let e=0;e<t.length;++e)t[e]/=n;else if("%="===o)for(let e=0;e<t.length;++e)t[e]%=n;else if("&="===o)for(let e=0;e<t.length;++e)t[e]&=n;else if("|="===o)for(let e=0;e<t.length;++e)t[e]|=n;else if("^="===o)for(let e=0;e<t.length;++e)t[e]^=n;else if("<<="===o)for(let e=0;e<t.length;++e)t[e]<<=n;else if(">>="===o)for(let e=0;e<t.length;++e)t[e]>>=n;else console.error(`Invalid operator ${o}. Line ${e.line}`)}else if(r instanceof Qe&&i instanceof Qe){const t=r.data,n=i.data;if(t.length!==n.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if("+="===o)for(let e=0;e<t.length;++e)t[e]+=n[e];else if("-="===o)for(let e=0;e<t.length;++e)t[e]-=n[e];else if("*="===o)for(let e=0;e<t.length;++e)t[e]*=n[e];else if("/="===o)for(let e=0;e<t.length;++e)t[e]/=n[e];else if("%="===o)for(let e=0;e<t.length;++e)t[e]%=n[e];else if("&="===o)for(let e=0;e<t.length;++e)t[e]&=n[e];else if("|="===o)for(let e=0;e<t.length;++e)t[e]|=n[e];else if("^="===o)for(let e=0;e<t.length;++e)t[e]^=n[e];else if("<<="===o)for(let e=0;e<t.length;++e)t[e]<<=n[e];else if(">>="===o)for(let e=0;e<t.length;++e)t[e]>>=n[e];else console.error(`Invalid operator ${o}. Line ${e.line}`)}else{if(!(r instanceof Ze&&i instanceof Ze))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);"+="===o?r.value+=i.value:"-="===o?r.value-=i.value:"*="===o?r.value*=i.value:"/="===o?r.value/=i.value:"%="===o?r.value%=i.value:"&="===o?r.value&=i.value:"|="===o?r.value|=i.value:"^="===o?r.value^=i.value:"<<="===o?r.value<<=i.value:">>="===o?r.value>>=i.value:console.error(`Invalid operator ${o}. Line ${e.line}`)}n instanceof et&&n.setDataValue(this,r,s,t)}}_function(e,t){const n=new xt(e);t.functions.set(e.name,n)}_const(e,t){let n=null;null!==e.value&&(n=this.evalExpression(e.value,t)),t.createVariable(e.name,n,e)}_let(e,t){let n=null;if(null!==e.value){if(n=this.evalExpression(e.value,t),null===n)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof Pe||(n=n.clone())}else{const r=e.type.name;if("f32"===r||"i32"===r||"u32"===r||"bool"===r||"f16"===r||"vec2"===r||"vec3"===r||"vec4"===r||"vec2f"===r||"vec3f"===r||"vec4f"===r||"vec2i"===r||"vec3i"===r||"vec4i"===r||"vec2u"===r||"vec3u"===r||"vec4u"===r||"vec2h"===r||"vec3h"===r||"vec4h"===r||"vec2b"===r||"vec3b"===r||"vec4b"===r||"mat2x2"===r||"mat2x3"===r||"mat2x4"===r||"mat3x2"===r||"mat3x3"===r||"mat3x4"===r||"mat4x2"===r||"mat4x3"===r||"mat4x4"===r||"mat2x2f"===r||"mat2x3f"===r||"mat2x4f"===r||"mat3x2f"===r||"mat3x3f"===r||"mat3x4f"===r||"mat4x2f"===r||"mat4x3f"===r||"mat4x4f"===r||"mat2x2h"===r||"mat2x3h"===r||"mat2x4h"===r||"mat3x2h"===r||"mat3x3h"===r||"mat3x4h"===r||"mat4x2h"===r||"mat4x3h"===r||"mat4x4h"===r||"array"===r){const r=new Le(e.type,[]);n=this._evalCreate(r,t)}}t.createVariable(e.name,n,e)}_var(e,t){let n=null;if(null!==e.value){if(n=this.evalExpression(e.value,t),null===n)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof Pe||(n=n.clone())}else{if(null===e.type)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const r=e.type.name;if("f32"===r||"i32"===r||"u32"===r||"bool"===r||"f16"===r||"vec2"===r||"vec3"===r||"vec4"===r||"vec2f"===r||"vec3f"===r||"vec4f"===r||"vec2i"===r||"vec3i"===r||"vec4i"===r||"vec2u"===r||"vec3u"===r||"vec4u"===r||"vec2h"===r||"vec3h"===r||"vec4h"===r||"vec2b"===r||"vec3b"===r||"vec4b"===r||"mat2x2"===r||"mat2x3"===r||"mat2x4"===r||"mat3x2"===r||"mat3x3"===r||"mat3x4"===r||"mat4x2"===r||"mat4x3"===r||"mat4x4"===r||"mat2x2f"===r||"mat2x3f"===r||"mat2x4f"===r||"mat3x2f"===r||"mat3x3f"===r||"mat3x4f"===r||"mat4x2f"===r||"mat4x3f"===r||"mat4x4f"===r||"mat2x2h"===r||"mat2x3h"===r||"mat2x4h"===r||"mat3x2h"===r||"mat3x3h"===r||"mat3x4h"===r||"mat4x2h"===r||"mat4x3h"===r||"mat4x4h"===r||e.type instanceof Te||e.type instanceof we||e.type instanceof ke){const r=new Le(e.type,[]);n=this._evalCreate(r,t)}}t.createVariable(e.name,n,e)}_switch(e,t){t=t.clone();const n=this.evalExpression(e.condition,t);if(!(n instanceof Ze))return console.error(`Invalid if condition. Line ${e.line}`),null;let r=null;for(const s of e.cases)if(s instanceof Ve)for(const i of s.selectors){if(i instanceof Re){r=s;continue}const o=this.evalExpression(i,t);if(!(o instanceof Ze))return console.error(`Invalid case selector. Line ${e.line}`),null;if(o.value===n.value)return this._execStatements(s.body,t)}else s instanceof We&&(r=s);return r?this._execStatements(r.body,t):null}_if(e,t){t=t.clone();const n=this.evalExpression(e.condition,t);if(!(n instanceof Ze))return console.error(`Invalid if condition. Line ${e.line}`),null;if(n.value)return this._execStatements(e.body,t);for(const r of e.elseif){const n=this.evalExpression(r.condition,t);if(!(n instanceof Ze))return console.error(`Invalid if condition. Line ${e.line}`),null;if(n.value)return this._execStatements(r.body,t)}return e.else?this._execStatements(e.else,t):null}_getScalarValue(e){return e instanceof Ze?e.value:(console.error("Expected scalar value.",e),0)}_for(e,t){for(t=t.clone(),this.execStatement(e.init,t);this._getScalarValue(this.evalExpression(e.condition,t));){const n=this._execStatements(e.body,t);if(n===At._breakObj)break;if(null!==n&&n!==At._continueObj)return n;this.execStatement(e.increment,t)}return null}_loop(e,t){for(t=t.clone();;){const n=this._execStatements(e.body,t);if(n===At._breakObj)break;if(n===At._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,t)===At._breakObj)break}else if(null!==n)return n}return null}_while(e,t){for(t=t.clone();this._getScalarValue(this.evalExpression(e.condition,t));){const n=this._execStatements(e.body,t);if(n===At._breakObj)break;if(n!==At._continueObj&&null!==n)return n}return null}_evalBitcast(e,t){const n=this.evalExpression(e.value,t),r=e.type;if(n instanceof Ze){const e=gt(n.value,n.typeInfo.name,r.name);return new Ze(e,this.getTypeInfo(r))}if(n instanceof Qe){const t=n.typeInfo.getTypeName();let s="";if(t.endsWith("f"))s="f32";else if(t.endsWith("i"))s="i32";else if(t.endsWith("u"))s="u32";else if(t.endsWith("b"))s="bool";else{if(!t.endsWith("h"))return console.error(`Unknown vector type ${t}. Line ${e.line}`),null;s="f16"}const i=r.getTypeName();let o="";if(i.endsWith("f"))o="f32";else if(i.endsWith("i"))o="i32";else if(i.endsWith("u"))o="u32";else if(i.endsWith("b"))o="bool";else{if(!i.endsWith("h"))return console.error(`Unknown vector type ${o}. Line ${e.line}`),null;o="f16"}const a=function(e,t,n){if(t===n)return e;const r=new Array(e.length);for(let s=0;s<e.length;s++)r[s]=gt(e[s],t,n);return r}(Array.from(n.data),s,o);return new Qe(a,this.getTypeInfo(r))}return console.error(`TODO: bitcast for ${n.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,t){return t.getVariableValue(e.name).clone().getSubData(this,e.postfix,t)}_evalCreate(e,t){var n;if(e instanceof Le){if(null===e.type)return Xe.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,t);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,t);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,t)}}const r=e instanceof Le?e.type.name:e.name,s=e instanceof Le?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(null===s)return console.error(`Unknown type ${r}. Line ${e.line}`),null;if(0===s.size)return null;const i=new et(new ArrayBuffer(s.size),s,0);if(s instanceof x){if(e.args)for(let o=0;o<e.args.length;++o){const n=s.members[o],r=e.args[o],a=this.evalExpression(r,t);i.setData(this,a,n.type,n.offset,t)}}else if(s instanceof w){let r=0;if(e.args)for(let o=0;o<e.args.length;++o){const a=e.args[o],u=this.evalExpression(a,t);null===s.format&&("x32"===(null===(n=u.typeInfo)||void 0===n?void 0:n.name)?s.format=this.getTypeInfo("i32"):s.format=u.typeInfo),i.setData(this,u,s.format,r,t),r+=s.stride}}else console.error(`Unknown type "${r}". Line ${e.line}`);return e instanceof Le?i.getSubData(this,e.postfix,t):i}_evalLiteral(e,t){const n=this.getTypeInfo(e.type),r=n.name;return"x32"===r||"u32"===r||"f32"===r||"f16"===r||"i32"===r||"bool"===r?new Ze(e.scalarValue,n):"vec2"===r||"vec3"===r||"vec4"===r||"vec2f"===r||"vec3f"===r||"vec4f"===r||"vec2h"===r||"vec3h"===r||"vec4h"===r||"vec2i"===r||"vec3i"===r||"vec4i"===r||"vec2u"===r||"vec3u"===r||"vec4u"===r?this._callConstructorVec(e,t):"mat2x2"===r||"mat2x3"===r||"mat2x4"===r||"mat3x2"===r||"mat3x3"===r||"mat3x4"===r||"mat4x2"===r||"mat4x3"===r||"mat4x4"===r||"mat2x2f"===r||"mat2x3f"===r||"mat2x4f"===r||"mat3x2f"===r||"mat3x3f"===r||"mat3x4f"===r||"mat4x2f"===r||"mat4x3f"===r||"mat4x4f"===r||"mat2x2h"===r||"mat2x3h"===r||"mat2x4h"===r||"mat3x2h"===r||"mat3x3h"===r||"mat3x4h"===r||"mat4x2h"===r||"mat4x3h"===r||"mat4x4h"===r?this._callConstructorMatrix(e,t):e.value}_evalVariable(e,t){const n=t.getVariableValue(e.name);return null===n?n:n.getSubData(this,e.postfix,t)}_maxFormatTypeInfo(e){let t=e[0];if("f32"===t.name)return t;for(let n=1;n<e.length;++n){const r=At._priority.get(t.name);At._priority.get(e[n].name)<r&&(t=e[n])}return"x32"===t.name?this.getTypeInfo("i32"):t}_evalUnaryOp(e,t){const n=this.evalExpression(e.right,t);if("&"===e.operator)return new Ye(n);if("*"===e.operator)return n instanceof Ye?n.reference.getSubData(this,e.postfix,t):(console.error(`Invalid dereference. Line ${e.line}`),null);const r=n instanceof Ze?n.value:n instanceof Qe?Array.from(n.data):null;switch(e.operator){case"+":{if(ot(r)){const e=r.map(((e,t)=>+e));return new Qe(e,n.typeInfo)}const e=r,t=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Ze(+e,t)}case"-":{if(ot(r)){const e=r.map(((e,t)=>-e));return new Qe(e,n.typeInfo)}const e=r,t=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Ze(-e,t)}case"!":{if(ot(r)){const e=r.map(((e,t)=>e?0:1));return new Qe(e,n.typeInfo)}const e=r,t=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Ze(e?0:1,t)}case"~":{if(ot(r)){const e=r.map(((e,t)=>~e));return new Qe(e,n.typeInfo)}const e=r,t=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new Ze(~e,t)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,t){const n=this.evalExpression(e.left,t),r=this.evalExpression(e.right,t),s=n instanceof Ze?n.value:n instanceof Qe||n instanceof Je?Array.from(n.data):null,i=r instanceof Ze?r.value:r instanceof Qe||r instanceof Je?Array.from(r.data):null;switch(e.operator){case"+":{if(ot(s)&&ot(i)){const t=s,r=i;if(t.length!==r.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const o=t.map(((e,t)=>e+r[t]));return new Qe(o,n.typeInfo)}if(ot(s)){const e=i,t=s.map(((t,n)=>t+e));return new Qe(t,n.typeInfo)}if(ot(i)){const e=s,t=i.map(((t,n)=>e+t));return new Qe(t,r.typeInfo)}const t=s,o=i,a=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new Ze(t+o,a)}case"-":{if(ot(s)&&ot(i)){const t=s,r=i;if(t.length!==r.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const o=t.map(((e,t)=>e-r[t]));return new Qe(o,n.typeInfo)}if(ot(s)){const e=i,t=s.map(((t,n)=>t-e));return new Qe(t,n.typeInfo)}if(ot(i)){const e=s,t=i.map(((t,n)=>e-t));return new Qe(t,r.typeInfo)}const t=s,o=i,a=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new Ze(t-o,a)}case"*":{if(ot(s)&&ot(i)){const t=s,o=i;if(n instanceof Je&&r instanceof Je){const s=function(e,t,n,r){if(void 0===Et[t.name]||void 0===Et[r.name])return null;const s=Et[t.name][0],i=Et[t.name][1],o=Et[r.name][0];if(s!==Et[r.name][1])return null;const a=new Array(o*i);for(let u=0;u<i;u++)for(let t=0;t<o;t++){let r=0;for(let o=0;o<s;o++)r+=e[o*i+u]*n[t*s+o];a[u*o+t]=r}return a}(t,n.typeInfo,o,r.typeInfo);if(null===s)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const i=Et[r.typeInfo.name][0],a=Et[n.typeInfo.name][1],u=this.getTypeInfo(`mat${i}x${a}f`);return new Je(s,u)}if(n instanceof Je&&r instanceof Qe){const s=function(e,t,n,r){if(void 0===Et[t.name]||void 0===Tt[r.name])return null;const s=Et[t.name][0],i=Et[t.name][1];if(s!==n.length)return null;const o=new Array(i);for(let a=0;a<i;a++){let t=0;for(let r=0;r<s;r++)t+=e[r*i+a]*n[r];o[a]=t}return o}(t,n.typeInfo,o,r.typeInfo);return null===s?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new Qe(s,r.typeInfo)}if(n instanceof Qe&&r instanceof Je){const s=function(e,t,n,r){if(void 0===Tt[t.name]||void 0===Et[r.name])return null;const s=Et[r.name][0],i=Et[r.name][1];if(i!==e.length)return null;const o=[];for(let a=0;a<s;a++){let t=0;for(let r=0;r<i;r++)t+=e[r]*n[r*s+a];o[a]=t}return o}(t,n.typeInfo,o,r.typeInfo);return null===s?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new Qe(s,n.typeInfo)}{if(t.length!==o.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const r=t.map(((e,t)=>e*o[t]));return new Qe(r,n.typeInfo)}}if(ot(s)){const e=i,t=s.map(((t,n)=>t*e));return n instanceof Je?new Je(t,n.typeInfo):new Qe(t,n.typeInfo)}if(ot(i)){const e=s,t=i.map(((t,n)=>e*t));return r instanceof Je?new Je(t,r.typeInfo):new Qe(t,r.typeInfo)}const t=s,o=i,a=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new Ze(t*o,a)}case"%":{if(ot(s)&&ot(i)){const t=s,r=i;if(t.length!==r.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const o=t.map(((e,t)=>e%r[t]));return new Qe(o,n.typeInfo)}if(ot(s)){const e=i,t=s.map(((t,n)=>t%e));return new Qe(t,n.typeInfo)}if(ot(i)){const e=s,t=i.map(((t,n)=>e%t));return new Qe(t,r.typeInfo)}const t=s,o=i,a=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new Ze(t%o,a)}case"/":{if(ot(s)&&ot(i)){const t=s,r=i;if(t.length!==r.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const o=t.map(((e,t)=>e/r[t]));return new Qe(o,n.typeInfo)}if(ot(s)){const e=i,t=s.map(((t,n)=>t/e));return new Qe(t,n.typeInfo)}if(ot(i)){const e=s,t=i.map(((t,n)=>e/t));return new Qe(t,r.typeInfo)}const t=s,o=i,a=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new Ze(t/o,a)}case"&":{if(ot(s)&&ot(i)){const t=s,r=i;if(t.length!==r.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const o=t.map(((e,t)=>e&r[t]));return new Qe(o,n.typeInfo)}if(ot(s)){const e=i,t=s.map(((t,n)=>t&e));return new Qe(t,n.typeInfo)}if(ot(i)){const e=s,t=i.map(((t,n)=>e&t));return new Qe(t,r.typeInfo)}const t=s,o=i,a=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new Ze(t&o,a)}case"|":{if(ot(s)&&ot(i)){const t=s,r=i;if(t.length!==r.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const o=t.map(((e,t)=>e|r[t]));return new Qe(o,n.typeInfo)}if(ot(s)){const e=i,t=s.map(((t,n)=>t|e));return new Qe(t,n.typeInfo)}if(ot(i)){const e=s,t=i.map(((t,n)=>e|t));return new Qe(t,r.typeInfo)}const t=s,o=i,a=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new Ze(t|o,a)}case"^":{if(ot(s)&&ot(i)){const t=s,r=i;if(t.length!==r.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const o=t.map(((e,t)=>e^r[t]));return new Qe(o,n.typeInfo)}if(ot(s)){const e=i,t=s.map(((t,n)=>t^e));return new Qe(t,n.typeInfo)}if(ot(i)){const e=s,t=i.map(((t,n)=>e^t));return new Qe(t,r.typeInfo)}const t=s,o=i,a=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new Ze(t^o,a)}case"<<":{if(ot(s)&&ot(i)){const t=s,r=i;if(t.length!==r.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const o=t.map(((e,t)=>e<<r[t]));return new Qe(o,n.typeInfo)}if(ot(s)){const e=i,t=s.map(((t,n)=>t<<e));return new Qe(t,n.typeInfo)}if(ot(i)){const e=s,t=i.map(((t,n)=>e<<t));return new Qe(t,r.typeInfo)}const t=s,o=i,a=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new Ze(t<<o,a)}case">>":{if(ot(s)&&ot(i)){const t=s,r=i;if(t.length!==r.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const o=t.map(((e,t)=>e>>r[t]));return new Qe(o,n.typeInfo)}if(ot(s)){const e=i,t=s.map(((t,n)=>t>>e));return new Qe(t,n.typeInfo)}if(ot(i)){const e=s,t=i.map(((t,n)=>e>>t));return new Qe(t,r.typeInfo)}const t=s,o=i,a=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new Ze(t>>o,a)}case">":if(ot(s)&&ot(i)){const t=s,r=i;if(t.length!==r.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const o=t.map(((e,t)=>e>r[t]?1:0));return new Qe(o,n.typeInfo)}if(ot(s)){const e=i,t=s.map(((t,n)=>t>e?1:0));return new Qe(t,n.typeInfo)}if(ot(i)){const e=s,t=i.map(((t,n)=>e>t?1:0));return new Qe(t,r.typeInfo)}return new Ze(s>i?1:0,this.getTypeInfo("bool"));case"<":if(ot(s)&&ot(i)){const t=s,r=i;if(t.length!==r.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const o=t.map(((e,t)=>e<r[t]?1:0));return new Qe(o,n.typeInfo)}if(ot(s)){const e=i,t=s.map(((t,n)=>t<e?1:0));return new Qe(t,n.typeInfo)}if(ot(i)){const e=s,t=i.map(((t,n)=>e<t?1:0));return new Qe(t,r.typeInfo)}return new Ze(s<i?1:0,this.getTypeInfo("bool"));case"==":if(ot(s)&&ot(i)){const t=s,r=i;if(t.length!==r.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const o=t.map(((e,t)=>e===r[t]?1:0));return new Qe(o,n.typeInfo)}if(ot(s)){const e=i,t=s.map(((t,n)=>t==e?1:0));return new Qe(t,n.typeInfo)}if(ot(i)){const e=s,t=i.map(((t,n)=>e==t?1:0));return new Qe(t,r.typeInfo)}return new Ze(s===i?1:0,this.getTypeInfo("bool"));case"!=":if(ot(s)&&ot(i)){const t=s,r=i;if(t.length!==r.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const o=t.map(((e,t)=>e!==r[t]?1:0));return new Qe(o,n.typeInfo)}if(ot(s)){const e=i,t=s.map(((t,n)=>t!==e?1:0));return new Qe(t,n.typeInfo)}if(ot(i)){const e=s,t=i.map(((t,n)=>e!==t?1:0));return new Qe(t,r.typeInfo)}return new Ze(s!==i?1:0,this.getTypeInfo("bool"));case">=":if(ot(s)&&ot(i)){const t=s,r=i;if(t.length!==r.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const o=t.map(((e,t)=>e>=r[t]?1:0));return new Qe(o,n.typeInfo)}if(ot(s)){const e=i,t=s.map(((t,n)=>t>=e?1:0));return new Qe(t,n.typeInfo)}if(ot(i)){const e=s,t=i.map(((t,n)=>e>=t?1:0));return new Qe(t,r.typeInfo)}return new Ze(s>=i?1:0,this.getTypeInfo("bool"));case"<=":if(ot(s)&&ot(i)){const t=s,r=i;if(t.length!==r.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const o=t.map(((e,t)=>e<=r[t]?1:0));return new Qe(o,n.typeInfo)}if(ot(s)){const e=i,t=s.map(((t,n)=>t<=e?1:0));return new Qe(t,n.typeInfo)}if(ot(i)){const e=s,t=i.map(((t,n)=>e<=t?1:0));return new Qe(t,r.typeInfo)}return new Ze(s<=i?1:0,this.getTypeInfo("bool"));case"&&":if(ot(s)&&ot(i)){const t=s,r=i;if(t.length!==r.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const o=t.map(((e,t)=>e&&r[t]?1:0));return new Qe(o,n.typeInfo)}if(ot(s)){const e=i,t=s.map(((t,n)=>t&&e?1:0));return new Qe(t,n.typeInfo)}if(ot(i)){const e=s,t=i.map(((t,n)=>e&&t?1:0));return new Qe(t,r.typeInfo)}return new Ze(s&&i?1:0,this.getTypeInfo("bool"));case"||":if(ot(s)&&ot(i)){const t=s,r=i;if(t.length!==r.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const o=t.map(((e,t)=>e||r[t]?1:0));return new Qe(o,n.typeInfo)}if(ot(s)){const e=i,t=s.map(((t,n)=>t||e?1:0));return new Qe(t,n.typeInfo)}if(ot(i)){const e=s,t=i.map(((t,n)=>e||t?1:0));return new Qe(t,r.typeInfo)}return new Ze(s||i?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,t){if(null!==e.cachedReturnValue)return e.cachedReturnValue;const n=t.clone();n.currentFunctionName=e.name;const r=t.getFunction(e.name);if(!r)return e.isBuiltin?this._callBuiltinFunction(e,n):this.getTypeInfo(e.name)?this._evalCreate(e,t):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let s=0;s<r.node.args.length;++s){const t=r.node.args[s],i=this.evalExpression(e.args[s],n);n.createVariable(t.name,i,t)}return this._execStatements(r.node.body,n)}_callBuiltinFunction(e,t){switch(e.name){case"all":return this.builtins.All(e,t);case"any":return this.builtins.Any(e,t);case"select":return this.builtins.Select(e,t);case"arrayLength":return this.builtins.ArrayLength(e,t);case"abs":return this.builtins.Abs(e,t);case"acos":return this.builtins.Acos(e,t);case"acosh":return this.builtins.Acosh(e,t);case"asin":return this.builtins.Asin(e,t);case"asinh":return this.builtins.Asinh(e,t);case"atan":return this.builtins.Atan(e,t);case"atanh":return this.builtins.Atanh(e,t);case"atan2":return this.builtins.Atan2(e,t);case"ceil":return this.builtins.Ceil(e,t);case"clamp":return this.builtins.Clamp(e,t);case"cos":return this.builtins.Cos(e,t);case"cosh":return this.builtins.Cosh(e,t);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,t);case"countOneBits":return this.builtins.CountOneBits(e,t);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,t);case"cross":return this.builtins.Cross(e,t);case"degrees":return this.builtins.Degrees(e,t);case"determinant":return this.builtins.Determinant(e,t);case"distance":return this.builtins.Distance(e,t);case"dot":return this.builtins.Dot(e,t);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,t);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,t);case"exp":return this.builtins.Exp(e,t);case"exp2":return this.builtins.Exp2(e,t);case"extractBits":return this.builtins.ExtractBits(e,t);case"faceForward":return this.builtins.FaceForward(e,t);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,t);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,t);case"floor":return this.builtins.Floor(e,t);case"fma":return this.builtins.Fma(e,t);case"fract":return this.builtins.Fract(e,t);case"frexp":return this.builtins.Frexp(e,t);case"insertBits":return this.builtins.InsertBits(e,t);case"inverseSqrt":return this.builtins.InverseSqrt(e,t);case"ldexp":return this.builtins.Ldexp(e,t);case"length":return this.builtins.Length(e,t);case"log":return this.builtins.Log(e,t);case"log2":return this.builtins.Log2(e,t);case"max":return this.builtins.Max(e,t);case"min":return this.builtins.Min(e,t);case"mix":return this.builtins.Mix(e,t);case"modf":return this.builtins.Modf(e,t);case"normalize":return this.builtins.Normalize(e,t);case"pow":return this.builtins.Pow(e,t);case"quantizeToF16":return this.builtins.QuantizeToF16(e,t);case"radians":return this.builtins.Radians(e,t);case"reflect":return this.builtins.Reflect(e,t);case"refract":return this.builtins.Refract(e,t);case"reverseBits":return this.builtins.ReverseBits(e,t);case"round":return this.builtins.Round(e,t);case"saturate":return this.builtins.Saturate(e,t);case"sign":return this.builtins.Sign(e,t);case"sin":return this.builtins.Sin(e,t);case"sinh":return this.builtins.Sinh(e,t);case"smoothStep":return this.builtins.SmoothStep(e,t);case"sqrt":return this.builtins.Sqrt(e,t);case"step":return this.builtins.Step(e,t);case"tan":return this.builtins.Tan(e,t);case"tanh":return this.builtins.Tanh(e,t);case"transpose":return this.builtins.Transpose(e,t);case"trunc":return this.builtins.Trunc(e,t);case"dpdx":return this.builtins.Dpdx(e,t);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,t);case"dpdxFine":return this.builtins.DpdxFine(e,t);case"dpdy":return this.builtins.Dpdy(e,t);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,t);case"dpdyFine":return this.builtins.DpdyFine(e,t);case"fwidth":return this.builtins.Fwidth(e,t);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,t);case"fwidthFine":return this.builtins.FwidthFine(e,t);case"textureDimensions":return this.builtins.TextureDimensions(e,t);case"textureGather":return this.builtins.TextureGather(e,t);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,t);case"textureLoad":return this.builtins.TextureLoad(e,t);case"textureNumLayers":return this.builtins.TextureNumLayers(e,t);case"textureNumLevels":return this.builtins.TextureNumLevels(e,t);case"textureNumSamples":return this.builtins.TextureNumSamples(e,t);case"textureSample":return this.builtins.TextureSample(e,t);case"textureSampleBias":return this.builtins.TextureSampleBias(e,t);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,t);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,t);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,t);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,t);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,t);case"textureStore":return this.builtins.TextureStore(e,t);case"atomicLoad":return this.builtins.AtomicLoad(e,t);case"atomicStore":return this.builtins.AtomicStore(e,t);case"atomicAdd":return this.builtins.AtomicAdd(e,t);case"atomicSub":return this.builtins.AtomicSub(e,t);case"atomicMax":return this.builtins.AtomicMax(e,t);case"atomicMin":return this.builtins.AtomicMin(e,t);case"atomicAnd":return this.builtins.AtomicAnd(e,t);case"atomicOr":return this.builtins.AtomicOr(e,t);case"atomicXor":return this.builtins.AtomicXor(e,t);case"atomicExchange":return this.builtins.AtomicExchange(e,t);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,t);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,t);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,t);case"pack4xI8":return this.builtins.Pack4xI8(e,t);case"pack4xU8":return this.builtins.Pack4xU8(e,t);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,t);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,t);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,t);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,t);case"pack2x16float":return this.builtins.Pack2x16float(e,t);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,t);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,t);case"unpack4xI8":return this.builtins.Unpack4xI8(e,t);case"unpack4xU8":return this.builtins.Unpack4xU8(e,t);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,t);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,t);case"unpack2x16float":return this.builtins.Unpack2x16float(e,t);case"storageBarrier":return this.builtins.StorageBarrier(e,t);case"textureBarrier":return this.builtins.TextureBarrier(e,t);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,t);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,t);case"subgroupAdd":return this.builtins.SubgroupAdd(e,t);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,t);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,t);case"subgroupAll":return this.builtins.SubgroupAll(e,t);case"subgroupAnd":return this.builtins.SubgroupAnd(e,t);case"subgroupAny":return this.builtins.SubgroupAny(e,t);case"subgroupBallot":return this.builtins.SubgroupBallot(e,t);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,t);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,t);case"subgroupElect":return this.builtins.SubgroupElect(e,t);case"subgroupMax":return this.builtins.SubgroupMax(e,t);case"subgroupMin":return this.builtins.SubgroupMin(e,t);case"subgroupMul":return this.builtins.SubgroupMul(e,t);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,t);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,t);case"subgroupOr":return this.builtins.SubgroupOr(e,t);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,t);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,t);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,t);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,t);case"subgroupXor":return this.builtins.SubgroupXor(e,t);case"quadBroadcast":return this.builtins.QuadBroadcast(e,t);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,t);case"quadSwapX":return this.builtins.QuadSwapX(e,t);case"quadSwapY":return this.builtins.QuadSwapY(e,t)}const n=t.getFunction(e.name);if(n){const r=t.clone();for(let t=0;t<n.node.args.length;++t){const s=n.node.args[t],i=this.evalExpression(e.args[t],r);r.setVariable(s.name,i,s)}return this._execStatements(n.node.body,r)}return null}_callConstructorValue(e,t){if(!e.args||0===e.args.length)return new Ze(0,this.getTypeInfo(e.type));const n=this.evalExpression(e.args[0],t);return n.typeInfo=this.getTypeInfo(e.type),n.getSubData(this,e.postfix,t).clone()}_callConstructorVec(e,t){const n=this.getTypeInfo(e.type),r=e.type.getTypeName(),s=Tt[r];if(void 0===s)return console.error(`Invalid vec constructor ${r}. Line ${e.line}`),null;const i=[];if(e instanceof Ce)if(e.isVector){const t=e.vectorValue;for(const e of t)i.push(e)}else i.push(e.scalarValue);else if(e.args)for(const o of e.args){const e=this.evalExpression(o,t);if(e instanceof Qe){const t=e.data;for(let e=0;e<t.length;++e){let n=t[e];i.push(n)}}else if(e instanceof Ze){let t=e.value;i.push(t)}}if(e.type instanceof ke&&null===e.type.format&&(e.type.format=ke.f32),0===i.length){const r=new Array(s).fill(0);return new Qe(r,n).getSubData(this,e.postfix,t)}if(1===i.length)for(;i.length<s;)i.push(i[0]);return i.length<s?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new Qe(i.length>s?i.slice(0,s):i,n).getSubData(this,e.postfix,t)}_callConstructorMatrix(e,t){const n=this.getTypeInfo(e.type),r=e.type.getTypeName(),s=Et[r];if(void 0===s)return console.error(`Invalid matrix constructor ${r}. Line ${e.line}`),null;const i=[];if(e instanceof Ce)if(e.isVector){const t=e.vectorValue;for(const e of t)i.push(e)}else i.push(e.scalarValue);else if(e.args)for(const o of e.args){const e=this.evalExpression(o,t);e instanceof Qe?i.push(...e.data):e instanceof Ze?i.push(e.value):e instanceof Je&&i.push(...e.data)}if(n instanceof k&&null===n.format&&(n.format=this.getTypeInfo("f32")),0===i.length){const r=new Array(s[2]).fill(0);return new Je(r,n).getSubData(this,e.postfix,t)}return i.length!==s[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new Je(i,n).getSubData(this,e.postfix,t)}}At._breakObj=new Ge(new b("BREAK",null),null),At._continueObj=new Ge(new b("CONTINUE",null),null),At._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class St{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class Lt{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new St,this._exec=new At,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const t=[];for(;!this._isAtEnd();){const e=this._global_decl_or_directive();if(!e)break;t.push(e)}if(this._deferArrayCountEval.length>0){for(const t of this._deferArrayCountEval){const n=t.arrayType,r=t.countNode;if(r instanceof $e){const t=r.name,s=this._context.constants.get(t);if(s)try{const e=s.constEvaluate(this._exec);n.count=e}catch(e){}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const n of t)n.search((e=>{e instanceof je||e instanceof Ie?e.type=this._forwardType(e.type):e instanceof Te?e.format=this._forwardType(e.format):e instanceof Q||e instanceof ee||e instanceof te?e.type=this._forwardType(e.type):e instanceof G?e.returnType=this._forwardType(e.returnType):e instanceof ze&&(e.type=this._forwardType(e.type))}));return t}_forwardType(e){if(e instanceof xe){const t=this._getType(e.name);if(t)return t}else e instanceof Ie?e.type=this._forwardType(e.type):e instanceof Te&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if("string"==typeof e){const t=new it(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,t){return e.line=null!=t?t:this._currentLine,e}_error(e,t){return{token:e,message:t,toString:()=>`${t}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==rt.eof}_match(e){if(e instanceof nt)return!!this._check(e)&&(this._advance(),!0);for(let t=0,n=e.length;t<n;++t){const n=e[t];if(this._check(n))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),`${t}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){const n=t.type;let r=!1;for(const t of e){if(n===t)return!0;t===rt.tokens.name&&(r=!0)}if(r){const e=rt.tokens.name.rule.exec(t.lexeme);if(e&&0==e.index&&e[0]==t.lexeme)return!0}return!1}if(t.type===e)return!0;if(e===rt.tokens.name){const e=rt.tokens.name.rule.exec(t.lexeme);return e&&0==e.index&&e[0]==t.lexeme}return!1}_advance(){var e,t;return this._currentLine=null!==(t=null===(e=this._peek())||void 0===e?void 0:e.line)&&void 0!==t?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(rt.tokens.semicolon)&&!this._isAtEnd(););if(this._match(rt.keywords.alias)){const e=this._type_alias();return this._consume(rt.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(rt.keywords.diagnostic)){const e=this._diagnostic();return this._consume(rt.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(rt.keywords.requires)){const e=this._requires_directive();return this._consume(rt.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(rt.keywords.enable)){const e=this._enable_directive();return this._consume(rt.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}const e=this._attribute();if(this._check(rt.keywords.var)){const t=this._global_variable_decl();return null!=t&&(t.attributes=e),this._consume(rt.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(rt.keywords.override)){const t=this._override_variable_decl();return null!=t&&(t.attributes=e),this._consume(rt.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(rt.keywords.let)){const t=this._global_let_decl();return null!=t&&(t.attributes=e),this._consume(rt.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(rt.keywords.const)){const t=this._global_const_decl();return null!=t&&(t.attributes=e),this._consume(rt.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(rt.keywords.struct)){const t=this._struct_decl();return null!=t&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}if(this._check(rt.keywords.fn)){const t=this._function_decl();return null!=t&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}return null}_function_decl(){if(!this._match(rt.keywords.fn))return null;const e=this._currentLine,t=this._consume(rt.tokens.ident,"Expected function name.").toString();this._consume(rt.tokens.paren_left,"Expected '(' for function arguments.");const n=[];if(!this._check(rt.tokens.paren_right))do{if(this._check(rt.tokens.paren_right))break;const e=this._attribute(),t=this._consume(rt.tokens.name,"Expected argument name.").toString();this._consume(rt.tokens.colon,"Expected ':' for argument type.");const r=this._attribute(),s=this._type_decl();null!=s&&(s.attributes=r,n.push(this._updateNode(new ze(t,s,e))))}while(this._match(rt.tokens.comma));this._consume(rt.tokens.paren_right,"Expected ')' after function arguments.");let r=null;if(this._match(rt.tokens.arrow)){const e=this._attribute();r=this._type_decl(),null!=r&&(r.attributes=e)}const s=this._compound_statement(),i=this._currentLine;return this._updateNode(new G(t,n,r,s,e,i),e)}_compound_statement(){const e=[];for(this._consume(rt.tokens.brace_left,"Expected '{' for block.");!this._check(rt.tokens.brace_right);){const t=this._statement();null!==t&&e.push(t)}return this._consume(rt.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(rt.tokens.semicolon)&&!this._isAtEnd(););if(this._check(rt.tokens.attr)&&this._attribute(),this._check(rt.keywords.if))return this._if_statement();if(this._check(rt.keywords.switch))return this._switch_statement();if(this._check(rt.keywords.loop))return this._loop_statement();if(this._check(rt.keywords.for))return this._for_statement();if(this._check(rt.keywords.while))return this._while_statement();if(this._check(rt.keywords.continuing))return this._continuing_statement();if(this._check(rt.keywords.static_assert))return this._static_assert_statement();if(this._check(rt.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(rt.keywords.return))e=this._return_statement();else if(this._check([rt.keywords.var,rt.keywords.let,rt.keywords.const]))e=this._variable_statement();else if(this._match(rt.keywords.discard))e=this._updateNode(new ye);else if(this._match(rt.keywords.break)){const t=this._updateNode(new _e);if(this._currentLoop.length>0){const e=this._currentLoop[this._currentLoop.length-1];t.loopId=e.id}e=t,this._check(rt.keywords.if)&&(this._advance(),t.condition=this._optional_paren_expression())}else if(this._match(rt.keywords.continue)){const t=this._updateNode(new be);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${t.line}`);{const e=this._currentLoop[this._currentLoop.length-1];t.loopId=e.id}e=t}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return null!=e&&this._consume(rt.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(rt.keywords.static_assert))return null;const e=this._currentLine,t=this._optional_paren_expression();return this._updateNode(new X(t),e)}_while_statement(){if(!this._match(rt.keywords.while))return null;const e=this._updateNode(new Y(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(rt.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(rt.keywords.continuing))return null;const t=this._currentLine,n=this._compound_statement();return this._updateNode(new Z(n,e),t)}_for_statement(){if(!this._match(rt.keywords.for))return null;this._consume(rt.tokens.paren_left,"Expected '('.");const e=this._updateNode(new K(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(rt.tokens.semicolon)?null:this._for_init(),this._consume(rt.tokens.semicolon,"Expected ';'."),e.condition=this._check(rt.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(rt.tokens.semicolon,"Expected ';'."),e.increment=this._check(rt.tokens.paren_right)?null:this._for_increment(),this._consume(rt.tokens.paren_right,"Expected ')'."),this._check(rt.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(rt.keywords.var)){const e=this._variable_decl();if(null===e)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(rt.tokens.equal)&&(t=this._short_circuit_or_expression()),this._updateNode(new Q(e.name,e.type,e.storage,e.access,t),e.line)}if(this._match(rt.keywords.let)){const e=this._currentLine,t=this._consume(rt.tokens.name,"Expected name for let.").toString();let n=null;if(this._match(rt.tokens.colon)){const e=this._attribute();n=this._type_decl(),null!=n&&(n.attributes=e)}this._consume(rt.tokens.equal,"Expected '=' for let.");const r=this._short_circuit_or_expression();return this._updateNode(new ee(t,n,null,null,r),e)}if(this._match(rt.keywords.const)){const e=this._currentLine,t=this._consume(rt.tokens.name,"Expected name for const.").toString();let n=null;if(this._match(rt.tokens.colon)){const e=this._attribute();n=this._type_decl(),null!=n&&(n.attributes=e)}this._consume(rt.tokens.equal,"Expected '=' for const.");const r=this._short_circuit_or_expression();return null===n&&r instanceof Ce&&(n=r.type),this._updateNode(new te(t,n,null,null,r),e)}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(null==t)return null;if(!this._check(rt.increment_operators))return this._current=e,null;const n=this._consume(rt.increment_operators,"Expected increment operator");return this._updateNode(new oe(n.type===rt.tokens.plus_plus?ne.increment:ne.decrement,t))}_assignment_statement(){let e=null;const t=this._currentLine;if(this._check(rt.tokens.brace_right))return null;let n=this._match(rt.tokens.underscore);if(n||(e=this._unary_expression()),!n&&null==e)return null;const r=this._consume(rt.assignment_operators,"Expected assignment operator."),s=this._short_circuit_or_expression();return this._updateNode(new ae(re.parse(r.lexeme),e,s),t)}_func_call_statement(){if(!this._check(rt.tokens.ident))return null;const e=this._currentLine,t=this._current,n=this._consume(rt.tokens.ident,"Expected function name."),r=this._argument_expression_list();return null===r?(this._current=t,null):this._updateNode(new ue(n.lexeme,r),e)}_loop_statement(){if(!this._match(rt.keywords.loop))return null;this._check(rt.tokens.attr)&&this._attribute(),this._consume(rt.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new ce([],null));this._currentLoop.push(e);let t=this._statement();for(;null!==t;){if(Array.isArray(t))for(let n of t)e.body.push(n);else e.body.push(t);if(t instanceof Z){e.continuing=t;break}t=this._statement()}return this._currentLoop.pop(),this._consume(rt.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(rt.keywords.switch))return null;const e=this._updateNode(new le(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(rt.tokens.attr)&&this._attribute(),this._consume(rt.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),null==e.cases||0==e.cases.length)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(rt.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let t=!1;for(;this._check([rt.keywords.default,rt.keywords.case]);){if(this._match(rt.keywords.case)){const n=this._case_selectors();for(const e of n)if(e instanceof Re){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");t=!0;break}this._match(rt.tokens.colon),this._check(rt.tokens.attr)&&this._attribute(),this._consume(rt.tokens.brace_left,"Exected '{' for switch case.");const r=this._case_body();this._consume(rt.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new Ve(n,r)))}if(this._match(rt.keywords.default)){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(rt.tokens.colon),this._check(rt.tokens.attr)&&this._attribute(),this._consume(rt.tokens.brace_left,"Exected '{' for switch default.");const n=this._case_body();this._consume(rt.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new We(n)))}}return e}_case_selectors(){const e=[];for(this._match(rt.keywords.default)?e.push(this._updateNode(new Re)):e.push(this._shift_expression());this._match(rt.tokens.comma);)this._match(rt.keywords.default)?e.push(this._updateNode(new Re)):e.push(this._shift_expression());return e}_case_body(){if(this._match(rt.keywords.fallthrough))return this._consume(rt.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(null==e)return[];e instanceof Array||(e=[e]);const t=this._case_body();return 0==t.length?e:[...e,t[0]]}_if_statement(){if(!this._match(rt.keywords.if))return null;const e=this._currentLine,t=this._optional_paren_expression();this._check(rt.tokens.attr)&&this._attribute();const n=this._compound_statement();let r=[];this._match_elseif()&&(this._check(rt.tokens.attr)&&this._attribute(),r=this._elseif_statement(r));let s=null;return this._match(rt.keywords.else)&&(this._check(rt.tokens.attr)&&this._attribute(),s=this._compound_statement()),this._updateNode(new he(t,n,r,s),e)}_match_elseif(){return this._tokens[this._current].type===rt.keywords.else&&this._tokens[this._current+1].type===rt.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const t=this._optional_paren_expression(),n=this._compound_statement();return e.push(this._updateNode(new qe(t,n))),this._match_elseif()&&(this._check(rt.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(rt.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new fe(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(rt.tokens.or_or);)e=this._updateNode(new Fe(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(rt.tokens.and_and);)e=this._updateNode(new Fe(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(rt.tokens.or);)e=this._updateNode(new Fe(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(rt.tokens.xor);)e=this._updateNode(new Fe(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(rt.tokens.and);)e=this._updateNode(new Fe(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([rt.tokens.equal_equal,rt.tokens.not_equal])?this._updateNode(new Fe(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([rt.tokens.less_than,rt.tokens.greater_than,rt.tokens.less_than_equal,rt.tokens.greater_than_equal]);)e=this._updateNode(new Fe(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([rt.tokens.shift_left,rt.tokens.shift_right]);)e=this._updateNode(new Fe(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([rt.tokens.plus,rt.tokens.minus]);)e=this._updateNode(new Fe(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([rt.tokens.star,rt.tokens.forward_slash,rt.tokens.modulo]);)e=this._updateNode(new Fe(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([rt.tokens.minus,rt.tokens.bang,rt.tokens.tilde,rt.tokens.star,rt.tokens.and])?this._updateNode(new Pe(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(rt.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(rt.tokens.bracket_right,"Expected ']'.");const t=this._updateNode(new De(e)),n=this._postfix_expression();return n&&(t.postfix=n),t}if(this._match(rt.tokens.period)){const e=this._consume(rt.tokens.name,"Expected member name."),t=this._postfix_expression(),n=this._updateNode(new Se(e.lexeme));return t&&(n.postfix=t),n}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const t=this._getStruct(e);if(null!==t)return t;switch(e){case"void":return ve.void;case"bool":return ve.bool;case"i32":return ve.i32;case"u32":return ve.u32;case"f32":return ve.f32;case"f16":return ve.f16;case"vec2f":return ke.vec2f;case"vec3f":return ke.vec3f;case"vec4f":return ke.vec4f;case"vec2i":return ke.vec2i;case"vec3i":return ke.vec3i;case"vec4i":return ke.vec4i;case"vec2u":return ke.vec2u;case"vec3u":return ke.vec3u;case"vec4u":return ke.vec4u;case"vec2h":return ke.vec2h;case"vec3h":return ke.vec3h;case"vec4h":return ke.vec4h;case"mat2x2f":return ke.mat2x2f;case"mat2x3f":return ke.mat2x3f;case"mat2x4f":return ke.mat2x4f;case"mat3x2f":return ke.mat3x2f;case"mat3x3f":return ke.mat3x3f;case"mat3x4f":return ke.mat3x4f;case"mat4x2f":return ke.mat4x2f;case"mat4x3f":return ke.mat4x3f;case"mat4x4f":return ke.mat4x4f;case"mat2x2h":return ke.mat2x2h;case"mat2x3h":return ke.mat2x3h;case"mat2x4h":return ke.mat2x4h;case"mat3x2h":return ke.mat3x2h;case"mat3x3h":return ke.mat3x3h;case"mat3x4h":return ke.mat3x4h;case"mat4x2h":return ke.mat4x2h;case"mat4x3h":return ke.mat4x3h;case"mat4x4h":return ke.mat4x4h;case"mat2x2i":return ke.mat2x2i;case"mat2x3i":return ke.mat2x3i;case"mat2x4i":return ke.mat2x4i;case"mat3x2i":return ke.mat3x2i;case"mat3x3i":return ke.mat3x3i;case"mat3x4i":return ke.mat3x4i;case"mat4x2i":return ke.mat4x2i;case"mat4x3i":return ke.mat4x3i;case"mat4x4i":return ke.mat4x4i;case"mat2x2u":return ke.mat2x2u;case"mat2x3u":return ke.mat2x3u;case"mat2x4u":return ke.mat2x4u;case"mat3x2u":return ke.mat3x2u;case"mat3x3u":return ke.mat3x3u;case"mat3x4u":return ke.mat3x4u;case"mat4x2u":return ke.mat4x2u;case"mat4x3u":return ke.mat4x3u;case"mat4x4u":return ke.mat4x4u}return null}_validateTypeRange(e,t){if("i32"===t.name){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if("u32"===t.name&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(rt.tokens.ident)){const e=this._previous().toString();if(this._check(rt.tokens.paren_left)){const t=this._argument_expression_list(),n=this._getType(e);return null!==n?this._updateNode(new Le(n,t)):this._updateNode(new Oe(e,t))}if(this._context.constants.has(e)){const t=this._context.constants.get(e);return this._updateNode(new Me(e,t.value))}return this._updateNode(new $e(e))}if(this._match(rt.tokens.int_literal)){const e=this._previous().toString();let t=e.endsWith("i")||e.endsWith("i")?ve.i32:e.endsWith("u")||e.endsWith("U")?ve.u32:ve.x32;const n=parseInt(e);return this._validateTypeRange(n,t),this._updateNode(new Ce(new Ze(n,this._exec.getTypeInfo(t)),t))}if(this._match(rt.tokens.uint_literal)){const e=parseInt(this._previous().toString());return this._validateTypeRange(e,ve.u32),this._updateNode(new Ce(new Ze(e,this._exec.getTypeInfo(ve.u32)),ve.u32))}if(this._match([rt.tokens.decimal_float_literal,rt.tokens.hex_float_literal])){let e=this._previous().toString(),t=e.endsWith("h");t&&(e=e.substring(0,e.length-1));const n=parseFloat(e);this._validateTypeRange(n,t?ve.f16:ve.f32);const r=t?ve.f16:ve.f32;return this._updateNode(new Ce(new Ze(n,this._exec.getTypeInfo(r)),r))}if(this._match([rt.keywords.true,rt.keywords.false])){let e=this._previous().toString()===rt.keywords.true.rule;return this._updateNode(new Ce(new Ze(e?1:0,this._exec.getTypeInfo(ve.bool)),ve.bool))}if(this._check(rt.tokens.paren_left))return this._paren_expression();if(this._match(rt.keywords.bitcast)){this._consume(rt.tokens.less_than,"Expected '<'.");const e=this._type_decl();this._consume(rt.tokens.greater_than,"Expected '>'.");const t=this._paren_expression();return this._updateNode(new Ne(e,t))}const e=this._type_decl(),t=this._argument_expression_list();return this._updateNode(new Le(e,t))}_argument_expression_list(){if(!this._match(rt.tokens.paren_left))return null;const e=[];do{if(this._check(rt.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(rt.tokens.comma));return this._consume(rt.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(rt.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(rt.tokens.paren_right),e}_paren_expression(){this._consume(rt.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(rt.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(rt.keywords.struct))return null;const e=this._currentLine,t=this._consume(rt.tokens.ident,"Expected name for struct.").toString();this._consume(rt.tokens.brace_left,"Expected '{' for struct body.");const n=[];for(;!this._check(rt.tokens.brace_right);){const e=this._attribute(),t=this._consume(rt.tokens.name,"Expected variable name.").toString();this._consume(rt.tokens.colon,"Expected ':' for struct member type.");const r=this._attribute(),s=this._type_decl();null!=s&&(s.attributes=r),this._check(rt.tokens.brace_right)?this._match(rt.tokens.comma):this._consume(rt.tokens.comma,"Expected ',' for struct member."),n.push(this._updateNode(new je(t,s,e)))}this._consume(rt.tokens.brace_right,"Expected '}' after struct body.");const r=this._currentLine,s=this._updateNode(new we(t,n,e,r),e);return this._context.structs.set(t,s),s}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(rt.tokens.equal)){const t=this._const_expression();e.value=t}if(null!==e.type&&e.value instanceof Ce){if("x32"!==e.value.type.name&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else null===e.type&&e.value instanceof Ce&&(e.type="x32"===e.value.type.name?ve.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(rt.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(rt.keywords.const))return null;const t=this._consume(rt.tokens.name,"Expected variable name"),n=this._currentLine;let r=null;if(this._match(rt.tokens.colon)){const e=this._attribute();r=this._type_decl(),null!=r&&(r.attributes=e)}let s=null;this._consume(rt.tokens.equal,"const declarations require an assignment");const i=this._short_circuit_or_expression();try{let e=[ve.f32],n=i.constEvaluate(this._exec,e);n instanceof Ze&&this._validateTypeRange(n.value,e[0]),e[0]instanceof ke&&null===e[0].format&&n.typeInfo instanceof k&&null!==n.typeInfo.format&&("f16"===n.typeInfo.format.name?e[0].format=ve.f16:"f32"===n.typeInfo.format.name?e[0].format=ve.f32:"i32"===n.typeInfo.format.name?e[0].format=ve.i32:"u32"===n.typeInfo.format.name?e[0].format=ve.u32:"bool"===n.typeInfo.format.name?e[0].format=ve.bool:console.error(`TODO: impelement template format type ${n.typeInfo.format.name}`)),s=this._updateNode(new Ce(n,e[0])),this._exec.context.setVariable(t.toString(),n)}catch(e){s=i}if(null!==r&&s instanceof Ce){if("x32"!==s.type.name&&r.getTypeName()!==s.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${s.type.name} to ${r.name}. Line:${this._currentLine}`);s.type=r,s.isScalar&&this._validateTypeRange(s.scalarValue,s.type)}else null===r&&s instanceof Ce&&(r=null!==(e=null==s?void 0:s.type)&&void 0!==e?e:ve.f32,r===ve.x32&&(r=ve.i32));const o=this._updateNode(new te(t.toString(),r,"","",s),n);return this._context.constants.set(o.name,o),o}_global_let_decl(){if(!this._match(rt.keywords.let))return null;const e=this._currentLine,t=this._consume(rt.tokens.name,"Expected variable name");let n=null;if(this._match(rt.tokens.colon)){const e=this._attribute();n=this._type_decl(),null!=n&&(n.attributes=e)}let r=null;if(this._match(rt.tokens.equal)&&(r=this._const_expression()),null!==n&&r instanceof Ce){if("x32"!==r.type.name&&n.getTypeName()!==r.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${r.type.name} to ${n.name}. Line:${this._currentLine}`);r.type=n}else null===n&&r instanceof Ce&&(n="x32"===r.type.name?ve.i32:r.type);return r instanceof Ce&&r.isScalar&&this._validateTypeRange(r.scalarValue,n),this._updateNode(new ee(t.toString(),n,"","",r),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(rt.keywords.var))return null;const e=this._currentLine;let t="",n="";this._match(rt.tokens.less_than)&&(t=this._consume(rt.storage_class,"Expected storage_class.").toString(),this._match(rt.tokens.comma)&&(n=this._consume(rt.access_mode,"Expected access_mode.").toString()),this._consume(rt.tokens.greater_than,"Expected '>'."));const r=this._consume(rt.tokens.name,"Expected variable name");let s=null;if(this._match(rt.tokens.colon)){const e=this._attribute();s=this._type_decl(),null!=s&&(s.attributes=e)}return this._updateNode(new Q(r.toString(),s,t,n,null),e)}_override_decl(){if(!this._match(rt.keywords.override))return null;const e=this._consume(rt.tokens.name,"Expected variable name");let t=null;if(this._match(rt.tokens.colon)){const e=this._attribute();t=this._type_decl(),null!=t&&(t.attributes=e)}return this._updateNode(new J(e.toString(),t,null))}_diagnostic(){this._consume(rt.tokens.paren_left,"Expected '('");const e=this._consume(rt.tokens.ident,"Expected severity control name.");this._consume(rt.tokens.comma,"Expected ','");let t=this._consume(rt.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(rt.tokens.period)&&(t+=`.${this._consume(rt.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(rt.tokens.paren_right,"Expected ')'"),this._updateNode(new me(e.toString(),t))}_enable_directive(){const e=this._consume(rt.tokens.ident,"identity expected.");return this._updateNode(new de(e.toString()))}_requires_directive(){const e=[this._consume(rt.tokens.ident,"identity expected.").toString()];for(;this._match(rt.tokens.comma);){const t=this._consume(rt.tokens.ident,"identity expected.");e.push(t.toString())}return this._updateNode(new pe(e))}_type_alias(){const e=this._consume(rt.tokens.ident,"identity expected.");this._consume(rt.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(null===t)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const n=this._updateNode(new ge(e.toString(),t));return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([rt.tokens.ident,...rt.texel_format,rt.keywords.bool,rt.keywords.f32,rt.keywords.i32,rt.keywords.u32])){const e=this._advance().toString();if(this._context.structs.has(e))return this._context.structs.get(e);if(this._context.aliases.has(e))return this._context.aliases.get(e).type;if(!this._getType(e)){const t=this._updateNode(new xe(e));return this._forwardTypeCount++,t}return this._updateNode(new ve(e))}let e=this._texture_sampler_types();if(e)return e;if(this._check(rt.template_types)){let e=this._advance().toString(),t=null,n=null;return this._match(rt.tokens.less_than)&&(t=this._type_decl(),n=null,this._match(rt.tokens.comma)&&(n=this._consume(rt.access_mode,"Expected access_mode for pointer").toString()),this._consume(rt.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new ke(e,t,n))}if(this._match(rt.keywords.ptr)){let e=this._previous().toString();this._consume(rt.tokens.less_than,"Expected '<' for pointer.");const t=this._consume(rt.storage_class,"Expected storage_class for pointer");this._consume(rt.tokens.comma,"Expected ',' for pointer.");const n=this._type_decl();let r=null;return this._match(rt.tokens.comma)&&(r=this._consume(rt.access_mode,"Expected access_mode for pointer").toString()),this._consume(rt.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new Ie(e,t.toString(),n,r))}const t=this._attribute();if(this._match(rt.keywords.array)){let n=null,r=-1;const s=this._previous();let i=null;if(this._match(rt.tokens.less_than)){n=this._type_decl(),this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);let t="";if(this._match(rt.tokens.comma)){i=this._shift_expression();try{t=i.constEvaluate(this._exec).toString(),i=null}catch(e){t="1"}}this._consume(rt.tokens.greater_than,"Expected '>' for array."),r=t?parseInt(t):0}const o=this._updateNode(new Te(s.toString(),t,n,r));return i&&this._deferArrayCountEval.push({arrayType:o,countNode:i}),o}return null}_texture_sampler_types(){if(this._match(rt.sampler_type))return this._updateNode(new Ee(this._previous().toString(),null,null));if(this._match(rt.depth_texture_type))return this._updateNode(new Ee(this._previous().toString(),null,null));if(this._match(rt.sampled_texture_type)||this._match(rt.multisampled_texture_type)){const e=this._previous();this._consume(rt.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(rt.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Ee(e.toString(),t,null))}if(this._match(rt.storage_texture_type)){const e=this._previous();this._consume(rt.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(rt.texel_format,"Invalid texel format.").toString();this._consume(rt.tokens.comma,"Expected ',' after texel format.");const n=this._consume(rt.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(rt.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Ee(e.toString(),t,n))}return null}_attribute(){let e=[];for(;this._match(rt.tokens.attr);){const t=this._consume(rt.attribute_name,"Expected attribute name"),n=this._updateNode(new He(t.toString(),null));if(this._match(rt.tokens.paren_left)){if(n.value=this._consume(rt.literal_or_ident,"Expected attribute value").toString(),this._check(rt.tokens.comma)){this._advance();do{const e=this._consume(rt.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(e)}while(this._match(rt.tokens.comma))}this._consume(rt.tokens.paren_right,"Expected ')'")}e.push(n)}return 0==e.length?null:e}}class Ot extends bt{constructor(e){super(),e&&this.update(e)}update(e){const t=(new Lt).parse(e);this.updateAST(t)}}function $t(e){const t={attributes:[],bindings:[]};let n;try{n=function(e){try{return new Ot(e)}catch(t){if(t instanceof Error)throw t;let e="WGSL parse error";throw"object"==typeof t&&t?.message&&(e+=`: ${t.message} `),"object"==typeof t&&t?.token&&(e+=t.token.line||""),new Error(e,{cause:t})}}(e)}catch(o){return s.R.error(o.message)(),t}for(const s of n.uniforms){const e=[];for(const t of s.type?.members||[])e.push({name:t.name,type:Mt(t.type)});t.bindings.push({type:"uniform",name:s.name,group:s.group,location:s.binding,members:e})}for(const s of n.textures)t.bindings.push({type:"texture",name:s.name,group:s.group,location:s.binding});for(const s of n.samplers)t.bindings.push({type:"sampler",name:s.name,group:s.group,location:s.binding});const r=n.entry.vertex[0],i=r?.inputs.length||0;for(let s=0;s<i;s++){const e=r.inputs[s];if("location"===e.locationType){const n=Mt(e.type);t.attributes.push({name:e.name,location:Number(e.location),type:n})}}return t}function Mt(e){return e?.format?`${e.name}<${e.format.name}>`:e.name}var Ct=n(77933),Nt=n(4500);class Dt{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(e){if(this.id=e.id||(0,Nt.L)("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&i.h.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){this.indices?.destroy();for(const e of Object.values(this.attributes))e.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function Bt(e,t){if(t instanceof Dt)return t;const n=function(e,t){if(!t.indices)return;const n=t.indices.value;return e.createBuffer({usage:i.h.INDEX,data:n})}(e,t),{attributes:r,bufferLayout:s}=function(e,t){const n=[],r={};for(const[i,o]of Object.entries(t.attributes)){let t=i;switch(i){case"POSITION":t="positions";break;case"NORMAL":t="normals";break;case"TEXCOORD_0":t="texCoords";break;case"COLOR_0":t="colors"}if(o){r[t]=e.createBuffer({data:o.value,id:`${i}-buffer`});const{value:s,size:a,normalized:u}=o;n.push({name:t,format:(0,Ct.OB)(s,a,u)})}}const s=t._calculateVertexCount(t.attributes,t.indices);return{attributes:r,bufferLayout:n,vertexCount:s}}(e,t);return new Dt({topology:t.topology||"triangle-list",bufferLayout:s,vertexCount:t.vertexCount,indices:n,attributes:r})}var Pt=n(69499);class Ft{static defaultProps={...r.r.defaultProps};static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new Ft(e),e._lumaData.defaultPipelineFactory}device;cachingEnabled;destroyPolicy;debug;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};get[Symbol.toStringTag](){return"PipelineFactory"}toString(){return`PipelineFactory(${this.device.id})`}constructor(e){this.device=e,this.cachingEnabled=e.props._cachePipelines,this.destroyPolicy=e.props._cacheDestroyPolicy,this.debug=e.props.debugFactories}createRenderPipeline(e){if(!this.cachingEnabled)return this.device.createRenderPipeline(e);const t={...r.r.defaultProps,...e},n=this._renderPipelineCache,i=this._hashRenderPipeline(t);let o=n[i]?.pipeline;return o?(n[i].useCount++,this.debug&&s.R.warn(`${this}: ${n[i].pipeline} reused, count=${n[i].useCount}, (id=${e.id})`)()):(o=this.device.createRenderPipeline({...t,id:t.id?`${t.id}-cached`:(0,Nt.L)("unnamed-cached")}),o.hash=i,n[i]={pipeline:o,useCount:1},this.debug&&s.R.warn(`${this}: ${o} created, count=${n[i].useCount}`)()),o}createComputePipeline(e){if(!this.cachingEnabled)return this.device.createComputePipeline(e);const t={...Pt.C.defaultProps,...e},n=this._computePipelineCache,r=this._hashComputePipeline(t);let i=n[r]?.pipeline;return i?(n[r].useCount++,this.debug&&s.R.warn(`${this}: ${n[r].pipeline} reused, count=${n[r].useCount}, (id=${e.id})`)()):(i=this.device.createComputePipeline({...t,id:t.id?`${t.id}-cached`:void 0}),i.hash=r,n[r]={pipeline:i,useCount:1},this.debug&&s.R.warn(`${this}: ${i} created, count=${n[r].useCount}`)()),i}release(e){if(!this.cachingEnabled)return void e.destroy();const t=this._getCache(e),n=e.hash;t[n].useCount--,0===t[n].useCount?(this._destroyPipeline(e),this.debug&&s.R.warn(`${this}: ${e} released and destroyed`)()):t[n].useCount<0?(s.R.error(`${this}: ${e} released, useCount < 0, resetting`)(),t[n].useCount=0):this.debug&&s.R.warn(`${this}: ${e} released, count=${t[n].useCount}`)()}_destroyPipeline(e){const t=this._getCache(e);switch(this.destroyPolicy){case"never":return!1;case"unused":return delete t[e.hash],e.destroy(),!0}}_getCache(e){let t;if(e instanceof Pt.C&&(t=this._computePipelineCache),e instanceof r.r&&(t=this._renderPipelineCache),!t)throw new Error(`${this}`);if(!t[e.hash])throw new Error(`${this}: ${e} matched incorrect entry`);return t}_hashComputePipeline(e){const{type:t}=this.device;return`${t}/C/${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const t=e.vs?this._getHash(e.vs.source):0,n=e.fs?this._getHash(e.fs.source):0,r=this._getHash(JSON.stringify(e.bufferLayout)),{type:s}=this.device;if("webgl"===s)return`${s}/R/${t}/${n}V-BL${r}`;{const i=this._getHash(JSON.stringify(e.parameters));return`${s}/R/${t}/${n}V-T${e.topology}P${i}BL${r}`}}_getHash(e){return void 0===this._hashes[e]&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}}var Ut=n(11669);class Rt{static defaultProps={...Ut.M.defaultProps};static getDefaultShaderFactory(e){return e._lumaData.defaultShaderFactory||=new Rt(e),e._lumaData.defaultShaderFactory}device;cachingEnabled;destroyPolicy;debug;_cache={};get[Symbol.toStringTag](){return"ShaderFactory"}toString(){return`${this[Symbol.toStringTag]}(${this.device.id})`}constructor(e){this.device=e,this.cachingEnabled=e.props._cacheShaders,this.destroyPolicy=e.props._cacheDestroyPolicy,this.debug=!0}createShader(e){if(!this.cachingEnabled)return this.device.createShader(e);const t=this._hashShader(e);let n=this._cache[t];if(n)n.useCount++,this.debug&&s.R.warn(`${this}: Reusing shader ${n.shader.id} count=${n.useCount}`)();else{const r=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=n={shader:r,useCount:1},this.debug&&s.R.warn(`${this}: Created new shader ${r.id}`)()}return n.shader}release(e){if(!this.cachingEnabled)return void e.destroy();const t=this._hashShader(e),n=this._cache[t];if(n)if(n.useCount--,0===n.useCount)"unused"===this.destroyPolicy&&(delete this._cache[t],n.shader.destroy(),this.debug&&s.R.warn(`${this}: Releasing shader ${e.id}, destroyed`)());else{if(n.useCount<0)throw new Error(`ShaderFactory: Shader ${e.id} released too many times`);this.debug&&s.R.warn(`${this}: Releasing shader ${e.id} count=${n.useCount}`)()}}_hashShader(e){return`${e.stage}:${e.source}`}}let Vt=null,Wt=null;function zt(e,t,n){if(e===t)return!0;if(!n||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!zt(e[r],t[r],n-1))return!1;return!0}if(Array.isArray(t))return!1;if("object"==typeof e&&"object"==typeof t){const r=Object.keys(e),s=Object.keys(t);if(r.length!==s.length)return!1;for(const i of r){if(!t.hasOwnProperty(i))return!1;if(!zt(e[i],t[i],n-1))return!1}return!0}return!1}class qt{bufferLayouts;constructor(e){this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find((t=>t.name===e))||null}getAttributeNamesForBuffer(e){return e.attributes?e.attributes?.map((e=>e.attribute)):[e.name]}mergeBufferLayouts(e,t){const n=[...e];for(const r of t){const e=n.findIndex((e=>e.name===r.name));e<0?n.push(r):n[e]=r}return n}getBufferIndex(e){const t=this.bufferLayouts.findIndex((t=>t.name===e));return-1===t&&s.R.warn(`BufferLayout: Missing buffer for "${e}".`)(),t}}var jt=n(35185);function Ht(e){return function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}(e)||function(e){return!!Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}(e)}function Gt(e){const t={bindings:{},uniforms:{}};return Object.keys(e).forEach((n=>{const r=e[n];var s;Ht(s=r)||"number"==typeof s||"boolean"==typeof s?t.uniforms[n]=r:t.bindings[n]=r})),t}class Xt{options={disableWarnings:!1};modules;moduleUniforms;moduleBindings;constructor(e,t){Object.assign(this.options,t);const n=(0,jt.$Q)(Object.values(e).filter((e=>e.dependencies)));for(const r of n)e[r.name]=r;s.R.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[r,i]of Object.entries(e))this._addModule(i),i.name&&r!==i.name&&!this.options.disableWarnings&&s.R.warn(`Module name: ${r} vs ${i.name}`)()}destroy(){}setProps(e){for(const t of Object.keys(e)){const n=t,r=e[n]||{},i=this.modules[n];if(!i){this.options.disableWarnings||s.R.warn(`Module ${t} not found`)();continue}const o=this.moduleUniforms[n],a=this.moduleBindings[n],u=i.getUniforms?.(r,o)||r,{uniforms:c,bindings:l}=Gt(u);this.moduleUniforms[n]={...o,...c},this.moduleBindings[n]={...a,...l}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){const e={};for(const[t,n]of Object.entries(this.moduleUniforms))for(const[r,s]of Object.entries(n))e[`${t}.${r}`]={type:this.modules[t].uniformTypes?.[r],value:String(s)};return e}_addModule(e){const t=e.name;this.moduleUniforms[t]=e.defaultUniforms||{},this.moduleBindings[t]={}}}let Yt="";const Zt=["+X","-X","+Y","-Y","+Z","-Z"],Kt=["+X","-X","+Y","-Y","+Z","-Z"];class Qt{device;id;props;texture;sampler;view;ready;isReady=!1;destroyed=!1;resolveReady=()=>{};rejectReady=()=>{};get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}constructor(e,t){this.device=e;const n=(0,Nt.L)("async-texture");this.props={...Qt.defaultProps,id:n,...t},this.id=this.props.id,t={...t},"string"==typeof t?.data&&"2d"===t.dimension&&(t.data=async function(e,t){const n=new Image;return n.crossOrigin=t?.crossOrigin||"anonymous",n.src=e.startsWith("http")?e:Yt+e,await n.decode(),t?await createImageBitmap(n,t):await createImageBitmap(n)}(t.data)),t.mipmaps&&(t.mipLevels="auto"),this.ready=new Promise(((e,t)=>{this.resolveReady=()=>{this.isReady=!0,e()},this.rejectReady=t})),this.initAsync(t)}async initAsync(e){const t=e.data,n=await Jt(t).then(void 0,this.rejectReady);if(this.destroyed)return;const r=this.props.width&&this.props.height?{width:this.props.width,height:this.props.height}:this.getTextureDataSize(n);if(!r)throw new Error("Texture size could not be determined");const i={...r,...e,data:void 0,mipLevels:1},o=this.device.getMipLevelCount(i.width,i.height);if(i.mipLevels="auto"===this.props.mipLevels?o:Math.min(o,this.props.mipLevels),this.texture=this.device.createTexture(i),this.sampler=this.texture.sampler,this.view=this.texture.view,e.data)switch(this.props.dimension){case"1d":this._setTexture1DData(this.texture,n);break;case"2d":this._setTexture2DData(n);break;case"3d":this._setTexture3DData(this.texture,n);break;case"2d-array":this._setTextureArrayData(this.texture,n);break;case"cube":this._setTextureCubeData(this.texture,n);break;case"cube-array":this._setTextureCubeArrayData(this.texture,n)}this.props.mipmaps&&this.generateMipmaps(),s.R.info(1,`${this} loaded`),this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}generateMipmaps(){this.texture.generateMipmapsWebGL()}setSampler(e={}){this.texture.setSampler(e instanceof g.L?e:this.device.createSampler(e))}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const t=this.texture;this.texture=t.clone(e),t.destroy()}return!0}isTextureLevelData(e){const t=e?.data;return ArrayBuffer.isView(t)}getTextureDataSize(e){if(!e)return null;if(ArrayBuffer.isView(e))return null;if(Array.isArray(e))return this.getTextureDataSize(e[0]);if(this.device.isExternalImage(e))return this.device.getExternalImageSize(e);if(e&&"object"==typeof e&&e.constructor===Object){const t=Object.values(e)[0];return{width:t.width,height:t.height}}throw new Error("texture size deduction failed")}getCubeFaceDepth(e){switch(e){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(e)}}setTextureData(e){}_setTexture1DData(e,t){throw new Error("setTexture1DData not supported in WebGL.")}_setTexture2DData(e,t=0){if(!this.texture)throw new Error("Texture not initialized");const n=this._normalizeTextureData(e);n.length>1&&!1!==this.props.mipmaps&&s.R.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let r=0;r<n.length;r++){const e=n[r];this.device.isExternalImage(e)?this.texture.copyExternalImage({image:e,depth:t,mipLevel:r,flipY:!0}):this.texture.copyImageData({data:e.data,mipLevel:r})}}_setTexture3DData(e,t){if("3d"!==this.texture?.props.dimension)throw new Error(this.id);for(let n=0;n<t.length;n++)this._setTexture2DData(t[n],n)}_setTextureCubeData(e,t){if("cube"!==this.texture?.props.dimension)throw new Error(this.id);for(const[n,r]of Object.entries(t)){const e=Kt.indexOf(n);this._setTexture2DData(r,e)}}_setTextureArrayData(e,t){if("2d-array"!==this.texture?.props.dimension)throw new Error(this.id);for(let n=0;n<t.length;n++)this._setTexture2DData(t[n],n)}_setTextureCubeArrayData(e,t){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}_setTextureCubeFaceData(e,t,n,r=0){Array.isArray(t)&&t.length>1&&!1!==this.props.mipmaps&&s.R.warn(`${this.id} has mipmap and multiple LODs.`)();const i=Zt.indexOf(n);this._setTexture2DData(t,i)}_normalizeTextureData(e){const t=this.texture;let n;return n=ArrayBuffer.isView(e)?[{data:e,width:t.width,height:t.height}]:Array.isArray(e)?e:[e],n}static defaultProps={...m.g.defaultProps,data:null,mipmaps:!1}}async function Jt(e){if(e=await e,Array.isArray(e))return await Promise.all(e.map(Jt));if(e&&"object"==typeof e&&e.constructor===Object){const t=e,n=await Promise.all(Object.values(t)),r=Object.keys(t),s={};for(let e=0;e<r.length;e++)s[r[e]]=n[e];return s}return e}class en{static defaultProps={...r.r.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:_._.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0};device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;isInstanced=void 0;instanceCount=0;vertexCount;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}constructor(e,t){this.props={...en.defaultProps,...t},t=this.props,this.id=t.id||(0,Nt.L)("model"),this.device=e,Object.assign(this.userData,t.userData);const n=Object.fromEntries(this.props.modules?.map((e=>[e.name,e]))||[]),r=t.shaderInputs||new Xt(n,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(r);const s=function(e){return{type:e.type,shaderLanguage:e.info.shadingLanguage,shaderLanguageVersion:e.info.shadingLanguageVersion,gpu:e.info.gpu,features:e.features}}(e),i=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if("webgpu"===this.device.type&&this.props.source){const{source:e,getUniforms:t}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:s,...this.props,modules:i});this.source=e,this._getModuleUniforms=t,this.props.shaderLayout||=$t(this.source)}else{const{vs:e,fs:t,getUniforms:n}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:s,...this.props,modules:i});this.vs=e,this.fs=t,this._getModuleUniforms=n}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&this.setGeometry(t.geometry),this.pipelineFactory=t.pipelineFactory||Ft.getDefaultPipelineFactory(this.device),this.shaderFactory=t.shaderFactory||Rt.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in t&&(this.isInstanced=t.isInstanced),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.vertexCount&&this.setVertexCount(t.vertexCount),t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||=e}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const t=this._areBindingsLoading();if(t)return s.R.info(2,`>>> DRAWING ABORTED ${this.id}: ${t} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let n;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const t=this._getBindings();this.pipeline.setBindings(t,{disableWarnings:this.props.disableWarnings});const{indexBuffer:r}=this.vertexArray,s=r?r.byteLength/("uint32"===r.indexType?4:2):void 0;n=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:s,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),n?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",n}setGeometry(e){this._gpuGeometry?.destroy();const t=e&&Bt(this.device,e);if(t){this.setTopology(t.topology||"triangle-list");const e=new qt(this.bufferLayout);this.bufferLayout=e.mergeBufferLayouts(t.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(t)}this._gpuGeometry=t}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const t=new qt(this.bufferLayout);this.bufferLayout=this._gpuGeometry?t.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){zt(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,void 0===this.isInstanced&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new f(this.shaderInputs.modules);for(const[t,n]of Object.entries(this.shaderInputs.modules))if(tn(n)){const e=this._uniformStore.getManagedUniformBuffer(this.device,t);this.bindings[`${t}Uniforms`]=e}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){const n=t?.disableWarnings??this.props.disableWarnings;e.indices&&s.R.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=function(e,t){const n=Object.fromEntries(e.attributes.map((e=>[e.name,e.location]))),r=t.slice();return r.sort(((e,t)=>{const r=e.attributes?e.attributes.map((e=>e.attribute)):[e.name],s=t.attributes?t.attributes.map((e=>e.attribute)):[t.name];return Math.min(...r.map((e=>n[e])))-Math.min(...s.map((e=>n[e])))})),r}(this.pipeline.shaderLayout,this.bufferLayout);const r=new qt(this.bufferLayout);for(const[i,o]of Object.entries(e)){const e=r.getBufferLayout(i);if(!e){n||s.R.warn(`Model(${this.id}): Missing layout for buffer "${i}".`)();continue}const t=r.getAttributeNamesForBuffer(e);let a=!1;for(const n of t){const e=this._attributeInfos[n];if(e){const t="webgpu"===this.device.type?r.getBufferIndex(e.bufferName):e.location;this.vertexArray.setBuffer(t,o),a=!0}}a||n||s.R.warn(`Model(${this.id}): Ignoring buffer "${o.id}" for unknown attribute "${i}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(const[n,r]of Object.entries(e)){const e=this._attributeInfos[n];e?this.vertexArray.setConstantWebGL(e.location,r):(t?.disableWarnings??this.props.disableWarnings)||s.R.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${n}"`)()}this.setNeedsRedraw("constants")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof Qt&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[t,n]of Object.entries(this.bindings))n instanceof Qt?n.isReady&&(e[t]=n.texture):e[t]=n;return e}_getBindingsUpdateTimestamp(){let e=0;for(const t of Object.values(this.bindings))t instanceof p.X?e=Math.max(e,t.texture.updateTimestamp):t instanceof i.h||t instanceof m.g?e=Math.max(e,t.updateTimestamp):t instanceof Qt?e=t.texture?Math.max(e,t.texture.updateTimestamp):1/0:t instanceof g.L||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const t={...e.attributes};for(const[n]of Object.entries(t))this.pipeline.shaderLayout.attributes.find((e=>e.name===n))||"positions"===n||delete t[n];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||=e,this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(s.R.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const n=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let r=null;this.source?r=n:this.fs&&(r=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:n,fs:r}),this._attributeInfos=(0,y.P)(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){const e=s.R.level>3?0:1e4;s.R.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,s.R.group(2,`>>> DRAWING MODEL ${this.id}`,{collapsed:s.R.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=function(e){const t={},n="Values";if(0===e.attributes.length&&!e.varyings?.length)return{"No attributes or varyings":{[n]:"N/A"}};for(const r of e.attributes)r&&(t[`in ${r.location} ${r.name}: ${r.type}`]={[n]:r.stepMode||"vertex"});for(const r of e.varyings||[])t[`out ${r.location} ${r.name}`]={[n]:JSON.stringify(r)};return t}(this.pipeline.shaderLayout,this.id);s.R.table(2,e)();const t=this.shaderInputs.getDebugTable();s.R.table(2,t)();const n=this._getAttributeDebugTable();s.R.table(2,this._attributeInfos)(),s.R.table(2,n)(),s.R.groupEnd(2)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(e){const t=this.device.props.debugFramebuffers;if(this._drawCount++,!t)return;const n=e.props.framebuffer;n&&function(e,{id:t,minimap:n,opaque:r,top:s="0",left:i="0",rgbaScale:o=1}){Vt||(Vt=document.createElement("canvas"),Vt.id=t,Vt.title=t,Vt.style.zIndex="100",Vt.style.position="absolute",Vt.style.top=s,Vt.style.left=i,Vt.style.border="blue 5px solid",Vt.style.transform="scaleY(-1)",document.body.appendChild(Vt),Wt=Vt.getContext("2d")),Vt.width===e.width&&Vt.height===e.height||(Vt.width=e.width/2,Vt.height=e.height/2,Vt.style.width="400px",Vt.style.height="400px");const a=e.device.readPixelsToArrayWebGL(e),u=Wt?.createImageData(e.width,e.height);if(u){const e=0;for(let t=0;t<a.length;t+=4)u.data[e+t+0]=a[t+0]*o,u.data[e+t+1]=a[t+1]*o,u.data[e+t+2]=a[t+2]*o,u.data[e+t+3]=r?255:a[t+3]*o;Wt?.putImageData(u,0,0)}}(n,{id:n.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[t,n]of Object.entries(this._attributeInfos)){const r=this.vertexArray.attributes[n.location];e[n.location]={name:t,type:n.shaderType,values:r?this._getBufferOrConstantValues(r,n.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:t}=this.vertexArray,n="uint32"===t.indexType?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:n.toString()}}return e}_getBufferOrConstantValues(e,t){const n=(0,u.Ak)(t);return(e instanceof i.h?new n(e.debugData):e).toString()}}function tn(e){return Boolean(e.uniformTypes&&!function(e){for(const t in e)return!1;return!0}(e.uniformTypes))}},4500:(e,t,n)=>{n.d(t,{L:()=>s});const r={};function s(e="id"){r[e]=r[e]||1;return`${e}-${r[e]++}`}},73288:(e,t,n)=>{n.d(t,{Wk:()=>s});const r="#version 300 es\nout vec4 transform_output;\nvoid main() {\n  transform_output = vec4(0);\n}";function s(e){const{input:t,inputChannels:n,output:s}=e||{};if(!t)return r;if(!n)throw new Error("inputChannels");return`#version 300 es\nin ${function(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${e}`)}}(n)} ${t};\nout vec4 ${s};\nvoid main() {\n  ${s} = ${function(e,t){switch(t){case 1:return`vec4(${e}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${e}, 0.0, 1.0)`;case 3:return`vec4(${e}, 1.0)`;case 4:return e;default:throw new Error(`invalid channels: ${t}`)}}(t,n)};\n}`}},3189:(e,t,n)=>{n.d(t,{_:()=>k});var r=n(70628),s=n(35185);var i=n(42984);const o=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,"#version 300 es\n"],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],a=[...o,[l("attribute"),"in $1"],[l("varying"),"out $1"]],u=[...o,[l("varying"),"in $1"]];function c(e,t){for(const[n,r]of t)e=e.replace(n,r);return e}function l(e){return new RegExp(`\\b${e}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function h(e,t){let n="";for(const r in e){const s=e[r];if(n+=`void ${s.signature} {\n`,s.header&&(n+=`  ${s.header}`),t[r]){const e=t[r];e.sort(((e,t)=>e.order-t.order));for(const t of e)n+=`  ${t.injection}\n`}s.footer&&(n+=`  ${s.footer}`),n+="}\n"}return n}function f(e){const t={vertex:{},fragment:{}};for(const n of e){let e,r;"string"!=typeof n?(e=n,r=e.hook):(e={},r=n),r=r.trim();const[s,i]=r.split(":"),o=r.replace(/\(.+/,""),a=Object.assign(e,{signature:i});switch(s){case"vs":t.vertex[o]=a;break;case"fs":t.fragment[o]=a;break;default:throw new Error(s)}}return t}function d(e,t){if(!e)throw new Error(t||"shadertools: assertion failed.")}function p(e,t="unnamed"){const n=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(e);return n?n[1]:t}function m(e){let t=100;const n=e.match(/[^\s]+/g);if(n&&n.length>=2&&"#version"===n[0]){const e=parseInt(n[1],10);Number.isFinite(e)&&(t=e)}if(100!==t&&300!==t)throw new Error(`Invalid GLSL version ${t}`);return t}const g=`\n\n${i.O_}\n`;function y(e,t){const{source:n,stage:s,modules:o,hookFunctions:a=[],inject:u={},log:c}=t;d("string"==typeof n,"shader source must be a string");const l=n;let p="";const m=f(a),y={},_={},b={};for(const r in u){const e="string"==typeof u[r]?{injection:u[r],order:0}:u[r],t=/^(v|f)s:(#)?([\w-]+)$/.exec(r);if(t){const n=t[2],s=t[3];n?"decl"===s?_[r]=[e]:b[r]=[e]:y[r]=[e]}else b[r]=[e]}const x=o;for(const i of x){c&&(0,r.ZG)(i,l,c);p+=v(i,"wgsl");const e=i.injections?.[s]||{};for(const t in e){const n=/^(v|f)s:#([\w-]+)$/.exec(t);if(n){const r="decl"===n[2]?_:b;r[t]=r[t]||[],r[t].push(e[t])}else y[t]=y[t]||[],y[t].push(e[t])}}return p+=g,p=(0,i.bv)(p,s,_),p+=h(m[s],y),p+=l,p=(0,i.bv)(p,s,b),p}function _(e,t){const{source:n,stage:s,language:o="glsl",modules:l,defines:y={},hookFunctions:_=[],inject:b={},prologue:x=!0,log:w}=t;d("string"==typeof n,"shader source must be a string");const k="glsl"===o?function(e,t){return{name:p(e,t),language:"glsl",version:m(e)}}(n).version:-1,I=e.shaderLanguageVersion,T=100===k?"#version 100":"#version 300 es",E=n.split("\n").slice(1).join("\n"),A={};l.forEach((e=>{Object.assign(A,e.defines)})),Object.assign(A,y);let S="";switch(o){case"wgsl":break;case"glsl":S=x?`${T}\n\n// ----- PROLOGUE -------------------------\n#define SHADER_TYPE_${s.toUpperCase()}\n\n${function(e){switch(e?.gpu.toLowerCase()){case"apple":return"#define APPLE_GPU\n// Apple optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n";case"nvidia":return"#define NVIDIA_GPU\n// Nvidia optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n";case"intel":return"#define INTEL_GPU\n// Intel optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n";case"amd":return"#define AMD_GPU\n";default:return"#define DEFAULT_GPU\n// Prevent driver from optimizing away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Headless Chrome's software shader 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// If the GPU doesn't have full 32 bits precision, will causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n"}}(e)}\n${"fragment"===s?"precision highp float;\n":""}\n\n// ----- APPLICATION DEFINES -------------------------\n\n${function(e={}){let t="";for(const n in e){const r=e[n];(r||Number.isFinite(r))&&(t+=`#define ${n.toUpperCase()} ${e[n]}\n`)}return t}(A)}\n\n`:`${T}\n`}const L=f(_),O={},$={},M={};for(const r in b){const e="string"==typeof b[r]?{injection:b[r],order:0}:b[r],t=/^(v|f)s:(#)?([\w-]+)$/.exec(r);if(t){const n=t[2],s=t[3];n?"decl"===s?$[r]=[e]:M[r]=[e]:O[r]=[e]}else M[r]=[e]}for(const i of l){w&&(0,r.ZG)(i,E,w);S+=v(i,s);const e=i.instance?.normalizedInjections[s]||{};for(const t in e){const n=/^(v|f)s:#([\w-]+)$/.exec(t);if(n){const r="decl"===n[2]?$:M;r[t]=r[t]||[],r[t].push(e[t])}else O[t]=O[t]||[],O[t].push(e[t])}}return S+="// ----- MAIN SHADER SOURCE -------------------------",S+=g,S=(0,i.bv)(S,s,$),S+=h(L[s],O),S+=E,S=(0,i.bv)(S,s,M),"glsl"===o&&k!==I&&(S=function(e,t){if(300!==Number(e.match(/^#version[ \t]+(\d+)/m)?.[1]||100))throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(t){case"vertex":return c(e,a);case"fragment":return c(e,u);default:throw new Error(t)}}(S,s)),S.trim()}function b(e){return function(t){const n={};for(const r of e){const e=r.getUniforms?.(t,n);Object.assign(n,e)}return n}}function v(e,t){let n;switch(t){case"vertex":n=e.vs||"";break;case"fragment":n=e.fs||"";break;case"wgsl":n=e.source||"";break;default:d(!1)}if(!e.name)throw new Error("Shader module must have a name");const r=e.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let s=`// ----- MODULE ${e.name} ---------------\n\n`;return"wgsl"!==t&&(s+=`#define MODULE_${r}\n`),s+=`${n}\n`,s}const x=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,w=/^\s*\#\s*endif\s*$/;class k{static defaultShaderAssembler;_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return k.defaultShaderAssembler=k.defaultShaderAssembler||new k,k.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find((t=>t.name===("string"==typeof e?e:e.name)))||this._defaultModules.push(e)}removeDefaultModule(e){const t="string"==typeof e?e:e.name;this._defaultModules=this._defaultModules.filter((e=>e.name!==t))}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const t=this._getModuleList(e.modules),n=this._hookFunctions,{source:r,getUniforms:i}=function(e){const t=(0,s.$Q)(e.modules||[]);return{source:y(e.platformInfo,{...e,source:e.source,stage:"vertex",modules:t}),getUniforms:b(t)}}({...e,source:e.source,modules:t,hookFunctions:n}),o="wgsl"===e.platformInfo.shaderLanguage?function(e,t){const n=e.split("\n"),r=[];let s=!0,i=null;for(const o of n){const e=o.match(x),n=o.match(w);e?(i=e[1],s=Boolean(t?.defines?.[i])):n?s=!0:s&&r.push(o)}return r.join("\n")}(r):r;return{source:o,getUniforms:i,modules:t}}assembleGLSLShaderPair(e){const t=this._getModuleList(e.modules),n=this._hookFunctions,r=function(e){const{vs:t,fs:n}=e,r=(0,s.$Q)(e.modules||[]);return{vs:_(e.platformInfo,{...e,source:t,stage:"vertex",modules:r}),fs:_(e.platformInfo,{...e,source:n,stage:"fragment",modules:r}),getUniforms:b(r)}}({...e,vs:e.vs,fs:e.fs,modules:t,hookFunctions:n});return{...r,modules:t}}_getModuleList(e=[]){const t=new Array(this._defaultModules.length+e.length),n={};let s=0;for(let r=0,i=this._defaultModules.length;r<i;++r){const e=this._defaultModules[r],i=e.name;t[s++]=e,n[i]=!0}for(let r=0,i=e.length;r<i;++r){const i=e[r],o=i.name;n[o]||(t[s++]=i,n[o]=!0)}return t.length=s,(0,r.$g)(t),t}}},42984:(e,t,n)=>{n.d(t,{O_:()=>a,bv:()=>l,Uu:()=>u});const r={vertex:"#ifdef MODULE_LOGDEPTH\n  logdepth_adjustPosition(gl_Position);\n#endif\n",fragment:"#ifdef MODULE_MATERIAL\n  fragColor = material_filterColor(fragColor);\n#endif\n\n#ifdef MODULE_LIGHTING\n  fragColor = lighting_filterColor(fragColor);\n#endif\n\n#ifdef MODULE_FOG\n  fragColor = fog_filterColor(fragColor);\n#endif\n\n#ifdef MODULE_PICKING\n  fragColor = picking_filterHighlightColor(fragColor);\n  fragColor = picking_filterPickingColor(fragColor);\n#endif\n\n#ifdef MODULE_LOGDEPTH\n  logdepth_setFragDepth();\n#endif\n"},s=/void\s+main\s*\([^)]*\)\s*\{\n?/,i=/}\n?[^{}]*$/,o=[],a="__LUMA_INJECT_DECLARATIONS__";function u(e){const t={vertex:{},fragment:{}};for(const n in e){let r=e[n];"string"==typeof r&&(r={order:0,injection:r}),t[c(n)][n]=r}return t}function c(e){const t=e.slice(0,2);switch(t){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(t)}}function l(e,t,n,u=!1){const c="vertex"===t;for(const r in n){const t=n[r];t.sort(((e,t)=>e.order-t.order)),o.length=t.length;for(let e=0,n=t.length;e<n;++e)o[e]=t[e].injection;const u=`${o.join("\n")}\n`;switch(r){case"vs:#decl":c&&(e=e.replace(a,u));break;case"vs:#main-start":c&&(e=e.replace(s,(e=>e+u)));break;case"vs:#main-end":c&&(e=e.replace(i,(e=>u+e)));break;case"fs:#decl":c||(e=e.replace(a,u));break;case"fs:#main-start":c||(e=e.replace(s,(e=>e+u)));break;case"fs:#main-end":c||(e=e.replace(i,(e=>u+e)));break;default:e=e.replace(r,(e=>e+u))}}return e=e.replace(a,""),u&&(e=e.replace(/\}\s*$/,(e=>e+r[t]))),e}},35185:(e,t,n)=>{n.d(t,{$Q:()=>s});var r=n(70628);function s(e){(0,r.$g)(e);const t={},n={};i({modules:e,level:0,moduleMap:t,moduleDepth:n});const s=Object.keys(n).sort(((e,t)=>n[t]-n[e])).map((e=>t[e]));return(0,r.$g)(s),s}function i(e){const{modules:t,level:n,moduleMap:r,moduleDepth:s}=e;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const i of t)r[i.name]=i,(void 0===s[i.name]||s[i.name]<n)&&(s[i.name]=n);for(const o of t)o.dependencies&&i({modules:o.dependencies,level:n+1,moduleMap:r,moduleDepth:s})}},70628:(e,t,n)=>{n.d(t,{ZG:()=>c,UK:()=>u,$g:()=>a});const r={number:{type:"number",validate:(e,t)=>Number.isFinite(e)&&"object"==typeof t&&(void 0===t.max||e<=t.max)&&(void 0===t.min||e>=t.min)},array:{type:"array",validate:(e,t)=>Array.isArray(e)||ArrayBuffer.isView(e)}};function s(e){let t=i(e);if("object"!==t)return{value:e,...r[t],type:t};if("object"==typeof e)return e?void 0!==e.type?{...e,...r[e.type],type:e.type}:void 0===e.value?{type:"object",value:e}:(t=i(e.value),{...e,...r[t],type:t}):{type:"object",value:null};throw new Error("props")}function i(e){return Array.isArray(e)||ArrayBuffer.isView(e)?"array":typeof e}var o=n(42984);function a(e){e.map((e=>u(e)))}function u(e){if(e.instance)return;a(e.dependencies||[]);const{propTypes:t={},deprecations:n=[],inject:r={}}=e,i={normalizedInjections:(0,o.Uu)(r),parsedDeprecations:l(n)};t&&(i.propValidators=function(e){const t={};for(const[n,r]of Object.entries(e))t[n]=s(r);return t}(t)),e.instance=i;let u={};t&&(u=Object.entries(t).reduce(((e,[t,n])=>{const r=n?.value;return r&&(e[t]=r),e}),{})),e.defaultUniforms={...e.defaultUniforms,...u}}function c(e,t,n){e.deprecations?.forEach((e=>{e.regex?.test(t)&&(e.deprecated?n.deprecated(e.old,e.new)():n.removed(e.old,e.new)())}))}function l(e){return e.forEach((e=>{if("function"===e.type)e.regex=new RegExp(`\\b${e.old}\\(`);else e.regex=new RegExp(`${e.type} ${e.old};`)})),e}},34938:(e,t,n)=>{n.d(t,{i:()=>r});const r={name:"fp32",vs:"#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\n\n// All these functions are for substituting tan() function from Intel GPU only\nconst float TWO_PI = 6.2831854820251465;\nconst float PI_2 = 1.5707963705062866;\nconst float PI_16 = 0.1963495463132858;\n\nconst float SIN_TABLE_0 = 0.19509032368659973;\nconst float SIN_TABLE_1 = 0.3826834261417389;\nconst float SIN_TABLE_2 = 0.5555702447891235;\nconst float SIN_TABLE_3 = 0.7071067690849304;\n\nconst float COS_TABLE_0 = 0.9807852506637573;\nconst float COS_TABLE_1 = 0.9238795042037964;\nconst float COS_TABLE_2 = 0.8314695954322815;\nconst float COS_TABLE_3 = 0.7071067690849304;\n\nconst float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!\nconst float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!\nconst float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!\nconst float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!\n\nfloat sin_taylor_fp32(float a) {\n  float r, s, t, x;\n\n  if (a == 0.0) {\n    return 0.0;\n  }\n\n  x = -a * a;\n  s = a;\n  r = a;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_3;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_5;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_7;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_9;\n  s = s + t;\n\n  return s;\n}\n\nvoid sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {\n  if (a == 0.0) {\n    sin_t = 0.0;\n    cos_t = 1.0;\n  }\n  sin_t = sin_taylor_fp32(a);\n  cos_t = sqrt(1.0 - sin_t * sin_t);\n}\n\nfloat tan_taylor_fp32(float a) {\n    float sin_a;\n    float cos_a;\n\n    if (a == 0.0) {\n        return 0.0;\n    }\n\n    // 2pi range reduction\n    float z = floor(a / TWO_PI);\n    float r = a - TWO_PI * z;\n\n    float t;\n    float q = floor(r / PI_2 + 0.5);\n    int j = int(q);\n\n    if (j < -2 || j > 2) {\n        return 1.0 / 0.0;\n    }\n\n    t = r - PI_2 * q;\n\n    q = floor(t / PI_16 + 0.5);\n    int k = int(q);\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return 1.0 / 0.0;\n    } else {\n        t = t - PI_16 * q;\n    }\n\n    float u = 0.0;\n    float v = 0.0;\n\n    float sin_t, cos_t;\n    float s, c;\n    sincos_taylor_fp32(t, sin_t, cos_t);\n\n    if (k == 0) {\n        s = sin_t;\n        c = cos_t;\n    } else {\n        if (abs(float(abs_k) - 1.0) < 0.5) {\n            u = COS_TABLE_0;\n            v = SIN_TABLE_0;\n        } else if (abs(float(abs_k) - 2.0) < 0.5) {\n            u = COS_TABLE_1;\n            v = SIN_TABLE_1;\n        } else if (abs(float(abs_k) - 3.0) < 0.5) {\n            u = COS_TABLE_2;\n            v = SIN_TABLE_2;\n        } else if (abs(float(abs_k) - 4.0) < 0.5) {\n            u = COS_TABLE_3;\n            v = SIN_TABLE_3;\n        }\n        if (k > 0) {\n            s = u * sin_t + v * cos_t;\n            c = u * cos_t - v * sin_t;\n        } else {\n            s = u * sin_t - v * cos_t;\n            c = u * cos_t + v * sin_t;\n        }\n    }\n\n    if (j == 0) {\n        sin_a = s;\n        cos_a = c;\n    } else if (j == 1) {\n        sin_a = c;\n        cos_a = -s;\n    } else if (j == -1) {\n        sin_a = -c;\n        cos_a = s;\n    } else {\n        sin_a = -s;\n        cos_a = -c;\n    }\n    return sin_a / cos_a;\n}\n#endif\n\nfloat tan_fp32(float a) {\n#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\n  return tan_taylor_fp32(a);\n#else\n  return tan(a);\n#endif\n}\n"}},22454:(e,t,n)=>{function r(e,t=[],n=0){const r=Math.fround(e),s=e-r;return t[n]=r,t[n+1]=s,t}function s(e){return e-Math.fround(e)}function i(e){const t=new Float32Array(32);for(let n=0;n<4;++n)for(let s=0;s<4;++s){const i=4*n+s;r(e[4*s+n],t,2*i)}return t}n.d(t,{dI:()=>o});const o={name:"fp64arithmetic",vs:"\nuniform fp64arithmeticUniforms {\n  uniform float ONE;\n} fp64;\n\n/*\nAbout LUMA_FP64_CODE_ELIMINATION_WORKAROUND\n\nThe purpose of this workaround is to prevent shader compilers from\noptimizing away necessary arithmetic operations by swapping their sequences\nor transform the equation to some 'equivalent' form.\n\nThe method is to multiply an artifical variable, ONE, which will be known to\nthe compiler to be 1 only at runtime. The whole expression is then represented\nas a polynomial with respective to ONE. In the coefficients of all terms, only one a\nand one b should appear\n\nerr = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE\n*/\n\n// Divide float number to high and low floats to extend fraction bits\nvec2 split(float a) {\n  const float SPLIT = 4097.0;\n  float t = a * SPLIT;\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float a_hi = t * fp64.ONE - (t - a);\n  float a_lo = a * fp64.ONE - a_hi;\n#else\n  float a_hi = t - (t - a);\n  float a_lo = a - a_hi;\n#endif\n  return vec2(a_hi, a_lo);\n}\n\n// Divide float number again when high float uses too many fraction bits\nvec2 split2(vec2 a) {\n  vec2 b = split(a.x);\n  b.y += a.y;\n  return b;\n}\n\n// Special sum operation when a > b\nvec2 quickTwoSum(float a, float b) {\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float sum = (a + b) * fp64.ONE;\n  float err = b - (sum - a) * fp64.ONE;\n#else\n  float sum = a + b;\n  float err = b - (sum - a);\n#endif\n  return vec2(sum, err);\n}\n\n// General sum operation\nvec2 twoSum(float a, float b) {\n  float s = (a + b);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float v = (s * fp64.ONE - a) * fp64.ONE;\n  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);\n#else\n  float v = s - a;\n  float err = (a - (s - v)) + (b - v);\n#endif\n  return vec2(s, err);\n}\n\nvec2 twoSub(float a, float b) {\n  float s = (a - b);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float v = (s * fp64.ONE - a) * fp64.ONE;\n  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);\n#else\n  float v = s - a;\n  float err = (a - (s - v)) - (b + v);\n#endif\n  return vec2(s, err);\n}\n\nvec2 twoSqr(float a) {\n  float prod = a * a;\n  vec2 a_fp64 = split(a);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *\n    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;\n#else\n  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;\n#endif\n  return vec2(prod, err);\n}\n\nvec2 twoProd(float a, float b) {\n  float prod = a * b;\n  vec2 a_fp64 = split(a);\n  vec2 b_fp64 = split(b);\n  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +\n    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;\n  return vec2(prod, err);\n}\n\nvec2 sum_fp64(vec2 a, vec2 b) {\n  vec2 s, t;\n  s = twoSum(a.x, b.x);\n  t = twoSum(a.y, b.y);\n  s.y += t.x;\n  s = quickTwoSum(s.x, s.y);\n  s.y += t.y;\n  s = quickTwoSum(s.x, s.y);\n  return s;\n}\n\nvec2 sub_fp64(vec2 a, vec2 b) {\n  vec2 s, t;\n  s = twoSub(a.x, b.x);\n  t = twoSub(a.y, b.y);\n  s.y += t.x;\n  s = quickTwoSum(s.x, s.y);\n  s.y += t.y;\n  s = quickTwoSum(s.x, s.y);\n  return s;\n}\n\nvec2 mul_fp64(vec2 a, vec2 b) {\n  vec2 prod = twoProd(a.x, b.x);\n  // y component is for the error\n  prod.y += a.x * b.y;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  prod = split2(prod);\n#endif\n  prod = quickTwoSum(prod.x, prod.y);\n  prod.y += a.y * b.x;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  prod = split2(prod);\n#endif\n  prod = quickTwoSum(prod.x, prod.y);\n  return prod;\n}\n\nvec2 div_fp64(vec2 a, vec2 b) {\n  float xn = 1.0 / b.x;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  vec2 yn = mul_fp64(a, vec2(xn, 0));\n#else\n  vec2 yn = a * xn;\n#endif\n  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;\n  vec2 prod = twoProd(xn, diff);\n  return sum_fp64(yn, prod);\n}\n\nvec2 sqrt_fp64(vec2 a) {\n  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);\n  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);\n\n  float x = 1.0 / sqrt(a.x);\n  float yn = a.x * x;\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;\n#else\n  vec2 yn_sqr = twoSqr(yn);\n#endif\n  float diff = sub_fp64(a, yn_sqr).x;\n  vec2 prod = twoProd(x * 0.5, diff);\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  return sum_fp64(split(yn), prod);\n#else\n  return sum_fp64(vec2(yn, 0.0), prod);\n#endif\n}\n",defaultUniforms:{ONE:1},uniformTypes:{ONE:"f32"},fp64ify:r,fp64LowPart:s,fp64ifyMatrix4:i}},58073:(e,t,n)=>{n.d(t,{a:()=>s});var r=n(54901);class s extends Array{clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=e[n+t];return this.check()}toArray(e=[],t=0){for(let n=0;n<this.ELEMENTS;++n)e[t+n]=this[n];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:(0,r.cy)(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(r.$W)}formatString(e){let t="";for(let n=0;n<this.ELEMENTS;++n)t+=(n>0?", ":"")+(0,r.Fl)(this[n],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!(0,r.aI)(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,n){if(void 0===n)return this.lerp(this,e,t);for(let r=0;r<this.ELEMENTS;++r){const s=e[r],i="number"==typeof t?t:t[r];this[r]=s+n*(i-s)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e[n]),t[n]);return this.check()}add(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]+=t[e];return this.check()}subtract(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]-=t[e];return this.check()}scale(e){if("number"==typeof e)for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(r.$W.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e),t);return this.check()}get elements(){return this}}},46022:(e,t,n)=>{n.d(t,{u:()=>o});var r=n(58073),s=n(73731),i=n(54901);class o extends r.a{toString(){let e="[";if(i.$W.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let n=0;n<this.RANK;++n)e+=` ${this[n*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,n){return this[t*this.RANK+e]=(0,s.ws)(n),this}getColumn(e,t=new Array(this.RANK).fill(-0)){const n=e*this.RANK;for(let r=0;r<this.RANK;++r)t[r]=this[n+r];return t}setColumn(e,t){const n=e*this.RANK;for(let r=0;r<this.RANK;++r)this[n+r]=t[r];return this}}},54272:(e,t,n)=>{n.d(t,{M:()=>o});var r=n(58073),s=n(73731),i=n(4990);class o extends r.a{get x(){return this[0]}set x(e){this[0]=(0,s.ws)(e)}get y(){return this[1]}set y(e){this[1]=(0,s.ws)(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let n=0;n<this.ELEMENTS;++n){const r=this[n]-e[n];t+=r*r}return(0,s.ws)(t)}dot(e){let t=0;for(let n=0;n<this.ELEMENTS;++n)t+=this[n]*e[n];return(0,s.ws)(t)}normalize(){const e=this.magnitude();if(0!==e)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]*=t[e];return this.check()}divide(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t[e];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return(0,i.v)(e>=0&&e<this.ELEMENTS,"index is out of range"),(0,s.ws)(this[e])}setComponent(e,t){return(0,i.v)(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}},31886:(e,t,n)=>{n.d(t,{k:()=>g});var r,s=n(46022),i=n(73731),o=n(68225),a=n(90218),u=n(83588),c=n(82859),l=n(39426);!function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL0ROW3=3]="COL0ROW3",e[e.COL1ROW0=4]="COL1ROW0",e[e.COL1ROW1=5]="COL1ROW1",e[e.COL1ROW2=6]="COL1ROW2",e[e.COL1ROW3=7]="COL1ROW3",e[e.COL2ROW0=8]="COL2ROW0",e[e.COL2ROW1=9]="COL2ROW1",e[e.COL2ROW2=10]="COL2ROW2",e[e.COL2ROW3=11]="COL2ROW3",e[e.COL3ROW0=12]="COL3ROW0",e[e.COL3ROW1=13]="COL3ROW1",e[e.COL3ROW2=14]="COL3ROW2",e[e.COL3ROW3=15]="COL3ROW3"}(r||(r={}));const h=45*Math.PI/180,f=1,d=.1,p=500,m=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class g extends s.u{static get IDENTITY(){return function(){_||(_=new g,Object.freeze(_));return _}()}static get ZERO(){return function(){y||(y=new g([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(y));return y}()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return r}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,n,r,s,i,o,a,u,c,l,h,f,d,p,m){return this[0]=e,this[1]=t,this[2]=n,this[3]=r,this[4]=s,this[5]=i,this[6]=o,this[7]=a,this[8]=u,this[9]=c,this[10]=l,this[11]=h,this[12]=f,this[13]=d,this[14]=p,this[15]=m,this.check()}setRowMajor(e,t,n,r,s,i,o,a,u,c,l,h,f,d,p,m){return this[0]=e,this[1]=s,this[2]=u,this[3]=f,this[4]=t,this[5]=i,this[6]=c,this[7]=d,this[8]=n,this[9]=o,this[10]=l,this[11]=p,this[12]=r,this[13]=a,this[14]=h,this[15]=m,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(m)}fromObject(e){return this.check()}fromQuaternion(e){return(0,a.I0)(this,e),this.check()}frustum(e){const{left:t,right:n,bottom:r,top:s,near:i=d,far:o=p}=e;return o===1/0?function(e,t,n,r,s,i){const o=2*i/(n-t),a=2*i/(s-r),u=(n+t)/(n-t),c=(s+r)/(s-r),l=-1,h=-1,f=-2*i;e[0]=o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=u,e[9]=c,e[10]=l,e[11]=h,e[12]=0,e[13]=0,e[14]=f,e[15]=0}(this,t,n,r,s,i):(0,a.$h)(this,t,n,r,s,i,o),this.check()}lookAt(e){const{eye:t,center:n=[0,0,0],up:r=[0,1,0]}=e;return(0,a.t5)(this,t,n,r),this.check()}ortho(e){const{left:t,right:n,bottom:r,top:s,near:i=d,far:o=p}=e;return(0,a.v3)(this,t,n,r,s,i,o),this.check()}orthographic(e){const{fovy:t=h,aspect:n=f,focalDistance:r=1,near:s=d,far:i=p}=e;b(t);const o=t/2,a=r*Math.tan(o),u=a*n;return this.ortho({left:-u,right:u,bottom:-a,top:a,near:s,far:i})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:n=1,near:r=.1,far:s=500}=e;return b(t),(0,a.fN)(this,t,n,r,s),this.check()}determinant(){return(0,a.a4)(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const n=this.getScale(t),r=1/n[0],s=1/n[1],i=1/n[2];return e[0]=this[0]*r,e[1]=this[1]*s,e[2]=this[2]*i,e[3]=0,e[4]=this[4]*r,e[5]=this[5]*s,e[6]=this[6]*i,e[7]=0,e[8]=this[8]*r,e[9]=this[9]*s,e[10]=this[10]*i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const n=this.getScale(t),r=1/n[0],s=1/n[1],i=1/n[2];return e[0]=this[0]*r,e[1]=this[1]*s,e[2]=this[2]*i,e[3]=this[4]*r,e[4]=this[5]*s,e[5]=this[6]*i,e[6]=this[8]*r,e[7]=this[9]*s,e[8]=this[10]*i,e}transpose(){return(0,a.mg)(this,this),this.check()}invert(){return(0,a.B8)(this,this),this.check()}multiplyLeft(e){return(0,a.lw)(this,e,this),this.check()}multiplyRight(e){return(0,a.lw)(this,this,e),this.check()}rotateX(e){return(0,a.eL)(this,this,e),this.check()}rotateY(e){return(0,a.Z8)(this,this,e),this.check()}rotateZ(e){return(0,a.Qr)(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return(0,a.e$)(this,this,e,t),this.check()}scale(e){return(0,a.hs)(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return(0,a.Tl)(this,this,e),this.check()}transform(e,t){return 4===e.length?(t=(0,l.Z0)(t||[-0,-0,-0,-0],e,this),(0,i.qk)(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:n}=e;let r;switch(n){case 2:r=(0,u.Z0)(t||[-0,-0],e,this);break;case 3:r=(0,c.Z0)(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return(0,i.qk)(r,e.length),r}transformAsVector(e,t){let n;switch(e.length){case 2:n=(0,o.B$)(t||[-0,-0],e,this);break;case 3:n=(0,o.cL)(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return(0,i.qk)(n,e.length),n}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,n){return this.identity().translate([e,t,n])}}let y,_;function b(e){if(e>2*Math.PI)throw Error("expected radians")}},87597:(e,t,n)=>{n.d(t,{P:()=>l});var r=n(54272),s=n(54901),i=n(73731),o=n(82859),a=n(68225);const u=[0,0,0];let c;class l extends r.M{static get ZERO(){return c||(c=new l(0,0,0),Object.freeze(c)),c}constructor(e=0,t=0,n=0){super(-0,-0,-0),1===arguments.length&&(0,s.cy)(e)?this.copy(e):(s.$W.debug&&((0,i.ws)(e),(0,i.ws)(t),(0,i.ws)(n)),this[0]=e,this[1]=t,this[2]=n)}set(e,t,n){return this[0]=e,this[1]=t,this[2]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return s.$W.debug&&((0,i.ws)(e.x),(0,i.ws)(e.y),(0,i.ws)(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=(0,i.ws)(e)}angle(e){return(0,o.g7)(this,e)}cross(e){return(0,o.$A)(this,this,e),this.check()}rotateX({radians:e,origin:t=u}){return(0,o.eL)(this,this,t,e),this.check()}rotateY({radians:e,origin:t=u}){return(0,o.Z8)(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=u}){return(0,o.x6)(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return(0,o.Z0)(this,this,e),this.check()}transformAsVector(e){return(0,a.cL)(this,this,e),this.check()}transformByMatrix3(e){return(0,o.ei)(this,this,e),this.check()}transformByMatrix2(e){return(0,a.J4)(this,this,e),this.check()}transformByQuaternion(e){return(0,o.gL)(this,this,e),this.check()}}},50741:(e,t,n)=>{n.d(t,{p8:()=>r,tb:()=>s});const r=1e-6;let s="undefined"!=typeof Float32Array?Float32Array:Array;Math.random;Math.PI},90218:(e,t,n)=>{n.d(t,{$h:()=>g,B8:()=>i,I0:()=>m,IL:()=>p,Qr:()=>d,Tl:()=>u,Z8:()=>f,a4:()=>o,e$:()=>l,eL:()=>h,fN:()=>y,hs:()=>c,lw:()=>a,mg:()=>s,t5:()=>b,v3:()=>_});var r=n(50741);function s(e,t){if(e===t){const n=t[1],r=t[2],s=t[3],i=t[6],o=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=i,e[11]=t[14],e[12]=s,e[13]=o,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function i(e,t){const n=t[0],r=t[1],s=t[2],i=t[3],o=t[4],a=t[5],u=t[6],c=t[7],l=t[8],h=t[9],f=t[10],d=t[11],p=t[12],m=t[13],g=t[14],y=t[15],_=n*a-r*o,b=n*u-s*o,v=n*c-i*o,x=r*u-s*a,w=r*c-i*a,k=s*c-i*u,I=l*m-h*p,T=l*g-f*p,E=l*y-d*p,A=h*g-f*m,S=h*y-d*m,L=f*y-d*g;let O=_*L-b*S+v*A+x*E-w*T+k*I;return O?(O=1/O,e[0]=(a*L-u*S+c*A)*O,e[1]=(s*S-r*L-i*A)*O,e[2]=(m*k-g*w+y*x)*O,e[3]=(f*w-h*k-d*x)*O,e[4]=(u*E-o*L-c*T)*O,e[5]=(n*L-s*E+i*T)*O,e[6]=(g*v-p*k-y*b)*O,e[7]=(l*k-f*v+d*b)*O,e[8]=(o*S-a*E+c*I)*O,e[9]=(r*E-n*S-i*I)*O,e[10]=(p*w-m*v+y*_)*O,e[11]=(h*v-l*w-d*_)*O,e[12]=(a*T-o*A-u*I)*O,e[13]=(n*A-r*T+s*I)*O,e[14]=(m*b-p*x-g*_)*O,e[15]=(l*x-h*b+f*_)*O,e):null}function o(e){const t=e[0],n=e[1],r=e[2],s=e[3],i=e[4],o=e[5],a=e[6],u=e[7],c=e[8],l=e[9],h=e[10],f=e[11],d=e[12],p=e[13],m=e[14],g=t*o-n*i,y=t*a-r*i,_=n*a-r*o,b=c*p-l*d,v=c*m-h*d,x=l*m-h*p;return u*(t*x-n*v+r*b)-s*(i*x-o*v+a*b)+e[15]*(c*_-l*y+h*g)-f*(d*_-p*y+m*g)}function a(e,t,n){const r=t[0],s=t[1],i=t[2],o=t[3],a=t[4],u=t[5],c=t[6],l=t[7],h=t[8],f=t[9],d=t[10],p=t[11],m=t[12],g=t[13],y=t[14],_=t[15];let b=n[0],v=n[1],x=n[2],w=n[3];return e[0]=b*r+v*a+x*h+w*m,e[1]=b*s+v*u+x*f+w*g,e[2]=b*i+v*c+x*d+w*y,e[3]=b*o+v*l+x*p+w*_,b=n[4],v=n[5],x=n[6],w=n[7],e[4]=b*r+v*a+x*h+w*m,e[5]=b*s+v*u+x*f+w*g,e[6]=b*i+v*c+x*d+w*y,e[7]=b*o+v*l+x*p+w*_,b=n[8],v=n[9],x=n[10],w=n[11],e[8]=b*r+v*a+x*h+w*m,e[9]=b*s+v*u+x*f+w*g,e[10]=b*i+v*c+x*d+w*y,e[11]=b*o+v*l+x*p+w*_,b=n[12],v=n[13],x=n[14],w=n[15],e[12]=b*r+v*a+x*h+w*m,e[13]=b*s+v*u+x*f+w*g,e[14]=b*i+v*c+x*d+w*y,e[15]=b*o+v*l+x*p+w*_,e}function u(e,t,n){const r=n[0],s=n[1],i=n[2];let o,a,u,c,l,h,f,d,p,m,g,y;return t===e?(e[12]=t[0]*r+t[4]*s+t[8]*i+t[12],e[13]=t[1]*r+t[5]*s+t[9]*i+t[13],e[14]=t[2]*r+t[6]*s+t[10]*i+t[14],e[15]=t[3]*r+t[7]*s+t[11]*i+t[15]):(o=t[0],a=t[1],u=t[2],c=t[3],l=t[4],h=t[5],f=t[6],d=t[7],p=t[8],m=t[9],g=t[10],y=t[11],e[0]=o,e[1]=a,e[2]=u,e[3]=c,e[4]=l,e[5]=h,e[6]=f,e[7]=d,e[8]=p,e[9]=m,e[10]=g,e[11]=y,e[12]=o*r+l*s+p*i+t[12],e[13]=a*r+h*s+m*i+t[13],e[14]=u*r+f*s+g*i+t[14],e[15]=c*r+d*s+y*i+t[15]),e}function c(e,t,n){const r=n[0],s=n[1],i=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function l(e,t,n,s){let i,o,a,u,c,l,h,f,d,p,m,g,y,_,b,v,x,w,k,I,T,E,A,S,L=s[0],O=s[1],$=s[2],M=Math.sqrt(L*L+O*O+$*$);return M<r.p8?null:(M=1/M,L*=M,O*=M,$*=M,o=Math.sin(n),i=Math.cos(n),a=1-i,u=t[0],c=t[1],l=t[2],h=t[3],f=t[4],d=t[5],p=t[6],m=t[7],g=t[8],y=t[9],_=t[10],b=t[11],v=L*L*a+i,x=O*L*a+$*o,w=$*L*a-O*o,k=L*O*a-$*o,I=O*O*a+i,T=$*O*a+L*o,E=L*$*a+O*o,A=O*$*a-L*o,S=$*$*a+i,e[0]=u*v+f*x+g*w,e[1]=c*v+d*x+y*w,e[2]=l*v+p*x+_*w,e[3]=h*v+m*x+b*w,e[4]=u*k+f*I+g*T,e[5]=c*k+d*I+y*T,e[6]=l*k+p*I+_*T,e[7]=h*k+m*I+b*T,e[8]=u*E+f*A+g*S,e[9]=c*E+d*A+y*S,e[10]=l*E+p*A+_*S,e[11]=h*E+m*A+b*S,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function h(e,t,n){const r=Math.sin(n),s=Math.cos(n),i=t[4],o=t[5],a=t[6],u=t[7],c=t[8],l=t[9],h=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=i*s+c*r,e[5]=o*s+l*r,e[6]=a*s+h*r,e[7]=u*s+f*r,e[8]=c*s-i*r,e[9]=l*s-o*r,e[10]=h*s-a*r,e[11]=f*s-u*r,e}function f(e,t,n){const r=Math.sin(n),s=Math.cos(n),i=t[0],o=t[1],a=t[2],u=t[3],c=t[8],l=t[9],h=t[10],f=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*s-c*r,e[1]=o*s-l*r,e[2]=a*s-h*r,e[3]=u*s-f*r,e[8]=i*r+c*s,e[9]=o*r+l*s,e[10]=a*r+h*s,e[11]=u*r+f*s,e}function d(e,t,n){const r=Math.sin(n),s=Math.cos(n),i=t[0],o=t[1],a=t[2],u=t[3],c=t[4],l=t[5],h=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*s+c*r,e[1]=o*s+l*r,e[2]=a*s+h*r,e[3]=u*s+f*r,e[4]=c*s-i*r,e[5]=l*s-o*r,e[6]=h*s-a*r,e[7]=f*s-u*r,e}function p(e,t){const n=t[0],r=t[1],s=t[2],i=t[4],o=t[5],a=t[6],u=t[8],c=t[9],l=t[10];return e[0]=Math.sqrt(n*n+r*r+s*s),e[1]=Math.sqrt(i*i+o*o+a*a),e[2]=Math.sqrt(u*u+c*c+l*l),e}function m(e,t){const n=t[0],r=t[1],s=t[2],i=t[3],o=n+n,a=r+r,u=s+s,c=n*o,l=r*o,h=r*a,f=s*o,d=s*a,p=s*u,m=i*o,g=i*a,y=i*u;return e[0]=1-h-p,e[1]=l+y,e[2]=f-g,e[3]=0,e[4]=l-y,e[5]=1-c-p,e[6]=d+m,e[7]=0,e[8]=f+g,e[9]=d-m,e[10]=1-c-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function g(e,t,n,r,s,i,o){const a=1/(n-t),u=1/(s-r),c=1/(i-o);return e[0]=2*i*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*i*u,e[6]=0,e[7]=0,e[8]=(n+t)*a,e[9]=(s+r)*u,e[10]=(o+i)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*i*2*c,e[15]=0,e}const y=function(e,t,n,r,s){const i=1/Math.tan(t/2);if(e[0]=i/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=s&&s!==1/0){const t=1/(r-s);e[10]=(s+r)*t,e[14]=2*s*r*t}else e[10]=-1,e[14]=-2*r;return e};const _=function(e,t,n,r,s,i,o){const a=1/(t-n),u=1/(r-s),c=1/(i-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*a,e[13]=(s+r)*u,e[14]=(o+i)*c,e[15]=1,e};function b(e,t,n,s){let i,o,a,u,c,l,h,f,d,p;const m=t[0],g=t[1],y=t[2],_=s[0],b=s[1],v=s[2],x=n[0],w=n[1],k=n[2];return Math.abs(m-x)<r.p8&&Math.abs(g-w)<r.p8&&Math.abs(y-k)<r.p8?function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}(e):(f=m-x,d=g-w,p=y-k,i=1/Math.sqrt(f*f+d*d+p*p),f*=i,d*=i,p*=i,o=b*p-v*d,a=v*f-_*p,u=_*d-b*f,i=Math.sqrt(o*o+a*a+u*u),i?(i=1/i,o*=i,a*=i,u*=i):(o=0,a=0,u=0),c=d*u-p*a,l=p*o-f*u,h=f*a-d*o,i=Math.sqrt(c*c+l*l+h*h),i?(i=1/i,c*=i,l*=i,h*=i):(c=0,l=0,h=0),e[0]=o,e[1]=c,e[2]=f,e[3]=0,e[4]=a,e[5]=l,e[6]=d,e[7]=0,e[8]=u,e[9]=h,e[10]=p,e[11]=0,e[12]=-(o*m+a*g+u*y),e[13]=-(c*m+l*g+h*y),e[14]=-(f*m+d*g+p*y),e[15]=1,e)}},83588:(e,t,n)=>{n.d(t,{Bw:()=>o,Cc:()=>u,WQ:()=>s,Z0:()=>f,ZF:()=>c,ei:()=>h,hs:()=>i,jb:()=>d,l0:()=>l,ze:()=>a});var r=n(50741);function s(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function i(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e}function o(e){const t=e[0],n=e[1];return Math.sqrt(t*t+n*n)}function a(e,t){return e[0]=-t[0],e[1]=-t[1],e}function u(e,t,n,r){const s=t[0],i=t[1];return e[0]=s+r*(n[0]-s),e[1]=i+r*(n[1]-i),e}function c(e,t,n){const r=t[0],s=t[1];return e[0]=n[0]*r+n[2]*s,e[1]=n[1]*r+n[3]*s,e}function l(e,t,n){const r=t[0],s=t[1];return e[0]=n[0]*r+n[2]*s+n[4],e[1]=n[1]*r+n[3]*s+n[5],e}function h(e,t,n){const r=t[0],s=t[1];return e[0]=n[0]*r+n[3]*s+n[6],e[1]=n[1]*r+n[4]*s+n[7],e}function f(e,t,n){const r=t[0],s=t[1];return e[0]=n[0]*r+n[4]*s+n[12],e[1]=n[1]*r+n[5]*s+n[13],e}const d=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e};!function(){const e=function(){const e=new r.tb(2);return r.tb!=Float32Array&&(e[0]=0,e[1]=0),e}()}()},82859:(e,t,n)=>{n.d(t,{$A:()=>l,Bw:()=>i,Cc:()=>h,Il:()=>v,Om:()=>c,S8:()=>u,Z0:()=>f,Z8:()=>g,eL:()=>m,ei:()=>d,fA:()=>o,g7:()=>_,gL:()=>p,jb:()=>b,uE:()=>x,vt:()=>s,x6:()=>y,ze:()=>a});var r=n(50741);function s(){const e=new r.tb(3);return r.tb!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function i(e){const t=e[0],n=e[1],r=e[2];return Math.sqrt(t*t+n*n+r*r)}function o(e,t,n){const s=new r.tb(3);return s[0]=e,s[1]=t,s[2]=n,s}function a(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function u(e,t){const n=t[0],r=t[1],s=t[2];let i=n*n+r*r+s*s;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function c(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function l(e,t,n){const r=t[0],s=t[1],i=t[2],o=n[0],a=n[1],u=n[2];return e[0]=s*u-i*a,e[1]=i*o-r*u,e[2]=r*a-s*o,e}function h(e,t,n,r){const s=t[0],i=t[1],o=t[2];return e[0]=s+r*(n[0]-s),e[1]=i+r*(n[1]-i),e[2]=o+r*(n[2]-o),e}function f(e,t,n){const r=t[0],s=t[1],i=t[2];let o=n[3]*r+n[7]*s+n[11]*i+n[15];return o=o||1,e[0]=(n[0]*r+n[4]*s+n[8]*i+n[12])/o,e[1]=(n[1]*r+n[5]*s+n[9]*i+n[13])/o,e[2]=(n[2]*r+n[6]*s+n[10]*i+n[14])/o,e}function d(e,t,n){const r=t[0],s=t[1],i=t[2];return e[0]=r*n[0]+s*n[3]+i*n[6],e[1]=r*n[1]+s*n[4]+i*n[7],e[2]=r*n[2]+s*n[5]+i*n[8],e}function p(e,t,n){const r=n[0],s=n[1],i=n[2],o=n[3],a=t[0],u=t[1],c=t[2];let l=s*c-i*u,h=i*a-r*c,f=r*u-s*a,d=s*f-i*h,p=i*l-r*f,m=r*h-s*l;const g=2*o;return l*=g,h*=g,f*=g,d*=2,p*=2,m*=2,e[0]=a+l+d,e[1]=u+h+p,e[2]=c+f+m,e}function m(e,t,n,r){const s=[],i=[];return s[0]=t[0]-n[0],s[1]=t[1]-n[1],s[2]=t[2]-n[2],i[0]=s[0],i[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),i[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2],e}function g(e,t,n,r){const s=[],i=[];return s[0]=t[0]-n[0],s[1]=t[1]-n[1],s[2]=t[2]-n[2],i[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),i[1]=s[1],i[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2],e}function y(e,t,n,r){const s=[],i=[];return s[0]=t[0]-n[0],s[1]=t[1]-n[1],s[2]=t[2]-n[2],i[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),i[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),i[2]=s[2],e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2],e}function _(e,t){const n=e[0],r=e[1],s=e[2],i=t[0],o=t[1],a=t[2],u=Math.sqrt((n*n+r*r+s*s)*(i*i+o*o+a*a)),l=u&&c(e,t)/u;return Math.acos(Math.min(Math.max(l,-1),1))}const b=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e},v=i,x=function(e){const t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r};!function(){const e=s()}()},39426:(e,t,n)=>{n.d(t,{Bw:()=>l,C:()=>o,Cc:()=>p,Om:()=>d,S8:()=>f,WQ:()=>u,Z0:()=>m,fA:()=>i,gL:()=>g,hZ:()=>a,hs:()=>c,m3:()=>h,o8:()=>s,t2:()=>y});var r=n(50741);function s(e){const t=new r.tb(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function i(e,t,n,s){const i=new r.tb(4);return i[0]=e,i[1]=t,i[2]=n,i[3]=s,i}function o(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function a(e,t,n,r,s){return e[0]=t,e[1]=n,e[2]=r,e[3]=s,e}function u(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e}function c(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function l(e){const t=e[0],n=e[1],r=e[2],s=e[3];return Math.sqrt(t*t+n*n+r*r+s*s)}function h(e){const t=e[0],n=e[1],r=e[2],s=e[3];return t*t+n*n+r*r+s*s}function f(e,t){const n=t[0],r=t[1],s=t[2],i=t[3];let o=n*n+r*r+s*s+i*i;return o>0&&(o=1/Math.sqrt(o)),e[0]=n*o,e[1]=r*o,e[2]=s*o,e[3]=i*o,e}function d(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function p(e,t,n,r){const s=t[0],i=t[1],o=t[2],a=t[3];return e[0]=s+r*(n[0]-s),e[1]=i+r*(n[1]-i),e[2]=o+r*(n[2]-o),e[3]=a+r*(n[3]-a),e}function m(e,t,n){const r=t[0],s=t[1],i=t[2],o=t[3];return e[0]=n[0]*r+n[4]*s+n[8]*i+n[12]*o,e[1]=n[1]*r+n[5]*s+n[9]*i+n[13]*o,e[2]=n[2]*r+n[6]*s+n[10]*i+n[14]*o,e[3]=n[3]*r+n[7]*s+n[11]*i+n[15]*o,e}function g(e,t,n){const r=t[0],s=t[1],i=t[2],o=n[0],a=n[1],u=n[2],c=n[3],l=c*r+a*i-u*s,h=c*s+u*r-o*i,f=c*i+o*s-a*r,d=-o*r-a*s-u*i;return e[0]=l*c+d*-o+h*-u-f*-a,e[1]=h*c+d*-a+f*-o-l*-u,e[2]=f*c+d*-u+l*-a-h*-o,e[3]=t[3],e}function y(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}!function(){const e=function(){const e=new r.tb(4);return r.tb!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}()}()},4990:(e,t,n)=>{function r(e,t){if(!e)throw new Error(`math.gl assertion ${t}`)}n.d(t,{v:()=>r})},54901:(e,t,n)=>{n.d(t,{$W:()=>i,Cc:()=>d,F2:()=>l,Fl:()=>o,aI:()=>p,cy:()=>a,eh:()=>u,qE:()=>f,uj:()=>h,xW:()=>c});const r=1/Math.PI*180,s=1/180*Math.PI;globalThis.mathgl=globalThis.mathgl||{config:{EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1}};const i=globalThis.mathgl.config;function o(e,{precision:t=i.precision}={}){return e=function(e){return Math.round(e/i.EPSILON)*i.EPSILON}(e),`${parseFloat(e.toPrecision(t))}`}function a(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function u(e){return l(e)}function c(e){return h(e)}function l(e,t){return m(e,(e=>e*s),t)}function h(e,t){return m(e,(e=>e*r),t)}function f(e,t,n){return m(e,(e=>Math.max(t,Math.min(n,e))))}function d(e,t,n){return a(e)?e.map(((e,r)=>d(e,t[r],n))):n*t+(1-n)*e}function p(e,t,n){const r=i.EPSILON;n&&(i.EPSILON=n);try{if(e===t)return!0;if(a(e)&&a(t)){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!p(e[n],t[n]))return!1;return!0}return e&&e.equals?e.equals(t):t&&t.equals?t.equals(e):"number"==typeof e&&"number"==typeof t&&Math.abs(e-t)<=i.EPSILON*Math.max(1,Math.abs(e),Math.abs(t))}finally{i.EPSILON=r}}function m(e,t,n){if(a(e)){const r=e;n=n||function(e){return e.clone?e.clone():new Array(e.length)}(r);for(let s=0;s<n.length&&s<r.length;++s){const r="number"==typeof e?e:e[s];n[s]=t(r,s,n)}return n}return t(e)}},68225:(e,t,n)=>{function r(e,t,n){const r=t[0],s=t[1],i=n[3]*r+n[7]*s||1;return e[0]=(n[0]*r+n[4]*s)/i,e[1]=(n[1]*r+n[5]*s)/i,e}function s(e,t,n){const r=t[0],s=t[1],i=t[2],o=n[3]*r+n[7]*s+n[11]*i||1;return e[0]=(n[0]*r+n[4]*s+n[8]*i)/o,e[1]=(n[1]*r+n[5]*s+n[9]*i)/o,e[2]=(n[2]*r+n[6]*s+n[10]*i)/o,e}function i(e,t,n){const r=t[0],s=t[1];return e[0]=n[0]*r+n[2]*s,e[1]=n[1]*r+n[3]*s,e[2]=t[2],e}function o(e,t,n){const r=t[0],s=t[1];return e[0]=n[0]*r+n[2]*s,e[1]=n[1]*r+n[3]*s,e[2]=t[2],e[3]=t[3],e}function a(e,t,n){const r=t[0],s=t[1],i=t[2];return e[0]=n[0]*r+n[3]*s+n[6]*i,e[1]=n[1]*r+n[4]*s+n[7]*i,e[2]=n[2]*r+n[5]*s+n[8]*i,e[3]=t[3],e}n.d(t,{B$:()=>r,Cg:()=>o,J4:()=>i,cL:()=>s,vE:()=>a})},73731:(e,t,n)=>{n.d(t,{qk:()=>i,ws:()=>s});var r=n(54901);function s(e){if(!Number.isFinite(e))throw new Error(`Invalid number ${JSON.stringify(e)}`);return e}function i(e,t,n=""){if(r.$W.debug&&!function(e,t){if(e.length!==t)return!1;for(let n=0;n<e.length;++n)if(!Number.isFinite(e[n]))return!1;return!0}(e,t))throw new Error(`math.gl: ${n} some fields set to invalid numbers'`);return e}},26369:(e,t,n)=>{function r(e,t){if(!e)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}n.d(t,{v:()=>r})},34336:(e,t,n)=>{n.d(t,{F:()=>o});var r=n(26369),s=n(70177),i=n(88967);function o(e){const{width:t,height:n,bounds:o,minExtent:a=0,maxZoom:u=24,offset:c=[0,0]}=e,[[l,h],[f,d]]=o,p=function(e=0){if("number"==typeof e)return{top:e,bottom:e,left:e,right:e};return(0,r.v)(Number.isFinite(e.top)&&Number.isFinite(e.bottom)&&Number.isFinite(e.left)&&Number.isFinite(e.right)),e}(e.padding),m=(0,i.Gw)([l,(0,s.qE)(d,-i.aH,i.aH)]),g=(0,i.Gw)([f,(0,s.qE)(h,-i.aH,i.aH)]),y=[Math.max(Math.abs(g[0]-m[0]),a),Math.max(Math.abs(g[1]-m[1]),a)],_=[t-p.left-p.right-2*Math.abs(c[0]),n-p.top-p.bottom-2*Math.abs(c[1])];(0,r.v)(_[0]>0&&_[1]>0);const b=_[0]/y[0],v=_[1]/y[1],x=(p.right-p.left)/2/b,w=(p.top-p.bottom)/2/v,k=[(g[0]+m[0])/2+x,(g[1]+m[1])/2+w],I=(0,i.iV)(k),T=Math.min(u,(0,s.p6)(Math.abs(Math.min(b,v))));return(0,r.v)(Number.isFinite(T)),{longitude:I[0],latitude:I[1],zoom:T}}},34617:(e,t,n)=>{n.d(t,{r:()=>c,v:()=>l});var r=n(70177),s=n(88967),i=n(83588);const o=.01,a=["longitude","latitude","zoom"],u={curve:1.414,speed:1.2};function c(e,t,n,u){const{startZoom:c,startCenterXY:l,uDelta:f,w0:d,u1:p,S:m,rho:g,rho2:y,r0:_}=h(e,t,u);if(p<o){const s={};for(const i of a){const o=e[i],a=t[i];s[i]=(0,r.Cc)(o,a,n)}return s}const b=n*m,v=Math.cosh(_)/Math.cosh(_+g*b),x=d*((Math.cosh(_)*Math.tanh(_+g*b)-Math.sinh(_))/y)/p,w=1/v,k=c+(0,s.J9)(w),I=i.hs([],f,x);i.WQ(I,I,l);const T=(0,s.iV)(I);return{longitude:T[0],latitude:T[1],zoom:k}}function l(e,t,n){const r={...u,...n},{screenSpeed:s,speed:i,maxDuration:o}=r,{S:a,rho:c}=h(e,t,r),l=1e3*a;let f;return f=Number.isFinite(s)?l/(s/c):l/i,Number.isFinite(o)&&f>o?0:f}function h(e,t,n){const r=(n=Object.assign({},u,n)).curve,a=e.zoom,c=[e.longitude,e.latitude],l=(0,s.XM)(a),h=t.zoom,f=[t.longitude,t.latitude],d=(0,s.XM)(h-a),p=(0,s.Gw)(c),m=(0,s.Gw)(f),g=i.jb([],m,p),y=Math.max(e.width,e.height),_=y/d,b=i.Bw(g)*l,v=Math.max(b,o),x=r*r,w=(_*_-y*y+x*x*v*v)/(2*y*x*v),k=(_*_-y*y-x*x*v*v)/(2*_*x*v),I=Math.log(Math.sqrt(w*w+1)-w),T=Math.log(Math.sqrt(k*k+1)-k);return{startZoom:a,startCenterXY:p,uDelta:g,w0:y,u1:b,S:(T-I)/r,rho:r,rho2:x,r0:I,r1:T}}},37925:(e,t,n)=>{n.d(t,{g:()=>a});var r=n(83588),s=n(88967),i=n(70177);const o=Math.PI/180;function a(e,t=0){const{width:n,height:r,unproject:s}=e,i={targetZ:t},a=s([0,r],i),c=s([n,r],i);let l,h;return(e.fovy?.5*e.fovy*o:Math.atan(.5/e.altitude))>(90-e.pitch)*o-.01?(l=u(e,0,t),h=u(e,n,t)):(l=s([0,0],i),h=s([n,0],i)),[a,c,h,l]}function u(e,t,n){const{pixelUnprojectionMatrix:o}=e,a=(0,i._U)(o,[t,0,1,1]),u=(0,i._U)(o,[t,e.height,1,1]),c=(n*e.distanceScales.unitsPerMeter[2]-a[2])/(u[2]-a[2]),l=r.Cc([],a,u,c),h=(0,s.iV)(l);return h.push(n),h}},73279:(e,t,n)=>{n.d(t,{CK:()=>i.C,Fe:()=>s.F,Gw:()=>a.Gw,Os:()=>a.Os,VJ:()=>a.VJ,aH:()=>a.aH,dT:()=>a.dT,fO:()=>a.fO,gW:()=>r.g,iV:()=>a.iV,mY:()=>a.mY,nI:()=>a.nI,om:()=>a.om,rY:()=>a.rY,rj:()=>o.r,v7:()=>o.v,wZ:()=>a.wZ,xJ:()=>a.xJ});n(38494);var r=n(37925),s=n(34336),i=n(32264),o=n(34617),a=n(88967)},70177:(e,t,n)=>{n.d(t,{$M:()=>s,Cc:()=>a,_U:()=>i,p6:()=>c,qE:()=>u,zi:()=>o});var r=n(39426);function s(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function i(e,t){const n=r.Z0([],t,e);return r.hs(n,n,1/n[3]),n}function o(e,t){const n=e%t;return n<0?t+n:n}function a(e,t,n){return n*t+(1-n)*e}function u(e,t,n){return e<t?t:e>n?n:e}const c=Math.log2||function(e){return Math.log(e)*Math.LOG2E}},32264:(e,t,n)=>{n.d(t,{C:()=>o});var r=n(88967),s=n(70177);const i=512;function o(e){const{width:t,height:n,pitch:o=0}=e;let{longitude:a,latitude:u,zoom:c,bearing:l=0}=e;(a<-180||a>180)&&(a=(0,s.zi)(a+180,360)-180),(l<-180||l>180)&&(l=(0,s.zi)(l+180,360)-180);const h=(0,s.p6)(n/i);if(c<=h)c=h,u=0;else{const e=n/2/Math.pow(2,c),t=(0,r.iV)([0,e])[1];if(u<t)u=t;else{const t=(0,r.iV)([0,i-e])[1];u>t&&(u=t)}}return{width:t,height:n,longitude:a,latitude:u,zoom:c,pitch:o,bearing:l}}},88967:(e,t,n)=>{n.d(t,{Gw:()=>_,J9:()=>y,Os:()=>E,VJ:()=>S,XM:()=>g,aH:()=>p,dT:()=>k,fO:()=>v,iV:()=>b,mY:()=>x,nI:()=>w,om:()=>T,rY:()=>I,wZ:()=>A,xJ:()=>L});var r=n(70177),s=n(90218),i=n(82859),o=n(83588),a=n(26369);const u=Math.PI,c=u/4,l=u/180,h=180/u,f=512,d=4003e4,p=85.051129,m=1.5;function g(e){return Math.pow(2,e)}function y(e){return(0,r.p6)(e)}function _(e){const[t,n]=e;(0,a.v)(Number.isFinite(t)),(0,a.v)(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const r=n*l;return[f*(t*l+u)/(2*u),f*(u+Math.log(Math.tan(c+.5*r)))/(2*u)]}function b(e){const[t,n]=e,r=t/f*(2*u)-u,s=2*(Math.atan(Math.exp(n/f*(2*u)-u))-c);return[r*h,s*h]}function v(e){const{latitude:t}=e;(0,a.v)(Number.isFinite(t));const n=Math.cos(t*l);return y(d*n)-9}function x(e){const t=Math.cos(e*l);return f/d/t}function w(e){const{latitude:t,longitude:n,highPrecision:r=!1}=e;(0,a.v)(Number.isFinite(t)&&Number.isFinite(n));const s=f,i=Math.cos(t*l),o=s/360,u=o/i,c=s/d/i,h={unitsPerMeter:[c,c,c],metersPerUnit:[1/c,1/c,1/c],unitsPerDegree:[o,u,c],degreesPerUnit:[1/o,1/u,1/c]};if(r){const e=l*Math.tan(t*l)/i,n=o*e/2,r=s/d*e,a=r/u*c;h.unitsPerDegree2=[0,n,r],h.unitsPerMeter2=[a,0,a]}return h}function k(e,t){const[n,r,s]=e,[i,o,a]=t,{unitsPerMeter:u,unitsPerMeter2:c}=w({longitude:n,latitude:r,highPrecision:!0}),l=_(e);l[0]+=i*(u[0]+c[0]*o),l[1]+=o*(u[1]+c[1]*o);const h=b(l),f=(s||0)+(a||0);return Number.isFinite(s)||Number.isFinite(a)?[h[0],h[1],f]:h}function I(e){const{height:t,pitch:n,bearing:o,altitude:a,scale:u,center:c}=e,h=(0,r.$M)();s.Tl(h,h,[0,0,-a]),s.eL(h,h,-n*l),s.Qr(h,h,o*l);const f=u/t;return s.hs(h,h,[f,f,f]),c&&s.Tl(h,h,i.ze([],c)),h}function T(e){const{width:t,height:n,altitude:s,pitch:i=0,offset:o,center:a,scale:u,nearZMultiplier:c=1,farZMultiplier:h=1}=e;let{fovy:f=E(m)}=e;void 0!==s&&(f=E(s));const d=f*l,p=i*l,g=A(f);let y=g;a&&(y+=a[2]*u/Math.cos(p)/n);const _=d*(.5+(o?o[1]:0)/n),b=Math.sin(_)*y/Math.sin((0,r.qE)(Math.PI/2-p-_,.01,Math.PI-.01)),v=Math.sin(p)*b+y,x=10*y;return{fov:d,aspect:t/n,focalDistance:g,near:c,far:Math.min(v*h,x)}}function E(e){return 2*Math.atan(.5/e)*h}function A(e){return.5/Math.tan(.5*e*l)}function S(e,t){const[n,s,i=0]=e;return(0,a.v)(Number.isFinite(n)&&Number.isFinite(s)&&Number.isFinite(i)),(0,r._U)(t,[n,s,i,1])}function L(e,t,n=0){const[s,i,u]=e;if((0,a.v)(Number.isFinite(s)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(u)){return(0,r._U)(t,[s,i,u,1])}const c=(0,r._U)(t,[s,i,0,1]),l=(0,r._U)(t,[s,i,1,1]),h=c[2],f=l[2],d=h===f?0:((n||0)-h)/(f-h);return o.Cc([],c,l,d)}},38494:(e,t,n)=>{n(70177),n(88967),n(34336),n(37925)},7853:(e,t,n)=>{n.d(t,{EU:()=>ne,e8:()=>s,uq:()=>P,h1:()=>U,Cx:()=>D});var r,s,i;!function(e){e[e.Start=1]="Start",e[e.Move=2]="Move",e[e.End=4]="End",e[e.Cancel=8]="Cancel"}(r||(r={})),function(e){e[e.None=0]="None",e[e.Left=1]="Left",e[e.Right=2]="Right",e[e.Up=4]="Up",e[e.Down=8]="Down",e[e.Horizontal=3]="Horizontal",e[e.Vertical=12]="Vertical",e[e.All=15]="All"}(s||(s={})),function(e){e[e.Possible=1]="Possible",e[e.Began=2]="Began",e[e.Changed=4]="Changed",e[e.Ended=8]="Ended",e[e.Recognized=8]="Recognized",e[e.Cancelled=16]="Cancelled",e[e.Failed=32]="Failed"}(i||(i={}));const o="auto",a="manipulation",u="none",c="pan-x",l="pan-y";class h{constructor(e,t){this.actions="",this.manager=e,this.set(t)}set(e){"compute"===e&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const t of this.manager.recognizers)t.options.enable&&(e=e.concat(t.getTouchAction()));return function(e){if(e.includes(u))return u;const t=e.includes(c),n=e.includes(l);return t&&n?u:t||n?t?c:l:e.includes(a)?a:o}(e.join(" "))}}function f(e){return e.trim().split(/\s+/g)}function d(e,t,n){if(e)for(const r of f(t))e.addEventListener(r,n,!1)}function p(e,t,n){if(e)for(const r of f(t))e.removeEventListener(r,n,!1)}function m(e){return(e.ownerDocument||e).defaultView}function g(e){const t=e.length;if(1===t)return{x:Math.round(e[0].clientX),y:Math.round(e[0].clientY)};let n=0,r=0,s=0;for(;s<t;)n+=e[s].clientX,r+=e[s].clientY,s++;return{x:Math.round(n/t),y:Math.round(r/t)}}function y(e){const t=[];let n=0;for(;n<e.pointers.length;)t[n]={clientX:Math.round(e.pointers[n].clientX),clientY:Math.round(e.pointers[n].clientY)},n++;return{timeStamp:Date.now(),pointers:t,center:g(t),deltaX:e.deltaX,deltaY:e.deltaY}}function _(e,t){const n=t.x-e.x,r=t.y-e.y;return Math.sqrt(n*n+r*r)}function b(e,t){const n=t.clientX-e.clientX,r=t.clientY-e.clientY;return Math.sqrt(n*n+r*r)}function v(e,t){const n=t.clientX-e.clientX,r=t.clientY-e.clientY;return 180*Math.atan2(r,n)/Math.PI}function x(e,t){return e===t?s.None:Math.abs(e)>=Math.abs(t)?e<0?s.Left:s.Right:t<0?s.Up:s.Down}function w(e,t,n){return{x:t/e||0,y:n/e||0}}function k(e,t){const{session:n}=e,{pointers:s}=t,{length:i}=s;n.firstInput||(n.firstInput=y(t)),i>1&&!n.firstMultiple?n.firstMultiple=y(t):1===i&&(n.firstMultiple=!1);const{firstInput:o,firstMultiple:a}=n,u=a?a.center:o.center,c=t.center=g(s);t.timeStamp=Date.now(),t.deltaTime=t.timeStamp-o.timeStamp,t.angle=function(e,t){const n=t.x-e.x,r=t.y-e.y;return 180*Math.atan2(r,n)/Math.PI}(u,c),t.distance=_(u,c);const{deltaX:l,deltaY:h}=function(e,t){const n=t.center;let s=e.offsetDelta,i=e.prevDelta;const o=e.prevInput;return t.eventType!==r.Start&&o?.eventType!==r.End||(i=e.prevDelta={x:o?.deltaX||0,y:o?.deltaY||0},s=e.offsetDelta={x:n.x,y:n.y}),{deltaX:i.x+(n.x-s.x),deltaY:i.y+(n.y-s.y)}}(n,t);t.deltaX=l,t.deltaY=h,t.offsetDirection=x(t.deltaX,t.deltaY);const f=w(t.deltaTime,t.deltaX,t.deltaY);var d,p;t.overallVelocityX=f.x,t.overallVelocityY=f.y,t.overallVelocity=Math.abs(f.x)>Math.abs(f.y)?f.x:f.y,t.scale=a?(d=a.pointers,b((p=s)[0],p[1])/b(d[0],d[1])):1,t.rotation=a?function(e,t){return v(t[1],t[0])-v(e[1],e[0])}(a.pointers,s):0,t.maxPointers=n.prevInput?t.pointers.length>n.prevInput.maxPointers?t.pointers.length:n.prevInput.maxPointers:t.pointers.length;let m=e.element;return function(e,t){let n=e;for(;n;){if(n===t)return!0;n=n.parentNode}return!1}(t.srcEvent.target,m)&&(m=t.srcEvent.target),t.target=m,function(e,t){const n=e.lastInterval||t,s=t.timeStamp-n.timeStamp;let i,o,a,u;if(t.eventType!==r.Cancel&&(s>25||void 0===n.velocity)){const r=t.deltaX-n.deltaX,c=t.deltaY-n.deltaY,l=w(s,r,c);o=l.x,a=l.y,i=Math.abs(l.x)>Math.abs(l.y)?l.x:l.y,u=x(r,c),e.lastInterval=t}else i=n.velocity,o=n.velocityX,a=n.velocityY,u=n.direction;t.velocity=i,t.velocityX=o,t.velocityY=a,t.direction=u}(n,t),t}class I{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=e=>{this.manager.options.enable&&this.handler(e)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,t){!function(e,t,n){const s=n.pointers.length,i=n.changedPointers.length,o=t&r.Start&&s-i==0,a=t&(r.End|r.Cancel)&&s-i==0;n.isFirst=Boolean(o),n.isFinal=Boolean(a),o&&(e.session={}),n.eventType=t;const u=k(e,n);e.emit("hammer.input",u),e.recognize(u),e.session.prevInput=u}(this.manager,e,t)}init(){d(this.element,this.evEl,this.domHandler),d(this.target,this.evTarget,this.domHandler),d(m(this.element),this.evWin,this.domHandler)}destroy(){p(this.element,this.evEl,this.domHandler),p(this.target,this.evTarget,this.domHandler),p(m(this.element),this.evWin,this.domHandler)}}const T={pointerdown:r.Start,pointermove:r.Move,pointerup:r.End,pointercancel:r.Cancel,pointerout:r.Cancel};class E extends I{constructor(e){super(e),this.evEl="pointerdown",this.evWin="pointermove pointerup pointercancel",this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:t}=this;let n=!1;const s=T[e.type],i=e.pointerType,o="touch"===i;let a=t.findIndex((t=>t.pointerId===e.pointerId));s&r.Start&&(e.buttons||o)?a<0&&(t.push(e),a=t.length-1):s&(r.End|r.Cancel)&&(n=!0),a<0||(t[a]=e,this.callback(s,{pointers:t,changedPointers:[e],eventType:s,pointerType:i,srcEvent:e}),n&&t.splice(a,1))}}const A=["","webkit","Moz","MS","ms","o"];function S(e,t){const n=t[0].toUpperCase()+t.slice(1);for(const r of A){const s=r?r+n:t;if(s in e)return s}}const L={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class O{constructor(e,t){this.options={...L,...t,cssProps:{...L.cssProps,...t.cssProps},inputTarget:t.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new E(this),this.touchAction=new h(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?2:1}recognize(e){const{session:t}=this;if(t.stopped)return;let n;this.session.prevented&&e.srcEvent.preventDefault();const{recognizers:r}=this;let{curRecognizer:s}=t;(!s||s&&s.state&i.Recognized)&&(s=t.curRecognizer=null);let o=0;for(;o<r.length;)n=r[o],2===t.stopped||s&&n!==s&&!n.canRecognizeWith(s)?n.reset():n.recognize(e),!s&&n.state&(i.Began|i.Changed|i.Ended)&&(s=t.curRecognizer=n),o++}get(e){const{recognizers:t}=this;for(let n=0;n<t.length;n++)if(t[n].options.event===e)return t[n];return null}add(e){if(Array.isArray(e)){for(const t of e)this.add(t);return this}const t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const t of e)this.remove(t);return this}const t="string"==typeof e?this.get(e):e;if(t){const{recognizers:e}=this,n=e.indexOf(t);-1!==n&&(e.splice(n,1),this.touchAction.update())}return this}on(e,t){if(!e||!t)return;const{handlers:n}=this;for(const r of f(e))n[r]=n[r]||[],n[r].push(t)}off(e,t){if(!e)return;const{handlers:n}=this;for(const r of f(e))t?n[r]&&n[r].splice(n[r].indexOf(t),1):delete n[r]}emit(e,t){const n=this.handlers[e]&&this.handlers[e].slice();if(!n||!n.length)return;const r=t;r.type=e,r.preventDefault=function(){t.srcEvent.preventDefault()};let s=0;for(;s<n.length;)n[s](r),s++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:t}=this;if(t){for(const[n,r]of Object.entries(this.options.cssProps)){const s=S(t.style,n);e?(this.oldCssProps[s]=t.style[s],t.style[s]=r):t.style[s]=this.oldCssProps[s]||""}e||(this.oldCssProps={})}}}let $=1;function M(e){return e&i.Cancelled?"cancel":e&i.Ended?"end":e&i.Changed?"move":e&i.Began?"start":""}class C{constructor(e){this.options=e,this.id=$++,this.state=i.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const t of e)this.recognizeWith(t);return this}let t;if("string"==typeof e){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{simultaneous:n}=this;return n[t.id]||(n[t.id]=t,t.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const t of e)this.dropRecognizeWith(t);return this}let t;return t="string"==typeof e?this.manager.get(e):e,t&&delete this.simultaneous[t.id],this}requireFailure(e){if(Array.isArray(e)){for(const t of e)this.requireFailure(t);return this}let t;if("string"==typeof e){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{requireFail:n}=this;return-1===n.indexOf(t)&&(n.push(t),t.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const t of e)this.dropRequireFailure(t);return this}let t;if(t="string"==typeof e?this.manager.get(e):e,t){const e=this.requireFail.indexOf(t);e>-1&&this.requireFail.splice(e,1)}return this}hasRequireFailures(){return Boolean(this.requireFail.find((e=>e.options.enable)))}canRecognizeWith(e){return Boolean(this.simultaneous[e.id])}emit(e){if(!e)return;const{state:t}=this;t<i.Ended&&this.manager.emit(this.options.event+M(t),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),t>=i.Ended&&this.manager.emit(this.options.event+M(t),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=i.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(i.Failed|i.Possible)))return!1;e++}return!0}recognize(e){const t={...e};if(!this.options.enable)return this.reset(),void(this.state=i.Failed);this.state&(i.Recognized|i.Cancelled|i.Failed)&&(this.state=i.Possible),this.state=this.process(t),this.state&(i.Began|i.Changed|i.Ended|i.Cancelled)&&this.tryEmit(t)}getEventNames(){return[this.options.event]}reset(){}}class N extends C{attrTest(e){const t=this.options.pointers;return 0===t||e.pointers.length===t}process(e){const{state:t}=this,{eventType:n}=e,s=t&(i.Began|i.Changed),o=this.attrTest(e);return s&&(n&r.Cancel||!o)?t|i.Cancelled:s||o?n&r.End?t|i.Ended:t&i.Began?t|i.Changed:i.Began:i.Failed}}class D extends C{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[a]}process(e){const{options:t}=this,n=e.pointers.length===t.pointers,s=e.distance<t.threshold,o=e.deltaTime<t.time;if(this.reset(),e.eventType&r.Start&&0===this.count)return this.failTimeout();if(s&&o&&n){if(e.eventType!==r.End)return this.failTimeout();const n=!this.pTime||e.timeStamp-this.pTime<t.interval,s=!this.pCenter||_(this.pCenter,e.center)<t.posThreshold;this.pTime=e.timeStamp,this.pCenter=e.center,s&&n?this.count+=1:this.count=1,this._input=e;if(0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=setTimeout((()=>{this.state=i.Recognized,this.tryEmit(this._input)}),t.interval),i.Began):i.Recognized}return i.Failed}failTimeout(){return this._timer=setTimeout((()=>{this.state=i.Failed}),this.options.interval),i.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===i.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const B=["","start","move","end","cancel","up","down","left","right"];class P extends N{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:s.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,t=[];return e&s.Horizontal&&t.push(l),e&s.Vertical&&t.push(c),t}getEventNames(){return B.map((e=>this.options.event+e))}directionTest(e){const{options:t}=this;let n=!0,{distance:r}=e,{direction:i}=e;const o=e.deltaX,a=e.deltaY;return i&t.direction||(t.direction&s.Horizontal?(i=0===o?s.None:o<0?s.Left:s.Right,n=o!==this.pX,r=Math.abs(e.deltaX)):(i=0===a?s.None:a<0?s.Up:s.Down,n=a!==this.pY,r=Math.abs(e.deltaY))),e.direction=i,n&&r>t.threshold&&Boolean(i&t.direction)}attrTest(e){return super.attrTest(e)&&(Boolean(this.state&i.Began)||!(this.state&i.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const t=s[e.direction].toLowerCase();t&&(e.additionalEvent=this.options.event+t),super.emit(e)}}const F=["","start","move","end","cancel","in","out"];class U extends N{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[u]}getEventNames(){return F.map((e=>this.options.event+e))}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||Boolean(this.state&i.Began))}emit(e){if(1!==e.scale){const t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}super.emit(e)}}class R{constructor(e,t,n){this.element=e,this.callback=t,this.options=n}}const V="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",W=("undefined"!=typeof window?window:global,"undefined"!=typeof global?global:window,"undefined"!=typeof document&&document,-1!==V.indexOf("firefox")),z=4.000244140625;class q extends R{constructor(e,t,n){super(e,t,{enable:!0,...n}),this.handleEvent=e=>{if(!this.options.enable)return;let t=e.deltaY;globalThis.WheelEvent&&(W&&e.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(t/=globalThis.devicePixelRatio),e.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(t*=40)),0!==t&&t%z==0&&(t=Math.floor(t/z)),e.shiftKey&&t&&(t*=.25),this.callback({type:"wheel",center:{x:e.clientX,y:e.clientY},delta:-t,srcEvent:e,pointerType:"mouse",target:e.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,t){"wheel"===e&&(this.options.enable=t)}}const j=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class H extends R{constructor(e,t,n){super(e,t,{enable:!0,...n}),this.handleEvent=e=>{this.handleOverEvent(e),this.handleOutEvent(e),this.handleEnterEvent(e),this.handleLeaveEvent(e),this.handleMoveEvent(e)},this.pressed=!1;const{enable:r}=this.options;this.enableMoveEvent=r,this.enableLeaveEvent=r,this.enableEnterEvent=r,this.enableOutEvent=r,this.enableOverEvent=r,j.forEach((t=>e.addEventListener(t,this.handleEvent)))}destroy(){j.forEach((e=>this.element.removeEventListener(e,this.handleEvent)))}enableEventType(e,t){switch(e){case"pointermove":this.enableMoveEvent=t;break;case"pointerover":this.enableOverEvent=t;break;case"pointerout":this.enableOutEvent=t;break;case"pointerenter":this.enableEnterEvent=t;break;case"pointerleave":this.enableLeaveEvent=t}}handleOverEvent(e){this.enableOverEvent&&"mouseover"===e.type&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&"mouseout"===e.type&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&"mouseenter"===e.type&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&"mouseleave"===e.type&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":0===e.buttons&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const G=["keydown","keyup"];class X extends R{constructor(e,t,n){super(e,t,{enable:!0,tabIndex:0,...n}),this.handleEvent=e=>{const t=e.target||e.srcElement;"INPUT"===t.tagName&&"text"===t.type||"TEXTAREA"===t.tagName||(this.enableDownEvent&&"keydown"===e.type&&this.callback({type:"keydown",srcEvent:e,key:e.key,target:e.target}),this.enableUpEvent&&"keyup"===e.type&&this.callback({type:"keyup",srcEvent:e,key:e.key,target:e.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",G.forEach((t=>e.addEventListener(t,this.handleEvent)))}destroy(){G.forEach((e=>this.element.removeEventListener(e,this.handleEvent)))}enableEventType(e,t){"keydown"===e&&(this.enableDownEvent=t),"keyup"===e&&(this.enableUpEvent=t)}}class Y extends R{constructor(e,t,n){super(e,t,n),this.handleEvent=e=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:e.clientX,y:e.clientY},srcEvent:e,pointerType:"mouse",target:e.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){"contextmenu"===e&&(this.options.enable=t)}}const Z={pointerdown:1,pointermove:2,pointerup:4,mousedown:1,mousemove:2,mouseup:4};function K(e){const t=Z[e.srcEvent.type];if(!t)return null;const{buttons:n,button:r}=e.srcEvent;let s=!1,i=!1,o=!1;return 2===t?(s=Boolean(1&n),i=Boolean(4&n),o=Boolean(2&n)):(s=0===r,i=1===r,o=2===r),{leftButton:s,middleButton:i,rightButton:o}}function Q(e,t){const n=e.center;if(!n)return null;const r=t.getBoundingClientRect(),s=r.width/t.offsetWidth||1,i=r.height/t.offsetHeight||1;return{center:n,offsetCenter:{x:(n.x-r.left-t.clientLeft)/s,y:(n.y-r.top-t.clientTop)/i}}}const J={srcElement:"root",priority:0};class ee{constructor(e,t){this.handleEvent=e=>{if(this.isEmpty())return;const t=this._normalizeEvent(e);let n=e.srcEvent.target;for(;n&&n!==t.rootElement;){if(this._emit(t,n),t.handled)return;n=n.parentNode}this._emit(t,"root")},this.eventManager=e,this.recognizerName=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,n,r=!1,s=!1){const{handlers:i,handlersByElement:o}=this,a={...J,...n};let u=o.get(a.srcElement);u||(u=[],o.set(a.srcElement,u));const c={type:e,handler:t,srcElement:a.srcElement,priority:a.priority};r&&(c.once=!0),s&&(c.passive=!0),i.push(c),this._active=this._active||!c.passive;let l=u.length-1;for(;l>=0&&!(u[l].priority>=c.priority);)l--;u.splice(l+1,0,c)}remove(e,t){const{handlers:n,handlersByElement:r}=this;for(let s=n.length-1;s>=0;s--){const i=n[s];if(i.type===e&&i.handler===t){n.splice(s,1);const e=r.get(i.srcElement);e.splice(e.indexOf(i),1),0===e.length&&r.delete(i.srcElement)}}this._active=n.some((e=>!e.passive))}_emit(e,t){const n=this.handlersByElement.get(t);if(n){let t=!1;const r=()=>{e.handled=!0},s=()=>{e.handled=!0,t=!0},i=[];for(let o=0;o<n.length;o++){const{type:a,handler:u,once:c}=n[o];if(u({...e,type:a,stopPropagation:r,stopImmediatePropagation:s}),c&&i.push(n[o]),t)break}for(let e=0;e<i.length;e++){const{type:t,handler:n}=i[e];this.remove(t,n)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...K(e),...Q(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}function te(e){if("recognizer"in e)return e;let t;const n=Array.isArray(e)?[...e]:[e];if("function"==typeof n[0]){t=new(n.shift())(n.shift()||{})}else t=n.shift();return{recognizer:t,recognizeWith:"string"==typeof n[0]?[n[0]]:n[0],requireFailure:"string"==typeof n[1]?[n[1]]:n[1]}}class ne{constructor(e=null,t={}){if(this._onBasicInput=e=>{this.manager.emit(e.srcEvent.type,e)},this._onOtherEvent=e=>{this.manager.emit(e.type,e)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...t},this.events=new Map,this.element=e,e){this.manager=new O(e,this.options);for(const e of this.options.recognizers){const{recognizer:t,recognizeWith:n,requireFailure:r}=te(e);this.manager.add(t),n&&t.recognizeWith(n),r&&t.requireFailure(r)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new q(e,this._onOtherEvent,{enable:!1}),this.moveInput=new H(e,this._onOtherEvent,{enable:!1}),this.keyInput=new X(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new Y(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,t,n){this._addEventHandler(e,t,n,!1)}once(e,t,n){this._addEventHandler(e,t,n,!0)}watch(e,t,n){this._addEventHandler(e,t,n,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){const{manager:n}=this;if(!n)return;const r=n.get(e);r&&(r.set({enable:t}),n.touchAction.update()),this.wheelInput?.enableEventType(e,t),this.moveInput?.enableEventType(e,t),this.keyInput?.enableEventType(e,t),this.contextmenuInput?.enableEventType(e,t)}_addEventHandler(e,t,n,r,s){if("string"!=typeof e){n=t;for(const[t,i]of Object.entries(e))this._addEventHandler(t,i,n,r,s);return}const{manager:i,events:o}=this;if(!i)return;let a=o.get(e);if(!a){const t=this._getRecognizerName(e)||e;a=new ee(this,t),o.set(e,a),i&&i.on(e,a.handleEvent)}a.add(e,t,n,r,s),a.isEmpty()||this._toggleRecognizer(a.recognizerName,!0)}_removeEventHandler(e,t){if("string"!=typeof e){for(const[t,n]of Object.entries(e))this._removeEventHandler(t,n);return}const{events:n}=this,r=n.get(e);if(r&&(r.remove(e,t),r.isEmpty())){const{recognizerName:e}=r;let t=!1;for(const r of n.values())if(r.recognizerName===e&&!r.isEmpty()){t=!0;break}t||this._toggleRecognizer(e,!1)}}_getRecognizerName(e){return this.manager.recognizers.find((t=>t.getEventNames().includes(e)))?.options.event}}},19495:(e,t,n)=>{function r(e){var t,n,r,i=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,r=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new s(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function s(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return s=function(e){this.s=e,this.n=e.next},s.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Promise.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Promise.reject(e):t(n.apply(this.s,arguments))}},new s(e)}n.d(t,{A:()=>r})}}]);