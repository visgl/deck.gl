"use strict";(self.webpackChunkproject_website=self.webpackChunkproject_website||[]).push([[3424],{69499:(e,t,r)=>{r.d(t,{C:()=>s});var i=r(5153);class s extends i.F{get[Symbol.toStringTag](){return"ComputePipeline"}hash="";shaderLayout;constructor(e,t){super(e,t,s.defaultProps),this.shaderLayout=t.shaderLayout}static defaultProps={...i.F.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0}}},63424:(e,t,r)=>{r.d(t,{WebGPUDevice:()=>ne});var i=r(28171),s=r(26839),n=r(29651);class a extends s.h{device;handle;byteLength;constructor(e,t){super(e,t),this.device=e,this.byteLength=t.byteLength||t.data?.byteLength||0;const r=Boolean(this.props.onMapped||t.data),i=4*Math.ceil(this.byteLength/4);if(this.device.pushErrorScope("out-of-memory"),this.device.pushErrorScope("validation"),this.handle=this.props.handle||this.device.handle.createBuffer({label:this.props.id,usage:this.props.usage||GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,mappedAtCreation:r,size:i}),this.device.popErrorScope((e=>{this.device.reportError(new Error(`${this} creation failed ${e.message}`),this)(),this.device.debug()})),this.device.popErrorScope((e=>{this.device.reportError(new Error(`${this} out of memory: ${e.message}`),this)(),this.device.debug()})),this.device.pushErrorScope("validation"),t.data||t.onMapped)try{const e=this.handle.getMappedRange();if(t.data){const r=t.data;new r.constructor(e).set(r)}else t.onMapped?.(e,"mapped")}finally{this.handle.unmap()}this.device.popErrorScope((e=>{this.device.reportError(new Error(`${this} creation failed ${e.message}`),this)(),this.device.debug()}))}destroy(){this.handle?.destroy(),this.handle=null}write(e,t=0){const r=ArrayBuffer.isView(e)?e.buffer:e,i=ArrayBuffer.isView(e)?e.byteOffset:0;this.device.pushErrorScope("validation"),this.device.handle.queue.writeBuffer(this.handle,t,r,i,e.byteLength),this.device.popErrorScope((e=>{this.device.reportError(new Error(`${this}.write() ${e.message}`),this)(),this.device.debug()}))}async mapAndWriteAsync(e,t=0,r=this.byteLength-t){const i=!!(this.usage&s.h.MAP_WRITE)?null:this._getMappableBuffer(s.h.MAP_WRITE|s.h.COPY_SRC,0,this.byteLength),n=i||this;this.device.pushErrorScope("validation");try{await this.device.handle.queue.onSubmittedWorkDone(),await n.handle.mapAsync(GPUMapMode.WRITE,t,r);const s=n.handle.getMappedRange(t,r);await e(s,"mapped"),n.handle.unmap(),i&&this._copyBuffer(i,t,r)}finally{this.device.popErrorScope((e=>{this.device.reportError(new Error(`${this}.mapAndWriteAsync() ${e.message}`),this)(),this.device.debug()})),i?.destroy()}}async readAsync(e=0,t=this.byteLength-e){return this.mapAndReadAsync((e=>new Uint8Array(e.slice(0))),e,t)}async mapAndReadAsync(e,t=0,r=this.byteLength-t){if(t%8!=0||r%4!=0)throw new Error("byteOffset must be multiple of 8 and byteLength multiple of 4");if(t+r>this.handle.size)throw new Error("Mapping range exceeds buffer size");const i=!!(this.usage&s.h.MAP_READ)?null:this._getMappableBuffer(s.h.MAP_READ|s.h.COPY_DST,0,this.byteLength),n=i||this;this.device.pushErrorScope("validation");try{await this.device.handle.queue.onSubmittedWorkDone(),i&&i._copyBuffer(this),await n.handle.mapAsync(GPUMapMode.READ,t,r);const s=n.handle.getMappedRange(t,r),a=await e(s,"mapped");return n.handle.unmap(),a}finally{this.device.popErrorScope((e=>{this.device.reportError(new Error(`${this}.mapAndReadAsync() ${e.message}`),this)(),this.device.debug()})),i?.destroy()}}readSyncWebGL(e,t){throw new Error("Not implemented")}_getMappableBuffer(e,t,r){n.R.warn(`${this} is not readable, creating a temporary Buffer`);return new a(this.device,{usage:e,byteLength:r})}_copyBuffer(e,t=0,r=this.byteLength){this.device.pushErrorScope("validation");const i=this.device.handle.createCommandEncoder();i.copyBufferToBuffer(e.handle,t,this.handle,t,r),this.device.handle.queue.submit([i.finish()]),this.device.popErrorScope((e=>{this.device.reportError(new Error(`${this}._getReadableBuffer() ${e.message}`),this)(),this.device.debug()}))}}var o=r(80698);function h(e){if(e.includes("webgl"))throw new Error("webgl-only format");return e}var d=r(89277);class p extends d.L{device;handle;constructor(e,t){super(e,t),this.device=e;const r={...this.props,mipmapFilter:void 0};"comparison-sampler"!==t.type&&delete r.compare,t.mipmapFilter&&"none"!==t.mipmapFilter&&(r.mipmapFilter=t.mipmapFilter),this.handle=t.handle||this.device.handle.createSampler(r),this.handle.label=this.props.id}destroy(){this.handle=null}}var c=r(75638);class l extends c.X{device;handle;texture;constructor(e,t){super(e,t),this.device=e,this.texture=t.texture,this.device.pushErrorScope("validation"),this.handle=this.texture.handle.createView({format:this.props.format||this.texture.format,dimension:this.props.dimension||this.texture.dimension,aspect:this.props.aspect,baseMipLevel:this.props.baseMipLevel,mipLevelCount:this.props.mipLevelCount,baseArrayLayer:this.props.baseArrayLayer,arrayLayerCount:this.props.arrayLayerCount}),this.device.popErrorScope((e=>{this.device.reportError(new Error(`TextureView constructor: ${e.message}`),this)(),this.device.debug()})),this.handle.label=this.props.id}destroy(){this.handle=null}}class u extends o.g{device;handle;sampler;view;constructor(e,t){super(e,t),this.device=e,"cube"===this.dimension&&(this.depth=6),this.device.pushErrorScope("out-of-memory"),this.device.pushErrorScope("validation"),this.handle=this.props.handle||this.device.handle.createTexture({label:this.id,size:{width:this.width,height:this.height,depthOrArrayLayers:this.depth},usage:this.props.usage||o.g.TEXTURE|o.g.COPY_DST,dimension:this.baseDimension,format:h(this.format),mipLevelCount:this.mipLevels,sampleCount:this.props.samples}),this.device.popErrorScope((e=>{this.device.reportError(new Error(`${this} constructor: ${e.message}`),this)(),this.device.debug()})),this.device.popErrorScope((e=>{this.device.reportError(new Error(`${this} out of memory: ${e.message}`),this)(),this.device.debug()})),this.props.handle&&(this.handle.label||=this.id,this.width=this.handle.width,this.height=this.handle.height),this.sampler=t.sampler instanceof p?t.sampler:new p(this.device,t.sampler||{}),this.view=new l(this.device,{...this.props,texture:this,mipLevelCount:this.mipLevels,arrayLayerCount:"3d"!==this.dimension?this.depth:1}),this._initializeData(t.data)}destroy(){this.handle?.destroy(),this.handle=null}createView(e){return new l(this.device,{...e,texture:this})}copyImageData(e){const{width:t,height:r,depth:i}=this,s=this._normalizeCopyImageDataOptions(e);this.device.pushErrorScope("validation"),this.device.handle.queue.writeTexture({texture:this.handle,mipLevel:s.mipLevel,aspect:s.aspect,origin:[s.x,s.y,s.z]},s.data,{offset:s.byteOffset,bytesPerRow:s.bytesPerRow,rowsPerImage:s.rowsPerImage},[t,r,i]),this.device.popErrorScope((e=>{this.device.reportError(new Error(`copyImageData: ${e.message}`),this)(),this.device.debug()}))}copyExternalImage(e){const t=this._normalizeCopyExternalImageOptions(e);return this.device.pushErrorScope("validation"),this.device.handle.queue.copyExternalImageToTexture({source:t.image,origin:[t.sourceX,t.sourceY],flipY:t.flipY},{texture:this.handle,origin:[t.x,t.y,0],mipLevel:t.mipLevel,aspect:t.aspect,colorSpace:t.colorSpace,premultipliedAlpha:t.premultipliedAlpha},[t.width,t.height,1]),this.device.popErrorScope((e=>{this.device.reportError(new Error(`copyExternalImage: ${e.message}`),this)(),this.device.debug()})),{width:t.width,height:t.height}}generateMipmapsWebGL(){n.R.warn(`${this}: generateMipmaps not supported in WebGPU`)()}}var m=r(5153);class f extends m.F{get[Symbol.toStringTag](){return"ExternalTexture"}constructor(e,t){super(e,t,f.defaultProps)}static defaultProps={...m.F.defaultProps,source:void 0,colorSpace:"srgb"}}class g extends f{device;handle;sampler;constructor(e,t){super(e,t),this.device=e,this.handle=this.props.handle||this.device.handle.importExternalTexture({source:t.source,colorSpace:t.colorSpace}),this.sampler=null}destroy(){this.handle=null}setSampler(e){return this.sampler=e instanceof p?e:new p(this.device,e),this}}var b=r(11669);class v extends b.M{device;handle;constructor(e,t){super(e,t),this.device=e;const r=t.source.includes("#version");if("glsl"===this.props.language||r)throw new Error("GLSL shaders are not supported in WebGPU");this.device.pushErrorScope("validation"),this.handle=this.props.handle||this.device.handle.createShaderModule({code:t.source}),this.device.popErrorScope((e=>{this.device.reportError(new Error(`${this} creation failed:\n"${e.message}"`),this,this.props.source)(),this.device.debug()})),this.handle.label=this.props.id,this._checkCompilationError()}get asyncCompilationStatus(){return this.getCompilationInfo().then((()=>this.compilationStatus))}async _checkCompilationError(){const e=await this.getCompilationInfo(),t=Boolean(e.find((e=>"error"===e.type)));this.compilationStatus=t?"error":"success",this.debugShader(),"error"===this.compilationStatus&&(this.device.reportError(new Error("Shader compilation error"),this,e)(),this.device.debug())}destroy(){this.handle=null}async getCompilationInfo(){return(await this.handle.getCompilationInfo()).messages}}var y=r(22512);function w(e){return e.depthStencil=e.depthStencil||{format:"depth24plus",stencilFront:{},stencilBack:{},depthWriteEnabled:!1,depthCompare:"less-equal"},e.depthStencil}function S(e){return w(e).stencilFront}function E(e){return w(e).stencilBack}const x={cullMode:(e,t,r)=>{r.primitive=r.primitive||{},r.primitive.cullMode=t},frontFace:(e,t,r)=>{r.primitive=r.primitive||{},r.primitive.frontFace=t},depthWriteEnabled:(e,t,r)=>{if(t){w(r).depthWriteEnabled=t}},depthCompare:(e,t,r)=>{w(r).depthCompare=t},depthFormat:(e,t,r)=>{w(r).format=t},depthBias:(e,t,r)=>{w(r).depthBias=t},depthBiasSlopeScale:(e,t,r)=>{w(r).depthBiasSlopeScale=t},depthBiasClamp:(e,t,r)=>{w(r).depthBiasClamp=t},stencilReadMask:(e,t,r)=>{w(r).stencilReadMask=t},stencilWriteMask:(e,t,r)=>{w(r).stencilWriteMask=t},stencilCompare:(e,t,r)=>{const i=S(r),s=E(r);i.compare=t,s.compare=t},stencilPassOperation:(e,t,r)=>{const i=S(r),s=E(r);i.passOp=t,s.passOp=t},stencilFailOperation:(e,t,r)=>{const i=S(r),s=E(r);i.failOp=t,s.failOp=t},stencilDepthFailOperation:(e,t,r)=>{const i=S(r),s=E(r);i.depthFailOp=t,s.depthFailOp=t},sampleCount:(e,t,r)=>{r.multisample=r.multisample||{},r.multisample.count=t},sampleMask:(e,t,r)=>{r.multisample=r.multisample||{},r.multisample.mask=t},sampleAlphaToCoverageEnabled:(e,t,r)=>{r.multisample=r.multisample||{},r.multisample.alphaToCoverageEnabled=t},colorMask:(e,t,r)=>{B(r,0).writeMask=t},blend:(e,t,r)=>{t&&A(r,0)},blendColorOperation:(e,t,r)=>{const i=A(r,0);i.color=i.color||{},i.color.operation=t},blendColorSrcFactor:(e,t,r)=>{const i=A(r,0);i.color=i.color||{},i.color.srcFactor=t},blendColorDstFactor:(e,t,r)=>{A(r,0).color.dstFactor=t},blendAlphaOperation:(e,t,r)=>{const i=A(r,0);i.alpha=i.alpha||{},i.alpha.operation=t},blendAlphaSrcFactor:(e,t,r)=>{const i=A(r,0);i.alpha=i.alpha||{},i.alpha.srcFactor=t},blendAlphaDstFactor:(e,t,r)=>{const i=A(r,0);i.alpha=i.alpha||{},i.alpha.dstFactor=t},unclippedDepth:P,provokingVertex:P,polygonMode:P,polygonOffsetLine:P,clipDistance0:P,clipDistance1:P,clipDistance2:P,clipDistance3:P,clipDistance4:P,clipDistance5:P,clipDistance6:P,clipDistance7:P};function P(e,t,r){n.R.warn(`${e} parameter not supported in WebGPU`)()}const C={primitive:{cullMode:"back",topology:"triangle-list"},vertex:{module:void 0,entryPoint:"main"},fragment:{module:void 0,entryPoint:"main",targets:[]},layout:"auto"};function L(e,t={}){Object.assign(e,{...C,...e}),function(e,t){for(const[r,i]of Object.entries(t)){const t=x[r];t?t(r,i,e):n.R.error(`Illegal parameter ${r} in WebGPU`)()}}(e,t)}function B(e,t){return e.fragment.targets=e.fragment?.targets||[],Array.isArray(e.fragment?.targets)||n.R.warn("parameters: no targets array")(),0===e.fragment?.targets?.length&&e.fragment.targets?.push({}),e.fragment?.targets?.[0]}function A(e,t){const r=B(e);return r.blend=r.blend||{color:{},alpha:{}},r.blend}function _(e,t,r,i){const s=function(e,t){const r=[];for(const[i,s]of Object.entries(e)){let e=G(t,i);if(e){const t=D(s,e.location);t&&r.push(t)}if(s instanceof o.g&&(e=G(t,`${i}Sampler`,{ignoreWarnings:!0}),e)){const t=D(s,e.location,{sampler:!0});t&&r.push(t)}}return r}(i,r);e.pushErrorScope("validation");const a=e.createBindGroup({layout:t,entries:s});return e.popErrorScope().then((e=>{e&&n.R.error(`bindGroup creation: ${e.message}`,a)()})),a}function G(e,t,r){const i=e.bindings.find((e=>e.name===t||`${e.name.toLocaleLowerCase()}uniforms`===t.toLocaleLowerCase()));return i||r?.ignoreWarnings||n.R.warn(`Binding ${t} not set: Not found in shader layout.`)(),i||null}function D(e,t,r){return e instanceof s.h?{binding:t,resource:{buffer:e.handle}}:e instanceof d.L?{binding:t,resource:e.handle}:e instanceof o.g?r?.sampler?{binding:t,resource:e.sampler.handle}:{binding:t,resource:e.view.handle}:(n.R.warn(`invalid binding ${name}`,e),null)}var T=r(77933);function R(e){if(e.endsWith("-webgl"))throw new Error(`WebGPU does not support vertex format ${e}`);return e}function $(e,t){const r=[],i=new Set;for(const s of t){const t=[];let n="vertex",a=0,o=s.format;if(s.attributes)for(const r of s.attributes){const h=O(e,r.attribute,i),d=h?.location;o=r.format||s.format,n=h?.stepMode||(h?.name.startsWith("instance")?"instance":"vertex"),t.push({format:R(o),offset:r.byteOffset,shaderLocation:d}),a+=(0,T.yx)(o).byteLength}else{const r=O(e,s.name,i);if(!r)continue;a=(0,T.yx)(o).byteLength,n=r.stepMode||(r.name.startsWith("instance")?"instance":"vertex"),t.push({format:R(o),offset:0,shaderLocation:r.location})}r.push({arrayStride:s.byteStride||a,stepMode:n,attributes:t})}for(const s of e.attributes)i.has(s.name)||r.push({arrayStride:(0,T.yx)("float32x3").byteLength,stepMode:s.stepMode||(s.name.startsWith("instance")?"instance":"vertex"),attributes:[{format:R("float32x3"),offset:0,shaderLocation:s.location}]});return r.sort(((e,t)=>Math.min(...Array.from(e.attributes,(e=>e.shaderLocation)))-Math.min(...Array.from(t.attributes,(e=>e.shaderLocation))))),r}function O(e,t,r){const i=e.attributes.find((e=>e.name===t));if(!i)return n.R.warn(`Supplied attribute not present in shader layout: ${t}`)(),null;if(r){if(r.has(t))throw new Error(`Found multiple entries for attribute: ${t}`);r.add(t)}return i}class F extends y.r{device;handle;vs;fs=null;_bindings;_bindGroupLayout=null;_bindGroup=null;get[Symbol.toStringTag](){return"WebGPURenderPipeline"}constructor(e,t){if(super(e,t),this.device=e,this.handle=this.props.handle,!this.handle){const e=this._getRenderPipelineDescriptor();n.R.groupCollapsed(1,`new WebGPURenderPipeline(${this.id})`)(),n.R.probe(1,JSON.stringify(e,null,2))(),n.R.groupEnd(1)(),this.device.pushErrorScope("validation"),this.handle=this.device.handle.createRenderPipeline(e),this.device.popErrorScope((e=>{this.device.reportError(new Error(`${this} creation failed:\n"${e.message}"`),this)(),this.device.debug()}))}this.handle.label=this.props.id,this.vs=t.vs,this.fs=t.fs,this._bindings={...this.props.bindings}}destroy(){this.handle=null}setBindings(e){for(const[t,r]of Object.entries(e))this._bindings[t]!==r&&(this._bindGroup=null);Object.assign(this._bindings,e)}draw(e){const t=e.renderPass;this.device.pushErrorScope("validation"),t.handle.setPipeline(this.handle),this.device.popErrorScope((e=>{this.device.reportError(new Error(`${this} setPipeline failed:\n"${e.message}"`),this)(),this.device.debug()}));const r=this._getBindGroup();return r&&t.handle.setBindGroup(0,r),e.vertexArray.bindBeforeRender(e.renderPass),e.indexCount?t.handle.drawIndexed(e.indexCount,e.instanceCount,e.firstIndex,e.baseVertex,e.firstInstance):t.handle.draw(e.vertexCount||0,e.instanceCount||1,e.firstInstance),e.vertexArray.unbindAfterRender(e.renderPass),!0}_getBindGroup(){return 0===this.shaderLayout.bindings.length?null:(this._bindGroupLayout=this._bindGroupLayout||this.handle.getBindGroupLayout(0),this._bindGroup=this._bindGroup||_(this.device.handle,this._bindGroupLayout,this.shaderLayout,this._bindings),this._bindGroup)}_getRenderPipelineDescriptor(){const e={module:this.props.vs.handle,entryPoint:this.props.vertexEntryPoint||"main",buffers:$(this.shaderLayout,this.props.bufferLayout)},t=[];if(this.props.colorAttachmentFormats)for(const a of this.props.colorAttachmentFormats)t.push(a?{format:h(a)}:null);else t.push({format:h(this.device.preferredColorFormat)});const r={module:this.props.fs.handle,entryPoint:this.props.fragmentEntryPoint||"main",targets:t},i=this.device.createPipelineLayout({shaderLayout:this.shaderLayout}),s={vertex:e,fragment:r,primitive:{topology:this.props.topology},layout:i.handle},n=this.props.depthStencilAttachmentFormat||this.device.preferredDepthFormat;return this.props.parameters.depthWriteEnabled&&(s.depthStencil={format:h(n)}),L(s,this.props.parameters),s}}var I=r(74918);class M extends I.G{device;handle=null;colorAttachments=[];depthStencilAttachment=null;constructor(e,t){super(e,t),this.device=e,this.autoCreateAttachmentTextures()}updateAttachments(){}}var W=r(69499);class k extends W.C{device;handle;_bindGroupLayout=null;_bindGroup=null;_bindings={};constructor(e,t){super(e,t),this.device=e;const r=this.props.shader;this.handle=this.props.handle||this.device.handle.createComputePipeline({label:this.props.id,compute:{module:r.handle,entryPoint:this.props.entryPoint,constants:this.props.constants},layout:"auto"})}setBindings(e){Object.assign(this._bindings,e)}_getBindGroup(){return this._bindGroupLayout=this._bindGroupLayout||this.handle.getBindGroupLayout(0),this._bindGroup=this._bindGroup||_(this.device.handle,this._bindGroupLayout,this.shaderLayout,this._bindings),this._bindGroup}}var U=r(19023),V=r(44921);class z extends U.o{get[Symbol.toStringTag](){return"WebGPUVertexArray"}device;handle=null;constructor(e,t){super(e,t),this.device=e}destroy(){}setIndexBuffer(e){this.indexBuffer=e}setBuffer(e,t){this.attributes[e]=t}bindBeforeRender(e,t,r){const i=e,s=this.indexBuffer;s?.handle&&(n.R.info(3,"setting index buffer",s?.handle,s?.indexType)(),i.handle.setIndexBuffer(s?.handle,s?.indexType));for(let a=0;a<this.maxVertexAttributes;a++){const e=this.attributes[a];e?.handle&&(n.R.info(3,`setting vertex buffer ${a}`,e?.handle)(),i.handle.setVertexBuffer(a,e?.handle))}}unbindAfterRender(e){}static isConstantAttributeZeroSupported(e){return"Chrome"===(0,V.X)()}}var Q=r(38623);class q extends Q.Q{device;handle;depthStencilAttachment=null;get[Symbol.toStringTag](){return"WebGPUCanvasContext"}constructor(e,t,r){super(r);const i=this.canvas.getContext("webgpu");if(!i)throw new Error(`${this}: Failed to create WebGPU canvas context`);this.device=e,this.handle=i,this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this._updateDevice()}destroy(){this.handle.unconfigure(),super.destroy()}getCurrentFramebuffer(e={depthStencilFormat:"depth24plus"}){const t=this.getCurrentTexture();if(t.width!==this.drawingBufferWidth||t.height!==this.drawingBufferHeight){const[e,r]=this.getDrawingBufferSize();this.drawingBufferWidth=t.width,this.drawingBufferHeight=t.height,n.R.log(1,`${this}: Resized to compensate for initial canvas size mismatch ${e}x${r} => ${this.drawingBufferWidth}x${this.drawingBufferHeight}px`)()}return e?.depthStencilFormat&&this._createDepthStencilAttachment(e?.depthStencilFormat),new M(this.device,{colorAttachments:[t],depthStencilAttachment:this.depthStencilAttachment})}_updateDevice(){this.depthStencilAttachment&&(this.depthStencilAttachment.destroy(),this.depthStencilAttachment=null),this.handle.configure({device:this.device.handle,format:this.device.preferredColorFormat,colorSpace:this.props.colorSpace,alphaMode:this.props.alphaMode})}getCurrentTexture(){const e=this.handle.getCurrentTexture();return this.device.createTexture({id:`${this.id}#color-texture`,handle:e,format:this.device.preferredColorFormat,width:e.width,height:e.height})}_createDepthStencilAttachment(e){return this.depthStencilAttachment||(this.depthStencilAttachment=this.device.createTexture({id:`${this.id}#depth-stencil-texture`,usage:o.g.RENDER_ATTACHMENT,format:e,width:this.drawingBufferWidth,height:this.drawingBufferHeight})),this.depthStencilAttachment}}var j=r(47173),N=r(6895);class Y extends N.M{device;handle;constructor(e,t){super(e.device,{}),this.device=e.device,this.handle=this.props.handle||e.handle.finish({label:t?.id||"unnamed-command-buffer"})}}var X=r(42719);class H extends X.A{device;handle;pipeline=null;constructor(e,t={}){super(e,t),this.device=e;const r=t.framebuffer||e.getCanvasContext().getCurrentFramebuffer(),i=this.getRenderPassDescriptor(r),s=t.timestampQuerySet;if(s&&(i.occlusionQuerySet=s.handle),e.features.has("timestamp-query")){const e=t.timestampQuerySet;i.timestampWrites=e?{querySet:e.handle,beginningOfPassWriteIndex:t.beginTimestampIndex,endOfPassWriteIndex:t.endTimestampIndex}:void 0}if(!e.commandEncoder)throw new Error("commandEncoder not available");this.device.pushErrorScope("validation"),this.handle=this.props.handle||e.commandEncoder.handle.beginRenderPass(i),this.device.popErrorScope((e=>{this.device.reportError(new Error(`${this} creation failed:\n"${e.message}"`),this)(),this.device.debug()})),this.handle.label=this.props.id,n.R.groupCollapsed(3,`new WebGPURenderPass(${this.id})`)(),n.R.probe(3,JSON.stringify(i,null,2))(),n.R.groupEnd(3)()}destroy(){}end(){this.handle.end()}setPipeline(e){this.pipeline=e,this.device.pushErrorScope("validation"),this.handle.setPipeline(this.pipeline.handle),this.device.popErrorScope((e=>{this.device.reportError(new Error(`${this} setPipeline failed:\n"${e.message}"`),this)(),this.device.debug()}))}setBindings(e){this.pipeline?.setBindings(e);const t=this.pipeline?._getBindGroup();t&&this.handle.setBindGroup(0,t)}setIndexBuffer(e,t,r=0,i){this.handle.setIndexBuffer(e.handle,t,r,i)}setVertexBuffer(e,t,r=0){this.handle.setVertexBuffer(e,t.handle,r)}draw(e){e.indexCount?this.handle.drawIndexed(e.indexCount,e.instanceCount,e.firstIndex,e.baseVertex,e.firstInstance):this.handle.draw(e.vertexCount||0,e.instanceCount||1,e.firstIndex,e.firstInstance)}drawIndirect(){}setParameters(e){const{blendConstant:t,stencilReference:r,scissorRect:i,viewport:s}=e;t&&this.handle.setBlendConstant(t),r&&this.handle.setStencilReference(r),i&&this.handle.setScissorRect(i[0],i[1],i[2],i[3]),s&&this.handle.setViewport(s[0],s[1],s[2],s[3],s[4]??0,s[5]??1)}pushDebugGroup(e){this.handle.pushDebugGroup(e)}popDebugGroup(){this.handle.popDebugGroup()}insertDebugMarker(e){this.handle.insertDebugMarker(e)}beginOcclusionQuery(e){this.handle.beginOcclusionQuery(e)}endOcclusionQuery(){this.handle.endOcclusionQuery()}getRenderPassDescriptor(e){const t={colorAttachments:[]};if(t.colorAttachments=e.colorAttachments.map(((e,t)=>{return{loadOp:!1!==this.props.clearColor?"clear":"load",clearValue:(r=this.props.clearColors?.[t]||this.props.clearColor||X.A.defaultClearColor,{r:r[0],g:r[1],b:r[2],a:r[3]}),storeOp:this.props.discard?"discard":"store",view:e.handle};var r})),e.depthStencilAttachment){t.depthStencilAttachment={view:e.depthStencilAttachment.handle};const{depthStencilAttachment:r}=t;this.props.depthReadOnly&&(r.depthReadOnly=!0),!1!==this.props.clearDepth&&(r.depthClearValue=this.props.clearDepth);!0&&(r.depthLoadOp=!1!==this.props.clearDepth?"clear":"load",r.depthStoreOp="store");!1&&(r.stencilLoadOp=!1!==this.props.clearStencil?"clear":"load",r.stencilStoreOp="store")}return t}}class J extends m.F{constructor(e,t){super(e,t,J.defaultProps)}static defaultProps={...m.F.defaultProps,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0};get[Symbol.toStringTag](){return"ComputePass"}}class Z extends J{device;handle;_webgpuPipeline=null;constructor(e,t){let r;if(super(e,t),this.device=e,e.features.has("timestamp-query")){const e=t.timestampQuerySet;e&&(r={querySet:e.handle,beginningOfPassWriteIndex:t.beginTimestampIndex,endOfPassWriteIndex:t.endTimestampIndex})}this.handle=this.props.handle||e.commandEncoder.handle.beginComputePass({label:this.props.id,timestampWrites:r})}destroy(){}end(){this.handle.end()}setPipeline(e){const t=e;this.handle.setPipeline(t.handle),this._webgpuPipeline=t,this.setBindings([])}setBindings(e){const t=this._webgpuPipeline._getBindGroup();this.handle.setBindGroup(0,t)}dispatch(e,t,r){this.handle.dispatchWorkgroups(e,t,r)}dispatchIndirect(e,t=0){const r=e;this.handle.dispatchWorkgroupsIndirect(r.handle,t)}pushDebugGroup(e){this.handle.pushDebugGroup(e)}popDebugGroup(){this.handle.popDebugGroup()}insertDebugMarker(e){this.handle.insertDebugMarker(e)}}class K extends j.i{device;handle;constructor(e,t={}){super(e,t),this.device=e,this.handle=t.handle||this.device.handle.createCommandEncoder({label:this.props.id}),this.handle.label=this.props.id}destroy(){}finish(e){this.device.pushErrorScope("validation");const t=new Y(this,{id:e?.id||"unnamed-command-buffer"});return this.device.popErrorScope((e=>{const t=`${this} command encoding: ${e.message}. Maybe add depthWriteEnabled to your Model?`;this.device.reportError(new Error(t),this)(),this.device.debug()})),t}beginRenderPass(e){return new H(this.device,e)}beginComputePass(e){return new Z(this.device,e)}copyBufferToBuffer(e){const t=e.sourceBuffer,r=e.destinationBuffer;this.handle.copyBufferToBuffer(t.handle,e.sourceOffset??0,r.handle,e.destinationOffset??0,e.size??0)}copyBufferToTexture(e){const t=e.sourceBuffer,r=e.destinationTexture;this.handle.copyBufferToTexture({buffer:t.handle,offset:e.offset??0,bytesPerRow:e.bytesPerRow,rowsPerImage:e.rowsPerImage},{texture:r.handle,mipLevel:e.mipLevel??0,origin:e.origin??{}},{width:e.extent?.[0],height:e.extent?.[1],depthOrArrayLayers:e.extent?.[2]})}copyTextureToBuffer(e){}copyTextureToTexture(e){}pushDebugGroup(e){this.handle.pushDebugGroup(e)}popDebugGroup(){this.handle.popDebugGroup()}insertDebugMarker(e){this.handle.insertDebugMarker(e)}resolveQuerySet(e,t,r){const i=e,s=t;this.handle.resolveQuerySet(i.handle,r?.firstQuery||0,r?.queryCount||e.props.count-(r?.firstQuery||0),s.handle,r?.destinationOffset||0)}}var ee=r(57856);class te extends ee.d{device;handle;constructor(e,t){super(e,t),this.device=e,this.handle=this.props.handle||this.device.handle.createQuerySet({type:this.props.type,count:this.props.count}),this.handle.label=this.props.id}destroy(){this.handle?.destroy(),this.handle=null}}class re extends m.F{get[Symbol.toStringTag](){return"PipelineLayout"}constructor(e,t){super(e,t,re.defaultProps)}static defaultProps={...m.F.defaultProps,shaderLayout:{attributes:[],bindings:[]}}}class ie extends re{device;handle;constructor(e,t){super(e,t),this.device=e;const r=this.mapShaderLayoutToBindGroupEntries();this.handle=this.device.handle.createPipelineLayout({label:t?.id??"unnamed-pipeline-layout",bindGroupLayouts:[this.device.handle.createBindGroupLayout({label:"bind-group-layout",entries:r})]})}destroy(){this.handle=null}mapShaderLayoutToBindGroupEntries(){const e=[];for(let t=0;t<this.props.shaderLayout.bindings.length;t++){const r=this.props.shaderLayout.bindings[t],i={};switch(r.type){case"uniform":i.buffer={type:"uniform",hasDynamicOffset:r.hasDynamicOffset,minBindingSize:r.minBindingSize};break;case"read-only-storage":i.buffer={type:"read-only-storage",hasDynamicOffset:r.hasDynamicOffset,minBindingSize:r.minBindingSize};break;case"sampler":i.sampler={type:r.samplerType};break;case"storage":se(r)?i.storageTexture={format:r.format,access:r.access,viewDimension:r.viewDimension}:i.buffer={type:"storage",hasDynamicOffset:r.hasDynamicOffset,minBindingSize:r.minBindingSize};break;case"texture":i.texture={multisampled:r.multisampled,sampleType:r.sampleType,viewDimension:r.viewDimension};break;default:n.R.warn("unhandled binding type when creating pipeline descriptor")()}const s=GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT|GPUShaderStage.COMPUTE;e.push({binding:r.location,visibility:r.visibility||s,...i})}return e}}const se=e=>void 0!==e.format;class ne extends i.pF{handle;adapter;adapterInfo;type="webgpu";preferredColorFormat=navigator.gpu.getPreferredCanvasFormat();preferredDepthFormat="depth24plus";features;info;limits;lost;canvasContext=null;_isLost=!1;commandEncoder;get[Symbol.toStringTag](){return"WebGPUDevice"}toString(){return`WebGPUDevice(${this.id})`}constructor(e,t,r,s){super({...e,id:e.id||"webgpu-device"}),this.handle=t,this.adapter=r,this.adapterInfo=s,this.info=this._getInfo(),this.features=this._getFeatures(),this.limits=this.handle.limits,t.addEventListener("uncapturederror",(e=>{e.preventDefault();const t=e instanceof GPUUncapturedErrorEvent?e.error.message:"Unknown WebGPU error";this.reportError(new Error(t),this)(),this.debug()})),this.lost=new Promise((async e=>{const t=await this.handle.lost;this._isLost=!0,e({reason:"destroyed",message:t.message})}));const n=i.pF._getCanvasContextProps(e);n&&(this.canvasContext=new q(this,this.adapter,n)),this.commandEncoder=this.createCommandEncoder({})}destroy(){this.handle.destroy()}get isLost(){return this._isLost}isVertexFormatSupported(e){return!this.getVertexFormatInfo(e).webglOnly}getTextureByteAlignment(){return 1}createBuffer(e){const t=this._normalizeBufferProps(e);return new a(this,t)}createTexture(e){return new u(this,e)}createExternalTexture(e){return new g(this,e)}createShader(e){return new v(this,e)}createSampler(e){return new p(this,e)}createRenderPipeline(e){return new F(this,e)}createFramebuffer(e){return new M(this,e)}createComputePipeline(e){return new k(this,e)}createVertexArray(e){return new z(this,e)}createCommandEncoder(e){return new K(this,e)}createTransformFeedback(e){throw new Error("Transform feedback not supported in WebGPU")}createQuerySet(e){return new te(this,e)}createCanvasContext(e){return new q(this,this.adapter,e)}createPipelineLayout(e){return new ie(this,e)}submit(e){e||(e=this.commandEncoder.finish(),this.commandEncoder.destroy(),this.commandEncoder=this.createCommandEncoder({id:`${this.id}-default-encoder`})),this.pushErrorScope("validation"),this.handle.queue.submit([e.handle]),this.popErrorScope((e=>{this.reportError(new Error(`${this} command submission: ${e.message}`),this)(),this.debug()}))}pushErrorScope(e){this.handle.pushErrorScope(e)}popErrorScope(e){this.handle.popErrorScope().then((t=>{t&&e(t)}))}_getInfo(){const[e,t]=(this.adapterInfo.driver||"").split(" Version "),r=this.adapterInfo.vendor||this.adapter.__brand||"unknown",i=e||"",s=t||"",n="apple"===r?"apple":"unknown",a=this.adapterInfo.architecture||"unknown",o=this.adapterInfo.backend||"unknown";return{type:"webgpu",vendor:r,renderer:i,version:s,gpu:n,gpuType:(this.adapterInfo.type||"").split(" ")[0].toLowerCase()||"unknown",gpuBackend:o,gpuArchitecture:a,shadingLanguage:"wgsl",shadingLanguageVersion:100}}_getFeatures(){const e=new Set(this.handle.features);e.has("depth-clamping")&&(e.delete("depth-clamping"),e.add("depth-clip-control")),e.has("texture-compression-bc")&&e.add("texture-compression-bc5-webgl");const t=["timer-query-webgl","compilation-status-async-webgl","float32-renderable-webgl","float16-renderable-webgl","norm16-renderable-webgl","texture-filterable-anisotropic-webgl","shader-noperspective-interpolation-webgl"];for(const r of t)e.add(r);return new i.I7(Array.from(e),this.props._disabledFeatures)}_getDeviceSpecificTextureFormatCapabilities(e){const{format:t}=e;return t.includes("webgl")?{format:t,create:!1,render:!1,filter:!1,blend:!1,store:!1}:e}}}}]);