"use strict";(self.webpackChunkproject_website=self.webpackChunkproject_website||[]).push([[6407],{3905:(e,a,t)=>{t.d(a,{Zo:()=>p,kt:()=>g});var r=t(67294);function n(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function o(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);a&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,r)}return t}function l(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?o(Object(t),!0).forEach((function(a){n(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function i(e,a){if(null==e)return{};var t,r,n=function(e,a){if(null==e)return{};var t,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],a.indexOf(t)>=0||(n[t]=e[t]);return n}(e,a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(n[t]=e[t])}return n}var s=r.createContext({}),d=function(e){var a=r.useContext(s),t=a;return e&&(t="function"==typeof e?e(a):l(l({},a),e)),t},p=function(e){var a=d(e.components);return r.createElement(s.Provider,{value:a},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var a=e.children;return r.createElement(r.Fragment,{},a)}},u=r.forwardRef((function(e,a){var t=e.components,n=e.mdxType,o=e.originalType,s=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),c=d(t),u=n,g=c["".concat(s,".").concat(u)]||c[u]||m[u]||o;return t?r.createElement(g,l(l({ref:a},p),{},{components:t})):r.createElement(g,l({ref:a},p))}));function g(e,a){var t=arguments,n=a&&a.mdxType;if("string"==typeof e||n){var o=t.length,l=new Array(o);l[0]=u;var i={};for(var s in a)hasOwnProperty.call(a,s)&&(i[s]=a[s]);i.originalType=e,i[c]="string"==typeof e?e:n,l[1]=i;for(var d=2;d<o;d++)l[d]=t[d];return r.createElement.apply(null,l)}return r.createElement.apply(null,t)}u.displayName="MDXCreateElement"},73141:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>s,contentTitle:()=>l,default:()=>m,frontMatter:()=>o,metadata:()=>i,toc:()=>d});var r=t(87462),n=(t(67294),t(3905));const o={},l="Loading Data",i={unversionedId:"developer-guide/loading-data",id:"developer-guide/loading-data",title:"Loading Data",description:"deck.gl uses loaders.gl, a framework-agnostic library to read data and resources.",source:"@site/../docs/developer-guide/loading-data.md",sourceDirName:"developer-guide",slug:"/developer-guide/loading-data",permalink:"/docs/developer-guide/loading-data",draft:!1,editUrl:"https://github.com/visgl/deck.gl/tree/master/website/../docs/developer-guide/loading-data.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"View State Transitions",permalink:"/docs/developer-guide/view-state-transitions"},next:{title:"Using Lighting",permalink:"/docs/developer-guide/using-lighting"}},s={},d=[{value:"Customize Data Loading Behavior",id:"customize-data-loading-behavior",level:2},{value:"Example: Fetch data with credentials",id:"example-fetch-data-with-credentials",level:3},{value:"Example: Override the default image loading options",id:"example-override-the-default-image-loading-options",level:3},{value:"Support Additional Formats",id:"support-additional-formats",level:2},{value:"Force Reload From an URL",id:"force-reload-from-an-url",level:2},{value:"Loaders and Web Workers",id:"loaders-and-web-workers",level:2},{value:"Load Resource Without an URL",id:"load-resource-without-an-url",level:2},{value:"Example: Use image from a programmatically generated SVG string",id:"example-use-image-from-a-programmatically-generated-svg-string",level:3},{value:"Example: Parse glTF from a binary blob",id:"example-parse-gltf-from-a-binary-blob",level:3}],p={toc:d},c="wrapper";function m(e){let{components:a,...t}=e;return(0,n.kt)(c,(0,r.Z)({},p,t,{components:a,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"loading-data"},"Loading Data"),(0,n.kt)("p",null,"deck.gl uses ",(0,n.kt)("a",{parentName:"p",href:"https://loaders.gl"},"loaders.gl"),", a framework-agnostic library to read data and resources."),(0,n.kt)("p",null,"deck.gl core always includes loaders for JSON and standard image formats (e.g, png, jpeg, svg). Certain layers include additional loaders supporting their own use cases. It is easy for applications to provide options to configure the behavior of the default loaders or to add loaders to support for additional formats."),(0,n.kt)("p",null,"Some examples of when loaders are used:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"JSON array or object from an URL passed to the ",(0,n.kt)("inlineCode",{parentName:"li"},"data")," prop of a layer"),(0,n.kt)("li",{parentName:"ul"},"Texture from an image, such as ",(0,n.kt)("inlineCode",{parentName:"li"},"image")," in ",(0,n.kt)("inlineCode",{parentName:"li"},"BitmapLayer"),", ",(0,n.kt)("inlineCode",{parentName:"li"},"iconAtlas")," in ",(0,n.kt)("inlineCode",{parentName:"li"},"IconLayer"),", and ",(0,n.kt)("inlineCode",{parentName:"li"},"texture")," in ",(0,n.kt)("inlineCode",{parentName:"li"},"SimpleMeshLayer")),(0,n.kt)("li",{parentName:"ul"},"Geometries from a binary tile, e.g. ",(0,n.kt)("inlineCode",{parentName:"li"},"MVTLayer"),", ",(0,n.kt)("inlineCode",{parentName:"li"},"TerrainLayer"),", and ",(0,n.kt)("inlineCode",{parentName:"li"},"Tile3DLayer")),(0,n.kt)("li",{parentName:"ul"},"Geometries from a standard 3D format, e.g. ",(0,n.kt)("inlineCode",{parentName:"li"},"scenegraph")," in ",(0,n.kt)("inlineCode",{parentName:"li"},"ScenegraphLayer"),", and ",(0,n.kt)("inlineCode",{parentName:"li"},"mesh")," in ",(0,n.kt)("inlineCode",{parentName:"li"},"SimpleMeshLayer"))),(0,n.kt)("h2",{id:"customize-data-loading-behavior"},"Customize Data Loading Behavior"),(0,n.kt)("p",null,"All layers support a ",(0,n.kt)("a",{parentName:"p",href:"/docs/api-reference/core/layer#loadoptions"},"loadOptions")," prop that can be used to customize loading and parsing."),(0,n.kt)("h3",{id:"example-fetch-data-with-credentials"},"Example: Fetch data with credentials"),(0,n.kt)("p",null,"In a production environment, deck.gl applications may need to load data from secure APIs that require special HTTP headers (such as ",(0,n.kt)("inlineCode",{parentName:"p"},"Authorization"),") to be set."),(0,n.kt)("p",null,"In order to access a secure API, the ",(0,n.kt)("inlineCode",{parentName:"p"},"loadOptions.fetch")," option passes through additional parameters to ",(0,n.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch"},"fetch"),", which deck.gl calls under the hood to load resources."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"new ScatterplotLayer({\n  data: 'https://secure-server.com/userActivity',\n  loadOptions: {\n    fetch: {\n      method: 'POST',\n      body: JSON.stringify(requestBody),\n      headers: {\n        'Authorization': `Bearer ${accessToken}`,\n      }\n    }\n  }\n  ...\n});\n")),(0,n.kt)("h3",{id:"example-override-the-default-image-loading-options"},"Example: Override the default image loading options"),(0,n.kt)("p",null,"deck.gl uses ",(0,n.kt)("a",{parentName:"p",href:"https://loaders.gl/modules/images/docs/api-reference/image-loader"},"ImageLoader")," to read common image formats. The default loader options are:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"{\n  image: {type: 'auto'},\n  imagebitmap: {premultiplyAlpha: 'none'}\n}\n")),(0,n.kt)("p",null,"The image is decoded into an ",(0,n.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/createImageBitmap"},"ImageBitmap")," if the browser supports it (Firefox, Chrome, Edge) for better performance. You can override the default ",(0,n.kt)("a",{parentName:"p",href:"https://loaders.gl/modules/images/docs/api-reference/image-loader#magebitmap-options"},"options")," for the ",(0,n.kt)("inlineCode",{parentName:"p"},"createImageBitmap")," API as follows:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"new IconLayer({\n  iconAtlas: '/path/to/image.png',\n  loadOptions: {\n    imagebitmap: {\n      // Flip the image vertically\n      imageOrientation: 'flipY'\n    }\n  }\n})\n")),(0,n.kt)("p",null,"If the image is a SVG that does not include width and height information, ",(0,n.kt)("inlineCode",{parentName:"p"},"createImageBitmap")," will throw a ",(0,n.kt)("inlineCode",{parentName:"p"},"DOMException"),": ",(0,n.kt)("inlineCode",{parentName:"p"},"The image element contains an SVG image without intrinsic dimensions, and no resize options or crop region are specified"),". This can be fixed by explicitly setting its dimensions:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"new IconLayer({\n  ...\n  iconAtlas: '/path/to/image.svg',\n  loadOptions: {\n    imagebitmap: {\n      resizeWidth: 256,\n      resizeHeight: 256,\n      resizeQuality: 'high'\n    }\n  }\n})\n")),(0,n.kt)("h2",{id:"support-additional-formats"},"Support Additional Formats"),(0,n.kt)("p",null,"All layers support a ",(0,n.kt)("a",{parentName:"p",href:"/docs/api-reference/core/layer#loaders"},"loaders")," prop that can be used to add ",(0,n.kt)("a",{parentName:"p",href:"https://loaders.gl/docs/developer-guide/using-loaders"},"loaders.gl loaders")," for parsing a specific input format."),(0,n.kt)("p",null,"For example, the following code adds the ",(0,n.kt)("a",{parentName:"p",href:"https://loaders.gl/modules/csv/docs/api-reference/csv-loader"},"CSVLoader")," to support CSV/TSV files:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"import {CSVLoader} from '@loaders.gl/csv';\n\nnew HexagonLayer({\n  data: 'path/to/data.tsv',\n  loaders: [CSVLoader],\n  loadOptions: {\n    csv: {\n      delimiter: '\\t',\n      dynamicTyping: true,\n      skipEmptyLines: true\n    }\n  }\n});\n")),(0,n.kt)("p",null,"The following code adds the ",(0,n.kt)("a",{parentName:"p",href:"https://loaders.gl/modules/las/docs/api-reference/las-loader"},"LASLoader")," to support LAS/LAZ files:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"import {LASLoader} from '@loaders.gl/las';\n\nnew PointCloudLayer({\n  mesh: 'path/to/pointcloud.laz',\n  loaders: [LASLoader]\n});\n")),(0,n.kt)("h2",{id:"force-reload-from-an-url"},"Force Reload From an URL"),(0,n.kt)("p",null,"Usually, a layer refreshes its data when and only when the ",(0,n.kt)("inlineCode",{parentName:"p"},"data")," prop changes.\nThe following code refreshes data from the same URL every 5 minutes by changing a query parameter:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"const deck = new Deck({...});\n\nlet dataVersion = 0;\nfunction update() {\n  const layer = new ScatterplotLayer({\n    data: `path/to/data.json?v=${dataVersion}`\n  });\n\n  deck.setProps({layers: [layer]});\n};\n\nsetInterval(() => {\n  dataVersion++;\n  update();\n}, 5 * 60 * 1000);\n")),(0,n.kt)("h2",{id:"loaders-and-web-workers"},"Loaders and Web Workers"),(0,n.kt)("p",null,"For the best performance, some specialized loaders parse data using web workers, for example ",(0,n.kt)("inlineCode",{parentName:"p"},"TerrainLoader")," in the ",(0,n.kt)("a",{parentName:"p",href:"/docs/api-reference/geo-layers/terrain-layer"},"TerrainLayer")," and ",(0,n.kt)("inlineCode",{parentName:"p"},"MVTLoader")," in the ",(0,n.kt)("a",{parentName:"p",href:"/docs/api-reference/geo-layers/mvt-layer"},"MVTLayer"),". By default, the worker code is loaded from from the latest published NPM module on ",(0,n.kt)("a",{parentName:"p",href:"https://unpkg.com"},"unpkg.com"),"."),(0,n.kt)("p",null,"It might be desirable for some applications to serve the worker code itself without relying on the CDN. To do this, locate the worker bundle locally in ",(0,n.kt)("inlineCode",{parentName:"p"},"node_modules/@loaders.gl/<module>/dist/<name>-loader.worker.js")," and serve it as a static asset with your server. Point the loader to use this alternative URL using ",(0,n.kt)("inlineCode",{parentName:"p"},"loadOptions.<name>.workerUrl"),":"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"new MVTLayer({\n  loadOptions: {\n    mvt: {\n      workerUrl: <my_worker_url>\n    }\n  }\n}\n")),(0,n.kt)("p",null,"If the layer is used in an environment that does not support web workers, or you need to debug the loader code on the main thread, you may import the full loader like this:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"import {MVTLoader} from '@loaders.gl/mvt';\nnew MVTLayer({\n  loaders: [MVTLoader],\n  loadOptions: {worker: false}\n});\n")),(0,n.kt)("p",null,"Refer to each specific layer's documentation to see which loaders are used."),(0,n.kt)("h2",{id:"load-resource-without-an-url"},"Load Resource Without an URL"),(0,n.kt)("p",null,"In some use cases, resources do not exist at a static URL. For example, some applications construct images dynamically based on user input. Some applications receive arbitrary binary blobs from a server via a WebSocket connection."),(0,n.kt)("p",null,"Before reading on, remember that you don't have to use a loader if your app already knows how to interpret the content. For example, if you have the RGBA values of all pixels of an image. you can simply construct an ",(0,n.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/ImageData"},"ImageData")," object:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"new BitmapLayer({\n  image: new ImageData(pixels, 128, 128)\n})\n")),(0,n.kt)("p",null,"If you have a custom-formatted binary, consider the techniques in ",(0,n.kt)("a",{parentName:"p",href:"/docs/developer-guide/performance#use-binary-data"},"using binary data"),"."),(0,n.kt)("p",null,"The following examples only address the use cases where you need a loader/parser to interpret the incoming data."),(0,n.kt)("h3",{id:"example-use-image-from-a-programmatically-generated-svg-string"},"Example: Use image from a programmatically generated SVG string"),(0,n.kt)("p",null,"The following code dynamically generates SVG icons and convert them to ",(0,n.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/Data_URIs"},"data URLs"),"."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},'function createSVGIcon(number) {\n  const label = number < 10 ? number.toString : \'10+\';\n  return `\\\n  <svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n    <circle cx="12" cy="12" r="10" fill="#c00" stroke="#fa1" stroke-width="2"/>\n    <text x="12" y="12" fill="#fff" text-anchor="middle" alignment-baseline="middle" font-size="8">${label}</text>\n  </svg>`;\n}\n\n// Note that a xml string cannot be directly embedded in a data URL\n// it has to be either escaped or converted to base64.\nfunction svgToDataURL(svg) {\n  return `data:image/svg+xml;charset=utf-8,${encodeURIComponent(svg)}`;\n  // or\n  return `data:image/svg+xml;base64,${btoa(svg)}`;\n}\n\nnew IconLayer({\n  getIcon: d => {\n    url: svgToDataURL(createSVGIcon(d.value)),\n    width: 24,\n    height: 24\n  }\n})\n')),(0,n.kt)("h3",{id:"example-parse-gltf-from-a-binary-blob"},"Example: Parse glTF from a binary blob"),(0,n.kt)("p",null,"The following code shows how to parse a glTF model that is already loaded into an ",(0,n.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer"},"ArrayBuffer")," object."),(0,n.kt)("p",null,"There are two ways for deck.gl to load it. One is to create a blob URL:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"const blob = new Blob([arraybuffer]);\nconst objectURL = URL.createObjectURL(blob);\n\nnew ScenegraphLayer({\n  scenegraph: objectURL\n});\n")),(0,n.kt)("p",null,"Or more directly, import the ",(0,n.kt)("a",{parentName:"p",href:"https://loaders.gl/modules/core/docs/api-reference/parse"},"parse")," utility from loaders.gl (already a dependency of deck.gl), which returns a promise:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js"},"import {parse} from '@loaders.gl/core';\nimport {GLTFLoader} from '@loaders.gl/gltf';\n\nnew ScenegraphLayer({\n  scenegraph: parse(arraybuffer, GLTFLoader)\n})\n")))}m.isMDXComponent=!0}}]);