"use strict";(self.webpackChunkproject_website=self.webpackChunkproject_website||[]).push([[7374],{3905:(e,t,i)=>{i.d(t,{Zo:()=>d,kt:()=>g});var n=i(67294);function o(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function s(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function r(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?s(Object(i),!0).forEach((function(t){o(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):s(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function a(e,t){if(null==e)return{};var i,n,o=function(e,t){if(null==e)return{};var i,n,o={},s=Object.keys(e);for(n=0;n<s.length;n++)i=s[n],t.indexOf(i)>=0||(o[i]=e[i]);return o}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)i=s[n],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(o[i]=e[i])}return o}var l=n.createContext({}),c=function(e){var t=n.useContext(l),i=t;return e&&(i="function"==typeof e?e(t):r(r({},t),e)),i},d=function(e){var t=c(e.components);return n.createElement(l.Provider,{value:t},e.children)},u="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},p=n.forwardRef((function(e,t){var i=e.components,o=e.mdxType,s=e.originalType,l=e.parentName,d=a(e,["components","mdxType","originalType","parentName"]),u=c(i),p=o,g=u["".concat(l,".").concat(p)]||u[p]||h[p]||s;return i?n.createElement(g,r(r({ref:t},d),{},{components:i})):n.createElement(g,r({ref:t},d))}));function g(e,t){var i=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var s=i.length,r=new Array(s);r[0]=p;var a={};for(var l in t)hasOwnProperty.call(t,l)&&(a[l]=t[l]);a.originalType=e,a[u]="string"==typeof e?e:o,r[1]=a;for(var c=2;c<s;c++)r[c]=i[c];return n.createElement.apply(null,r)}return n.createElement.apply(null,i)}p.displayName="MDXCreateElement"},85162:(e,t,i)=>{i.d(t,{Z:()=>r});var n=i(67294),o=i(86010);const s={tabItem:"tabItem_Ymn6"};function r(e){let{children:t,hidden:i,className:r}=e;return n.createElement("div",{role:"tabpanel",className:(0,o.Z)(s.tabItem,r),hidden:i},t)}},74866:(e,t,i)=>{i.d(t,{Z:()=>w});var n=i(87462),o=i(67294),s=i(86010),r=i(12466),a=i(16550),l=i(91980),c=i(67392),d=i(50012);function u(e){return function(e){return o.Children.map(e,(e=>{if((0,o.isValidElement)(e)&&"value"in e.props)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')}))}(e).map((e=>{let{props:{value:t,label:i,attributes:n,default:o}}=e;return{value:t,label:i,attributes:n,default:o}}))}function h(e){const{values:t,children:i}=e;return(0,o.useMemo)((()=>{const e=null!=t?t:u(i);return function(e){const t=(0,c.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error('Docusaurus error: Duplicate values "'+t.map((e=>e.value)).join(", ")+'" found in <Tabs>. Every value needs to be unique.')}(e),e}),[t,i])}function p(e){let{value:t,tabValues:i}=e;return i.some((e=>e.value===t))}function g(e){let{queryString:t=!1,groupId:i}=e;const n=(0,a.k6)(),s=function(e){let{queryString:t=!1,groupId:i}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!i)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=i?i:null}({queryString:t,groupId:i});return[(0,l._X)(s),(0,o.useCallback)((e=>{if(!s)return;const t=new URLSearchParams(n.location.search);t.set(s,e),n.replace({...n.location,search:t.toString()})}),[s,n])]}function f(e){const{defaultValue:t,queryString:i=!1,groupId:n}=e,s=h(e),[r,a]=(0,o.useState)((()=>function(e){var t;let{defaultValue:i,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(i){if(!p({value:i,tabValues:n}))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+i+'" but none of its children has the corresponding value. Available values are: '+n.map((e=>e.value)).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");return i}const o=null!=(t=n.find((e=>e.default)))?t:n[0];if(!o)throw new Error("Unexpected error: 0 tabValues");return o.value}({defaultValue:t,tabValues:s}))),[l,c]=g({queryString:i,groupId:n}),[u,f]=function(e){let{groupId:t}=e;const i=function(e){return e?"docusaurus.tab."+e:null}(t),[n,s]=(0,d.Nk)(i);return[n,(0,o.useCallback)((e=>{i&&s.set(e)}),[i,s])]}({groupId:n}),m=(()=>{const e=null!=l?l:u;return p({value:e,tabValues:s})?e:null})();(0,o.useLayoutEffect)((()=>{m&&a(m)}),[m]);return{selectedValue:r,selectValue:(0,o.useCallback)((e=>{if(!p({value:e,tabValues:s}))throw new Error("Can't select invalid tab value="+e);a(e),c(e),f(e)}),[c,f,s]),tabValues:s}}var m=i(72389);const v={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function y(e){let{className:t,block:i,selectedValue:a,selectValue:l,tabValues:c}=e;const d=[],{blockElementScrollPositionUntilNextRender:u}=(0,r.o5)(),h=e=>{const t=e.currentTarget,i=d.indexOf(t),n=c[i].value;n!==a&&(u(t),l(n))},p=e=>{var t;let i=null;switch(e.key){case"Enter":h(e);break;case"ArrowRight":{var n;const t=d.indexOf(e.currentTarget)+1;i=null!=(n=d[t])?n:d[0];break}case"ArrowLeft":{var o;const t=d.indexOf(e.currentTarget)-1;i=null!=(o=d[t])?o:d[d.length-1];break}}null==(t=i)||t.focus()};return o.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.Z)("tabs",{"tabs--block":i},t)},c.map((e=>{let{value:t,label:i,attributes:r}=e;return o.createElement("li",(0,n.Z)({role:"tab",tabIndex:a===t?0:-1,"aria-selected":a===t,key:t,ref:e=>d.push(e),onKeyDown:p,onClick:h},r,{className:(0,s.Z)("tabs__item",v.tabItem,null==r?void 0:r.className,{"tabs__item--active":a===t})}),null!=i?i:t)})))}function _(e){let{lazy:t,children:i,selectedValue:n}=e;if(i=Array.isArray(i)?i:[i],t){const e=i.find((e=>e.props.value===n));return e?(0,o.cloneElement)(e,{className:"margin-top--md"}):null}return o.createElement("div",{className:"margin-top--md"},i.map(((e,t)=>(0,o.cloneElement)(e,{key:t,hidden:e.props.value!==n}))))}function b(e){const t=f(e);return o.createElement("div",{className:(0,s.Z)("tabs-container",v.tabList)},o.createElement(y,(0,n.Z)({},e,t)),o.createElement(_,(0,n.Z)({},e,t)))}function w(e){const t=(0,m.Z)();return o.createElement(b,(0,n.Z)({key:String(t)},e))}},27260:(e,t,i)=>{i.d(t,{IM:()=>o,Sr:()=>n,fL:()=>s});const n={LIGHT:"https://deck.gl/mapstyle/deck-light.json",LIGHT_LABEL:"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json",DARK:"https://deck.gl/mapstyle/deck-dark.json",BLANK:{version:8,sources:{},layers:[]}},o="https://raw.githubusercontent.com/visgl/deck.gl-data/master/website",s="https://github.com/visgl/deck.gl/tree/9.0-release"},44752:(e,t,i)=>{i.d(t,{C:()=>c});const n=["dataComparator","fetch"],o=["autoHighlight","coordinateOrigin","coordinateSystem","highlightColor","modelMatrix","opacity","pickable","visible","wrapLongitude"],s={loaders:[],coordinateSystem:"COORDINATE_SYSTEM.LNGLAT",renderSubLayers:"props => new GeoJsonLayer(props)",characterSet:'" !\\"#$%&\'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}~"'};function r(e,t){if(!e.includes("\n")||0===t)return e;const i=e.split("\n");if(t>0){const e="".padStart(t," ");return i.map(((t,i)=>i>0?e+t:t)).join("\n")}return i.map(((e,i)=>i>0?e.slice(-t):e)).join("\n")}function a(e){return null==e?"null":"string"==typeof e?"'"+e+"'":"function"==typeof e?e.toString():Array.isArray(e)?"["+e.map(a).join(", ")+"]":e===Number.MAX_SAFE_INTEGER?"Number.MAX_SAFE_INTEGER":r(JSON.stringify(e,null,2),2)}function l(e,t){const i=[],l={};t=function(e){const t=e.split("\n");t.pop();const i={};let n,o=1/0;for(const s of t){const e=s.match(/^(\s*)(\w+):\s*(.*)/);e&&e[1].length<=o?(o=e[1].length,n=e[2],i[n]=e[3]):n&&(i[n]+="\n"+s)}for(n in i)i[n]=r(i[n].replace(/,\s*$/,""),2-o);return i}(t);let c=e.constructor,d=!1;const u=e.props[Symbol.for("asyncPropOriginal")],h=e.props[Symbol.for("asyncPropResolved")];function p(e,t,o,s){if(!l[e]&&!n.includes(e)){const n=(o?"// ":"")+e+": "+t+",";void 0===s?i.push(n):i.splice(s,0,n),l[e]=!0}}let g=1;for(p("id",a(e.id)),t.data&&p("data",t.data,!1,g++);c.layerName;){if(c.hasOwnProperty("defaultProps")){i.push("","/* props "+(d?"inherited from":"from")+" "+c.layerName+" class */","");const n=Object.keys(c.defaultProps).sort();for(const i of n){const n=c.defaultProps[i],r=!(i in u)&&!(i in h)&&!Object.hasOwnProperty.call(e.props,i);let l,d=!1;i in t?l=t[i]:(d=n&&n.deprecatedFor,d=d||i.startsWith("_"),d=d||n&&"accessor"===n.type&&"function"==typeof n.value,d=d||"Layer"===c.layerName&&!o.includes(i),l=u[i]||e.props[i],l="function"==typeof l?null:i in s?s[i]:a(l)),d||p(i,l,r)}}c=Object.getPrototypeOf(c),d=!0}for(const n in t)n in l||p(n,t[n],!1,g++);return i.join("\n  ")}function c(e,t){const{Layer:i,isExperimental:n,getTooltip:o,props:s,mapStyle:a=!0,dependencies:c=[],imports:d,initialViewState:u}=e,h=n?"_"+i.layerName:i.layerName,p=["DeckGL",h],g=[];if(d)for(const r in d)r[0]>="a"||(r.endsWith("Loader")?g.push(r):p.push(r));const f=r(JSON.stringify(u,null,2).replace(/"/g,""),2),m="const {"+p.join(", ")+"} = deck;\n"+(g.length?"const {"+g.join(", ")+"} = loaders;\n":"")+"\nconst layer = new "+h+"({\n  "+l(t,s)+"\n});\n\nnew DeckGL({\n  "+(a?"mapStyle: 'https://basemaps.cartocdn.com/gl/positron-gl-style/style.json',":"")+"\n  initialViewState: "+f+",\n  controller: true,\n  "+(o?"getTooltip: "+o+",":"")+"\n  layers: [layer]\n});\n  ";!function(e){let{dependencies:t=[],title:i,source:n}=e;const o={js_external:t.concat(["https://unpkg.com/deck.gl@latest/dist.min.js"]).join(";"),title:i,parent:48721472,tags:["webgl","data visualization"],editors:"001",css:"\n  body {\n    margin: 0;\n    width: 100vw;\n    height: 100vh;\n    overflow: hidden;\n  }\n  \n  .deck-tooltip {\n    font-size: 0.8em;\n    font-family: Helvetica, Arial, sans-serif;\n  }\n  ",js:"/*\n* "+window.location.href+"\n*/\n"+n},s=document.createElement("form");s.action="https://codepen.io/pen/define/",s.method="POST",s.style.display="none",document.body.appendChild(s);const r=document.createElement("input");r.type="text",r.name="data",r.value=JSON.stringify(o),s.appendChild(r),window.open("","deck-example-codepen"),s.target="deck-example-codepen",s.submit(),s.remove()}({dependencies:c.concat(["https://unpkg.com/maplibre-gl@3.6.0/dist/maplibre-gl.js"]),title:"deck.gl "+i.layerName,source:m})}},62757:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{v:()=>makeLayerDemo});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(67294),_deck_gl_react__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(50920),react_map_gl_maplibre__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(24808),styled_components__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(19521),_docusaurus_theme_common__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(92949),_constants_defaults__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(27260),_codepen_automation__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(44752);const INITIAL_VIEW_STATE={longitude:-122.4,latitude:37.74,zoom:11,maxZoom:20,pitch:30,bearing:0},TOOLTIP_STYLE={padding:"4px",background:"rgba(0, 0, 0, 0.8)",color:"#fff",maxWidth:"300px",fontSize:"10px",zIndex:9},DemoPlaceholder=styled_components__WEBPACK_IMPORTED_MODULE_4__.ZP.div.withConfig({displayName:"demo-base__DemoPlaceholder",componentId:"sc-bhdrci-0"})(["height:50vh;min-height:200px;position:relative;margin-bottom:24px;@media screen and (max-width:768px){height:60vh;}"]),DemoContainer=styled_components__WEBPACK_IMPORTED_MODULE_4__.ZP.div.withConfig({displayName:"demo-base__DemoContainer",componentId:"sc-bhdrci-1"})(["height:50vh;min-height:200px;position:absolute;width:100%;left:0;top:0;overflow:hidden;@media screen and (max-width:768px){height:60vh;}"]),DemoSourceLink=styled_components__WEBPACK_IMPORTED_MODULE_4__.ZP.div.withConfig({displayName:"demo-base__DemoSourceLink",componentId:"sc-bhdrci-2"})(["position:absolute;top:0;right:0;padding:8px;background:var(--ifm-background-surface-color);margin:12px;box-shadow:0 2px 4px rgba(0,0,0,0.3);cursor:pointer;font-weight:bold;font-size:12px;&:hover{color:var(--ifm-color-primary);}svg{width:20px;vertical-align:middle;margin-right:4px;}"]);function evalObject(source,globals,output){return eval("(function evalObject(globals){\n    Object.assign(globalThis, globals);\n    "+(output?source+"\n      return {"+output.join(",")+"};":"return "+source+";")+"\n  })")(globals)}function makeLayerDemo(config){const{Layer:Layer,getTooltip:getTooltip,props:props,mapStyle:mapStyle=!0,initialViewState:initialViewState=INITIAL_VIEW_STATE,imports:imports}=config;config.initialViewState=initialViewState;const _getTooltip=getTooltip&&eval(getTooltip),styledGetTooltip=e=>{const t=_getTooltip&&_getTooltip(e);return t&&{text:t,style:TOOLTIP_STYLE}},layerProps=evalObject(props,imports);function Demo(){const{colorMode:e}=(0,_docusaurus_theme_common__WEBPACK_IMPORTED_MODULE_5__.I)(),t=new Layer(layerProps),i="dark"===e?_constants_defaults__WEBPACK_IMPORTED_MODULE_2__.Sr.DARK:_constants_defaults__WEBPACK_IMPORTED_MODULE_2__.Sr.LIGHT;return react__WEBPACK_IMPORTED_MODULE_0__.createElement(DemoPlaceholder,null,react__WEBPACK_IMPORTED_MODULE_0__.createElement(DemoContainer,null,react__WEBPACK_IMPORTED_MODULE_0__.createElement(_deck_gl_react__WEBPACK_IMPORTED_MODULE_6__.Z,{pickingRadius:5,initialViewState:initialViewState,getTooltip:styledGetTooltip,controller:!0,layers:[t]},mapStyle&&react__WEBPACK_IMPORTED_MODULE_0__.createElement(react_map_gl_maplibre__WEBPACK_IMPORTED_MODULE_1__.D5,{reuseMaps:!0,mapStyle:i}))),react__WEBPACK_IMPORTED_MODULE_0__.createElement(DemoSourceLink,{onClick:()=>(0,_codepen_automation__WEBPACK_IMPORTED_MODULE_3__.C)(config,t)},react__WEBPACK_IMPORTED_MODULE_0__.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},react__WEBPACK_IMPORTED_MODULE_0__.createElement("path",{d:"M0 0h24v24H0V0z",fill:"none"}),react__WEBPACK_IMPORTED_MODULE_0__.createElement("path",{fill:"currentcolor",d:"M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"})),"Edit on Codepen"))}return react__WEBPACK_IMPORTED_MODULE_0__.memo(Demo)}},54428:(e,t,i)=>{i.d(t,{PR:()=>w,QC:()=>v,Sv:()=>C,TI:()=>_,b6:()=>y,iU:()=>L,jb:()=>b,op:()=>S,v3:()=>T,xO:()=>P,yr:()=>x});var n=i(39632),o=i(90157),s=i(8373),r=i(54319),a=i(2511),l=i(43850),c=i(15386),d=i(54282),u=i(5416),h=i(54890),p=i(85073),g=i(40043),f=i(62757),m=i(27260);const v=(0,f.v)({Layer:o.Z,getTooltip:"({object}) => object && `${object.from.name} to ${object.to.name}`",props:"{\n    data: '"+m.IM+"/flights.json',\n    getSourcePosition: d => d.from.coordinates,\n    getTargetPosition: d => d.to.coordinates,\n    getSourceColor: [64, 255, 0],\n    getTargetColor: [0, 128, 200],\n    getWidth: 5,\n    pickable: true\n  }"}),y=(0,f.v)({Layer:s.Z,getTooltip:"({object}) => object && `${object.geohash} value: ${object.value}`",props:"{\n    data: '"+m.IM+"/sf.geohashes.json',\n    pickable: true,\n    wireframe: false,\n    filled: true,\n    extruded: true,\n    elevationScale: 1000,\n    getGeohash: d => d.geohash,\n    getFillColor: d => [d.value * 255, (1 - d.value) * 128, (1 - d.value) * 255],\n    getElevation: d => d.value\n  }"}),_=(0,f.v)({Layer:r.Z,getTooltip:"({object}) => object && `${object.quadkey} value: ${object.value}`",props:"{\n    data: '"+m.IM+"/sf.quadkeys.json',\n    pickable: true,\n    wireframe: false,\n    filled: true,\n    extruded: true,\n    elevationScale: 1000,\n    getQuadkey: d => d.quadkey,\n    getFillColor: d => [d.value * 128, (1 - d.value) * 255, (1 - d.value) * 255, 180],\n    getElevation: d => d.value\n  }"}),b=(0,f.v)({Layer:a.Z,getTooltip:"({object}) => object && `${object.token} value: ${object.value}`",props:"{\n    data: '"+m.IM+"/sf.s2cells.json',\n    pickable: true,\n    wireframe: false,\n    filled: true,\n    extruded: true,\n    elevationScale: 1000,\n    getS2Token: d => d.token,\n    getFillColor: d => [d.value * 255, (1 - d.value) * 255, (1 - d.value) * 128],\n    getElevation: d => d.value\n  }"}),w=(0,f.v)({Layer:l.Z,dependencies:["https://unpkg.com/h3-js@4.1.0"],getTooltip:"({object}) => object && `${object.hex} count: ${object.count}`",props:"{\n    data: '"+m.IM+"/sf.h3cells.json',\n    pickable: true,\n    wireframe: false,\n    filled: true,\n    extruded: true,\n    elevationScale: 20,\n    getHexagon: d => d.hex,\n    getFillColor: d => [255, (1 - d.count / 500) * 255, 0],\n    getElevation: d => d.count\n  }"}),x=(0,f.v)({Layer:c.Z,dependencies:["https://unpkg.com/h3-js@4.1.0"],getTooltip:"({object}) => object && `density: ${object.mean}`",props:"{\n    data: '"+m.IM+"/sf.h3clusters.json',\n    pickable: true,\n    stroked: true,\n    filled: true,\n    extruded: false,\n    getHexagons: d => d.hexIds,\n    getFillColor: d => [255, (1 - d.mean / 500) * 255, 0],\n    getLineColor: [255, 255, 255],\n    lineWidthMinPixels: 2\n  }"}),P=(0,f.v)({Layer:d.Z,getTooltip:"({tile}) => tile && `x:${tile.index.x}, y:${tile.index.y}, z:${tile.index.z}`",imports:{BitmapLayer:n.Z},mapStyle:null,props:"{\n    data: 'https://c.tile.openstreetmap.org/{z}/{x}/{y}.png',\n    pickable: true,\n    minZoom: 0,\n    maxZoom: 19,\n\n    renderSubLayers: props => {\n      const {boundingBox} = props.tile;\n\n      return new BitmapLayer(props, {\n        data: null,\n        image: props.data,\n        bounds: [boundingBox[0][0], boundingBox[0][1], boundingBox[1][0], boundingBox[1][1]]\n      });\n    }\n  }"}),C=(0,f.v)({Layer:u.Z,props:"{\n    data: '"+m.IM+"/sf.trips.json',\n    getPath: d => d.waypoints.map(p => p.coordinates),\n    getTimestamps: d => d.waypoints.map(p => p.timestamp - 1554772579000),\n    getColor: [253, 128, 93],\n    opacity: 0.8,\n    widthMinPixels: 8,\n    rounded: true,\n    trailLength: 600,\n    currentTime: 500\n  }"}),S=(0,f.v)({Layer:h.Z,props:"{\n    elevationDecoder: {\n      rScaler: 2,\n      gScaler: 0,\n      bScaler: 0,\n      offset: 0\n    },\n    elevationData: '"+m.IM+"/terrain.png',\n    texture: '"+m.IM+"/terrain-mask.png',\n    bounds: [-122.5233, 37.6493, -122.3566, 37.8159],\n    material: {\n      diffuse: 1\n    }\n  }"}),T=(0,f.v)({Layer:p.Z,mapStyle:null,getTooltip:"({object}) => object && (object.properties.name || object.properties.layerName)",props:"{\n    data: [\n      'https://tiles-a.basemaps.cartocdn.com/vectortiles/carto.streets/v1/{z}/{x}/{y}.mvt'\n    ],\n\n    minZoom: 0,\n    maxZoom: 14,\n    stroked: false,\n    getLineColor: [192, 192, 192],\n    getFillColor: f => {\n      switch (f.properties.layerName) {\n        case 'poi':\n          return [255, 0, 0];\n        case 'water':\n          return [120, 150, 180];\n        case 'building':\n          return [218, 218, 218];\n        default:\n          return [240, 240, 240];\n      }\n    },\n    getPointRadius: 2,\n    pointRadiusUnits: 'pixels',\n    getLineWidth: f => {\n      switch (f.properties.class) {\n        case 'street':\n          return 6;\n        case 'motorway':\n          return 10;\n        default:\n          return 1;\n      }\n    },\n    lineWidthMinPixels: 1,\n    pickable: true\n  }"}),L=(0,f.v)({Layer:g.g,isExperimental:!0,mapStyle:null,initialViewState:{longitude:-122.4,latitude:37.74,zoom:9,minZoom:1,maxZoom:20},props:"{\n    data: 'https://ows.terrestris.de/osm/service',\n    serviceType: 'wms',\n    layers: ['OSM-WMS']\n  }"})},70037:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>u,contentTitle:()=>c,default:()=>f,frontMatter:()=>l,metadata:()=>d,toc:()=>h});var n=i(87462),o=(i(67294),i(3905)),s=i(54428),r=i(74866),a=i(85162);const l={},c="TileLayer",d={unversionedId:"api-reference/geo-layers/tile-layer",id:"api-reference/geo-layers/tile-layer",title:"TileLayer",description:"The TileLayer is a composite layer that makes it possible to visualize very large datasets. Instead of fetching the entire dataset, it only loads and renders what's visible in the current viewport.",source:"@site/../docs/api-reference/geo-layers/tile-layer.md",sourceDirName:"api-reference/geo-layers",slug:"/api-reference/geo-layers/tile-layer",permalink:"/docs/api-reference/geo-layers/tile-layer",draft:!1,editUrl:"https://github.com/visgl/deck.gl/tree/master/website/../docs/api-reference/geo-layers/tile-layer.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"TextLayer",permalink:"/docs/api-reference/layers/text-layer"},next:{title:"Tile3DLayer",permalink:"/docs/api-reference/geo-layers/tile-3d-layer"}},u={},h=[{value:"Installation",id:"installation",level:2},{value:"Indexing System",id:"indexing-system",level:2},{value:"Properties",id:"properties",level:2},{value:"Data Options",id:"data-options",level:3},{value:"<code>data</code> (string | string[], optional)",id:"data",level:4},{value:"<code>getTileData</code> (Function, optional)",id:"gettiledata",level:4},{value:"<code>TilesetClass</code> (class, optional)",id:"tilesetclass",level:4},{value:"<code>tileSize</code> (number, optional)",id:"tilesize",level:4},{value:"<code>zoomOffset</code> (number, optional)",id:"zoomoffset",level:4},{value:"<code>maxZoom</code> (number | null, optional)",id:"maxzoom",level:4},{value:"<code>minZoom</code> (number, optional)",id:"minzoom",level:4},{value:"<code>extent</code> (number4, optional)",id:"extent",level:4},{value:"<code>maxCacheSize</code> (number, optional)",id:"maxcachesize",level:4},{value:"<code>maxCacheByteSize</code> (number, optional)",id:"maxcachebytesize",level:4},{value:"<code>refinementStrategy</code> (string | Function, optional)",id:"refinementstrategy",level:4},{value:"custom strategy",id:"custom-strategy",level:5},{value:"<code>maxRequests</code> (number, optional)",id:"maxrequests",level:4},{value:"<code>debounceTime</code> (number, optional)",id:"debouncetime",level:4},{value:"Render Options",id:"render-options",level:3},{value:"<code>renderSubLayers</code> (Function, optional)",id:"rendersublayers",level:4},{value:"<code>zRange</code> (number2, optional)",id:"zrange",level:4},{value:"<code>modelMatrix</code> (Matrix4, optional)",id:"modelmatrix",level:4},{value:"Callbacks",id:"callbacks",level:3},{value:"<code>onViewportLoad</code> (Function, optional)",id:"onviewportload",level:4},{value:"<code>onTileLoad</code> (Function, optional)",id:"ontileload",level:4},{value:"<code>onTileError</code> (Function, optional)",id:"ontileerror",level:4},{value:"<code>onTileUnload</code> (Function, optional)",id:"ontileunload",level:4},{value:"Tile",id:"tile",level:2},{value:"Tileset2D",id:"tileset2d",level:2},{value:"Source",id:"source",level:2}],p={toc:h},g="wrapper";function f(e){let{components:t,...i}=e;return(0,o.kt)(g,(0,n.Z)({},p,i,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"tilelayer"},"TileLayer"),(0,o.kt)(s.xO,{mdxType:"TileLayerDemo"}),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"TileLayer")," is a composite layer that makes it possible to visualize very large datasets. Instead of fetching the entire dataset, it only loads and renders what's visible in the current viewport."),(0,o.kt)("p",null,'To use this layer, the data must be sliced into "tiles". Each tile has a pre-defined bounding box and level of detail.\nUsers have the option to load each tile from a unique URL, defined by a template in the ',(0,o.kt)("inlineCode",{parentName:"p"},"data")," property.\nThe layer can also supply a callback ",(0,o.kt)("inlineCode",{parentName:"p"},"getTileData")," that does custom fetching when a tile is requested.\nThe loaded tile data is then rendered with the layer(s) returned by ",(0,o.kt)("inlineCode",{parentName:"p"},"renderSubLayers"),"."),(0,o.kt)(r.Z,{groupId:"language",mdxType:"Tabs"},(0,o.kt)(a.Z,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"import {Deck} from '@deck.gl/core';\nimport {TileLayer} from '@deck.gl/geo-layers';\nimport {BitmapLayer} from '@deck.gl/layers';\n\nconst layer = new TileLayer({\n  id: 'TileLayer',\n  data: 'https://c.tile.openstreetmap.org/{z}/{x}/{y}.png',\n  maxZoom: 19,\n  minZoom: 0,\n\n  renderSubLayers: props => {\n    const {boundingBox} = props.tile;\n\n    return new BitmapLayer(props, {\n      data: null,\n      image: props.data,\n      bounds: [boundingBox[0][0], boundingBox[0][1], boundingBox[1][0], boundingBox[1][1]]\n    });\n  },\n  pickable: true\n});\n\nnew Deck({\n  initialViewState: {\n    longitude: -122.4,\n    latitude: 37.74,\n    zoom: 11\n  },\n  controller: true,\n  getTooltip: ({tile}) => tile && `x:${tile.index.x}, y:${tile.index.y}, z:${tile.index.z}`,\n  layers: [layer]\n});\n"))),(0,o.kt)(a.Z,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"import {Deck} from '@deck.gl/core';\nimport {TileLayer, TileLayerPickingInfo} from '@deck.gl/geo-layers';\nimport {BitmapLayer} from '@deck.gl/layers';\n\nconst layer = new TileLayer({\n  id: 'TileLayer',\n  data: 'https://c.tile.openstreetmap.org/{z}/{x}/{y}.png',\n  maxZoom: 19,\n  minZoom: 0,\n\n  renderSubLayers: props => {\n    const {boundingBox} = props.tile;\n\n    return new BitmapLayer(props, {\n      data: null,\n      image: props.data,\n      bounds: [boundingBox[0][0], boundingBox[0][1], boundingBox[1][0], boundingBox[1][1]]\n    });\n  },\n  pickable: true\n});\n\nnew Deck({\n  initialViewState: {\n    longitude: -122.4,\n    latitude: 37.74,\n    zoom: 11\n  },\n  controller: true,\n  getTooltip: ({tile}: TileLayerPickingInfo) => tile && `x:${tile.index.x}, y:${tile.index.y}, z:${tile.index.z}`,\n  layers: [layer]\n});\n"))),(0,o.kt)(a.Z,{value:"react",label:"React",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"import React from 'react';\nimport DeckGL from '@deck.gl/react';\nimport {TileLayer} from '@deck.gl/geo-layers';\nimport {BitmapLayer} from '@deck.gl/layers';\nimport type {TileLayerPickingInfo} from '@deck.gl/geo-layers';\n\nfunction App() {\n  const layer = new TileLayer({\n    id: 'TileLayer',\n    data: 'https://c.tile.openstreetmap.org/{z}/{x}/{y}.png',\n    maxZoom: 19,\n    minZoom: 0,\n\n    renderSubLayers: props => {\n      const {boundingBox} = props.tile;\n\n      return new BitmapLayer(props, {\n        data: null,\n        image: props.data,\n        bounds: [boundingBox[0][0], boundingBox[0][1], boundingBox[1][0], boundingBox[1][1]]\n      });\n    },\n    pickable: true\n  });\n\n  return <DeckGL\n    initialViewState={{\n      longitude: -122.4,\n      latitude: 37.74,\n      zoom: 11\n    }}\n    controller\n    getTooltip={({tile}: TileLayerPickingInfo) => tile && `x:${tile.index.x}, y:${tile.index.y}, z:${tile.index.z}`}\n    layers={[layer]}\n  />;\n}\n")))),(0,o.kt)("h2",{id:"installation"},"Installation"),(0,o.kt)("p",null,"To install the dependencies from NPM:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"npm install deck.gl\n# or\nnpm install @deck.gl/core @deck.gl/layers @deck.gl/geo-layers\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"import {TileLayer} from '@deck.gl/geo-layers';\nimport type {TileLayerProps, TileLayerPickingInfo} from '@deck.gl/geo-layers';\n\nnew TileLayer<TileDataT>(...props: TileLayerProps<TileDataT>[]);\n")),(0,o.kt)("p",null,"To use pre-bundled scripts:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},'<script src="https://unpkg.com/deck.gl@^9.0.0/dist.min.js"><\/script>\n\x3c!-- or --\x3e\n<script src="https://unpkg.com/@deck.gl/core@^9.0.0/dist.min.js"><\/script>\n<script src="https://unpkg.com/@deck.gl/layers@^9.0.0/dist.min.js"><\/script>\n<script src="https://unpkg.com/@deck.gl/geo-layers@^9.0.0/dist.min.js"><\/script>\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"new deck.TileLayer({});\n")),(0,o.kt)("h2",{id:"indexing-system"},"Indexing System"),(0,o.kt)("p",null,"At each integer zoom level (",(0,o.kt)("inlineCode",{parentName:"p"},"z"),"), the XY plane in the view space is divided into square tiles of the same size, each uniquely identified by their ",(0,o.kt)("inlineCode",{parentName:"p"},"x")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"y")," index. When ",(0,o.kt)("inlineCode",{parentName:"p"},"z")," increases by 1, the view space is scaled by 2, meaning that one tile at ",(0,o.kt)("inlineCode",{parentName:"p"},"z")," covers the same area as four tiles at ",(0,o.kt)("inlineCode",{parentName:"p"},"z+1"),"."),(0,o.kt)("p",null,"When the ",(0,o.kt)("inlineCode",{parentName:"p"},"TileLayer")," is used with a geospatial view such as the ",(0,o.kt)("a",{parentName:"p",href:"/docs/api-reference/core/map-view"},"MapView"),", x, y, and z are determined from ",(0,o.kt)("a",{parentName:"p",href:"https://wiki.openstreetmap.org/wiki/Slippy_map_tilenames"},"the OSM tile index"),"."),(0,o.kt)("p",null,"When the ",(0,o.kt)("inlineCode",{parentName:"p"},"TileLayer")," is used with a non-geospatial view such as the ",(0,o.kt)("a",{parentName:"p",href:"/docs/api-reference/core/orthographic-view"},"OrthographicView")," or the ",(0,o.kt)("a",{parentName:"p",href:"/docs/api-reference/core/orbit-view"},"OrbitView"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"x")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"y")," increment from the world origin, and each tile's width and height match that defined by the ",(0,o.kt)("inlineCode",{parentName:"p"},"tileSize")," prop. For example, the tile ",(0,o.kt)("inlineCode",{parentName:"p"},"x: 0, y: 0")," occupies the square between ",(0,o.kt)("inlineCode",{parentName:"p"},"[0, 0]")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"[tileSize, tileSize]"),"."),(0,o.kt)("p",null,"If you need to offset the ",(0,o.kt)("inlineCode",{parentName:"p"},"z"),' level at which the tiles are fetched in order to fetch tiles at a higher resolution in order to produce a "crisper" picture, there is a ',(0,o.kt)("inlineCode",{parentName:"p"},"zoomOffset")," prop."),(0,o.kt)("h2",{id:"properties"},"Properties"),(0,o.kt)("p",null,"Inherits all properties from ",(0,o.kt)("a",{parentName:"p",href:"/docs/api-reference/core/layer"},"base ",(0,o.kt)("inlineCode",{parentName:"a"},"Layer")),"."),(0,o.kt)("p",null,"If using the default ",(0,o.kt)("inlineCode",{parentName:"p"},"renderSubLayers"),", supports all ",(0,o.kt)("a",{parentName:"p",href:"/docs/api-reference/layers/geojson-layer"},(0,o.kt)("inlineCode",{parentName:"a"},"GeoJSONLayer"))," properties to style features."),(0,o.kt)("h3",{id:"data-options"},"Data Options"),(0,o.kt)("h4",{id:"data"},(0,o.kt)("inlineCode",{parentName:"h4"},"data")," (string | string[], optional)"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Default: ",(0,o.kt)("inlineCode",{parentName:"li"},"[]"))),(0,o.kt)("p",null,"Either a URL template or an array of URL templates from which the tile data should be loaded."),(0,o.kt)("p",null,"If the value is a string: a URL template. Substrings ",(0,o.kt)("inlineCode",{parentName:"p"},"{x}")," ",(0,o.kt)("inlineCode",{parentName:"p"},"{y}")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"{z}"),", if present, will be replaced with a tile's actual index when it is requested."),(0,o.kt)("p",null,"If the value is an array: multiple URL templates. Each endpoint must return the same content for the same tile index. This can be used to work around ",(0,o.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Glossary/Domain_sharding"},"domain sharding"),", allowing browsers to download more resources simultaneously. Requests made are balanced among the endpoints, based on the tile index."),(0,o.kt)("h4",{id:"gettiledata"},(0,o.kt)("inlineCode",{parentName:"h4"},"getTileData")," (Function, optional)"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Default: ",(0,o.kt)("inlineCode",{parentName:"li"},"tile => load(tile.url)"))),(0,o.kt)("p",null,"If supplied, ",(0,o.kt)("inlineCode",{parentName:"p"},"getTileData")," is called to retrieve the data of each tile. It receives one argument ",(0,o.kt)("inlineCode",{parentName:"p"},"tile")," which contains the following fields:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"index")," (object) - index of the tile. ",(0,o.kt)("inlineCode",{parentName:"li"},"index")," is in the shape of ",(0,o.kt)("inlineCode",{parentName:"li"},"{x, y, z}"),", corresponding to the integer values specifying the tile."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"id")," (string) - unique string representation of index."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"url")," (string) - resolved url of the tile if the ",(0,o.kt)("inlineCode",{parentName:"li"},"data")," prop is provided, otherwise ",(0,o.kt)("inlineCode",{parentName:"li"},"null")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"bbox")," (object) - bounding box of the tile. When used with a geospatial view, ",(0,o.kt)("inlineCode",{parentName:"li"},"bbox")," is in the shape of ",(0,o.kt)("inlineCode",{parentName:"li"},"{west: <longitude>, north: <latitude>, east: <longitude>, south: <latitude>}"),". When used with a non-geospatial view, ",(0,o.kt)("inlineCode",{parentName:"li"},"bbox")," is in the shape of ",(0,o.kt)("inlineCode",{parentName:"li"},"{left, top, right, bottom}"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"signal")," (object) - an ",(0,o.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Web/API/AbortSignal"},"AbortSignal")," that may be signalled if there are too many queued requests. Note: only tiles that aren't visible will be aborted.")),(0,o.kt)("p",null,"It should return either the tile data or a Promise that resolves to the tile data."),(0,o.kt)("p",null,"This prop is not required if ",(0,o.kt)("inlineCode",{parentName:"p"},"data")," points to a supported format (JSON or image by default). Additional formats may be added by registering ",(0,o.kt)("a",{parentName:"p",href:"https://loaders.gl/modules/core/docs/api-reference/register-loaders"},"loaders.gl")," modules."),(0,o.kt)("p",null,"It is recommended to pass ",(0,o.kt)("inlineCode",{parentName:"p"},"signal")," to any ",(0,o.kt)("inlineCode",{parentName:"p"},"fetch")," calls and check its ",(0,o.kt)("inlineCode",{parentName:"p"},"aborted")," property before doing any expensive computation. If ",(0,o.kt)("inlineCode",{parentName:"p"},"signal")," is aborted, then throw or return falsy from ",(0,o.kt)("inlineCode",{parentName:"p"},"getTileData")," so the data is not cached; do not return incomplete data. If ",(0,o.kt)("inlineCode",{parentName:"p"},"signal")," is aborted, but ",(0,o.kt)("inlineCode",{parentName:"p"},"getTileData")," still returns a truthy response, then its data will be cached."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"getTileData: ({url, signal}) => {\n  const data = fetch(url, {signal});\n\n  if (signal.aborted) {\n    return null;\n  }\n  // Expensive computation on returned data\n}\n")),(0,o.kt)("h4",{id:"tilesetclass"},(0,o.kt)("inlineCode",{parentName:"h4"},"TilesetClass")," (class, optional)"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Default: ",(0,o.kt)("inlineCode",{parentName:"li"},"Tileset2D"))),(0,o.kt)("p",null,"Tileset class that ",(0,o.kt)("inlineCode",{parentName:"p"},"TileLayer")," uses for tile indexing. Extend ",(0,o.kt)("a",{parentName:"p",href:"#tileset2d"},"Tileset2D")," to implement a custom indexing scheme."),(0,o.kt)("h4",{id:"tilesize"},(0,o.kt)("inlineCode",{parentName:"h4"},"tileSize")," (number, optional)"),(0,o.kt)("p",null,"The pixel dimension of the tiles, usually a power of 2."),(0,o.kt)("p",null,"For geospatial viewports, tile size represents the target pixel width and height of each tile when rendered. Smaller tile sizes display the content at higher resolution, while the layer needs to load more tiles to fill the same viewport."),(0,o.kt)("p",null,"For non-geospatial viewports, the tile size should correspond to the true pixel size of the tiles."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Default: ",(0,o.kt)("inlineCode",{parentName:"li"},"512"))),(0,o.kt)("h4",{id:"zoomoffset"},(0,o.kt)("inlineCode",{parentName:"h4"},"zoomOffset")," (number, optional)"),(0,o.kt)("p",null,"This offset changes the zoom level at which the tiles are fetched.  Needs to be an integer."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Default: ",(0,o.kt)("inlineCode",{parentName:"li"},"0"))),(0,o.kt)("h4",{id:"maxzoom"},(0,o.kt)("inlineCode",{parentName:"h4"},"maxZoom")," (number | null, optional)"),(0,o.kt)("p",null,"The max zoom level of the layer's data. When overzoomed (i.e. ",(0,o.kt)("inlineCode",{parentName:"p"},"zoom > maxZoom"),"), tiles from this level will be displayed."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Default: ",(0,o.kt)("inlineCode",{parentName:"li"},"null"))),(0,o.kt)("h4",{id:"minzoom"},(0,o.kt)("inlineCode",{parentName:"h4"},"minZoom")," (number, optional)"),(0,o.kt)("p",null,"The min zoom level of the layer's data. When underzoomed (i.e. ",(0,o.kt)("inlineCode",{parentName:"p"},"zoom < minZoom"),"), the layer will not display any tiles unless ",(0,o.kt)("inlineCode",{parentName:"p"},"extent")," is defined, to avoid issuing too many tile requests."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Default: 0")),(0,o.kt)("h4",{id:"extent"},(0,o.kt)("inlineCode",{parentName:"h4"},"extent")," (number","[4]",", optional)"),(0,o.kt)("p",null,"The bounding box of the layer's data, in the form of ",(0,o.kt)("inlineCode",{parentName:"p"},"[minX, minY, maxX, maxY]"),". If provided, the layer will only load and render the tiles that are needed to fill this box. "),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Default: ",(0,o.kt)("inlineCode",{parentName:"li"},"null"))),(0,o.kt)("h4",{id:"maxcachesize"},(0,o.kt)("inlineCode",{parentName:"h4"},"maxCacheSize")," (number, optional)"),(0,o.kt)("p",null,"The maximum number of tiles that can be cached. The tile cache keeps loaded tiles in memory even if they are no longer visible. It reduces the need to re-download the same data over and over again when the user pan/zooms around the map, providing a smoother experience."),(0,o.kt)("p",null,"If not supplied, the ",(0,o.kt)("inlineCode",{parentName:"p"},"maxCacheSize")," is calculated as ",(0,o.kt)("inlineCode",{parentName:"p"},"5")," times the number of tiles in the current viewport."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Default: ",(0,o.kt)("inlineCode",{parentName:"li"},"null"))),(0,o.kt)("h4",{id:"maxcachebytesize"},(0,o.kt)("inlineCode",{parentName:"h4"},"maxCacheByteSize")," (number, optional)"),(0,o.kt)("p",null,"The maximum memory used for caching tiles. If this limit is supplied, ",(0,o.kt)("inlineCode",{parentName:"p"},"getTileData")," must return an object that contains a ",(0,o.kt)("inlineCode",{parentName:"p"},"byteLength")," field."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Default: ",(0,o.kt)("inlineCode",{parentName:"li"},"null"))),(0,o.kt)("h4",{id:"refinementstrategy"},(0,o.kt)("inlineCode",{parentName:"h4"},"refinementStrategy")," (string | Function, optional)"),(0,o.kt)("p",null,"How the tile layer refines the visibility of tiles. When zooming in and out, if the layer only shows tiles from the current zoom level, then the user may observe undesirable flashing while new data is loading. By setting ",(0,o.kt)("inlineCode",{parentName:"p"},"refinementStrategy")," the layer can attempt to maintain visual continuity by displaying cached data from a different zoom level before data is available."),(0,o.kt)("p",null,"This prop accepts one of the following:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"'best-available'"),": If a tile in the current viewport is waiting for its data to load, use cached content from the closest zoom level to fill the empty space. This approach minimizes the visual flashing due to missing content."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"'no-overlap'"),": Avoid showing overlapping tiles when backfilling with cached content. This is usually favorable when tiles do not have opaque backgrounds."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"'never'"),": Do not display any tile that is not selected."),(0,o.kt)("li",{parentName:"ul"},'A custom function. See "custom strategy" below.')),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Default: ",(0,o.kt)("inlineCode",{parentName:"li"},"'best-available'"))),(0,o.kt)("h5",{id:"custom-strategy"},"custom strategy"),(0,o.kt)("p",null,"Apps may define a custom ",(0,o.kt)("inlineCode",{parentName:"p"},"refinementStrategy")," by supplying its own callback function. The function will be called frequently on every viewport update and every tile loaded event."),(0,o.kt)("p",null,"When called, the function receives an array of ",(0,o.kt)("a",{parentName:"p",href:"#tile"},"Tile")," instances representing every tile that is currently in the cache. It is an opportunity to manipulate ",(0,o.kt)("inlineCode",{parentName:"p"},"tile.isVisible")," before sub layers are rendered. ",(0,o.kt)("inlineCode",{parentName:"p"},"isVisible")," is initially set to the value of ",(0,o.kt)("inlineCode",{parentName:"p"},"isSelected")," (equivalent to ",(0,o.kt)("inlineCode",{parentName:"p"},"refinementStrategy: 'never'"),")."),(0,o.kt)("h4",{id:"maxrequests"},(0,o.kt)("inlineCode",{parentName:"h4"},"maxRequests")," (number, optional)"),(0,o.kt)("p",null,"The maximum number of concurrent ",(0,o.kt)("inlineCode",{parentName:"p"},"getTileData")," calls."),(0,o.kt)("p",null,"If ",(0,o.kt)("inlineCode",{parentName:"p"},"<= 0"),", no throttling will occur, and ",(0,o.kt)("inlineCode",{parentName:"p"},"getTileData")," may be called an unlimited number of times concurrently regardless of how long that tile is or was visible."),(0,o.kt)("p",null,"If ",(0,o.kt)("inlineCode",{parentName:"p"},"> 0"),", a maximum of ",(0,o.kt)("inlineCode",{parentName:"p"},"maxRequests")," instances of ",(0,o.kt)("inlineCode",{parentName:"p"},"getTileData")," will be called concurrently. Requests may never be called if the tile wasn't visible long enough to be scheduled and started. Requests may also be aborted (through the ",(0,o.kt)("inlineCode",{parentName:"p"},"signal")," passed to ",(0,o.kt)("inlineCode",{parentName:"p"},"getTileData"),") if there are more than ",(0,o.kt)("inlineCode",{parentName:"p"},"maxRequests")," ongoing requests and some of those are for tiles that are no longer visible."),(0,o.kt)("p",null,"If ",(0,o.kt)("inlineCode",{parentName:"p"},"getTileData")," makes ",(0,o.kt)("inlineCode",{parentName:"p"},"fetch")," requests against an HTTP 1 web server, then ",(0,o.kt)("inlineCode",{parentName:"p"},"maxRequests")," should correlate to the browser's maximum number of concurrent ",(0,o.kt)("inlineCode",{parentName:"p"},"fetch")," requests. For Chrome, the max is 6 per domain. If you use the ",(0,o.kt)("inlineCode",{parentName:"p"},"data")," prop and specify multiple domains, you can increase this limit. For example, with Chrome and 3 domains specified, you can set ",(0,o.kt)("inlineCode",{parentName:"p"},"maxRequests=18"),"."),(0,o.kt)("p",null,'If the web server supports HTTP/2 (Open Chrome dev tools and look for "h2" in the Protocol column), then you can make an unlimited number of concurrent requests (and can set ',(0,o.kt)("inlineCode",{parentName:"p"},"maxRequests=-1"),"). Note that this will request data for every tile, no matter how long the tile was visible, and may increase server load."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Default: ",(0,o.kt)("inlineCode",{parentName:"li"},"6"))),(0,o.kt)("h4",{id:"debouncetime"},(0,o.kt)("inlineCode",{parentName:"h4"},"debounceTime")," (number, optional)"),(0,o.kt)("p",null,"Queue tile requests until no new tiles have been added for at least ",(0,o.kt)("inlineCode",{parentName:"p"},"debounceTime")," milliseconds."),(0,o.kt)("p",null,"If ",(0,o.kt)("inlineCode",{parentName:"p"},"debounceTime == 0"),", tile requests are issued as quickly as the ",(0,o.kt)("inlineCode",{parentName:"p"},"maxRequests")," concurrent request limit allows."),(0,o.kt)("p",null,"If ",(0,o.kt)("inlineCode",{parentName:"p"},"debounceTime > 0"),", tile requests are queued until a period of at least ",(0,o.kt)("inlineCode",{parentName:"p"},"debounceTime")," milliseconds has passed without any new tiles being added to the queue. May reduce bandwidth usage and total loading time during interactive view transitions."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Default: ",(0,o.kt)("inlineCode",{parentName:"li"},"0"))),(0,o.kt)("h3",{id:"render-options"},"Render Options"),(0,o.kt)("h4",{id:"rendersublayers"},(0,o.kt)("inlineCode",{parentName:"h4"},"renderSubLayers")," (Function, optional)"),(0,o.kt)("p",null,"Renders one or an array of Layer instances with all the ",(0,o.kt)("inlineCode",{parentName:"p"},"TileLayer")," props and the following props:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"id")," (string): An unique id for this sublayer"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"data")," (TileDataT): Resolved from ",(0,o.kt)("inlineCode",{parentName:"li"},"getTileData"),". As of deck.gl 8.2, this prop is always the data resolved from the Promise and is never a Promise itself."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"tile")," (",(0,o.kt)("a",{parentName:"li",href:"#tile"},"Tile"),")")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Default: ",(0,o.kt)("inlineCode",{parentName:"li"},"props => new GeoJsonLayer(props)"))),(0,o.kt)("p",null,"Note that the following sub layer props are overridden by ",(0,o.kt)("inlineCode",{parentName:"p"},"TileLayer")," internally:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"visible")," (toggled based on tile visibility)"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"highlightedObjectIndex")," (set based on the parent layer's highlight state)")),(0,o.kt)("h4",{id:"zrange"},(0,o.kt)("inlineCode",{parentName:"h4"},"zRange")," (number","[2]",", optional)"),(0,o.kt)("p",null,"An array representing the height range of the content in the tiles, as ",(0,o.kt)("inlineCode",{parentName:"p"},"[minZ, maxZ]"),'. This is designed to support tiles with 2.5D content, such as buildings or terrains. At high pitch angles, such a tile may "extrude into" the viewport even if its 2D bounding box is out of view. Therefore, it is necessary to provide additional information for the layer to behave correctly. The value of this prop is used for two purposes: 1) to determine the necessary tiles to load and/or render; 2) to determine the possible intersecting tiles during picking.'),(0,o.kt)("p",null,"This prop currently only has effect when used with a geospatial view."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Default: ",(0,o.kt)("inlineCode",{parentName:"li"},"null")," (interpreted as ",(0,o.kt)("inlineCode",{parentName:"li"},"[0, 0]"),")")),(0,o.kt)("h4",{id:"modelmatrix"},(0,o.kt)("inlineCode",{parentName:"h4"},"modelMatrix")," (Matrix4, optional)"),(0,o.kt)("p",null,"Affects both rendering and tile fetching to produce a transformed tile layer.  Note that this can result in tiles being fetched outside the ",(0,o.kt)("inlineCode",{parentName:"p"},"extent")," prop, for example if the ",(0,o.kt)("inlineCode",{parentName:"p"},"modelMatrix")," defines a rotation."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Default: ",(0,o.kt)("inlineCode",{parentName:"li"},"null"))),(0,o.kt)("h3",{id:"callbacks"},"Callbacks"),(0,o.kt)("h4",{id:"onviewportload"},(0,o.kt)("inlineCode",{parentName:"h4"},"onViewportLoad")," (Function, optional)"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"onViewportLoad")," is a function that is called when all tiles in the current viewport are loaded. An array of loaded ",(0,o.kt)("a",{parentName:"p",href:"#tile"},"Tile")," instances are passed as argument to this function"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Default: ",(0,o.kt)("inlineCode",{parentName:"li"},"data => null"))),(0,o.kt)("h4",{id:"ontileload"},(0,o.kt)("inlineCode",{parentName:"h4"},"onTileLoad")," (Function, optional)"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"onTileLoad")," called when a tile successfully loads."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Default: ",(0,o.kt)("inlineCode",{parentName:"li"},"() => {}"))),(0,o.kt)("p",null,"Receives arguments:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"tile")," (object) - the ",(0,o.kt)("a",{parentName:"li",href:"#tile"},"tile")," that has been loaded.")),(0,o.kt)("h4",{id:"ontileerror"},(0,o.kt)("inlineCode",{parentName:"h4"},"onTileError")," (Function, optional)"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"onTileError")," called when a tile failed to load."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Default: ",(0,o.kt)("inlineCode",{parentName:"li"},"console.error"))),(0,o.kt)("p",null,"Receives arguments:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"error")," (",(0,o.kt)("inlineCode",{parentName:"li"},"Error"),")")),(0,o.kt)("h4",{id:"ontileunload"},(0,o.kt)("inlineCode",{parentName:"h4"},"onTileUnload")," (Function, optional)"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"onTileUnload")," called when a tile is cleared from cache."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Default: ",(0,o.kt)("inlineCode",{parentName:"li"},"() => {}"))),(0,o.kt)("p",null,"Receives arguments:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"tile")," (object) - the ",(0,o.kt)("a",{parentName:"li",href:"#tile"},"tile")," that has been cleared from cache.")),(0,o.kt)("h2",{id:"tile"},"Tile"),(0,o.kt)("p",null,"Class to hold the reading of a single tile"),(0,o.kt)("p",null,"Properties:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"index")," (object) - index of the tile. ",(0,o.kt)("inlineCode",{parentName:"li"},"index")," is in the shape of ",(0,o.kt)("inlineCode",{parentName:"li"},"{x, y, z}"),", corresponding to the integer values specifying the tile."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"id")," (string) - unique string representation of index, as 'x-y-z', e.g. '0-2-3'."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"boundingBox")," (number","[2][2]",") - bounding box of the tile in the shape of ",(0,o.kt)("inlineCode",{parentName:"li"},"[[minX, minY], [maxX, maxY]]"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"content")," (object) - the tile's cached content. ",(0,o.kt)("inlineCode",{parentName:"li"},"null")," if the tile's initial load is pending, cancelled, or encountered an error."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"data")," (object | Promise) - the tile's requested content. If the tile is loading, returns a Promise that resolves to the loaded content when loading is completed."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"parent")," (Tile) - the nearest ancestor tile (a tile on a lower ",(0,o.kt)("inlineCode",{parentName:"li"},"z")," that contains this tile), if present in the cache"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"children")," (Tile[]) - the nearest sub tiles (tiles on higher ",(0,o.kt)("inlineCode",{parentName:"li"},"z")," that are contained by this tile), if present in the cache"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"isSelected")," (boolean) - if the tile is expected to show up in the current viewport"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"isVisible")," (boolean) - if the tile should be rendered"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"isLoaded")," (boolean) - if the content of the tile has been loaded")),(0,o.kt)("h2",{id:"tileset2d"},"Tileset2D"),(0,o.kt)("p",null,"Class that manages loading and purging of tile data. This class caches recently visited tiles and only creates new tiles if they are present."),(0,o.kt)("p",null,"To implement a custom indexing scheme, extend ",(0,o.kt)("inlineCode",{parentName:"p"},"Tileset2D")," and implement the following interface:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"getTileIndices({viewport, maxZoom, minZoom, zRange, modelMatrix, modelMatrixInverse})")," - returns an array of indices in the given viewport. The indices should have the shape of Objects, like ",(0,o.kt)("inlineCode",{parentName:"li"},"{q: '0123'}"),", to allow referencing in the URL template supplied to the ",(0,o.kt)("inlineCode",{parentName:"li"},"data")," prop."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"getTileId(index)")," - returns unique string key for a tile index."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"getParentIndex(index)")," - returns the index of the parent tile."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"getTileZoom(index)")," - returns a zoom level for a tile index."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"getTileMetadata(index)")," - returns additional metadata to add to tile.")),(0,o.kt)("p",null,"For example, to index using ",(0,o.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/en-us/bingmaps/articles/bing-maps-tile-system#tile-coordinates-and-quadkeys"},"quadkeys"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"import {_Tileset2D as Tileset2D} from '@deck.gl/geo-layers';\nclass QuadkeyTileset2D extends Tileset2D {\n  getTileIndices(opts) {\n    // Quadkeys and OSM tiles share the layout, leverage existing algorithm\n    // Data format: [{quadkey: '0120'}, {quadkey: '0121'}, {quadkey: '0120'},...]\n    return super.getTileIndices(opts).map(tileToQuadkey);\n  }\n\n  getTileId({quadkey}) {\n    return quadkey;\n  }\n\n  getTileZoom({quadkey}) {\n    return quadkey.length;\n  }\n\n  getParentIndex({quadkey}) {\n    const quadkey = quadkey.slice(0, -1);\n    return {quadkey};\n  }\n}\n\nconst quadkeyTileLayer = new TileLayer({\n  TilesetClass: QuadkeyTileset2D,\n  data: 'quadkey/{quadkey}.json',\n  ...\n});\n")),(0,o.kt)("h2",{id:"source"},"Source"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/visgl/deck.gl/tree/9.0-release/modules/geo-layers/src/tile-layer"},"modules/geo-layers/src/tile-layer")))}f.isMDXComponent=!0},24808:(e,t,i)=>{i.d(t,{D5:()=>r});var n=i(67294),o=i(83156);i(9547),i(38826),i(81255),i(37442),i(4432),i(6415),i(90552),i(33855),i(46176),i(38824),i(31592);const s=i.e(4613).then(i.t.bind(i,24613,23)),r=n.forwardRef((function(e,t){return(0,o.Z)(e,t,s)}))},58176:(e,t,i)=>{i.d(t,{x:()=>n});const n={dataType:null,batchType:null,name:"Terrain",id:"terrain",module:"terrain",version:"4.2.0-beta.2",worker:!0,extensions:["png","pngraw","jpg","jpeg","gif","webp","bmp"],mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp"],options:{terrain:{tesselator:"auto",bounds:void 0,meshMaxError:10,elevationDecoder:{rScaler:1,gScaler:0,bScaler:0,offset:0},skirtHeight:void 0}}}},56100:(e,t,i)=>{i.d(t,{Z:()=>b});var n=i(96129);const o=()=>{},s=2,r=3,a=e=>e,l=1;class c{constructor(e){this._onTransitionUpdate=e=>{const{time:t,settings:{interpolator:i,startProps:n,endProps:o,duration:s,easing:r}}=e,a=r(t/s),l=i.interpolateProps(n,o,a);this.propsInTransition=this.getControllerState({...this.props,...l}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new n.Z(e.timeline),this.onViewStateChange=e.onViewStateChange||o,this.onStateChange=e.onStateChange||o}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let n=i;if(this.transition.inProgress){const{interruption:e,endProps:t}=this.transition.settings;n={...i,...e===s?t:this.propsInTransition||i}}this._triggerTransition(n,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:i}=e;return(t>0||"auto"===t)&&Boolean(i)}_isUpdateDueToCurrentTransition(e){return!(!this.transition.inProgress||!this.propsInTransition)&&this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition)}_shouldIgnoreViewportChange(e,t){if(this.transition.inProgress){return this.transition.settings.interruption===r||this._isUpdateDueToCurrentTransition(t)}return!this._isTransitionEnabled(t)||t.transitionInterpolator.arePropsEqual(e,t)}_triggerTransition(e,t){const i=this.getControllerState(e),n=this.getControllerState(t).shortestPathFrom(i),o=t.transitionInterpolator,s=o.getDuration?o.getDuration(e,t):t.transitionDuration;if(0===s)return;const r=o.initializeProps(e,n);this.propsInTransition={};const c={duration:s,easing:t.transitionEasing||a,interpolator:o,interruption:t.transitionInterruption||l,startProps:r.start,endProps:r.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(c),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),null==e||e(t)}}}var d=i(59544);const u={transitionDuration:0},h=e=>1-(1-e)*(1-e),p=["wheel"],g=["panstart","panmove","panend"],f=["pinchstart","pinchmove","pinchend"],m=["tripanstart","tripanmove","tripanend"],v=["doubletap"],y=["keydown"],_={};class b{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new c({...e,getControllerState:e=>new this.ControllerState(e),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const t in this._events){var e;if(this._events[t])null==(e=this.eventManager)||e.off(t,this.handleEvent)}this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return!t&&this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return!t&&this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return!t&&this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:i}=this.props,{offsetCenter:n}=e;return[n.x-t,n.y-i]}isPointInBounds(e,t){const{width:i,height:n}=this.props;if(t&&t.handled)return!1;const o=e[0]>=0&&e[0]<=i&&e[1]>=0&&e[1]<=n;return o&&t&&t.stopPropagation(),o}isFunctionKeyPressed(e){const{srcEvent:t}=e;return Boolean(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout((()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)}),e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:!0===t?300:0;const{scrollZoom:i=!0,dragPan:n=!0,dragRotate:o=!0,doubleClickZoom:s=!0,touchZoom:r=!0,touchRotate:a=!1,keyboard:l=!0}=e,c=Boolean(this.onViewStateChange);this.toggleEvents(p,c&&i),this.toggleEvents(g,c),this.toggleEvents(f,c&&(r||a)),this.toggleEvents(m,c&&a),this.toggleEvents(v,c&&s),this.toggleEvents(y,c&&l),this.scrollZoom=i,this.dragPan=n,this.dragRotate=o,this.doubleClickZoom=s,this.touchZoom=r,this.touchRotate=a,this.keyboard=l}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach((e=>{this._events[e]!==t&&(this._events[e]=t,t?this.eventManager.on(e,this.handleEvent):this.eventManager.off(e,this.handleEvent))}))}updateViewport(e,t,i){void 0===t&&(t=null),void 0===i&&(i={});const n={...e.getViewportProps(),...t},o=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),o){const e=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:n,interactionState:this._interactionState,oldViewState:e,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||"pan"===this.dragMode)&&(i=!i);const n=this.controllerState[i?"panStart":"rotateStart"]({pos:t});return this._panMove=i,this.updateViewport(n,u,{isDragging:!0}),!0}_onPan(e){return!!this.isDragging()&&(this._panMove?this._onPanMove(e):this._onPanRotate(e))}_onPanEnd(e){return!!this.isDragging()&&(this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e))}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),i=this.controllerState.pan({pos:t});return this.updateViewport(i,u,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const i=this.getCenter(e),n=[i[0]+e.velocityX*t/2,i[1]+e.velocityY*t/2],o=this.controllerState.pan({pos:n}).panEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:h},{isDragging:!1,isPanning:!0})}else{const e=this.controllerState.panEnd();this.updateViewport(e,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),i=this.controllerState.rotate({pos:t});return this.updateViewport(i,u,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const i=this.getCenter(e),n=[i[0]+e.velocityX*t/2,i[1]+e.velocityY*t/2],o=this.controllerState.rotate({pos:n}).rotateEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:h},{isDragging:!1,isRotating:!0})}else{const e=this.controllerState.rotateEnd();this.updateViewport(e,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:i=.01,smooth:n=!1}=!0===this.scrollZoom?{}:this.scrollZoom,{delta:o}=e;let s=2/(1+Math.exp(-Math.abs(o*i)));o<0&&0!==s&&(s=1/s);const r=this.controllerState.zoom({pos:t,scale:s});return this.updateViewport(r,{...this._getTransitionProps({around:t}),transitionDuration:n?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const i=this.controllerState.rotateStart({pos:t});return this.updateViewport(i,u,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate)return!1;if(!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const i=this.controllerState.rotate({pos:t});return this.updateViewport(i,u,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const i=this.getCenter(e),n=[i[0],i[1]+=e.velocityY*t/2],o=this.controllerState.rotate({pos:n});this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:h},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const e=this.controllerState.rotateEnd();this.updateViewport(e,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const i=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return _._startPinchRotation=e.rotation,_._lastPinchEvent=e,this.updateViewport(i,u,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate)return!1;if(!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:i}=e,n=this.getCenter(e);t=t.zoom({pos:n,scale:i})}if(this.touchRotate){const{rotation:i}=e;t=t.rotate({deltaAngleX:_._startPinchRotation-i})}return this.updateViewport(t,u,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),_._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:i}=_;if(this.touchZoom&&t&&i&&e.scale!==i.scale){const n=this.getCenter(e);let o=this.controllerState.rotateEnd();const s=Math.log2(e.scale),r=(s-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),a=Math.pow(2,s+r*t/2);o=o.zoom({pos:n,scale:a}).zoomEnd(),this.updateViewport(o,{...this._getTransitionProps({around:n}),transitionDuration:t,transitionEasing:h},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const e=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(e,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return _._startPinchRotation=null,_._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const i=this.isFunctionKeyPressed(e),n=this.controllerState.zoom({pos:t,scale:i?.5:2});return this.updateViewport(n,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:n,rotateSpeedX:o,rotateSpeedY:s}=!0===this.keyboard?{}:this.keyboard,{controllerState:r}=this;let a;const l={};switch(e.srcEvent.code){case"Minus":a=t?r.zoomOut(i).zoomOut(i):r.zoomOut(i),l.isZooming=!0;break;case"Equal":a=t?r.zoomIn(i).zoomIn(i):r.zoomIn(i),l.isZooming=!0;break;case"ArrowLeft":t?(a=r.rotateLeft(o),l.isRotating=!0):(a=r.moveLeft(n),l.isPanning=!0);break;case"ArrowRight":t?(a=r.rotateRight(o),l.isRotating=!0):(a=r.moveRight(n),l.isPanning=!0);break;case"ArrowUp":t?(a=r.rotateUp(s),l.isRotating=!0):(a=r.moveUp(n),l.isPanning=!0);break;case"ArrowDown":t?(a=r.rotateDown(s),l.isRotating=!0):(a=r.moveDown(n),l.isPanning=!0);break;default:return!1}return this.updateViewport(a,this._getTransitionProps(),l),!0}_getTransitionProps(e){const{transition:t}=this;return t&&t.transitionInterpolator?e?{...t,transitionInterpolator:new d.Z({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t:u}}},26123:(e,t,i)=>{i.d(t,{U:()=>c,Z:()=>d});var n=i(55715),o=i(56100),s=i(79418),r=i(77394),a=i(46149),l=i(59544);class c extends s.Z{constructor(e){const{width:t,height:i,latitude:n,longitude:o,zoom:s,bearing:r=0,pitch:l=0,altitude:c=1.5,position:d=[0,0,0],maxZoom:u=20,minZoom:h=0,maxPitch:p=60,minPitch:g=0,startPanLngLat:f,startZoomLngLat:m,startRotatePos:v,startBearing:y,startPitch:_,startZoom:b,normalize:w=!0}=e;(0,a.Z)(Number.isFinite(o)),(0,a.Z)(Number.isFinite(n)),(0,a.Z)(Number.isFinite(s)),super({width:t,height:i,latitude:n,longitude:o,zoom:s,bearing:r,pitch:l,altitude:c,maxZoom:u,minZoom:h,maxPitch:p,minPitch:g,normalize:w,position:d},{startPanLngLat:f,startZoomLngLat:m,startRotatePos:v,startBearing:y,startPitch:_,startZoom:b}),this.makeViewport=e.makeViewport}panStart(e){let{pos:t}=e;return this._getUpdatedState({startPanLngLat:this._unproject(t)})}pan(e){let{pos:t,startPos:i}=e;const n=this.getState().startPanLngLat||this._unproject(i);if(!n)return this;const o=this.makeViewport(this.getViewportProps()).panByPosition(n,t);return this._getUpdatedState(o)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart(e){let{pos:t}=e;return this._getUpdatedState({startRotatePos:t,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate(e){let{pos:t,deltaAngleX:i=0,deltaAngleY:n=0}=e;const{startRotatePos:o,startBearing:s,startPitch:r}=this.getState();if(!o||void 0===s||void 0===r)return this;let a;return a=t?this._getNewRotation(t,o,r,s):{bearing:s+i,pitch:r+n},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart(e){let{pos:t}=e;return this._getUpdatedState({startZoomLngLat:this._unproject(t),startZoom:this.getViewportProps().zoom})}zoom(e){let{pos:t,startPos:i,scale:o}=e,{startZoom:s,startZoomLngLat:r}=this.getState();if(r||(s=this.getViewportProps().zoom,r=this._unproject(i)||this._unproject(t)),!r)return this;const{maxZoom:a,minZoom:l}=this.getViewportProps();let c=s+Math.log2(o);c=(0,n.uZ)(c,l,a);const d=this.makeViewport({...this.getViewportProps(),zoom:c});return this._getUpdatedState({zoom:c,...d.panByPosition(r,t)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e){return void 0===e&&(e=2),this._zoomFromCenter(e)}zoomOut(e){return void 0===e&&(e=2),this._zoomFromCenter(1/e)}moveLeft(e){return void 0===e&&(e=100),this._panFromCenter([e,0])}moveRight(e){return void 0===e&&(e=100),this._panFromCenter([-e,0])}moveUp(e){return void 0===e&&(e=100),this._panFromCenter([0,e])}moveDown(e){return void 0===e&&(e=100),this._panFromCenter([0,-e])}rotateLeft(e){return void 0===e&&(e=15),this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e){return void 0===e&&(e=15),this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e){return void 0===e&&(e=10),this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e){return void 0===e&&(e=10),this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),i={...this.getViewportProps()},{bearing:n,longitude:o}=i;return Math.abs(n-t.bearing)>180&&(i.bearing=n<0?n+360:n-360),Math.abs(o-t.longitude)>180&&(i.longitude=o<0?o+360:o-360),i}applyConstraints(e){const{maxZoom:t,minZoom:i,zoom:o}=e;e.zoom=(0,n.uZ)(o,i,t);const{maxPitch:s,minPitch:a,pitch:l}=e;e.pitch=(0,n.uZ)(l,a,s);const{normalize:c=!0}=e;return c&&Object.assign(e,(0,r.QA)(e)),e}_zoomFromCenter(e){const{width:t,height:i}=this.getViewportProps();return this.zoom({pos:[t/2,i/2],scale:e})}_panFromCenter(e){const{width:t,height:i}=this.getViewportProps();return this.pan({startPos:[t/2,i/2],pos:[t/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,i,o){const s=e[0]-t[0],r=e[1]-t[1],a=e[1],l=t[1],{width:c,height:d}=this.getViewportProps(),u=s/c;let h=0;r>0?Math.abs(d-l)>5&&(h=r/(l-d)*1.2):r<0&&l>5&&(h=1-a/l),h=(0,n.uZ)(h,-1,1);const{minPitch:p,maxPitch:g}=this.getViewportProps();let f=i;return h>0?f=i+h*(g-i):h<0&&(f=i-h*(p-i)),{pitch:f,bearing:o+180*u}}}class d extends o.Z{constructor(){super(...arguments),this.ControllerState=c,this.transition={transitionDuration:300,transitionInterpolator:new l.Z({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e);(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}},79418:(e,t,i)=>{i.d(t,{Z:()=>n});class n{constructor(e,t){this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}},84911:(e,t,i)=>{i.d(t,{Z:()=>r,z:()=>s});var n=i(70575);let o={};function s(e){o=e}function r(e,t,i,s){n.Z.level>0&&o[e]&&o[e].call(null,t,i,s)}},44297:(e,t,i)=>{i.d(t,{M:()=>r});const n=[255,255,255],o=1;let s=0;class r{constructor(e){void 0===e&&(e={}),this.type="ambient";const{color:t=n}=e,{intensity:i=o}=e;this.id=e.id||"ambient-"+s++,this.color=t,this.intensity=i}}},27113:(e,t,i)=>{i.d(t,{O:()=>l});var n=i(51394);const o=[255,255,255],s=1,r=[0,0,-1];let a=0;class l{constructor(e){void 0===e&&(e={}),this.type="directional";const{color:t=o}=e,{intensity:i=s}=e,{direction:l=r}=e,{_shadow:c=!1}=e;this.id=e.id||"directional-"+a++,this.color=t,this.intensity=i,this.type="directional",this.direction=new n.P(l).normalize().toArray(),this.shadow=c}getProjectedLight(e){return this}}},69523:(e,t,i)=>{i.d(t,{Z:()=>w});var n=i(44297),o=i(27113),s=i(84900),r=i(51394),a=i(64321);class l extends a.Z{constructor(e,t){super(e,t),this.shadowMap=e.createTexture({width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),this.depthBuffer=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1,dataFormat:6402,type:5125}),this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[this.shadowMap],depthStencilAttachment:this.depthBuffer})}render(e){const t=this.fbo,i=this.device.canvasContext.cssToDeviceRatio(),n=e.viewports[0],o=n.width*i,s=n.height*i;o===t.width&&s===t.height||t.resize({width:o,height:s}),super.render({...e,clearColor:[1,1,1,1],target:t,pass:"shadow"})}getLayerParameters(e,t,i){return{...e.props.parameters,blend:!1,depthRange:[0,1],depthTest:!0}}shouldDrawLayer(e){return!1!==e.props.shadowEnabled}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null),this.shadowMap&&(this.shadowMap.destroy(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.destroy(),this.depthBuffer=null)}}var c=i(19845),d=i(82153),u=i(36268),h=i(77394);const p=(0,u.Z)((function(e){let{viewport:t,center:i}=e;return new s.y(t.viewProjectionMatrix).invert().transform(i)})),g=(0,u.Z)((function(e){let{viewport:t,shadowMatrices:i}=e;const n=[],o=t.pixelUnprojectionMatrix,a=t.isGeospatial?void 0:1,l=[[0,0,a],[t.width,0,a],[0,t.height,a],[t.width,t.height,a],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map((e=>function(e,t){const[i,n,o]=e,s=(0,h.CT)([i,n,o],t);if(Number.isFinite(o))return s;return[s[0],s[1],0]}(e,o)));for(const c of i){const e=c.clone().translate(new r.P(t.center).negate()),i=l.map((t=>e.transform(t))),o=(new s.y).ortho({left:Math.min(...i.map((e=>e[0]))),right:Math.max(...i.map((e=>e[0]))),bottom:Math.min(...i.map((e=>e[1]))),top:Math.max(...i.map((e=>e[1]))),near:Math.min(...i.map((e=>-e[2]))),far:Math.max(...i.map((e=>-e[2])))});n.push(o.multiplyRight(c))}return n})),f=[0,0,0,1],m=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];const v={name:"shadow",dependencies:[d.Z],vs:"\nconst int max_lights = 2;\nuniform mat4 shadow_uViewProjectionMatrices[max_lights];\nuniform vec4 shadow_uProjectCenters[max_lights];\nuniform bool shadow_uDrawShadowMap;\nuniform bool shadow_uUseShadowMap;\nuniform int shadow_uLightId;\nuniform float shadow_uLightCount;\n\nout vec3 shadow_vPosition[max_lights];\n\nvec4 shadow_setVertexPosition(vec4 position_commonspace) {\n  if (shadow_uDrawShadowMap) {\n    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);\n  }\n  if (shadow_uUseShadowMap) {\n    for (int i = 0; i < max_lights; i++) {\n      if(i < int(shadow_uLightCount)) {\n        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);\n        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;\n      }\n    }\n  }\n  return gl_Position;\n}\n",fs:"\nconst int max_lights = 2;\nuniform bool shadow_uDrawShadowMap;\nuniform bool shadow_uUseShadowMap;\nuniform sampler2D shadow_uShadowMap0;\nuniform sampler2D shadow_uShadowMap1;\nuniform vec4 shadow_uColor;\nuniform float shadow_uLightCount;\n\nin vec3 shadow_vPosition[max_lights];\n\nconst vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);\nconst vec4 bitUnpackShift = 1.0 / bitPackShift;\nconst vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);\n\nfloat shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {\n  vec4 rgbaDepth = texture(shadowMap, position.xy);\n\n  float z = dot(rgbaDepth, bitUnpackShift);\n  return smoothstep(0.001, 0.01, position.z - z);\n}\n\nvec4 shadow_filterShadowColor(vec4 color) {\n  if (shadow_uDrawShadowMap) {\n    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);\n    rgbaDepth -= rgbaDepth.gbaa * bitMask;\n    return rgbaDepth;\n  }\n  if (shadow_uUseShadowMap) {\n    float shadowAlpha = 0.0;\n    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);\n    if(shadow_uLightCount > 1.0) {\n      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);\n    }\n    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;\n    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);\n\n    return vec4(\n      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),\n      blendedAlpha\n    );\n  }\n  return color;\n}\n",inject:{"vs:DECKGL_FILTER_GL_POSITION":"\n    position = shadow_setVertexPosition(geometry.position);\n    ","fs:DECKGL_FILTER_COLOR":"\n    color = shadow_filterShadowColor(color);\n    "},getUniforms:function(e,t){return void 0===e&&(e={}),void 0===t&&(t={}),"viewport"in e&&(e.drawToShadowMap||e.shadowMaps&&e.shadowMaps.length>0)?function(e,t){const{shadowEnabled:i=!0}=e;if(!i||!e.shadowMatrices||!e.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1,shadow_uShadowMap0:e.dummyShadowMap,shadow_uShadowMap1:e.dummyShadowMap};const n={shadow_uDrawShadowMap:Boolean(e.drawToShadowMap),shadow_uUseShadowMap:!!e.shadowMaps&&e.shadowMaps.length>0,shadow_uColor:e.shadowColor||f,shadow_uLightId:e.shadowLightId||0,shadow_uLightCount:e.shadowMatrices.length},o=p({viewport:e.viewport,center:t.project_uCenter}),s=[],a=g({shadowMatrices:e.shadowMatrices,viewport:e.viewport}).slice();for(let l=0;l<e.shadowMatrices.length;l++){const i=a[l],n=i.clone().translate(new r.P(e.viewport.center).negate());t.project_uCoordinateSystem===c.Df.LNGLAT&&t.project_uProjectionMode===c.zG.WEB_MERCATOR?(a[l]=n,s[l]=o):(a[l]=i.clone().multiplyRight(m),s[l]=n.transform(o))}for(let r=0;r<a.length;r++)n["shadow_uViewProjectionMatrices["+r+"]"]=a[r],n["shadow_uProjectCenters["+r+"]"]=s[r];for(let r=0;r<2;r++)n["shadow_uShadowMap"+r]=e.shadowMaps&&e.shadowMaps[r]||e.dummyShadowMap;return n}(e,t):{}}},y={color:[255,255,255],intensity:1},_=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],b=[0,0,0,200/255];class w{constructor(e){void 0===e&&(e={}),this.id="lighting-effect",this.shadowColor=b,this.shadow=!1,this.ambientLight=null,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.shadowMaps=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:t,deck:i}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(t),i._addDefaultShaderModule(v),this.dummyShadowMap=t.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const t in e){const i=e[t];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i)}}this._applyDefaultLights(),this.shadow=this.directionalLights.some((e=>e.shadow)),this.context&&this.setup(this.context),this.props=e}preRender(e){let{layers:t,layerFilter:i,viewports:n,onViewportActive:o,views:s}=e;if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let e=0;e<this.shadowPasses.length;e++){this.shadowPasses[e].render({layers:t,layerFilter:i,viewports:n,onViewportActive:o,views:s,moduleParameters:{shadowLightId:e,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}}getModuleParameters(e){const t=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return t.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map((t=>t.getProjectedLight({layer:e}))),pointLights:this.pointLights.map((t=>t.getProjectedLight({layer:e})))},t}cleanup(e){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(v))}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const i=(new s.y).lookAt({eye:new r.P(t.direction).negate()});e.push(i)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const i=new l(e);this.shadowPasses[t]=i,this.shadowMaps[t]=i.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:i}=this;e||0!==t.length||0!==i.length||(this.ambientLight=new n.M(y),this.directionalLights.push(new o.O(_[0]),new o.O(_[1])))}}},90271:(e,t,i)=>{i.d(t,{Z:()=>V});var n=i(63847),o=i(49308);const s=o.C9;function r(e,t){return{attribute:e,format:t.size>1?t.type+"x"+t.size:t.type,byteOffset:t.offset||0}}function a(e){return e.stride||e.size*e.bytesPerElement}var l=i(92232),c=i(82808),d=i(70575);function u(e,t){t.offset&&d.Z.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const i=a(e),n=(void 0!==t.vertexOffset?t.vertexOffset:e.vertexOffset||0)*i+(t.elementOffset||0)*e.bytesPerElement+(e.offset||0);return{...t,offset:n,stride:i}}class h{constructor(e,t,i){this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;const n=t.logicalType||t.type,s="float64"===n;let r,{defaultValue:a}=t;a=Number.isFinite(a)?[a]:a||new Array(this.size).fill(0),r=s?"float32":!n&&t.isIndexed?"uint32":n||"float32";let l=function(e){switch(e){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return(0,o.Xs)(e)}}(n||r);this.doublePrecision=s,s&&!1===t.fp64&&(l=Float32Array),this.value=null,this.settings={...t,defaultType:l,defaultValue:a,logicalType:n,type:r,normalized:r.includes("norm"),size:this.size,bytesPerElement:l.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*a(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),l.Z.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e,t){void 0===e&&(e=this.id),void 0===t&&(t=null);const i={};if(this.state.constant){const n=this.value;if(t){const o=u(this.getAccessor(),t),s=o.offset/n.BYTES_PER_ELEMENT,r=o.size||this.size;i[e]=n.subarray(s,s+r)}else i[e]=n}else i[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?i[e+"64Low"]=i[e]:i[e+"64Low"]=new Float32Array(this.size)),i}_getBufferLayout(e,t){void 0===e&&(e=this.id),void 0===t&&(t=null);const i=this.getAccessor(),n=[],o={name:this.id,byteStride:a(i),attributes:n};if(this.doublePrecision){const o=function(e,t){const i=u(e,t);return{high:i,low:{...i,offset:i.offset+4*e.size}}}(i,t||{});n.push(r(e,{...i,...o.high}),r(e+"64Low",{...i,...o.low}))}else if(t){const o=u(i,t);n.push(r(e,{...i,...o}))}else n.push(r(e,i));return o}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:i,size:n}=this,o=i*n;if(t&&o&&t.length>=o){const i=new Array(n).fill(1/0),s=new Array(n).fill(-1/0);for(let e=0;e<o;)for(let o=0;o<n;o++){const n=t[e++];n<i[o]&&(i[o]=n),n>s[o]&&(s[o]=n)}e=[i,s]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let i;i=ArrayBuffer.isView(e)?{value:e}:e instanceof n.l?{buffer:e}:e;const o={...this.settings,...i};if(ArrayBuffer.isView(i.value)){if(!i.type){if(this.doublePrecision&&i.value instanceof Float64Array)o.type="float32";else{const e=s(i.value);o.type=o.normalized?e.replace("int","norm"):e}}o.bytesPerElement=i.value.BYTES_PER_ELEMENT,o.stride=a(o)}if(t.bounds=null,i.constant){let e=i.value;e=this._normalizeValue(e,[],0),this.settings.normalized&&(e=this.normalizeConstant(e));if(!(!t.constant||!this._areValuesEqual(e,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=ArrayBuffer.isView(e)?e:new Float32Array(e)}else if(i.buffer){const e=i.buffer;t.externalBuffer=e,t.constant=!1,this.value=i.value||null}else if(i.value){this._checkExternalBuffer(i);let e=i.value;t.externalBuffer=null,t.constant=!1,this.value=e;let{buffer:n}=this;const s=a(o),r=(o.vertexOffset||0)*s;if(this.doublePrecision&&e instanceof Float64Array&&(e=(0,c.TK)(e,o)),this.settings.isIndexed){const t=this.settings.defaultType;e.constructor!==t&&(e=new t(e))}const l=e.byteLength+r+2*s;(!n||n.byteLength<l)&&(n=this._createBuffer(l)),n.write(e,r)}return this.setAccessor(o),!0}updateSubBuffer(e){void 0===e&&(e={}),this.state.bounds=null;const t=this.value,{startOffset:i=0,endOffset:n}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?(0,c.TK)(t,{size:this.size,startIndex:i,endIndex:n}):t.subarray(i,n),i*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,t){void 0===t&&(t=!1);const{state:i}=this,n=i.allocatedValue,o=l.Z.allocate(n,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=o;const{byteOffset:s}=this;let{buffer:r}=this;return(!r||r.byteLength<o.byteLength+s)&&(r=this._createBuffer(o.byteLength+s),t&&n&&r.write(n instanceof Float64Array?(0,c.TK)(n,this):n,s)),i.allocatedValue=o,i.constant=!1,i.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error("Attribute "+this.id+" value is not TypedArray");const i=this.settings.defaultType;let n=!1;if(this.doublePrecision&&(n=t.BYTES_PER_ELEMENT<4),n)throw new Error("Attribute "+this.id+" does not support "+t.constructor.name);t instanceof i||!this.settings.normalized||"normalized"in e||d.Z.warn("Attribute "+this.id+" is normalized")()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map((e=>(e+128)/255*2-1));case"snorm16":return new Float32Array(e).map((e=>(e+32768)/65535*2-1));case"unorm8":return new Float32Array(e).map((e=>e/255));case"unorm16":return new Float32Array(e).map((e=>e/65535));default:return e}}_normalizeValue(e,t,i){const{defaultValue:n,size:o}=this.settings;if(Number.isFinite(e))return t[i]=e,t;if(!e){let e=o;for(;--e>=0;)t[i+e]=n[e];return t}switch(o){case 4:t[i+3]=Number.isFinite(e[3])?e[3]:n[3];case 3:t[i+2]=Number.isFinite(e[2])?e[2]:n[2];case 2:t[i+1]=Number.isFinite(e[1])?e[1]:n[1];case 1:t[i+0]=Number.isFinite(e[0])?e[0]:n[0];break;default:let s=o;for(;--s>=0;)t[i+s]=Number.isFinite(e[s])?e[s]:n[s]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:i}=this;for(let n=0;n<i;n++)if(e[n]!==t[n])return!1;return!0}_createBuffer(e){var t;this._buffer&&this._buffer.destroy();const{isIndexed:i,type:o}=this.settings;return this._buffer=this.device.createBuffer({...null==(t=this._buffer)?void 0:t.props,id:this.id,usage:i?n.l.INDEX:n.l.VERTEX,indexType:i?o:void 0,byteLength:e}),this._buffer}}var p=i(46149),g=i(55884),f=i(63619);const m=[],v=[[0,1/0]];var y=i(42701);class _ extends h{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:v}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw(e){let{clearChangedFlags:t=!1}=void 0===e?{}:e;const i=this.state.needsRedraw;return this.state.needsRedraw=i&&!t,i}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var t,i,n;(t=this.state).layoutChanged||(t.layoutChanged=(i=e,n=this.getAccessor(),!(i.type===n.type&&i.size===n.size&&a(i)===a(n)&&(i.offset||0)===(n.offset||0)))),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat("function"!=typeof e&&e||[])}supportsTransition(){return Boolean(this.settings.transition)}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,i=this.settings.transition,n=Array.isArray(t)?e[t.find((t=>e[t]))]:e[t];return(0,y.M)(n,i)}setNeedsUpdate(e,t){if(void 0===e&&(e=this.id),this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:e=0,endRow:i=1/0}=t;this.state.updateRanges=function(e,t){if(e===v)return e;if(t[0]<0&&(t[0]=0),t[0]>=t[1])return e;const i=[],n=e.length;let o=0;for(let s=0;s<n;s++){const n=e[s];n[1]<t[0]?(i.push(n),o=s+1):n[0]>t[1]?i.push(n):t=[Math.min(n[0],t[0]),Math.max(n[1],t[1])]}return i.splice(o,0,t),i}(this.state.updateRanges,[e,i])}else this.state.updateRanges=v}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=m}setNeedsRedraw(e){void 0===e&&(e=this.id),this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:i}=this;return!i.noAlloc&&(!!i.update&&(super.allocate(e,t.updateRanges!==v),!0))}updateBuffer(e){let{numInstances:t,data:i,props:n,context:o}=e;if(!this.needsUpdate())return!1;const{state:{updateRanges:s},settings:{update:r,noAlloc:a}}=this;let l=!0;if(r){for(const[e,a]of s)r.call(o,this,{data:i,startRow:e,endRow:a,props:n,numInstances:t});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[e,i]of s){const n=Number.isFinite(e)?this.getVertexOffset(e):0,o=Number.isFinite(i)?this.getVertexOffset(i):a||!Number.isFinite(t)?this.value.length:t*this.size;super.updateSubBuffer({startOffset:n,endOffset:o})}else;this._checkAttributeArray()}else l=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),l}setConstantValue(e){if(void 0===e||"function"==typeof e)return!1;return this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t){void 0===t&&(t=null);const{state:i,settings:n}=this;if(!e)return i.binaryValue=null,i.binaryAccessor=null,!1;if(n.noAlloc)return!1;if(i.binaryValue===e)return this.clearNeedsUpdate(),!0;i.binaryValue=e,this.setNeedsRedraw();if(n.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const o=e;(0,p.Z)(ArrayBuffer.isView(o.value),"invalid "+n.accessor);const s=Boolean(o.size)&&o.size!==this.size;return i.binaryAccessor=(0,g.jr)(o.value,{size:o.size||this.size,stride:o.stride,offset:o.offset,startIndices:t,nested:s}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(const i in e)Object.assign(t,super.getValue(i,e[i]));return t}getBufferLayout(e){this.state.layoutChanged=!1;const t=this.settings.shaderAttributes,i=super._getBufferLayout(),{stepMode:n}=this.settings;if(i.stepMode="dynamic"===n?e?e.isInstanced?"instance":"vertex":"instance":null!=n?n:"vertex",!t)return i;for(const o in t){const e=super._getBufferLayout(o,t[o]);i.attributes.push(...e.attributes)}return i}_autoUpdater(e,t){let{data:i,startRow:n,endRow:o,props:s,numInstances:r}=t;if(e.constant)return;const{settings:a,state:l,value:c,size:d,startIndices:u}=e,{accessor:h,transform:m}=a,v=l.binaryAccessor||("function"==typeof h?h:s[h]);(0,p.Z)("function"==typeof v,'accessor "'+h+'" is not a function');let y=e.getVertexOffset(n);const{iterable:_,objectInfo:b}=(0,g.jB)(i,n,o);for(const p of _){b.index++;let t=v(p,b);if(m&&(t=m.call(this,t)),u){const i=(b.index<u.length-1?u[b.index+1]:r)-u[b.index];if(t&&Array.isArray(t[0])){let i=y;for(const n of t)e._normalizeValue(n,c,i),i+=d}else t&&t.length>d?c.set(t,y):(e._normalizeValue(t,b.target,0),(0,f.k)({target:c,source:b.target,start:y,count:i}));y+=i*d}else e._normalizeValue(t,c,y),y+=d}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||"function"==typeof e.update))throw new Error("Attribute "+this.id+" missing update or accessor")}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let i=!0;switch(t){case 4:i=i&&Number.isFinite(e[3]);case 3:i=i&&Number.isFinite(e[2]);case 2:i=i&&Number.isFinite(e[1]);case 1:i=i&&Number.isFinite(e[0]);break;default:i=!1}if(!i)throw new Error("Illegal attribute generated for "+this.id)}}}var b=i(36268),w=i(84911),x=i(85688),P=i(12861);function C(e){const{source:t,target:i,start:n=0,size:o,getData:s}=e,r=e.end||i.length,a=t.length,l=r-n;if(a>l)return void i.set(t.subarray(0,l),n);if(i.set(t,n),!s)return;let c=a;for(;c<l;){const e=s(c,t);for(let t=0;t<o;t++)i[n+c]=e[t]||0,c++}}function S(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'+e+'"')}}function T(e){switch(e){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function L(e){e.push(e.shift())}function M(e){let{device:t,source:i,target:n}=e;var o;(!n||n.byteLength<i.byteLength)&&(null==(o=n)||o.destroy(),n=t.createBuffer({byteLength:i.byteLength,usage:i.usage}));return n}function k(e){let{device:t,buffer:i,attribute:n,fromLength:o,toLength:s,fromStartIndices:r,getData:a=(e=>e)}=e;const l=n.doublePrecision&&n.value instanceof Float64Array?2:1,c=n.size*l,d=n.byteOffset,u=n.settings.bytesPerElement<4?d/n.settings.bytesPerElement*4:d,h=n.startIndices,p=r&&h,g=n.isConstant;if(!p&&i&&o>=s)return i;const f=n.value instanceof Float64Array?Float32Array:n.value.constructor,m=g?n.value:new f(n.getBuffer().readSyncWebGL(d,s*f.BYTES_PER_ELEMENT).buffer);if(n.settings.normalized&&!g){const e=a;a=(t,i)=>n.normalizeConstant(e(t,i))}const v=g?(e,t)=>a(m,t):(e,t)=>a(m.subarray(e+d,e+d+c),t),y=i?new Float32Array(i.readSyncWebGL(u,4*o).buffer):new Float32Array(0),_=new Float32Array(s);var b;(function(e){let{source:t,target:i,size:n,getData:o,sourceStartIndices:s,targetStartIndices:r}=e;if(!s||!r)return C({source:t,target:i,size:n,getData:o}),i;let a=0,l=0;const c=o&&((e,t)=>o(e+l,t)),d=Math.min(s.length,r.length);for(let u=1;u<d;u++){const e=s[u]*n,o=r[u]*n;C({source:t.subarray(a,e),target:i,start:l,end:o,size:n,getData:c}),a=e,l=o}l<i.length&&C({source:[],target:i,start:l,size:n,getData:c})}({source:y,target:_,sourceStartIndices:r,targetStartIndices:h,size:c,getData:v}),!i||i.byteLength<_.byteLength+u)&&(null==(b=i)||b.destroy(),i=t.createBuffer({byteLength:_.byteLength+u,usage:35050}));return i.write(_,u),i}var E=i(96129);class I{constructor(e){let{device:t,attribute:i,timeline:n}=e;this.buffers=[],this.currentLength=0,this.device=t,this.transition=new E.Z(n),this.attribute=i,this.attributeInTransition=function(e){const{device:t,settings:i,value:n}=e,o=new _(t,i);return o.setData({value:n instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:i.normalized}),o}(i),this.currentStartIndices=i.startIndices}get inProgress(){return this.transition.inProgress}start(e,t,i){void 0===i&&(i=1/0),this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=function(e,t){const{doublePrecision:i,settings:n,value:o,size:s}=e,r=i&&o instanceof Float64Array?2:1;let a=0;const{shaderAttributes:l}=e.settings;if(l)for(const d of Object.values(l)){var c;a=Math.max(a,null!=(c=d.vertexOffset)?c:0)}return(n.noAlloc?o.length:(t+a)*s)*r}(this.attribute,t),this.transition.start({...e,duration:i})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}const A="#version 300 es\n#define SHADER_NAME interpolation-transition-vertex-shader\n\nuniform float time;\nin ATTRIBUTE_TYPE aFrom;\nin ATTRIBUTE_TYPE aTo;\nout ATTRIBUTE_TYPE vCurrent;\n\nvoid main(void) {\n  vCurrent = mix(aFrom, aTo, time);\n  gl_Position = vec4(0.0);\n}\n",z="#version 300 es\n#define SHADER_NAME interpolation-transition-vertex-shader\n\nuniform float time;\nin ATTRIBUTE_TYPE aFrom;\nin ATTRIBUTE_TYPE aFrom64Low;\nin ATTRIBUTE_TYPE aTo;\nin ATTRIBUTE_TYPE aTo64Low;\nout ATTRIBUTE_TYPE vCurrent;\nout ATTRIBUTE_TYPE vCurrent64Low;\n\nvec2 mix_fp64(vec2 a, vec2 b, float x) {\n  vec2 range = sub_fp64(b, a);\n  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));\n}\n\nvoid main(void) {\n  for (int i=0; i<ATTRIBUTE_SIZE; i++) {\n    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), time);\n    vCurrent[i] = value.x;\n    vCurrent64Low[i] = value.y;\n  }\n  gl_Position = vec4(0.0);\n}\n";function R(e){return e.doublePrecision&&e.value instanceof Float64Array}const O="#version 300 es\n#define SHADER_NAME spring-transition-vertex-shader\n\n#define EPSILON 0.00001\n\nuniform float stiffness;\nuniform float damping;\nin ATTRIBUTE_TYPE aPrev;\nin ATTRIBUTE_TYPE aCur;\nin ATTRIBUTE_TYPE aTo;\nout ATTRIBUTE_TYPE vNext;\nout float vIsTransitioningFlag;\n\nATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {\n  ATTRIBUTE_TYPE velocity = cur - prev;\n  ATTRIBUTE_TYPE delta = dest - cur;\n  ATTRIBUTE_TYPE spring = delta * stiffness;\n  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;\n  return spring + damper + velocity + cur;\n}\n\nvoid main(void) {\n  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;\n  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;\n\n  vNext = getNextValue(aCur, aPrev, aTo);\n  gl_Position = vec4(0, 0, 0, 1);\n  gl_PointSize = 100.0;\n}\n",N="#version 300 es\n#define SHADER_NAME spring-transition-is-transitioning-fragment-shader\n\nin float vIsTransitioningFlag;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  if (vIsTransitioningFlag == 0.0) {\n    discard;\n  }\n  fragColor = vec4(1.0);\n}";const j={interpolation:class extends I{constructor(e){let{device:t,attribute:i,timeline:n}=e;super({device:t,attribute:i,timeline:n}),this.type="interpolation",this.transform=function(e,t){const i=t.size,n=S(i),o=T(i),s=t.getBufferLayout();if(R(t))return new x.H(e,{vs:z,bufferLayout:[{name:"aFrom",byteStride:8*i,attributes:[{attribute:"aFrom",format:o,byteOffset:0},{attribute:"aFrom64Low",format:o,byteOffset:4*i}]},{name:"aTo",byteStride:8*i,attributes:[{attribute:"aTo",format:o,byteOffset:0},{attribute:"aTo64Low",format:o,byteOffset:4*i}]}],modules:[P.n2],defines:{ATTRIBUTE_TYPE:n,ATTRIBUTE_SIZE:i},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0});return new x.H(e,{vs:A,bufferLayout:[{name:"aFrom",format:o},{name:"aTo",format:s.attributes[0].format}],defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"],disableWarnings:!0})}(t,i)}start(e,t){const i=this.currentLength,n=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0)return void this.transition.cancel();const{buffers:o,attribute:s}=this;L(o),o[0]=k({device:this.device,buffer:o[0],attribute:s,fromLength:i,toLength:this.currentLength,fromStartIndices:n,getData:e.enter}),o[1]=M({device:this.device,source:o[0],target:o[1]}),this.setBuffer(o[1]);const{transform:r}=this,a=r.model;let l=Math.floor(this.currentLength/s.size);R(s)&&(l/=2),a.setVertexCount(l),s.isConstant?(a.setAttributes({aFrom:o[0]}),a.setConstantAttributes({aTo:s.value})):a.setAttributes({aFrom:o[0],aTo:s.getBuffer()}),r.transformFeedback.setBuffers({vCurrent:o[1]})}onUpdate(){const{duration:e,easing:t}=this.settings,{time:i}=this.transition;let n=i/e;t&&(n=t(n));const{model:o}=this.transform;o.setUniforms({time:n}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}},spring:class extends I{constructor(e){let{device:t,attribute:i,timeline:n}=e;super({device:t,attribute:i,timeline:n}),this.type="spring",this.texture=function(e){return e.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}(t),this.framebuffer=function(e,t){return e.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[t]})}(t,this.texture),this.transform=function(e,t){const i=S(t.size),n=T(t.size);return new x.H(e,{vs:O,fs:N,bufferLayout:[{name:"aPrev",format:n},{name:"aCur",format:n},{name:"aTo",format:t.getBufferLayout().attributes[0].format}],varyings:["vNext"],defines:{ATTRIBUTE_TYPE:i},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}(t,i)}start(e,t){const i=this.currentLength,n=this.currentStartIndices;super.start(e,t);const{buffers:o,attribute:s}=this;for(let a=0;a<2;a++)o[a]=k({device:this.device,buffer:o[a],attribute:s,fromLength:i,toLength:this.currentLength,fromStartIndices:n,getData:e.enter});o[2]=M({device:this.device,source:o[0],target:o[2]}),this.setBuffer(o[1]);const{model:r}=this.transform;r.setVertexCount(Math.floor(this.currentLength/s.size)),s.isConstant?r.setConstantAttributes({aTo:s.value}):r.setAttributes({aTo:s.getBuffer()})}onUpdate(){const{buffers:e,transform:t,framebuffer:i,transition:n}=this,o=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]}),t.model.setUniforms({stiffness:o.stiffness,damping:o.damping}),t.run({framebuffer:i,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),L(e),this.setBuffer(e[1]);this.device.readPixelsToArrayWebGL(i)[0]>0||n.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}};class D{constructor(e,t){let{id:i,timeline:n}=t;if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=i,this.device=e,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update(e){let{attributes:t,transitions:i,numInstances:n}=e;this.numInstances=n||1;for(const o in t){const e=t[o],n=e.getTransitionSetting(i);n&&this._updateAttribute(o,e,n)}for(const o in this.transitions){const e=t[o];e&&e.getTransitionSetting(i)||this._removeTransition(o)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const i=this.transitions[t];i.inProgress&&(e[t]=i.attributeInTransition)}return e}run(){if(0===this.numInstances)return!1;for(const t in this.transitions){this.transitions[t].update()&&(this.needsRedraw=!0)}const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,i){const n=this.transitions[e];let o=!n||n.type!==i.type;if(o){n&&this._removeTransition(e);const s=j[i.type];s?this.transitions[e]=new s({attribute:t,timeline:this.timeline,device:this.device}):(d.Z.error("unsupported transition type '"+i.type+"'")(),o=!1)}(o||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}}const F="attributeManager.invalidate";class V{constructor(e,t){let{id:i="attribute-manager",stats:n,timeline:o}=void 0===t?{}:t;this.mergeBoundsMemoized=(0,b.Z)(c.cc),this.id=i,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new D(e,{id:i+"-transitions",timeline:o}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e){void 0===e&&(e={clearRedrawFlags:!1});const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const t of e)void 0!==this.attributes[t]&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const i=this._invalidateTrigger(e,t);(0,w.Z)(F,this,e,i)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);(0,w.Z)(F,this,"all")}update(e){let{data:t,numInstances:i,startIndices:n=null,transitions:o,props:s={},buffers:r={},context:a={}}=e,l=!1;(0,w.Z)("attributeManager.updateStart",this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const c in this.attributes){const e=this.attributes[c],o=e.settings.accessor;e.startIndices=n,e.numInstances=i,s[c]&&d.Z.removed("props."+c,"data.attributes."+c)(),e.setExternalBuffer(r[c])||e.setBinaryValue("string"==typeof o?r[o]:void 0,t.startIndices)||"string"==typeof o&&!r[o]&&e.setConstantValue(s[o])||e.needsUpdate()&&(l=!0,this._updateAttribute({attribute:e,numInstances:i,data:t,props:s,context:a})),this.needsRedraw=this.needsRedraw||e.needsRedraw()}l&&(0,w.Z)("attributeManager.updateEnd",this,i),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:i,transitions:o})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const t=e.map((e=>{var t;return null==(t=this.attributes[e])?void 0:t.getBounds()}));return this.mergeBoundsMemoized(t)}getChangedAttributes(e){void 0===e&&(e={clearChangedFlags:!1});const{attributes:t,attributeTransitionManager:i}=this,n={...i.getAttributes()};for(const o in t){const s=t[o];s.needsRedraw(e)&&!i.hasAttribute(o)&&(n[o]=s)}return n}getBufferLayouts(e){return Object.values(this.getAttributes()).map((t=>t.getBufferLayout(e)))}_add(e,t){for(const i in e){const n=e[i],o={...n,id:i,size:(n.isIndexed?1:n.size)||1,...t};this.attributes[i]=new _(this.device,o)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes){this.attributes[t].getUpdateTriggers().forEach((i=>{e[i]||(e[i]=[]),e[i].push(t)}))}this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:i,updateTriggers:n}=this,o=n[e];return o&&o.forEach((e=>{const n=i[e];n&&n.setNeedsUpdate(n.id,t)})),o}_updateAttribute(e){const{attribute:t,numInstances:i}=e;if((0,w.Z)("attribute.updateStart",t),t.constant)return void t.setConstantValue(t.value);t.allocate(i)&&(0,w.Z)("attribute.allocate",t,i);t.updateBuffer(e)&&(this.needsRedraw=!0,(0,w.Z)("attribute.updateEnd",t,i))}}},42701:(e,t,i)=>{i.d(t,{M:()=>o});const n={interpolation:{duration:0,easing:e=>e},spring:{stiffness:.05,damping:.5}};function o(e,t){if(!e)return null;Number.isFinite(e)&&(e={type:"interpolation",duration:e});const i=e.type||"interpolation";return{...n[i],...t,...e,type:i}}},96677:(e,t,i)=>{i.d(t,{Z:()=>a});var n=i(45286),o=i(84911),s=i(63619),r=i(44206);class a extends n.Z{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every((e=>e.isLoaded))}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo(e){let{info:t}=e;const{object:i}=t;return i&&i.__source&&i.__source.parent&&i.__source.parent.id===this.id?(t.object=i.__source.object,t.index=i.__source.index,t):t}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){const{_subLayerProps:i}=this.props;return i&&i[e]&&i[e].type||t}getSubLayerRow(e,t,i){return e.__source={parent:this,object:t,index:i},e}getSubLayerAccessor(e){if("function"==typeof e){const t={index:-1,data:this.props.data,target:[]};return(i,n)=>i&&i.__source?(t.index=i.__source.index,e(i.__source.object,t)):e(i,n)}return e}getSubLayerProps(e){var t;void 0===e&&(e={});const{opacity:i,pickable:n,visible:o,parameters:s,getPolygonOffset:a,highlightedObjectIndex:l,autoHighlight:c,highlightColor:d,coordinateSystem:u,coordinateOrigin:h,wrapLongitude:p,positionFormat:g,modelMatrix:f,extensions:m,fetch:v,operation:y,_subLayerProps:_}=this.props,b={id:"",updateTriggers:{},opacity:i,pickable:n,visible:o,parameters:s,getPolygonOffset:a,highlightedObjectIndex:l,autoHighlight:c,highlightColor:d,coordinateSystem:u,coordinateOrigin:h,wrapLongitude:p,positionFormat:g,modelMatrix:f,extensions:m,fetch:v,operation:y},w=_&&e.id&&_[e.id],x=w&&w.updateTriggers,P=e.id||"sublayer";if(w){const t=this.props[r.Wb],i=e.type?e.type._propTypes:{};for(const e in w){const n=i[e]||t[e];n&&"accessor"===n.type&&(w[e]=this.getSubLayerAccessor(w[e]))}}Object.assign(b,e,w),b.id=this.props.id+"-"+P,b.updateTriggers={all:null==(t=this.props.updateTriggers)?void 0:t.all,...e.updateTriggers,...x};for(const r of m){const e=r.getSubLayerProps.call(this,r);e&&Object.assign(b,e,{updateTriggers:Object.assign(b.updateTriggers,e.updateTriggers)})}return b}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let i=this.internalState.subLayers;const n=!i||this.needsUpdate();if(n){const e=this.renderLayers();i=(0,s.x)(e,Boolean),this.internalState.subLayers=i}(0,o.Z)("compositeLayer.renderLayers",this,n,i);for(const o of i)o.parent=this}}a.layerName="CompositeLayer"},19845:(e,t,i)=>{i.d(t,{Df:()=>o,FP:()=>a,iI:()=>r,zG:()=>s});var n=i(70575);const o={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(o,"IDENTITY",{get:()=>(n.Z.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const s={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},r={common:0,meters:1,pixels:2},a={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}}},47968:(e,t,i)=>{i.d(t,{Z:()=>H});var n=i(93732),o=i(76867),s=i(44206),r=i(70575),a=i(84911),l=i(63619),c=i(95328),d=i(39470);class u{constructor(e,t,i){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=i,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then((()=>this.getData()))}setData(e,t){if(e===this._data&&!t)return;this._data=e;const i=++this._loadCount;let n=e;"string"==typeof e&&(n=(0,d.z)(e)),n instanceof Promise?(this.isLoaded=!1,this._loader=n.then((e=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=e)})).catch((e=>{this._loadCount===i&&(this.isLoaded=!0,this._error=e||!0)}))):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const o of this._subscribers)o.onChange(this.getData())}}class h{constructor(e){var t;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:null==(t=e.device)?void 0:t.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return!!e.startsWith(this.protocol)||e in this._resources}add(e){let{resourceId:t,data:i,forceUpdate:n=!1,persistent:o=!0}=e,s=this._resources[t];s?s.setData(i,n):(s=new u(t,i,this._context),this._resources[t]=s),s.persistent=o}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe(e){let{consumerId:t}=e;const i=this._consumers[t];if(i){for(const e in i){const t=i[e],n=this._resources[t.resourceId];n&&n.unsubscribe(t)}delete this._consumers[t],this.prune()}}subscribe(e){let{resourceId:t,onChange:i,consumerId:n,requestId:o="default"}=e;const{_resources:s,protocol:r}=this;t.startsWith(r)&&(t=t.replace(r,""),s[t]||this.add({resourceId:t,data:null,persistent:!1}));const a=s[t];if(this._track(n,o,a,i),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout((()=>this._prune()),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,i,n){const o=this._consumers,s=o[e]=o[e]||{};let r=s[t];const a=r&&r.resourceId&&this._resources[r.resourceId];a&&(a.unsubscribe(r),this.prune()),i&&(r?(r.onChange=n,r.resourceId=i.id):r={onChange:n,resourceId:i.id},s[t]=r,i.subscribe(r))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];t.persistent||t.inUse()||(t.delete(),delete this._resources[e])}}}var p=i(36355);class g{constructor(e,t){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=e=>{(0,a.Z)("layerManager.activateViewport",this,e),e&&(this.context.viewport=e)};const{deck:i,stats:s,viewport:r,timeline:l}=t||{};this.layers=[],this.resourceManager=new h({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:null==e?void 0:e.gl,deck:i,shaderAssembler:(0,o.ik)(),defaultShaderModules:[],renderPass:void 0,stats:s||new c.Z({id:"deck.gl"}),viewport:r||new p.Z({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:l||new n.T,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e){void 0===e&&(e={clearRedrawFlags:!1});let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const n=i.getNeedsRedraw(e);t=t||n}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers(e){let{layerIds:t}=void 0===e?{}:e;return t?this.layers.filter((e=>t.find((t=>0===e.id.indexOf(t))))):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){(0,a.Z)("layerManager.setLayers",this,t,e),this._lastRenderedLayers=e;const i=(0,l.x)(e,Boolean);for(const n of i)n.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: "+e),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:t}=this.context;t.find((t=>t.name===e.name))||(t.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:t}=this.context,i=t.findIndex((t=>t.name===e.name));i>=0&&(t.splice(i,1),this._defaultShaderModulesChanged=!0)}_handleError(e,t,i){i.raiseError(t,e+" of "+i)}_updateLayers(e,t){const i={};for(const s of e)i[s.id]?r.Z.warn("Multiple old layers with same id "+s.id)():i[s.id]=s;if(this._defaultShaderModulesChanged){for(const t of e)t.setNeedsUpdate(),t.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const n=[];this._updateSublayersRecursively(t,i,n),this._finalizeOldLayers(i);let o=!1;for(const s of n)if(s.hasUniformTransition()){o="Uniform transition in "+s;break}this._needsUpdate=o,this.layers=n}_updateSublayersRecursively(e,t,i){for(const o of e){o.context=this.context;const e=t[o.id];null===e&&r.Z.warn("Multiple new layers with same id "+o.id)(),t[o.id]=null;let s=null;try{this._debug&&e!==o&&o.validateProps(),e?(this._transferLayerState(e,o),this._updateLayer(o)):this._initializeLayer(o),i.push(o),s=o.isComposite?o.getSubLayers():null}catch(n){this._handleError("matching",n,o)}s&&this._updateSublayersRecursively(s,t,i)}}_finalizeOldLayers(e){for(const t in e){const i=e[t];i&&this._finalizeLayer(i)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=s.dt.INITIALIZED}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=s.dt.MATCHED,t!==e&&(e.lifecycle=s.dt.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||"finalized "+e,e.lifecycle=s.dt.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=s.dt.FINALIZED}catch(t){this._handleError("finalization",t,e)}}}var f=i(8557);class m{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e){void 0===e&&(e={clearRedrawFlags:!1});const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter((t=>t.containsPixel(e))):this._viewports}getViews(){const e={};return this.views.forEach((t=>{e[t.id]=t})),e}getView(e){return this.views.find((t=>t.id===e))}getViewState(e){const t="string"==typeof e?this.getView(e):e,i=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(i):i}getViewport(e){return this._viewportMap[e]}unproject(e,t){const i=this.getViewports(),n={x:e[0],y:e[1]};for(let o=i.length-1;o>=0;--o){const s=i[o];if(s.containsPixel(n)){const i=e.slice();return i[0]-=s.x,i[1]-=s.y,s.unproject(i,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){e===this.width&&t===this.height||(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=(0,l.x)(e,Boolean);this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){if(e){!(0,f.v)(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e}else r.Z.warn("missing `viewState` or `initialViewState`")()}_createController(e,t){return new(0,t.type)({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:t=>{var i;return null==(i=this.getView(e.id))?void 0:i.makeViewport({viewState:t,width:this.width,height:this.height})}})}_updateController(e,t,i,n){const o=e.controller;if(o&&i){const s={...t,...o,id:e.id,x:i.x,y:i.y,width:i.width,height:i.height};return n&&n.constructor===o.type||(n=this._createController(e,s)),n&&n.setProps(s),n}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let n=e.length;n--;){const o=e[n],s=this.getViewState(o),r=o.makeViewport({viewState:s,width:this.width,height:this.height});let a=t[o.id];const l=Boolean(o.controller);l&&!a&&(i=!0),!i&&l||!a||(a.finalize(),a=null),this.controllers[o.id]=this._updateController(o,s,r,a),r&&this._viewports.unshift(r)}for(const n in t){const e=t[n];e&&!this.controllers[n]&&e.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach((e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)}))}_diffViews(e,t){return e.length!==t.length||e.some(((i,n)=>!e[n].equals(t[n])))}}var v=i(38861),y=i(69523);const _=new y.Z;class b{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find((t=>t.id===e.id))){const i=t.findIndex((t=>{return i=e,(null!=(n=t.order)?n:1/0)-(null!=(o=i.order)?o:1/0)>0;var i,n,o}));i<0?t.push(e):t.splice(i,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&((0,f.v)(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e){void 0===e&&(e={clearRedrawFlags:!1});const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const n of this.effects)t[n.id]=n;const i=[];for(const n of e){const e=t[n.id];let o=n;e&&e!==n?e.setProps?(e.setProps(n.props),o=e):e.cleanup(this._context):e||n.setup(this._context),i.push(o),delete t[n.id]}for(const n in t)t[n].cleanup(this._context);this.effects=i,this._resolvedEffects=i.concat(this._defaultEffects),e.some((e=>e instanceof y.Z))||this._resolvedEffects.push(_),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}var w=i(64321);class x extends w.Z{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}var P=i(88736);class C{constructor(e){this.device=e,this.gl=e.gl,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new x(e),this.pickLayersPass=new P.Z(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,i={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};i.effects&&this._preRender(i.effects,i);const n=this.lastPostProcessEffect?this.renderBuffers[0]:i.target;this.lastPostProcessEffect&&(i.clearColor=[0,0,0,0],i.clearCanvas=!0);const o=t.render({...i,target:n});i.effects&&this._postRender(i.effects,i),this.renderCount++,(0,a.Z)("deckRenderer.renderLayers",this,o,e)}needsRedraw(e){void 0===e&&(e={clearRedrawFlags:!1});const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const i of e)t.preRenderStats[i.id]=i.preRender(t),i.postRender&&(this.lastPostProcessEffect=i.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,t=this.device.canvasContext.getDrawingBufferSize();0===e.length&&[0,1].map((t=>{const i=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:"deck-renderbuffer-"+t,colorAttachments:[i]}))}));for(const i of e)i.resize(t)}_postRender(e,t){const{renderBuffers:i}=this,n={...t,inputBuffer:i[0],swapBuffer:i[1]};for(const o of e)if(o.postRender){n.target=o.id===this.lastPostProcessEffect?t.target:void 0;const e=o.postRender(n);n.inputBuffer=e,n.swapBuffer=e===i[0]?i[1]:i[0]}}}const S={pickedColor:null,pickedObjectIndex:-1};function T(e){let{pickedColors:t,decodePickingColor:i,deviceX:n,deviceY:o,deviceRadius:s,deviceRect:a}=e;const{x:l,y:c,width:d,height:u}=a;let h=s*s,p=-1,g=0;for(let r=0;r<u;r++){const e=r+c-o,i=e*e;if(i>h)g+=4*d;else for(let o=0;o<d;o++){if(t[g+3]-1>=0){const e=o+l-n,t=e*e+i;t<=h&&(h=t,p=g)}g+=4}}if(p>=0){const e=t.slice(p,p+4),n=i(e);if(n){const t=Math.floor(p/4/d),i=p/4-t*d;return{...n,pickedColor:e,pickedX:l+i,pickedY:c+t}}r.Z.error("Picked non-existent layer. Is picking buffer corrupt?")()}return S}function L(e){let t,{pickInfo:i,viewports:n,pixelRatio:o,x:s,y:r,z:a}=e,l=n[0];if(n.length>1&&(l=function(e,t){for(let i=e.length-1;i>=0;i--){const n=e[i];if(n.containsPixel(t))return n}return e[0]}((null==i?void 0:i.pickedViewports)||n,{x:s,y:r})),l){const e=[s-l.x,r-l.y];void 0!==a&&(e[2]=a),t=l.unproject(e)}return{color:null,layer:null,viewport:l,index:-1,picked:!1,x:s,y:r,pixel:[s,r],coordinate:t,devicePixel:i&&"pickedX"in i?[i.pickedX,i.pickedY]:void 0,pixelRatio:o}}function M(e){const{pickInfo:t,lastPickedInfo:i,mode:n,layers:o}=e,{pickedColor:s,pickedLayer:r,pickedObjectIndex:a}=t,l=r?[r]:[];if("hover"===n){const e=i.index,t=i.layerId,n=r?r.props.id:null;if(n!==t||a!==e){if(n!==t){const e=o.find((e=>e.props.id===t));e&&l.unshift(e)}i.layerId=n,i.index=a,i.info=null}}const c=L(e),d=new Map;return d.set(null,c),l.forEach((e=>{let t={...c};e===r&&(t.color=s,t.index=a,t.picked=!0),t=k({layer:e,info:t,mode:n});const o=t.layer;e===r&&"hover"===n&&(i.info=t),d.set(o.id,t),"hover"===n&&o.updateAutoHighlight(t)})),d}function k(e){let{layer:t,info:i,mode:n}=e;for(;t&&i;){const e=i.layer||null;i.sourceLayer=e,i.layer=t,i=t.getPickingInfo({info:i,mode:n,sourceLayer:e}),t=t.parent}return i}class E{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new P.Z(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject(e,t){let{x:i,y:n,layers:o,viewports:s}=e;void 0===t&&(t=this.lastPickedInfo.info);const r=t&&t.layer&&t.layer.id,a=t&&t.viewport&&t.viewport.id,l=r?o.find((e=>e.id===r)):null,c=a&&s.find((e=>e.id===a))||s[0],d=c&&c.unproject([i-c.x,n-c.y]),u={x:i,y:n,viewport:c,coordinate:d,layer:l};return{...t,...u}}_resizeBuffer(){var e,t;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const e=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=e}const i=this.device.gl;null==(e=this.pickingFBO)||e.resize({width:i.canvas.width,height:i.canvas.height}),null==(t=this.depthFBO)||t.resize({width:i.canvas.width,height:i.canvas.height})}_getPickable(e){if(!1===this._pickable)return null;const t=e.filter((e=>this.pickLayersPass.shouldDrawLayer(e)&&!e.isComposite));return t.length?t:null}_pickClosestObject(e){let{layers:t,views:i,viewports:n,x:o,y:s,radius:r=0,depth:a=1,mode:l="query",unproject3D:c,onViewportActive:d,effects:u}=e;const h=this.device.canvasContext.cssToDeviceRatio(),p=this._getPickable(t);if(!p||0===n.length)return{result:[],emptyInfo:L({viewports:n,x:o,y:s,pixelRatio:h})};this._resizeBuffer();const g=this.device.canvasContext.cssToDevicePixels([o,s],!0),f=[g.x+Math.floor(g.width/2),g.y+Math.floor(g.height/2)],m=Math.round(r*h),{width:v,height:y}=this.pickingFBO,_=this._getPickingRect({deviceX:f[0],deviceY:f[1],deviceRadius:m,deviceWidth:v,deviceHeight:y}),b={x:o-r,y:s-r,width:2*r+1,height:2*r+1};let w;const x=[],P=new Set;for(let C=0;C<a;C++){let e,t;if(_){e=T({...this._drawAndSample({layers:p,views:i,viewports:n,onViewportActive:d,deviceRect:_,cullRect:b,effects:u,pass:"picking:"+l}),deviceX:f[0],deviceY:f[1],deviceRadius:m,deviceRect:_})}else e={pickedColor:null,pickedObjectIndex:-1};if(e.pickedLayer&&c&&this.depthFBO){const{pickedColors:o}=this._drawAndSample({layers:[e.pickedLayer],views:i,viewports:n,onViewportActive:d,deviceRect:{x:e.pickedX,y:e.pickedY,width:1,height:1},cullRect:b,effects:u,pass:"picking:"+l+":z"},!0);o[3]&&(t=o[0])}e.pickedLayer&&C+1<a&&(P.add(e.pickedLayer),e.pickedLayer.disablePickingIndex(e.pickedObjectIndex)),w=M({pickInfo:e,lastPickedInfo:this.lastPickedInfo,mode:l,layers:p,viewports:n,x:o,y:s,z:t,pixelRatio:h});for(const i of w.values())i.layer&&x.push(i);if(!e.pickedColor)break}for(const C of P)C.restorePickingColors();return{result:x,emptyInfo:w.get(null)}}_pickVisibleObjects(e){let{layers:t,views:i,viewports:n,x:o,y:s,width:a=1,height:l=1,mode:c="query",maxObjects:d=null,onViewportActive:u,effects:h}=e;const p=this._getPickable(t);if(!p||0===n.length)return[];this._resizeBuffer();const g=this.device.canvasContext.cssToDeviceRatio(),f=this.device.canvasContext.cssToDevicePixels([o,s],!0),m=f.x,v=f.y+f.height,y=this.device.canvasContext.cssToDevicePixels([o+a,s+l],!0),_=y.x+y.width,b=y.y,w={x:m,y:b,width:_-m,height:v-b},x=function(e){let{pickedColors:t,decodePickingColor:i}=e;const n=new Map;if(t)for(let o=0;o<t.length;o+=4)if(t[o+3]-1>=0){const e=t.slice(o,o+4),s=e.join(",");if(!n.has(s)){const t=i(e);t?n.set(s,{...t,color:e}):r.Z.error("Picked non-existent layer. Is picking buffer corrupt?")()}}return Array.from(n.values())}(this._drawAndSample({layers:p,views:i,viewports:n,onViewportActive:u,deviceRect:w,cullRect:{x:o,y:s,width:a,height:l},effects:h,pass:"picking:"+c})),P=new Map,C=[],S=Number.isFinite(d);for(let r=0;r<x.length;r++){var T;if(S&&C.length>=d)break;const e=x[r];let t={color:e.pickedColor,layer:null,index:e.pickedObjectIndex,picked:!0,x:o,y:s,pixelRatio:g};t=k({layer:e.pickedLayer,info:t,mode:c});const i=t.layer.id;P.has(i)||P.set(i,new Set);const n=P.get(i),a=null!=(T=t.object)?T:t.index;n.has(a)||(n.add(a),C.push(t))}return C}_drawAndSample(e,t){let{layers:i,views:n,viewports:o,onViewportActive:s,deviceRect:r,cullRect:a,effects:l,pass:c}=e;void 0===t&&(t=!1);const d=t?this.depthFBO:this.pickingFBO,u={layers:i,layerFilter:this.layerFilter,views:n,viewports:o,onViewportActive:s,pickingFBO:d,deviceRect:r,cullRect:a,effects:l,pass:c,pickZ:t,preRenderStats:{}};for(const y of l)y.useInPicking&&(u.preRenderStats[y.id]=y.preRender(u));const{decodePickingColor:h}=this.pickLayersPass.render(u),{x:p,y:g,width:f,height:m}=r,v=new(t?Float32Array:Uint8Array)(f*m*4);return this.device.readPixelsToArrayWebGL(d,{sourceX:p,sourceY:g,sourceWidth:f,sourceHeight:m,target:v}),{pickedColors:v,decodePickingColor:h}}_getPickingRect(e){let{deviceX:t,deviceY:i,deviceRadius:n,deviceWidth:o,deviceHeight:s}=e;const r=Math.max(0,t-n),a=Math.max(0,i-n),l=Math.min(o,t+n+1)-r,c=Math.min(s,i+n+1)-a;return l<=0||c<=0?null:{x:r,y:a,width:l,height:c}}}var I=i(19845);const A={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},z="top-left",R="__root";class O{constructor(e){let{deck:t,parentElement:i}=e;this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=t,this.parentElement=i}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!(0,f.v)(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find((t=>t.id===e.id))||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const t={};for(const i of this.resolvedWidgets)t[i.id]=i;this.resolvedWidgets.length=0;for(const i of this.defaultWidgets)t[i.id]=null,this.resolvedWidgets.push(i);for(let i of e){const e=t[i.id];e?e.viewId!==i.viewId||e.placement!==i.placement?(this._remove(e),this._add(i)):i!==e&&(e.setProps(i.props),i=e):this._add(i),t[i.id]=null,this.resolvedWidgets.push(i)}for(const i in t){const e=t[i];e&&this._remove(e)}this.widgets=e}_add(e){const{viewId:t=null,placement:i=z}=e,n=e.onAdd({deck:this.deck,viewId:t});n&&this._getContainer(t,i).append(n),e._element=n}_remove(e){e.onRemove(),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,t){const i=e||R;let n=this.containers[i];var o;n||(n=document.createElement("div"),n.style.pointerEvents="none",n.style.position="absolute",n.style.overflow="hidden",null==(o=this.parentElement)||o.append(n),this.containers[i]=n);let s=n.querySelector("."+t);return s||(s=document.createElement("div"),s.className=t,s.style.position="absolute",s.style.zIndex="2",Object.assign(s.style,A[t]),n.append(s)),s}_updateContainers(){const e=this.deck.width,t=this.deck.height;for(const i in this.containers){const n=this.lastViewports[i]||null,o=i===R||n,s=this.containers[i];o?(s.style.display="block",s.style.left=(n?n.x:0)+"px",s.style.top=(n?n.y:0)+"px",s.style.width=(n?n.width:e)+"px",s.style.height=(n?n.height:t)+"px"):s.style.display="none"}}onRedraw(e){let{viewports:t,layers:i}=e;const n=t.reduce(((e,t)=>(e[t.id]=t,e)),{}),{lastViewports:o}=this;for(const s of this.getWidgets()){const{viewId:e}=s;if(e){const t=n[e];t&&(s.onViewportChange&&!t.equals(o[e])&&s.onViewportChange(t),null==s.onRedraw||s.onRedraw({viewports:[t],layers:i}))}else{if(s.onViewportChange)for(const e of t)e.equals(o[e.id])||s.onViewportChange(e);null==s.onRedraw||s.onRedraw({viewports:t,layers:i})}}this.lastViewports=n,this._updateContainers()}onHover(e,t){for(const n of this.getWidgets()){var i;const{viewId:o}=n;o&&o!==(null==(i=e.viewport)?void 0:i.id)||null==n.onHover||n.onHover(e,t)}}onEvent(e,t){const i=I.FP[t.type];if(i)for(const s of this.getWidgets()){var n;const{viewId:r}=s;var o;if(!r||r===(null==(n=e.viewport)?void 0:n.id))null==(o=s[i.handler])||o.call(s,e,t)}}}const N={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class j{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd(e){let{deck:t}=e;const i=document.createElement("div");return i.className="deck-tooltip",Object.assign(i.style,N),this.deck=t,this.element=i,i}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var t;this.isVisible&&e.id===(null==(t=this.lastViewport)?void 0:t.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:t}=this,i=t&&t.props.getTooltip;if(!i)return;const n=i(e);this.lastViewport=e.viewport,this.setTooltip(n,e.x,e.y)}setTooltip(e,t,i){const n=this.element;if(n){if("string"==typeof e)n.innerText=e;else{if(!e)return this.isVisible=!1,void(n.style.display="none");e.text&&(n.innerText=e.text),e.html&&(n.innerHTML=e.html),e.className&&(n.className=e.className)}this.isVisible=!0,n.style.display="block",n.style.transform="translate("+t+"px, "+i+"px)",e&&"object"==typeof e&&"style"in e&&Object.assign(n.style,e.style)}}}var D=i(92232),F=i(77322),V=i(86602),B=i(86293),Z=i(9618),U=i(56134),W=i(46149);function G(){}const q={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{type:"webgl"},gl:null,glOptions:{},canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:G,onWebGLInitialized:G,onResize:G,onViewStateChange:G,onInteractionStateChange:G,onBeforeRender:G,onAfterRender:G,onLoad:G,onError:e=>r.Z.error(e.message,e.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:e=>{let{isDragging:t}=e;return t?"grabbing":"grab"},getTooltip:null,debug:!1,drawPickingColors:!1};class H{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new c.Z({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=e=>{const{_pickRequest:t}=this;if("pointerleave"===e.type)t.x=-1,t.y=-1,t.radius=0;else{if(e.leftButton||e.rightButton)return;{const i=e.offsetCenter;if(!i)return;t.x=i.x,t.y=i.y,t.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:t.x,y:t.y}),t.event=e},this._onEvent=e=>{const t=I.FP[e.type],i=e.offsetCenter;if(!t||!i||!this.layerManager)return;const n=this.layerManager.getLayers(),o=this.deckPicker.getLastPickedObject({x:i.x,y:i.y,layers:n,viewports:this.getViewports(i)},this._lastPointerDownInfo),{layer:s}=o,r=s&&(s[t.handler]||s.props[t.handler]),a=this.props[t.handler];let l=!1;r&&(l=r.call(s,o,e)),l||(null==a||a(o,e),this.widgetManager.onEvent(o,e))},this._onPointerDown=e=>{const t=e.offsetCenter,i=this._pick("pickObject","pickObject Time",{x:t.x,y:t.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=i.result[0]||i.emptyInfo},this.props={...q,...e},(e=this.props).viewState&&e.initialViewState&&r.Z.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device?this.device=e.device:e.gl&&(e.gl instanceof WebGLRenderingContext&&r.Z.error("WebGL1 context not supported.")(),this.device=B.j.attach(e.gl));let t=this.device;t||(V.u.registerDevices([B.j]),t=V.u.createDevice({...e.deviceProps,canvas:this._createCanvas(e)})),this.animationLoop=this._createAnimationLoop(t,e),this.setProps(e),e._typedArrayManagerProps&&D.Z.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,t,i,n,o,s,r,a,l,c;(null==(e=this.animationLoop)||e.stop(),null==(t=this.animationLoop)||t.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,null==(i=this.layerManager)||i.finalize(),this.layerManager=null,null==(n=this.viewManager)||n.finalize(),this.viewManager=null,null==(o=this.effectManager)||o.finalize(),this.effectManager=null,null==(s=this.deckRenderer)||s.finalize(),this.deckRenderer=null,null==(r=this.deckPicker)||r.finalize(),this.deckPicker=null,null==(a=this.eventManager)||a.destroy(),this.eventManager=null,null==(l=this.widgetManager)||l.finalize(),this.widgetManager=null,this.props.canvas||this.props.device||this.props.gl||!this.canvas)||(null==(c=this.canvas.parentElement)||c.removeChild(this.canvas),this.canvas=null)}setProps(e){var t;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&r.Z.removed("onLayerHover","onHover")(),"onLayerClick"in e&&r.Z.removed("onLayerClick","onClick")(),e.initialViewState&&!(0,f.v)(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const i=Object.create(this.props);Object.assign(i,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),null==(t=this.animationLoop)||t.setProps(i),this.layerManager&&(this.viewManager.setProps(i),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(i),this.effectManager.setProps(i),this.deckRenderer.setProps(i),this.deckPicker.setProps(i),this.widgetManager.setProps(i)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e){if(void 0===e&&(e={clearRedrawFlags:!1}),!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(e),n=this.layerManager.needsRedraw(e),o=this.effectManager.needsRedraw(e),s=this.deckRenderer.needsRedraw(e);return t=t||i||n||o||s,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return null!==this.viewManager}getViews(){return(0,W.Z)(this.viewManager),this.viewManager.views}getViewports(e){return(0,W.Z)(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t){void 0===t&&(t=!1);for(const i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var t;null==(t=this.layerManager)||t.removeDefaultShaderModule(e)}_pick(e,t,i){(0,W.Z)(this.deckPicker);const{stats:n}=this;n.get("Pick Count").incrementCount(),n.get(t).timeStart();const o=this.deckPicker[e]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return n.get(t).timeEnd(),o}_createCanvas(e){let t=e.canvas;if("string"==typeof t&&(t=document.getElementById(t),(0,W.Z)(t)),!t){t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay";(e.parent||document.body).appendChild(t)}return Object.assign(t.style,e.style),t}_setCanvasSize(e){if(!this.canvas)return;const{width:t,height:i}=e;if(t||0===t){const e=Number.isFinite(t)?t+"px":t;this.canvas.style.width=e}if(i||0===i){var n;const t=Number.isFinite(i)?i+"px":i;this.canvas.style.position=(null==(n=e.style)?void 0:n.position)||"absolute",this.canvas.style.height=t}}_updateCanvasSize(){var e,t;const{canvas:i}=this;if(!i)return;const n=null!=(e=i.clientWidth)?e:i.width,o=null!=(t=i.clientHeight)?t:i.height;var s,r;n===this.width&&o===this.height||(this.width=n,this.height=o,null==(s=this.viewManager)||s.setProps({width:n,height:o}),null==(r=this.layerManager)||r.activateViewport(this.getViewports()[0]),this.props.onResize({width:n,height:o}))}_createAnimationLoop(e,t){const{gl:i,onError:n,useDevicePixels:o}=t;return new Z.x({device:e,useDevicePixels:o,autoResizeDrawingBuffer:!i,autoResizeViewport:!1,onInitialize:e=>this._setDevice(e.device),onRender:this._onRenderFrame.bind(this),onError:n})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,t=Array.isArray(e)?e:e?[e]:[new v.Z({id:"default-view"})];return t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:e}=this;if(e.event){const{result:o,emptyInfo:s}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=o.length>0;let r=s,a=!1;for(const i of o){var t;r=i,a=(null==(t=i.layer)?void 0:t.onHover(i,e.event))||a}var i,n;if(!a)null==(i=(n=this.props).onHover)||i.call(n,r,e.event),this.widgetManager.onHover(r,e.event);e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var t,i;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=null==(i=this.device.canvasContext)?void 0:i.canvas);this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device instanceof B.j&&this.props.onWebGLInitialized(this.device.gl);const o=new n.T;o.play(),this.animationLoop.attachTimeline(o),this.eventManager=new U.Q(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const n in I.FP)this.eventManager.on(n,this._onEvent);this.viewManager=new m({timeline:o,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const s=this.viewManager.getViewports()[0];this.layerManager=new g(this.device,{deck:this,stats:this.stats,viewport:s,timeline:o}),this.effectManager=new b({deck:this,device:this.device}),this.deckRenderer=new C(this.device),this.deckPicker=new E(this.device),this.widgetManager=new O({deck:this,parentElement:null==(t=this.canvas)?void 0:t.parentElement}),this.widgetManager.addDefault(new j),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){var i;const{device:n,gl:o}=this.layerManager.context;this.props.onBeforeRender({device:n,gl:o});const s={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t};null==(i=this.deckRenderer)||i.renderLayers(s),"screen"===s.pass&&this.widgetManager.onRedraw({viewports:s.viewports,layers:s.layers}),this.props.onAfterRender({device:n,gl:o})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60==0&&(this._getMetrics(),this.stats.reset(),r.Z.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const i=V.u.stats.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}}H.defaultProps=q,H.VERSION=F.q},77322:(e,t,i)=>{i.d(t,{q:()=>l});var n=i(46324),o=i(28083),s=i(70575),r=i(84911);const a={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:function(e){const t=e[0],i=e[e.length-1];return"{"===t&&"}"===i||"["===t&&"]"===i},parseTextSync:JSON.parse};const l=function(){const e="9.0.19",t=globalThis.deck&&globalThis.deck.VERSION;if(t&&t!==e)throw new Error("deck.gl - multiple versions detected: "+t+" vs "+e);return t||(s.Z.log(1,"deck.gl "+e)(),globalThis.deck={...globalThis.deck,VERSION:e,version:e,log:s.Z,_registerLoggers:r.z},(0,n.fh)([a,[o.S,{imagebitmap:{premultiplyAlpha:"none"}}]])),e}()},24217:(e,t,i)=>{i.d(t,{Z:()=>o});var n=i(8557);class o{static get componentName(){return Object.prototype.hasOwnProperty.call(this,"extensionName")?this.extensionName:""}constructor(e){e&&(this.opts=e)}equals(e){return this===e||this.constructor===e.constructor&&(0,n.v)(this.opts,e.opts,1)}getShaders(e){return null}getSubLayerProps(e){const{defaultProps:t}=e.constructor,i={updateTriggers:{}};for(const n in t)if(n in this.props){const e=t[n],o=this.props[n];i[n]=o,e&&"accessor"===e.type&&(i.updateTriggers[n]=this.props.updateTriggers[n],"function"==typeof o&&(i[n]=this.getSubLayerAccessor(o)))}return i}initializeState(e,t){}updateState(e,t){}onNeedsRedraw(e){}getNeedsPickingBuffer(e){return!1}draw(e,t){}finalizeState(e,t){}}o.defaultProps={},o.extensionName="LayerExtension"},45286:(e,t,i)=>{i.d(t,{Z:()=>te});var n=i(63847),o=i(19845),s=i(90271),r=i(42701),a=i(55715),l=i(96129);class c extends l.Z{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:i,duration:n,easing:o}}=this,s=o(e/n);this._value=(0,a.t7)(t,i,s)}}const d=1e-5;function u(e,t,i,n,o){const s=t-e;return(i-t)*o+-s*n+s+t}function h(e,t){if(Array.isArray(e)){let i=0;for(let n=0;n<e.length;n++){const o=e[n]-t[n];i+=o*o}return Math.sqrt(i)}return Math.abs(e-t)}class p extends l.Z{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:i,stiffness:n}=this.settings,{_prevValue:o=e,_currValue:s=e}=this;let r=function(e,t,i,n,o){if(Array.isArray(i)){const s=[];for(let r=0;r<i.length;r++)s[r]=u(e[r],t[r],i[r],n,o);return s}return u(e,t,i,n,o)}(o,s,t,i,n);const a=h(r,t),l=h(r,s);a<d&&l<d&&(r=t,this.end()),this._prevValue=s,this._currValue=r}}var g=i(70575);const f={interpolation:c,spring:p};class m{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,i,n){const{transitions:o}=this;if(o.has(e)){const i=o.get(e),{value:n=i.settings.fromValue}=i;t=n,this.remove(e)}if(!(n=(0,r.M)(n)))return;const s=f[n.type];if(!s)return void g.Z.error("unsupported transition type '"+n.type+"'")();const a=new s(this.timeline);a.start({...n,fromValue:t,toValue:i}),o.set(e,a)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,i]of this.transitions)i.update(),e[t]=i.value,i.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}var v=i(84435),y=i(44206);const _="count(): argument not an object",b="count(): argument not a container";function w(e){if(null===(t=e)||"object"!=typeof t)throw new Error(_);var t;if("function"==typeof e.count)return e.count();if(Number.isFinite(e.size))return e.size;if(Number.isFinite(e.length))return e.length;if(function(e){return null!==e&&"object"==typeof e&&e.constructor===Object}(e))return Object.keys(e).length;throw new Error(b)}var x=i(84911),P=i(46149),C=i(36268),S=i(66510),T=i(91796),L=i(92232),M=i(55884),k=i(45956);const E={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},I={};var A=i(8557);const z={boolean:{validate:(e,t)=>!0,equal:(e,t,i)=>Boolean(e)===Boolean(t)},number:{validate:(e,t)=>Number.isFinite(e)&&(!("max"in t)||e<=t.max)&&(!("min"in t)||e>=t.min)},color:{validate:(e,t)=>t.optional&&!e||N(e)&&(3===e.length||4===e.length),equal:(e,t,i)=>(0,A.v)(e,t,1)},accessor:{validate(e,t){const i=j(e);return"function"===i||i===j(t.value)},equal:(e,t,i)=>"function"==typeof t||(0,A.v)(e,t,1)},array:{validate:(e,t)=>t.optional&&!e||N(e),equal(e,t,i){const{compare:n}=i,o=Number.isInteger(n)?n:n?1:0;return n?(0,A.v)(e,t,o):e===t}},object:{equal(e,t,i){if(i.ignore)return!0;const{compare:n}=i,o=Number.isInteger(n)?n:n?1:0;return n?(0,A.v)(e,t,o):e===t}},function:{validate:(e,t)=>t.optional&&!e||"function"==typeof e,equal:(e,t,i)=>!i.compare&&!1!==i.ignore||e===t},data:{transform:(e,t,i)=>{if(!e)return e;const{dataTransform:n}=i.props;return n?n(e):"string"==typeof e.shape&&e.shape.endsWith("-table")&&Array.isArray(e.data)?e.data:e}},image:{transform:(e,t,i)=>{const n=i.context;return n&&n.device?function(e,t,i,n){if(i instanceof k.x)return i;i.constructor&&"Object"!==i.constructor.name&&(i={data:i});let o=null;i.compressed&&(o={minFilter:"linear",mipmapFilter:i.data.length>1?"nearest":"linear"});const s=t.createTexture({...i,sampler:{...E,...o,...n}});return I[s.id]=e,s}(i.id,n.device,e,{...t.parameters,...i.props.textureParameters}):null},release:(e,t,i)=>{var n,o;n=i.id,(o=e)&&o instanceof k.x&&I[o.id]===n&&(o.delete(),delete I[o.id])}}};function R(e,t){switch(j(t)){case"object":return O(e,t);case"array":return O(e,{type:"array",value:t,compare:!1});case"boolean":return O(e,{type:"boolean",value:t});case"number":return O(e,{type:"number",value:t});case"function":return O(e,{type:"function",value:t,compare:!0});default:return{name:e,type:"unknown",value:t}}}function O(e,t){return"type"in t?{name:e,...z[t.type],...t}:"value"in t?{name:e,type:j(t.value),...t}:{name:e,type:"object",value:t}}function N(e){return Array.isArray(e)||ArrayBuffer.isView(e)}function j(e){return N(e)?"array":null===e?"null":typeof e}const D="_mergedDefaultProps";function F(e,t){let i=D;if(t)for(const o of t){const e=o.constructor;e&&(i+=":"+(e.extensionName||e.name))}const n=Z(e,i);return n||(e[i]=function(e,t){const i=e.prototype;if(!i)return null;const n=Object.getPrototypeOf(e),o=F(n),s=Z(e,"defaultProps")||{},r=function(e){const t={},i={},n={};for(const[o,s]of Object.entries(e)){const e=null==s?void 0:s.deprecatedFor;if(e)n[o]=Array.isArray(e)?e:[e];else{const e=R(o,s);t[o]=e,i[o]=e.value}}return{propTypes:t,defaultProps:i,deprecatedProps:n}}(s),a=Object.assign(Object.create(null),o,r.defaultProps),l=Object.assign(Object.create(null),null==o?void 0:o[y.Wb],r.propTypes),c=Object.assign(Object.create(null),null==o?void 0:o[y.E7],r.deprecatedProps);for(const d of t){const e=F(d.constructor);e&&(Object.assign(a,e),Object.assign(l,e[y.Wb]),Object.assign(c,e[y.E7]))}(function(e,t){const i=function(e){const t=e.componentName;t||g.Z.warn(e.name+".componentName not specified")();return t||e.name}(t);Object.defineProperties(e,{id:{writable:!0,value:i}})})(a,e),function(e,t){const i={},n={};for(const o in t){const e=t[o],{name:s,value:r}=e;e.async&&(i[s]=r,n[s]=V(s))}e[y.lY]=i,e[y.fO]={},Object.defineProperties(e,n)}(a,l),function(e,t){for(const i in t)Object.defineProperty(e,i,{enumerable:!1,set(e){const n=this.id+": "+i;for(const o of t[i])B(this,o)||(this[o]=e);g.Z.deprecated(n,t[i].join("/"))()}})}(a,c),a[y.Wb]=l,a[y.E7]=c,0!==t.length||B(e,"_propTypes")||(e._propTypes=l);return a}(e,t||[]))}function V(e){return{enumerable:!0,set(t){"string"==typeof t||t instanceof Promise||(0,M.D0)(t)?this[y.fO][e]=t:this[y.bN][e]=t},get(){if(this[y.bN]){if(e in this[y.bN]){return this[y.bN][e]||this[y.lY][e]}if(e in this[y.fO]){const t=this[y.fm]&&this[y.fm].internalState;if(t&&t.hasAsyncProp(e))return t.getAsyncProp(e)||this[y.lY][e]}}return this[y.lY][e]}}}function B(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Z(e,t){return B(e,t)&&e[t]}let U=0;class W{constructor(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.props=function(e,t){let i;for(let s=t.length-1;s>=0;s--){const e=t[s];"extensions"in e&&(i=e.extensions)}const n=F(e.constructor,i),o=Object.create(n);o[y.fm]=e,o[y.fO]={},o[y.bN]={};for(let s=0;s<t.length;++s){const e=t[s];for(const t in e)o[t]=e[t]}return Object.freeze(o),o}(this,t),this.id=this.props.id,this.count=U++}clone(e){const{props:t}=this,i={};for(const n in t[y.lY])n in t[y.bN]?i[n]=t[y.bN][n]:n in t[y.fO]&&(i[n]=t[y.fO][n]);return new this.constructor({...t,...i,...e})}}W.componentName="Component",W.defaultProps={};const G=Object.freeze({});class q{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||G}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return Boolean(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[y.fm]||this.component;const t=e[y.bN]||{},i=e[y.fO]||e,n=e[y.lY]||{};for(const o in t){const e=t[o];this._createAsyncPropData(o,n[o]),this._updateAsyncProp(o,e),t[o]=this.getAsyncProp(o)}for(const o in i){const e=i[o];this._createAsyncPropData(o,n[o]),this._updateAsyncProp(o,e)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){this._didAsyncInputValueChange(e,t)&&("string"==typeof t&&(t=this._fetch(e,t)),t instanceof Promise?this._watchPromise(e,t):(0,M.D0)(t)?this._resolveAsyncIterable(e,t):this._setPropValue(e,t))}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const i=this.asyncProps[e];return t!==i.resolvedValue&&t!==i.lastValue&&(i.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const i=this.asyncProps[e];i&&(t=this._postProcessValue(i,t),i.resolvedValue=t,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(e,t,i){const n=this.asyncProps[e];n&&i>=n.resolvedLoadCount&&void 0!==t&&(this._freezeAsyncOldProps(),n.resolvedValue=t,n.resolvedLoadCount=i,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const i=this.asyncProps[e];if(i){i.pendingLoadCount++;const n=i.pendingLoadCount;t.then((t=>{this.component&&(t=this._postProcessValue(i,t),this._setAsyncPropValue(e,t,n),this._onResolve(e,t))})).catch((t=>{this._onError(e,t)}))}}async _resolveAsyncIterable(e,t){if("data"!==e)return void this._setPropValue(e,t);const i=this.asyncProps[e];if(!i)return;i.pendingLoadCount++;const n=i.pendingLoadCount;let o=[],s=0;for await(const r of t){if(!this.component)return;const{dataTransform:t}=this.component.props;o=t?t(r,o):o.concat(r),Object.defineProperty(o,"__diff",{enumerable:!1,value:[{startRow:s,endRow:o.length}]}),s=o.length,this._setAsyncPropValue(e,o,n)}this._onResolve(e,o)}_postProcessValue(e,t){const i=e.type;return i&&this.component&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(t,i,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const i=this.component&&this.component.props[y.Wb];this.asyncProps[e]={type:i&&i[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class H extends q{constructor(e){let{attributeManager:t,layer:i}=e;super(i),this.attributeManager=t,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const i=this.layer,n=null==i?void 0:i.props.fetch;return n?n(t,{propName:e,layer:i}):super._fetch(e,t)}_onResolve(e,t){const i=this.layer;if(i){const n=i.props.onDataLoad;"data"===e&&n&&n(t,{propName:e,layer:i})}}_onError(e,t){const i=this.layer;i&&i.raiseError(t,"loading "+e+" of "+this.layer)}}var K=i(77394),Y=i(39470);const J=2**24-1,X=Object.freeze([]),$=(0,C.Z)((e=>{let{oldViewport:t,viewport:i}=e;return t.equals(i)}));let Q=new Uint8ClampedArray(0);const ee={data:{type:"data",value:X,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:e=>e&&e.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(e,t)=>{let{propName:i,layer:n,loaders:o,loadOptions:s,signal:r}=t;const{resourceManager:a}=n.context;var l;(s=s||n.getLoadOptions(),o=o||n.props.loaders,r)&&(s={...s,fetch:{...null==(l=s)?void 0:l.fetch,signal:r}});let c=a.contains(e);return c||s||(a.add({resourceId:e,data:(0,Y.z)(e,o),persistent:!1}),c=!0),c?a.subscribe({resourceId:e,onChange:e=>{var t;return null==(t=n.internalState)?void 0:t.reloadAsyncProp(i,e)},consumerId:n.id,requestId:i}):(0,Y.z)(e,o,s)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:o.Df.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:e=>{let{layerIndex:t}=e;return[0,100*-t]}},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class te extends W{constructor(){super(...arguments),this.internalState=null,this.lifecycle=y.dt.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return(this.constructor.layerName||this.constructor.name)+"({id: '"+this.props.id+"'})"}project(e){(0,P.Z)(this.internalState);const t=this.internalState.viewport||this.context.viewport,i=(0,T.T)(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[n,o,s]=(0,K.aW)(i,t.pixelProjectionMatrix);return 2===e.length?[n,o]:[n,o,s]}unproject(e){(0,P.Z)(this.internalState);return(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){(0,P.Z)(this.internalState);const i=this.internalState.viewport||this.context.viewport;return(0,T.D)(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return!!this.internalState&&!this.internalState.isAsyncPropLoading()}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setModuleParameters(e){for(const t of this.getModels())t.updateModuleSettings(e)}setShaderModuleProps(){for(const e of this.getModels())e.shaderInputs.setProps(...arguments)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===o.Df.DEFAULT||e===o.Df.LNGLAT||e===o.Df.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t){return void 0===t&&(t=[]),t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){(0,P.Z)(e instanceof Uint8Array);const[t,i,n]=e;return t+256*i+65536*n-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&void 0!==this.state.numInstances?this.state.numInstances:w(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return null==(e=this.getAttributeManager())?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=(0,S.l)(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const t of this.props.extensions)e=(0,S.l)(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:i}=e.changeFlags;if(i&&t)if(Array.isArray(i))for(const n of i)t.invalidateAll(n);else t.invalidateAll();if(t){const{props:i}=e,n=this.internalState.hasPickingBuffer,o=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some((e=>e.getNeedsPickingBuffer.call(this,e)));if(n!==o){this.internalState.hasPickingBuffer=o;const{pickingColors:e,instancePickingColors:i}=t.attributes,n=e||i;n&&(o&&n.constant&&(n.constant=!1,t.invalidate(n.id)),n.value||o||(n.constant=!0,n.value=[0,0,0]))}}}finalizeState(e){for(const i of this.getModels())i.destroy();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e)}getPickingInfo(e){let{info:t,mode:i,sourceLayer:n}=e;const{index:o}=t;return o>=0&&Array.isArray(this.props.data)&&(t.object=this.props.data[o]),t}raiseError(e,t){var i,n,o;(t&&(e=new Error(t+": "+e.message,{cause:e})),null!=(i=(n=this.props).onError)&&i.call(n,e))||(null==(o=this.context)||null==o.onError||o.onError(e,this))}getNeedsRedraw(e){return void 0===e&&(e={clearRedrawFlags:!1}),this._getNeedsRedraw(e)}needsUpdate(){return!!this.internalState&&(this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()))}hasUniformTransition(){var e;return(null==(e=this.internalState)?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,t&&$({oldViewport:t,viewport:e})||(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e){void 0===e&&(e="all");const t=this.getAttributeManager();t&&("all"===e?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(const i in e)e[i].layoutChanged()&&(t=!0);for(const i of this.getModels())this._setModelAttributes(i,e,t)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,i=this.getNumInstances(),n=this.getStartIndices();e.update({data:t.data,numInstances:i,startIndices:n,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const o=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(o)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),i=Object.create(this.props);for(const e in t)Object.defineProperty(i,e,{value:t[e]});return i}return this.props}calculateInstancePickingColors(e,t){let{numInstances:i}=t;if(e.constant)return;const n=Math.floor(Q.length/4);if(this.internalState.usesPickingColorCache=!0,n<i){i>J&&g.Z.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Q=L.Z.allocate(Q,i,{size:4,copy:!0,maxCount:Math.max(i,J)});const e=Math.floor(Q.length/4),t=[];for(let i=n;i<e;i++)this.encodePickingColor(i,t),Q[4*i+0]=t[0],Q[4*i+1]=t[1],Q[4*i+2]=t[2]}e.value=Q.subarray(0,4*i)}_setModelAttributes(e,t,i){var o;if(void 0===i&&(i=!1),!Object.keys(t).length)return;if(i){const i=this.getAttributeManager();e.setBufferLayout(i.getBufferLayouts(e)),t=i.getAttributes()}const s=(null==(o=e.userData)?void 0:o.excludeAttributes)||{},r={},a={};for(const l in t){if(s[l])continue;const i=t[l].getValue();for(const o in i){const s=i[o];s instanceof n.l?t[l].settings.isIndexed?e.setIndexBuffer(s):r[o]=s:s&&(a[o]=s)}}e.setAttributes(r),e.setConstantAttributes(a)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t))return void this._disablePickingIndex(e);const{pickingColors:i,instancePickingColors:n}=this.getAttributeManager().attributes,o=i||n,s=o&&t.attributes&&t.attributes[o.id];if(s&&s.value){const i=s.value,n=this.encodePickingColor(e);for(let e=0;e<t.length;e++){const t=o.getVertexOffset(e);i[t]===n[0]&&i[t+1]===n[1]&&i[t+2]===n[2]&&this._disablePickingIndex(e)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:i}=this.getAttributeManager().attributes,n=t||i;if(!n)return;const o=n.getVertexOffset(e),s=n.getVertexOffset(e+1);n.buffer.write(new Uint8Array(s-o),o)}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,i=e||t;i&&(this.internalState.usesPickingColorCache&&i.value.buffer!==Q.buffer&&(i.value=Q.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){(0,P.Z)(!this.internalState),(0,P.Z)(Number.isFinite(this.props.coordinateSystem)),(0,x.Z)("layer.initialize",this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new H({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(g.Z.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new m(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){(0,x.Z)("layer.matched",this,this===e);const{state:t,internalState:i}=e;this!==e&&(this.internalState=i,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if((0,x.Z)("layer.update",this,e),!e)return;const t=this.props,i=this.context,n=this.internalState,o=i.viewport,s=this._updateUniformTransition();n.propsInTransition=s,i.viewport=n.viewport||o,this.props=s;try{const e=this._getUpdateParams(),t=this.getModels();if(i.device)this.updateState(e);else try{this.updateState(e)}catch(r){}for(const i of this.props.extensions)i.updateState.call(this,e,i);const n=this.getModels()[0]!==t[0];this._postUpdate(e,n)}finally{i.viewport=o,this.props=t,this._clearChangeFlags(),n.needsUpdate=!1,n.resetOldProps()}}_finalize(){(0,x.Z)("layer.finalize",this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer(e){let{renderPass:t,moduleParameters:i=null,uniforms:n={},parameters:o={}}=e;this._updateAttributeTransition();const s=this.props,r=this.context;this.props=this.internalState.propsInTransition||s;const a=this.props.opacity;n.opacity=Math.pow(a,1/2.2);try{if(i){const{isActive:e,isAttribute:t}=i.picking;this.setModuleParameters(i),this.setShaderModuleProps({picking:{isActive:e,isAttribute:t}})}const{getPolygonOffset:e}=this.props,s=e&&e(n)||[0,0];r.device.setParametersWebGL({polygonOffset:s});for(const t of this.getModels())t.setParameters(o);r.device.withParametersWebGL(o,(()=>{const e={renderPass:t,moduleParameters:i,uniforms:n,parameters:o,context:r};for(const t of this.props.extensions)t.draw.call(this,e,t);this.draw(e)}))}finally{this.props=s}}getChangeFlags(){var e;return null==(e=this.internalState)?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const n in e)if(e[n]){let i=!1;if("dataChanged"===n){const o=e[n],s=t[n];o&&Array.isArray(s)&&(t.dataChanged=Array.isArray(o)?s.concat(o):o,i=!0)}t[n]||(t[n]=e[n],i=!0),i&&(0,x.Z)("layer.changeFlag",this,n,e)}const i=Boolean(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=i,t.somethingChanged=i||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){const i=(0,v.Yt)(e,t);if(i.updateTriggersChanged)for(const o in i.updateTriggersChanged)i.updateTriggersChanged[o]&&this.invalidateAttribute(o);if(i.transitionsChanged)for(const o in i.transitionsChanged){var n;this.internalState.uniformTransitions.add(o,t[o],e[o],null==(n=e.transitions)?void 0:n[o])}return this.setChangeFlags(i)}validateProps(){(0,v.eQ)(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:i}=this.props;e.picked&&"function"==typeof i&&(t.highlightColor=i(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new s.Z(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:i,oldProps:n}=e;this.setNeedsRedraw(),this._updateAttributes();const o=this.state.model;null!=o&&o.isInstanced&&o.setInstanceCount(this.getNumInstances());const{autoHighlight:s,highlightedObjectIndex:r,highlightColor:a}=i;if(t||n.autoHighlight!==s||n.highlightedObjectIndex!==r||n.highlightColor!==a){const e={};s||(e.highlightedObjectColor=null),Array.isArray(a)&&(e.highlightColor=a),(t||r!==n.highlightedObjectIndex)&&(e.highlightedObjectColor=Number.isFinite(r)&&r>=0?this.encodePickingColor(r):null),this.setShaderModuleProps({picking:e})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const i=this.getAttributeManager(),n=!!i&&i.getNeedsRedraw(e);if(t=t||n,t)for(const o of this.props.extensions)o.onNeedsRedraw.call(this,o);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}te.defaultProps=ee,te.layerName="Layer"},44206:(e,t,i)=>{i.d(t,{E7:()=>r,Wb:()=>s,bN:()=>c,dt:()=>n,fO:()=>l,fm:()=>o,lY:()=>a});const n={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},o=Symbol.for("component"),s=Symbol.for("propTypes"),r=Symbol.for("deprecatedProps"),a=Symbol.for("asyncPropDefaults"),l=Symbol.for("asyncPropOriginal"),c=Symbol.for("asyncPropResolved")},84435:(e,t,i)=>{i.d(t,{Yt:()=>s,eQ:()=>o,tg:()=>a});var n=i(44206);function o(e){const t=e[n.Wb];for(const i in t){const n=t[i],{validate:o}=n;if(o&&!o(e[i],n))throw new Error("Invalid prop "+i+": "+e[i])}}function s(e,t){const i=a({newProps:e,oldProps:t,propTypes:e[n.Wb],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),o=function(e,t){if(null===t)return"oldProps is null, initial diff";let i=!1;const{dataComparator:n,_dataDiff:o}=e;n?n(e.data,t.data)||(i="Data comparator detected a change"):e.data!==t.data&&(i="A new data container was supplied");i&&o&&(i=o(e.data,t.data)||i);return i}(e,t);let s=!1;return o||(s=function(e,t){if(null===t)return{all:!0};if("all"in e.updateTriggers){if(d(e,t,"all"))return{all:!0}}const i={};let n=!1;for(const o in e.updateTriggers)if("all"!==o){d(e,t,o)&&(i[o]=!0,n=!0)}return!!n&&i}(e,t)),{dataChanged:o,propsChanged:i,updateTriggersChanged:s,extensionsChanged:c(e,t),transitionsChanged:r(e,t)}}function r(e,t){if(!e.transitions)return!1;const i={},o=e[n.Wb];let s=!1;for(const n in e.transitions){const r=o[n],a=r&&r.type;("number"===a||"color"===a||"array"===a)&&l(e[n],t[n],r)&&(i[n]=!0,s=!0)}return!!s&&i}function a(e){let{newProps:t,oldProps:i,ignoreProps:n={},propTypes:o={},triggerName:s="props"}=e;if(i===t)return!1;if("object"!=typeof t||null===t)return s+" changed shallowly";if("object"!=typeof i||null===i)return s+" changed shallowly";for(const r of Object.keys(t))if(!(r in n)){if(!(r in i))return s+"."+r+" added";const e=l(t[r],i[r],o[r]);if(e)return s+"."+r+" "+e}for(const r of Object.keys(i))if(!(r in n)){if(!(r in t))return s+"."+r+" dropped";if(!Object.hasOwnProperty.call(t,r)){const e=l(t[r],i[r],o[r]);if(e)return s+"."+r+" "+e}}return!1}function l(e,t,i){let n=i&&i.equal;return n&&!n(e,t,i)?"changed deeply":n||(n=e&&t&&e.equals,!n||n.call(e,t))?n||t===e?null:"changed shallowly":"changed deeply"}function c(e,t){if(null===t)return!0;const i=t.extensions,{extensions:n}=e;if(n===i)return!1;if(!i||!n)return!0;if(n.length!==i.length)return!0;for(let o=0;o<n.length;o++)if(!n[o].equals(i[o]))return!0;return!1}function d(e,t,i){let n=e.updateTriggers[i];n=null==n?{}:n;let o=t.updateTriggers[i];o=null==o?{}:o;return a({oldProps:o,newProps:n,triggerName:i})}},64321:(e,t,i)=>{i.d(t,{Z:()=>o});var n=i(44941);class o extends n.Z{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){var t,i,n;const[o,s]=this.device.canvasContext.getDrawingBufferSize(),r=null==(t=e.clearCanvas)||t,a=null!=(i=e.clearColor)?i:!!r&&[0,0,0,0],l=!!r&&1,c=!!r&&0,d=null!=(n=e.colorMask)?n:15,u={viewport:[0,0,o,s]};e.colorMask&&(u.colorMask=d),e.scissorRect&&(u.scissorRect=e.scissorRect);const h=this.device.beginRenderPass({framebuffer:e.target,parameters:u,clearColor:a,clearDepth:l,clearStencil:c});try{return this._drawLayers(h,e)}finally{h.end()}}_drawLayers(e,t){const{target:i,moduleParameters:n,viewports:o,views:s,onViewportActive:r,clearStack:a=!0}=t;t.pass=t.pass||"unknown",a&&(this._lastRenderIndex=-1);const l=[];for(const c of o){const o=s&&s[c.id];null==r||r(c);const a=this._getDrawLayerParams(c,t),d=c.subViewports||[c];for(const s of d){const r=this._drawLayersInViewport(e,{target:i,moduleParameters:n,viewport:s,view:o,pass:t.pass,layers:t.layers},a);l.push(r)}}return l}_getDrawLayerParams(e,t,i){let{layers:n,pass:o,isPicking:r=!1,layerFilter:a,cullRect:l,effects:c,moduleParameters:d}=t;void 0===i&&(i=!1);const u=[],h=s(this._lastRenderIndex+1),p={layer:n[0],viewport:e,isPicking:r,renderPass:o,cullRect:l},g={};for(let s=0;s<n.length;s++){const t=n[s],r=this._shouldDrawLayer(t,p,a,g),l={shouldDrawLayer:r};var f;if(r&&!i)l.layerRenderIndex=h(t,r),l.moduleParameters=this._getModuleParameters(t,c,o,d),l.layerParameters={...null==(f=t.context.deck)?void 0:f.props.parameters,...this.getLayerParameters(t,s,e)};u[s]=l}return u}_drawLayersInViewport(e,t,i){let{layers:n,moduleParameters:o,pass:s,target:r,viewport:a,view:l}=t;const c=function(e,t){let{moduleParameters:i,target:n,viewport:o}=t;const s=i&&i.devicePixelRatio||e.canvasContext.cssToDeviceRatio(),[,r]=e.canvasContext.getDrawingBufferSize(),a=n?n.height:r,l=o;return[l.x*s,a-(l.y+l.height)*s,l.width*s,l.height*s]}(this.device,{moduleParameters:o,target:r,viewport:a});if(l&&l.props.clear){const e=!0===l.props.clear?{color:!0,depth:!0}:l.props.clear;this.device.withParametersWebGL({scissorTest:!0,scissor:c},(()=>this.device.clearWebGL(e)))}const d={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:c});for(let h=0;h<n.length;h++){const t=n[h],{shouldDrawLayer:o,layerRenderIndex:r,moduleParameters:l,layerParameters:c}=i[h];if(o&&t.props.pickable&&d.pickableCount++,t.isComposite)d.compositeCount++;else if(o){d.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,r),l.viewport=a,t.context.renderPass=e;try{t._drawLayer({renderPass:e,moduleParameters:l,uniforms:{layerIndex:r},parameters:c})}catch(u){t.raiseError(u,"drawing "+t+" to "+s)}}}return d}shouldDrawLayer(e){return!0}getModuleParameters(e,t){return null}getLayerParameters(e,t,i){return e.props.parameters}_shouldDrawLayer(e,t,i,n){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let o=e.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(t))return!1;t.layer=o,o=o.parent}if(i){const e=t.layer.id;if(e in n||(n[e]=i(t)),!n[e])return!1}return e.activateViewport(t.viewport),!0}_getModuleParameters(e,t,i,n){var o;const s=this.device.canvasContext.cssToDeviceRatio(),r=Object.assign(Object.create((null==(o=e.internalState)?void 0:o.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,picking:{isActive:0},devicePixelRatio:s});if(t)for(const a of t)Object.assign(r,null==a.getModuleParameters?void 0:a.getModuleParameters(e));return Object.assign(r,this.getModuleParameters(e,t),n)}}function s(e,t){void 0===e&&(e=0),void 0===t&&(t={});const i={},n=(o,r)=>{const a=o.props._offset,l=o.id,c=o.parent&&o.parent.id;let d;if(c&&!(c in t)&&n(o.parent,!1),c in i){const e=i[c]=i[c]||s(t[c],t);d=e(o,r),i[l]=e}else Number.isFinite(a)?(d=a+(t[c]||0),i[l]=null):d=e;return r&&d>=e&&(e=d+1),t[l]=d,d};return n}},44941:(e,t,i)=>{i.d(t,{Z:()=>n});class n{constructor(e,t){void 0===t&&(t={id:"pass"});const{id:i}=t;this.id=i,this.device=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}},88736:(e,t,i)=>{i.d(t,{Z:()=>r});var n=i(64321),o=i(70575);const s={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class r extends n.Z{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer(e){let{layers:t,layerFilter:i,views:n,viewports:o,onViewportActive:s,pickingFBO:r,deviceRect:{x:l,y:c,width:d,height:u},cullRect:h,effects:p,pass:g="picking",pickZ:f,moduleParameters:m}=e;this.pickZ=f;const v=this._resetColorEncoder(f),y=[l,c,d,u],_=super.render({target:r,layers:t,layerFilter:i,views:n,viewports:o,onViewportActive:s,cullRect:h,effects:null==p?void 0:p.filter((e=>e.useInPicking)),pass:g,isPicking:!0,moduleParameters:m,clearColor:[0,0,0,0],colorMask:15,scissorRect:y});this._colorEncoderState=null;return{decodePickingColor:v&&a.bind(null,v),stats:_}}shouldDrawLayer(e){const{pickable:t,operation:i}=e.props;return t&&i.includes("draw")||i.includes("terrain")||i.includes("mask")}getModuleParameters(){return{picking:{isActive:1,isAttribute:this.pickZ},lightSources:{}}}getLayerParameters(e,t,i){const n={depthMask:!0,depthTest:!0,depthRange:[0,1],...e.props.parameters},{pickable:r,operation:a}=e.props;return!this._colorEncoderState||a.includes("terrain")?n.blend=!1:r&&a.includes("draw")&&(Object.assign(n,s),n.blend=!0,n.blendColor=function(e,t,i){const{byLayer:n,byAlpha:s}=e;let r,a=n.get(t);a?(a.viewports.push(i),r=a.a):(r=n.size+1,r<=255?(a={a:r,layer:t,viewports:[i]},n.set(t,a),s[r]=a):(o.Z.warn("Too many pickable layers, only picking the first 255")(),r=0));return[0,0,0,r/255]}(this._colorEncoderState,e,i)),n}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function a(e,t){const i=e.byAlpha[t[3]];return i&&{pickedLayer:i.layer,pickedViewports:i.viewports,pickedObjectIndex:i.layer.decodePickingColor(t)}}},76867:(e,t,i)=>{i.d(t,{ik:()=>r});var n=i(92202);const o=[i(82153).Z],s=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function r(){const e=n.q.getDefaultShaderAssembler();for(const t of o)e.addDefaultModule(t);for(const t of s)e.addShaderHook(t);return e}},23064:(e,t,i)=>{i.d(t,{Z:()=>o});var n=i(35300);const o={...n.q,defaultUniforms:{...n.q.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":"\n    // for picking depth values\n    picking_setPickingAttribute(position.z / position.w);\n  ","vs:DECKGL_FILTER_COLOR":"\n  picking_setPickingColor(geometry.pickingColor);\n  ","fs:DECKGL_FILTER_COLOR":{order:99,injection:"\n  // use highlight color if this fragment belongs to the selected object.\n  color = picking_filterHighlightColor(color);\n\n  // use picking color if rendering to picking FBO.\n  color = picking_filterPickingColor(color);\n    "}}}},91796:(e,t,i)=>{i.d(t,{D:()=>h,T:()=>u});var n=i(19845),o=i(15203),s=i(83224),r=i(16018),a=i(53015),l=i(77394);const c=[0,0,0];function d(e,t,i){void 0===i&&(i=!1);const n=t.projectPosition(e);if(i&&t instanceof s.Z){const[i,o,s=0]=e,r=t.getDistanceScales([i,o]);n[2]=s*r.unitsPerMeter[2]}return n}function u(e,t){let{viewport:i,modelMatrix:o,coordinateSystem:s,coordinateOrigin:a,offsetMode:c}=t,[u,h,p=0]=e;switch(o&&([u,h,p]=r.fF([],[u,h,p,1],o)),s){case n.Df.LNGLAT:return d([u,h,p],i,c);case n.Df.LNGLAT_OFFSETS:return d([u+a[0],h+a[1],p+(a[2]||0)],i,c);case n.Df.METER_OFFSETS:return d((0,l.eG)(a,[u,h,p]),i,c);case n.Df.CARTESIAN:default:return i.isGeospatial?[u+a[0],h+a[1],p+a[2]]:i.projectPosition([u,h,p])}}function h(e,t){const{viewport:i,coordinateSystem:s,coordinateOrigin:r,modelMatrix:l,fromCoordinateSystem:d,fromCoordinateOrigin:h}=function(e){const{viewport:t,modelMatrix:i,coordinateOrigin:o}=e;let{coordinateSystem:s,fromCoordinateSystem:r,fromCoordinateOrigin:a}=e;return s===n.Df.DEFAULT&&(s=t.isGeospatial?n.Df.LNGLAT:n.Df.CARTESIAN),void 0===r&&(r=s),void 0===a&&(a=o),{viewport:t,coordinateSystem:s,coordinateOrigin:o,modelMatrix:i,fromCoordinateSystem:r,fromCoordinateOrigin:a}}(t),{autoOffset:p=!0}=t,{geospatialOrigin:g=c,shaderCoordinateOrigin:f=c,offsetMode:m=!1}=p?(0,o.v)(i,s,r):{},v=u(e,{viewport:i,modelMatrix:l,coordinateSystem:d,coordinateOrigin:h,offsetMode:m});if(m){const e=i.projectPosition(g||f);a.lu(v,v,e)}return v}},82153:(e,t,i)=>{i.d(t,{Z:()=>d});var n=i(89946);const o="#define SMOOTH_EDGE_RADIUS 0.5",s={name:"geometry",vs:"\n"+o+"\n\nstruct VertexGeometry {\n  vec4 position;\n  vec3 worldPosition;\n  vec3 worldPositionAlt;\n  vec3 normal;\n  vec2 uv;\n  vec3 pickingColor;\n} geometry = VertexGeometry(\n  vec4(0.0, 0.0, 1.0, 0.0),\n  vec3(0.0),\n  vec3(0.0),\n  vec3(0.0),\n  vec2(0.0),\n  vec3(0.0)\n);\n",fs:"\n"+o+"\n\nstruct FragmentGeometry {\n  vec2 uv;\n} geometry;\n\nfloat smoothedge(float edge, float x) {\n  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);\n}\n"};var r=i(19845);const a=Object.keys(r.Df).map((e=>"const int COORDINATE_SYSTEM_"+e+" = "+r.Df[e]+";")).join("")+"\n"+Object.keys(r.zG).map((e=>"const int PROJECTION_MODE_"+e+" = "+r.zG[e]+";")).join("")+"\n"+Object.keys(r.iI).map((e=>"const int UNIT_"+e.toUpperCase()+" = "+r.iI[e]+";")).join("")+"\nuniform int project_uCoordinateSystem;\nuniform int project_uProjectionMode;\nuniform float project_uScale;\nuniform bool project_uWrapLongitude;\nuniform vec3 project_uCommonUnitsPerMeter;\nuniform vec3 project_uCommonUnitsPerWorldUnit;\nuniform vec3 project_uCommonUnitsPerWorldUnit2;\nuniform vec4 project_uCenter;\nuniform mat4 project_uModelMatrix;\nuniform mat4 project_uViewProjectionMatrix;\nuniform vec2 project_uViewportSize;\nuniform float project_uDevicePixelRatio;\nuniform float project_uFocalDistance;\nuniform vec3 project_uCameraPosition;\nuniform vec3 project_uCoordinateOrigin;\nuniform vec3 project_uCommonOrigin;\nuniform bool project_uPseudoMeters;\nconst float TILE_SIZE = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE = TILE_SIZE / (PI * 2.0);\nconst vec3 ZERO_64_LOW = vec3(0.0);\nconst float EARTH_RADIUS = 6370972.0;\nconst float GLOBE_RADIUS = 256.0;\nfloat project_size_at_latitude(float lat) {\nfloat y = clamp(lat, -89.9, 89.9);\nreturn 1.0 / cos(radians(y));\n}\nfloat project_size() {\nif (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&\nproject_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&\nproject_uPseudoMeters == false) {\nif (geometry.position.w == 0.0) {\nreturn project_size_at_latitude(geometry.worldPosition.y);\n}\nfloat y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;\nfloat y2 = y * y;\nfloat y4 = y2 * y2;\nfloat y6 = y4 * y2;\nreturn 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;\n}\nreturn 1.0;\n}\nfloat project_size_at_latitude(float meters, float lat) {\nreturn meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);\n}\nfloat project_size(float meters) {\nreturn meters * project_uCommonUnitsPerMeter.z * project_size();\n}\nvec2 project_size(vec2 meters) {\nreturn meters * project_uCommonUnitsPerMeter.xy * project_size();\n}\nvec3 project_size(vec3 meters) {\nreturn meters * project_uCommonUnitsPerMeter * project_size();\n}\nvec4 project_size(vec4 meters) {\nreturn vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);\n}\nmat3 project_get_orientation_matrix(vec3 up) {\nvec3 uz = normalize(up);\nvec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));\nvec3 uy = cross(uz, ux);\nreturn mat3(ux, uy, uz);\n}\nbool project_needs_rotation(vec3 commonPosition, out mat3 transform) {\nif (project_uProjectionMode == PROJECTION_MODE_GLOBE) {\ntransform = project_get_orientation_matrix(commonPosition);\nreturn true;\n}\nreturn false;\n}\nvec3 project_normal(vec3 vector) {\nvec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);\nvec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);\nmat3 rotation;\nif (project_needs_rotation(geometry.position.xyz, rotation)) {\nn = rotation * n;\n}\nreturn n;\n}\nvec4 project_offset_(vec4 offset) {\nfloat dy = offset.y;\nvec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;\nreturn vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);\n}\nvec2 project_mercator_(vec2 lnglat) {\nfloat x = lnglat.x;\nif (project_uWrapLongitude) {\nx = mod(x + 180., 360.0) - 180.;\n}\nfloat y = clamp(lnglat.y, -89.9, 89.9);\nreturn vec2(\nradians(x) + PI,\nPI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))\n) * WORLD_SCALE;\n}\nvec3 project_globe_(vec3 lnglatz) {\nfloat lambda = radians(lnglatz.x);\nfloat phi = radians(lnglatz.y);\nfloat cosPhi = cos(phi);\nfloat D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;\nreturn vec3(\nsin(lambda) * cosPhi,\n-cos(lambda) * cosPhi,\nsin(phi)\n) * D;\n}\nvec4 project_position(vec4 position, vec3 position64Low) {\nvec4 position_world = project_uModelMatrix * position;\nif (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {\nif (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\nreturn vec4(\nproject_mercator_(position_world.xy),\nproject_size_at_latitude(position_world.z, position_world.y),\nposition_world.w\n);\n}\nif (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {\nposition_world.xyz += project_uCoordinateOrigin;\n}\n}\nif (project_uProjectionMode == PROJECTION_MODE_GLOBE) {\nif (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\nreturn vec4(\nproject_globe_(position_world.xyz),\nposition_world.w\n);\n}\n}\nif (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {\nif (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\nif (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {\nreturn vec4(\nproject_mercator_(position_world.xy) - project_uCommonOrigin.xy,\nproject_size(position_world.z),\nposition_world.w\n);\n}\n}\n}\nif (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||\n(project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&\n(project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\nproject_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {\nposition_world.xyz -= project_uCoordinateOrigin;\n}\nreturn project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));\n}\nvec4 project_position(vec4 position) {\nreturn project_position(position, ZERO_64_LOW);\n}\nvec3 project_position(vec3 position, vec3 position64Low) {\nvec4 projected_position = project_position(vec4(position, 1.0), position64Low);\nreturn projected_position.xyz;\n}\nvec3 project_position(vec3 position) {\nvec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);\nreturn projected_position.xyz;\n}\nvec2 project_position(vec2 position) {\nvec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);\nreturn projected_position.xy;\n}\nvec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {\nreturn viewProjectionMatrix * position + center;\n}\nvec4 project_common_position_to_clipspace(vec4 position) {\nreturn project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);\n}\nvec2 project_pixel_size_to_clipspace(vec2 pixels) {\nvec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;\nreturn offset * project_uFocalDistance;\n}\nfloat project_size_to_pixel(float meters) {\nreturn project_size(meters) * project_uScale;\n}\nfloat project_size_to_pixel(float size, int unit) {\nif (unit == UNIT_METERS) return project_size_to_pixel(size);\nif (unit == UNIT_COMMON) return size * project_uScale;\nreturn size;\n}\nfloat project_pixel_size(float pixels) {\nreturn pixels / project_uScale;\n}\nvec2 project_pixel_size(vec2 pixels) {\nreturn pixels / project_uScale;\n}\n";var l=i(15203);const c={};const d={name:"project",dependencies:[n.O,s],vs:a,getUniforms:function(e){return void 0===e&&(e=c),"viewport"in e?(0,l.C)(e):{}}}},15203:(e,t,i)=>{i.d(t,{C:()=>g,v:()=>p});var n=i(16018),o=i(86671),s=i(19845),r=i(36268);const a=[0,0,0,0],l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],c=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],d=[0,0,0],u=[0,0,0],h=(0,r.Z)((function(e){let{viewport:t,devicePixelRatio:i,coordinateSystem:r,coordinateOrigin:u}=e;const{projectionCenter:h,viewProjectionMatrix:g,originCommon:f,cameraPosCommon:m,shaderCoordinateOrigin:v,geospatialOrigin:y}=function(e,t,i){const{viewMatrixUncentered:s,projectionMatrix:r}=e;let{viewMatrix:c,viewProjectionMatrix:d}=e,u=a,h=a,g=e.cameraPosition;const{geospatialOrigin:f,shaderCoordinateOrigin:m,offsetMode:v}=p(e,t,i);v&&(h=e.projectPosition(f||m),g=[g[0]-h[0],g[1]-h[1],g[2]-h[2]],h[3]=1,u=n.fF([],h,d),c=s||c,d=o.Jp([],r,c),d=o.Jp([],d,l));return{viewMatrix:c,viewProjectionMatrix:d,projectionCenter:u,originCommon:h,cameraPosCommon:g,shaderCoordinateOrigin:m,geospatialOrigin:f}}(t,r,u),_=t.getDistanceScales(),b=[t.width*i,t.height*i],w=n.fF([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,x={project_uCoordinateSystem:r,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:v,project_uCommonOrigin:f.slice(0,3),project_uCenter:h,project_uPseudoMeters:Boolean(t._pseudoMeters),project_uViewportSize:b,project_uDevicePixelRatio:i,project_uFocalDistance:w,project_uCommonUnitsPerMeter:_.unitsPerMeter,project_uCommonUnitsPerWorldUnit:_.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:d,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:g,project_uModelMatrix:c,project_uCameraPosition:m};if(y){const e=t.getDistanceScales(y);switch(r){case s.Df.METER_OFFSETS:x.project_uCommonUnitsPerWorldUnit=e.unitsPerMeter,x.project_uCommonUnitsPerWorldUnit2=e.unitsPerMeter2;break;case s.Df.LNGLAT:case s.Df.LNGLAT_OFFSETS:t._pseudoMeters||(x.project_uCommonUnitsPerMeter=e.unitsPerMeter),x.project_uCommonUnitsPerWorldUnit=e.unitsPerDegree,x.project_uCommonUnitsPerWorldUnit2=e.unitsPerDegree2;break;case s.Df.CARTESIAN:x.project_uCommonUnitsPerWorldUnit=[1,1,e.unitsPerMeter[2]],x.project_uCommonUnitsPerWorldUnit2=[0,0,e.unitsPerMeter2[2]]}}return x}));function p(e,t,i){void 0===i&&(i=u),i.length<3&&(i=[i[0],i[1],0]);let n,o=i,r=!0;switch(n=t===s.Df.LNGLAT_OFFSETS||t===s.Df.METER_OFFSETS?i:e.isGeospatial?[Math.fround(e.longitude),Math.fround(e.latitude),0]:null,e.projectionMode){case s.zG.WEB_MERCATOR:t!==s.Df.LNGLAT&&t!==s.Df.CARTESIAN||(n=[0,0,0],r=!1);break;case s.zG.WEB_MERCATOR_AUTO_OFFSET:t===s.Df.LNGLAT?o=n:t===s.Df.CARTESIAN&&(o=[Math.fround(e.center[0]),Math.fround(e.center[1]),0],n=e.unprojectPosition(o),o[0]-=i[0],o[1]-=i[1],o[2]-=i[2]);break;case s.zG.IDENTITY:o=e.position.map(Math.fround),o[2]=o[2]||0;break;case s.zG.GLOBE:r=!1,n=null;break;default:r=!1}return{geospatialOrigin:n,shaderCoordinateOrigin:o,offsetMode:r}}function g(e){let{viewport:t,devicePixelRatio:i=1,modelMatrix:n=null,coordinateSystem:o=s.Df.DEFAULT,coordinateOrigin:r=u,autoWrapLongitude:a=!1}=e;o===s.Df.DEFAULT&&(o=t.isGeospatial?s.Df.LNGLAT:s.Df.CARTESIAN);const l=h({viewport:t,devicePixelRatio:i,coordinateSystem:o,coordinateOrigin:r});return l.project_uWrapLongitude=a,l.project_uModelMatrix=n||c,l}},81135:(e,t,i)=>{i.d(t,{Z:()=>n});const n={name:"project32",dependencies:[i(82153).Z],vs:"\nvec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition\n) {\n  vec3 projectedPosition = project_position(position, position64Low);\n  mat3 rotation;\n  if (project_needs_rotation(projectedPosition, rotation)) {\n    // offset is specified as ENU\n    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe\n    offset = rotation * offset;\n  }\n  commonPosition = vec4(projectedPosition + offset, 1.0);\n  return project_common_position_to_clipspace(commonPosition);\n}\n\nvec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset\n) {\n  vec4 commonPosition;\n  return project_position_to_clipspace(position, position64Low, offset, commonPosition);\n}\n"}},59544:(e,t,i)=>{i.d(t,{Z:()=>a});var n=i(14042),o=i(55715);const s=["longitude","latitude","zoom","bearing","pitch"],r=["longitude","latitude","zoom"];class a extends n.Z{constructor(e){void 0===e&&(e={});const t=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:s,required:r},super(i.transitionProps),this.opts=i}initializeProps(e,t){const i=super.initializeProps(e,t),{makeViewport:n,around:o}=this.opts;if(n&&o){const s=n(e),r=n(t),a=s.unproject(o);i.start.around=o,Object.assign(i.end,{around:r.project(a),aroundPosition:a,width:t.width,height:t.height})}return i}interpolateProps(e,t,i){const n={};for(const s of this._propsToExtract)n[s]=(0,o.t7)(e[s]||0,t[s]||0,i);if(t.aroundPosition&&this.opts.makeViewport){const s=this.opts.makeViewport({...t,...n});Object.assign(n,s.panByPosition(t.aroundPosition,(0,o.t7)(e.around,t.around,i)))}return n}}},14042:(e,t,i)=>{i.d(t,{Z:()=>s});var n=i(55715),o=i(46149);class s{constructor(e){const{compare:t,extract:i,required:n}=e;this._propsToCompare=t,this._propsToExtract=i||t,this._requiredProps=n}arePropsEqual(e,t){for(const i of this._propsToCompare)if(!(i in e)||!(i in t)||!(0,n.fS)(e[i],t[i]))return!1;return!0}initializeProps(e,t){const i={},n={};for(const o of this._propsToExtract)(o in e||o in t)&&(i[o]=e[o],n[o]=t[o]);return this._checkRequiredProps(i),this._checkRequiredProps(n),{start:i,end:n}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach((t=>{const i=e[t];(0,o.Z)(Number.isFinite(i)||Array.isArray(i),t+" is required for transition")}))}}},96129:(e,t,i)=>{i.d(t,{Z:()=>n});class n{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var t,i;this.cancel(),this.settings=e,this._inProgress=!0,null==(t=(i=this.settings).onStart)||t.call(i,this)}end(){var e,t;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,null==(e=(t=this.settings).onEnd)||e.call(t,this))}cancel(){var e,t;this._inProgress&&(null==(e=(t=this.settings).onInterrupt)||e.call(t,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,t;if(!this._inProgress)return!1;if(null===this._handle){const{_timeline:e,settings:t}=this;this._handle=e.addChannel({delay:e.getTime(),duration:t.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),null==(e=(t=this.settings).onUpdate)||e.call(t,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}},46149:(e,t,i)=>{function n(e,t){if(!e)throw new Error(t||"deck.gl: assertion failed.")}i.d(t,{Z:()=>n})},8557:(e,t,i)=>{function n(e,t,i){if(e===t)return!0;if(!i||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let o=0;o<e.length;o++)if(!n(e[o],t[o],i-1))return!1;return!0}if(Array.isArray(t))return!1;if("object"==typeof e&&"object"==typeof t){const o=Object.keys(e),s=Object.keys(t);if(o.length!==s.length)return!1;for(const r of o){if(!t.hasOwnProperty(r))return!1;if(!n(e[r],t[r],i-1))return!1}return!0}return!1}i.d(t,{v:()=>n})},63619:(e,t,i)=>{function n(e,t){return void 0===t&&(t=()=>!0),Array.isArray(e)?o(e,t,[]):t(e)?[e]:[]}function o(e,t,i){let n=-1;for(;++n<e.length;){const s=e[n];Array.isArray(s)?o(s,t,i):t(s)&&i.push(s)}return i}function s(e){let{target:t,source:i,start:n=0,count:o=1}=e;const s=i.length,r=o*s;let a=0;for(let l=n;a<s;a++)t[l++]=i[a];for(;a<r;)a<r-a?(t.copyWithin(n+a,n,n+a),a*=2):(t.copyWithin(n+a,n,n+r-a),a=r);return t}i.d(t,{k:()=>s,x:()=>n})},55884:(e,t,i)=>{i.d(t,{D0:()=>r,jB:()=>s,jr:()=>a});const n=[],o=[];function s(e,t,i){void 0===t&&(t=0),void 0===i&&(i=1/0);let s=n;const r={index:-1,data:e,target:[]};return e?"function"==typeof e[Symbol.iterator]?s=e:e.length>0&&(o.length=e.length,s=o):s=n,(t>0||Number.isFinite(i))&&(s=(Array.isArray(s)?s:Array.from(s)).slice(t,i),r.index=t-1),{iterable:s,objectInfo:r}}function r(e){return e&&e[Symbol.asyncIterator]}function a(e,t){const{size:i,stride:n,offset:o,startIndices:s,nested:r}=t,a=e.BYTES_PER_ELEMENT,l=n?n/a:i,c=o?o/a:0,d=Math.floor((e.length-c)/l);return(t,n)=>{let{index:o,target:a}=n;if(!s){const t=o*l+c;for(let n=0;n<i;n++)a[n]=e[t+n];return a}const u=s[o],h=s[o+1]||d;let p;if(r){p=new Array(h-u);for(let t=u;t<h;t++){const n=t*l+c;a=new Array(i);for(let t=0;t<i;t++)a[t]=e[n+t];p[t-u]=a}}else if(l===i)p=e.subarray(u*i+c,h*i+c);else{p=new e.constructor((h-u)*i);let t=0;for(let n=u;n<h;n++){const o=n*l+c;for(let n=0;n<i;n++)p[t++]=e[o+n]}}return p}}},70575:(e,t,i)=>{i.d(t,{Z:()=>n});const n=new(i(52327).Z)({id:"deck"})},82808:(e,t,i)=>{i.d(t,{Du:()=>l,Ks:()=>u,TK:()=>p,Xt:()=>a,bS:()=>s,cc:()=>g,wQ:()=>r});var n=i(92232),o=i(51394);function s(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function r(e,t){const i=e%t;return i<0?t+i:i}function a(e){return[e[12],e[13],e[14]]}function l(e){return{left:d(e[3]+e[0],e[7]+e[4],e[11]+e[8],e[15]+e[12]),right:d(e[3]-e[0],e[7]-e[4],e[11]-e[8],e[15]-e[12]),bottom:d(e[3]+e[1],e[7]+e[5],e[11]+e[9],e[15]+e[13]),top:d(e[3]-e[1],e[7]-e[5],e[11]-e[9],e[15]-e[13]),near:d(e[3]+e[2],e[7]+e[6],e[11]+e[10],e[15]+e[14]),far:d(e[3]-e[2],e[7]-e[6],e[11]-e[10],e[15]-e[14])}}const c=new o.P;function d(e,t,i,n){c.set(e,t,i);const s=c.len();return{distance:n/s,normal:new o.P(-e/s,-t/s,-i/s)}}function u(e){return e-Math.fround(e)}let h;function p(e,t){const{size:i=1,startIndex:o=0}=t,s=void 0!==t.endIndex?t.endIndex:e.length,r=(s-o)/i;h=n.Z.allocate(h,r,{type:Float32Array,size:2*i});let a=o,l=0;for(;a<s;){for(let t=0;t<i;t++){const n=e[a++];h[l+t]=n,h[l+t+i]=u(n)}l+=2*i}return h.subarray(0,r*i*2)}function g(e){let t=null,i=!1;for(const n of e)n&&(t?(i||(t=[[t[0][0],t[0][1]],[t[1][0],t[1][1]]],i=!0),t[0][0]=Math.min(t[0][0],n[0][0]),t[0][1]=Math.min(t[0][1],n[0][1]),t[1][0]=Math.max(t[1][0],n[1][0]),t[1][1]=Math.max(t[1][1],n[1][1])):t=n);return t}},36268:(e,t,i)=>{function n(e,t){if(e===t)return!0;if(Array.isArray(e)){const i=e.length;if(!t||t.length!==i)return!1;for(let n=0;n<i;n++)if(e[n]!==t[n])return!1;return!0}return!1}function o(e){let t,i={};return o=>{for(const s in o)if(!n(o[s],i[s])){t=e(o),i=o;break}return t}}i.d(t,{Z:()=>o})},66510:(e,t,i)=>{function n(e,t){if(!t)return e;const i={...e,...t};if("defines"in t&&(i.defines={...e.defines,...t.defines}),"modules"in t&&(i.modules=(e.modules||[]).concat(t.modules),t.modules.some((e=>"project64"===e.name)))){const e=i.modules.findIndex((e=>"project32"===e.name));e>=0&&i.modules.splice(e,1)}if("inject"in t)if(e.inject){const n={...e.inject};for(const e in t.inject)n[e]=(n[e]||"")+t.inject[e];i.inject=n}else i.inject=t.inject;return i}i.d(t,{l:()=>n})},80662:(e,t,i)=>{i.d(t,{Z:()=>a});var n=i(55884),o=i(92232),s=i(46149),r=i(63847);class a{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:t={}}=e;this.typedArrayManager=o.Z,this.attributes={},this._attributeDefs=t,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:t,buffers:i={},getGeometry:n,geometryBuffer:o,positionFormat:r,dataChanged:a,normalize:l=!0}=this.opts;if(this.data=t,this.getGeometry=n,this.positionSize=o&&o.size||("XY"===r?2:3),this.buffers=i,this.normalize=l,o&&((0,s.Z)(t.startIndices),this.getGeometry=this.getGeometryFromBuffer(o),l||(i.vertexPositions=o)),this.geometryBuffer=i.vertexPositions,Array.isArray(a))for(const s of a)this._rebuildGeometry(s);else this._rebuildGeometry()}updatePartialGeometry(e){let{startRow:t,endRow:i}=e;this._rebuildGeometry({startRow:t,endRow:i})}getGeometryFromBuffer(e){const t=e.value||e;return ArrayBuffer.isView(t)?(0,n.jr)(t,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,t){const{attributes:i,buffers:n,_attributeDefs:o,typedArrayManager:s}=this;for(const r in o)if(r in n)s.release(i[r]),i[r]=null;else{const n=o[r];n.copy=t,i[r]=s.allocate(i[r],e,n)}}_forEachGeometry(e,t,i){const{data:o,getGeometry:s}=this,{iterable:r,objectInfo:a}=(0,n.jB)(o,t,i);for(const n of r){a.index++;e(s?s(n,a):null,a.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:t,vertexStarts:i,instanceCount:n}=this;const{data:o,geometryBuffer:s}=this,{startRow:a=0,endRow:l=1/0}=e||{},c={};if(e||(t=[0],i=[0]),this.normalize||!s)this._forEachGeometry(((e,t)=>{const n=e&&this.normalizeGeometry(e);c[t]=n,i[t+1]=i[t]+(n?this.getGeometrySize(n):0)}),a,l),n=i[i.length-1];else if(i=o.startIndices,n=i[o.length]||0,ArrayBuffer.isView(s))n=n||s.length/this.positionSize;else if(s instanceof r.l){const e=4*this.positionSize;n=n||s.byteLength/e}else if(s.buffer){const e=s.stride||4*this.positionSize;n=n||s.buffer.byteLength/e}else if(s.value){const e=s.value,t=s.stride/e.BYTES_PER_ELEMENT||this.positionSize;n=n||e.length/t}this._allocate(n,Boolean(e)),this.indexStarts=t,this.vertexStarts=i,this.instanceCount=n;const d={};this._forEachGeometry(((e,o)=>{const s=c[o]||e;d.vertexStart=i[o],d.indexStart=t[o];const r=o<i.length-1?i[o+1]:n;d.geometrySize=r-i[o],d.geometryIndex=o,this.updateGeometryAttributes(s,d)}),a,l),this.vertexCount=t[t.length-1]}}},92232:(e,t,i)=>{i.d(t,{Z:()=>n});const n=new class{constructor(e){void 0===e&&(e={}),this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,i){let{size:n=1,type:o,padding:s=0,copy:r=!1,initialize:a=!1,maxCount:l}=i;const c=o||e&&e.constructor||Float32Array,d=t*n+s;if(ArrayBuffer.isView(e)){if(d<=e.length)return e;if(d*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new c(e.buffer,0,d)}let u=1/0;l&&(u=l*n+s);const h=this._allocate(c,d,a,u);return e&&r?h.set(e):a||h.fill(0,0,4),this._release(e),h}release(e){this._release(e)}_allocate(e,t,i,n){let o=Math.max(Math.ceil(t*this.opts.overAlloc),1);o>n&&(o=n);const s=this._pool,r=e.BYTES_PER_ELEMENT*o,a=s.findIndex((e=>e.byteLength>=r));if(a>=0){const t=new e(s.splice(a,1)[0],0,o);return i&&t.fill(0),t}return new e(o)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:i}=e,{byteLength:n}=i,o=t.findIndex((e=>e.byteLength>=n));o<0?t.push(i):(o>0||t.length<this.opts.poolSize)&&t.splice(o,0,i),t.length>this.opts.poolSize&&t.shift()}}},30120:(e,t,i)=>{i.d(t,{Z:()=>p});var n=i(84900),o=i(36355),s=i(19845),r=i(53015),a=i(16018);const l=Math.PI/180,c=180/Math.PI,d=6370972,u=256;function h(){const e=u/d,t=Math.PI/180*u;return{unitsPerMeter:[e,e,e],unitsPerMeter2:[0,0,0],metersPerUnit:[1/e,1/e,1/e],unitsPerDegree:[t,t,e],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/t,1/t,1/e]}}class p extends o.Z{constructor(e){void 0===e&&(e={});const{latitude:t=0,longitude:i=0,zoom:o=0,nearZMultiplier:s=.1,farZMultiplier:r=2,resolution:a=10}=e;let{height:c,altitude:d=1.5}=e;c=c||1,d=Math.max(.75,d);const p=(new n.y).lookAt({eye:[0,-d,0],up:[0,0,1]}),g=Math.pow(2,o);p.rotateX(t*l),p.rotateZ(-i*l),p.scale(g/c);const f=Math.atan(.5/d),m=2*u*g/c;super({...e,height:c,viewMatrix:p,longitude:i,latitude:t,zoom:o,distanceScales:h(),fovyRadians:2*f,focalDistance:d,near:s,far:Math.min(2,1/m+1)*d*r}),this.latitude=t,this.longitude=i,this.resolution=a}get projectionMode(){return s.zG.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e){void 0===e&&(e={});const t={targetZ:e.z||0},i=this.unproject([0,this.height/2],t),n=this.unproject([this.width/2,0],t),o=this.unproject([this.width,this.height/2],t),s=this.unproject([this.width/2,this.height],t);return o[0]<this.longitude&&(o[0]+=360),i[0]>this.longitude&&(i[0]-=360),[Math.min(i[0],o[0],n[0],s[0]),Math.min(i[1],o[1],n[1],s[1]),Math.max(i[0],o[0],n[0],s[0]),Math.max(i[1],o[1],n[1],s[1])]}unproject(e,t){let{topLeft:i=!0,targetZ:n}=void 0===t?{}:t;const[o,s,a]=e,l=i?s:this.height-s,{pixelUnprojectionMatrix:c}=this;let h;if(Number.isFinite(a))h=g(c,[o,l,a,1]);else{const e=g(c,[o,l,-1,1]),t=g(c,[o,l,1,1]),i=((n||0)/d+1)*u,s=r.x9(r.lu([],e,t)),a=r.x9(e),p=r.x9(t),f=4*((4*a*p-(s-a-p)**2)/16)/s,m=(Math.sqrt(a-f)-Math.sqrt(Math.max(0,i*i-f)))/Math.sqrt(s);h=r.t7([],e,t,m)}const[p,f,m]=this.unprojectPosition(h);return Number.isFinite(a)?[p,f,m]:Number.isFinite(n)?[p,f,n]:[p,f]}projectPosition(e){const[t,i,n=0]=e,o=t*l,s=i*l,r=Math.cos(s),a=(n/d+1)*u;return[Math.sin(o)*r*a,-Math.cos(o)*r*a,Math.sin(s)*a]}unprojectPosition(e){const[t,i,n]=e,o=r.Zh(e),s=Math.asin(n/o);return[Math.atan2(t,-i)*c,s*c,(o/u-1)*d]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,t){const i=this.unproject(t);return{longitude:e[0]-i[0]+this.longitude,latitude:e[1]-i[1]+this.latitude}}}function g(e,t){const i=a.fF([],t,e);return a.bA(i,i,1/i[3]),i}},36355:(e,t,i)=>{i.d(t,{Z:()=>f});var n=i(70575),o=i(82808),s=i(84900),r=i(55715),a=i(51394),l=i(86671),c=i(77394),d=i(19845);const u=Math.PI/180,h=(0,o.bS)(),p=[0,0,0],g={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};class f{constructor(e){void 0===e&&(e={}),this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||g,this.focalDistance=e.focalDistance||1,this.position=e.position||p,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:i}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?d.zG.WEB_MERCATOR:d.zG.WEB_MERCATOR_AUTO_OFFSET:d.zG.IDENTITY}equals(e){return e instanceof f&&(this===e||e.width===this.width&&e.height===this.height&&e.scale===this.scale&&(0,r.fS)(e.projectionMatrix,this.projectionMatrix)&&(0,r.fS)(e.viewMatrix,this.viewMatrix))}project(e,t){let{topLeft:i=!0}=void 0===t?{}:t;const n=this.projectPosition(e),o=(0,c.aW)(n,this.pixelProjectionMatrix),[s,r]=o,a=i?r:this.height-r;return 2===e.length?[s,a]:[s,a,o[2]]}unproject(e,t){let{topLeft:i=!0,targetZ:n}=void 0===t?{}:t;const[o,s,r]=e,a=i?s:this.height-s,l=n&&n*this.distanceScales.unitsPerMeter[2],d=(0,c.CT)([o,a,r],this.pixelUnprojectionMatrix,l),[u,h,p]=this.unprojectPosition(d);return Number.isFinite(r)?[u,h,p]:Number.isFinite(n)?[u,h,n]:[u,h]}projectPosition(e){const[t,i]=this.projectFlat(e);return[t,i,(e[2]||0)*this.distanceScales.unitsPerMeter[2]]}unprojectPosition(e){const[t,i]=this.unprojectFlat(e);return[t,i,(e[2]||0)*this.distanceScales.metersPerUnit[2]]}projectFlat(e){if(this.isGeospatial){const t=(0,c.w5)(e);return t[1]=(0,r.uZ)(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?(0,c.es)(e):e}getBounds(e){void 0===e&&(e={});const t={targetZ:e.z||0},i=this.unproject([0,0],t),n=this.unproject([this.width,0],t),o=this.unproject([0,this.height],t),s=this.unproject([this.width,this.height],t);return[Math.min(i[0],n[0],o[0],s[0]),Math.min(i[1],n[1],o[1],s[1]),Math.max(i[0],n[0],o[0],s[0]),Math.max(i[1],n[1],o[1],s[1])]}getDistanceScales(e){return e?(0,c.ro)({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel(e){let{x:t,y:i,width:n=1,height:o=1}=e;return t<this.x+this.width&&this.x<t+n&&i<this.y+this.height&&this.y<i+o}getFrustumPlanes(){return this._frustumPlanes.near||Object.assign(this._frustumPlanes,(0,o.Du)(this.viewProjectionMatrix)),this._frustumPlanes}panByPosition(e,t){return null}_initProps(e){const t=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=(0,c.Bf)({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||(0,c.ro)({latitude:i,longitude:t}));const n=Math.pow(2,this.zoom);this.scale=n;const{position:o,modelMatrix:r}=e;let l=p;if(o&&(l=r?new s.y(r).transformAsVector(o,[]):o),this.isGeospatial){const e=this.projectPosition([t,i,0]);this.center=new a.P(l).scale(this.distanceScales.unitsPerMeter).add(e)}else this.center=this.projectPosition(l)}_initMatrices(e){const{viewMatrix:t=h,projectionMatrix:i=null,orthographic:c=!1,fovyRadians:d,fovy:p=75,near:g=.1,far:f=1e3,padding:m=null,focalDistance:v=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=(new s.y).multiplyRight(t).translate(new a.P(this.center).negate()),this.projectionMatrix=i||function(e){let{width:t,height:i,orthographic:n,fovyRadians:o,focalDistance:a,padding:l,near:c,far:d}=e;const u=t/i,h=n?(new s.y).orthographic({fovy:o,aspect:u,focalDistance:a,near:c,far:d}):(new s.y).perspective({fovy:o,aspect:u,near:c,far:d});if(l){const{left:e=0,right:n=0,top:o=0,bottom:s=0}=l,a=(0,r.uZ)((e+t-n)/2,0,t)-t/2,c=(0,r.uZ)((o+i-s)/2,0,i)-i/2;h[8]-=2*a/t,h[9]+=2*c/i}return h}({width:this.width,height:this.height,orthographic:c,fovyRadians:d||p*u,focalDistance:v,padding:m,near:g,far:f});const y=(0,o.bS)();l.Jp(y,y,this.projectionMatrix),l.Jp(y,y,this.viewMatrix),this.viewProjectionMatrix=y,this.viewMatrixInverse=l.U_([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=(0,o.Xt)(this.viewMatrixInverse);const _=(0,o.bS)(),b=(0,o.bS)();l.bA(_,_,[this.width/2,-this.height/2,1]),l.Iu(_,_,[1,-1,0]),l.Jp(b,_,this.viewProjectionMatrix),this.pixelProjectionMatrix=b,this.pixelUnprojectionMatrix=l.U_((0,o.bS)(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||n.Z.warn("Pixel project matrix not invertible")()}}f.displayName="Viewport"},83224:(e,t,i)=>{i.d(t,{Z:()=>l});var n=i(36355),o=i(77394),s=i(55715),r=i(84900),a=i(24621);class l extends n.Z{constructor(e){void 0===e&&(e={});const{latitude:t=0,longitude:i=0,zoom:n=0,pitch:a=0,bearing:l=0,nearZMultiplier:c=.1,farZMultiplier:d=1.01,nearZ:u,farZ:h,orthographic:p=!1,projectionMatrix:g,repeat:f=!1,worldOffset:m=0,position:v,padding:y,legacyMeterSizes:_=!1}=e;let{width:b,height:w,altitude:x=1.5}=e;const P=Math.pow(2,n);let C;b=b||1,w=w||1;let S=null;if(g)x=g[5]/2,C=(0,o.Lu)(x);else{let i;if(e.fovy?(C=e.fovy,x=(0,o.sj)(C)):C=(0,o.Lu)(x),y){const{top:e=0,bottom:t=0}=y;i=[0,(0,s.uZ)((e+w-t)/2,0,w)-w/2]}S=(0,o.wl)({width:b,height:w,scale:P,center:v&&[0,0,v[2]*(0,o.NC)(t)],offset:i,pitch:a,fovy:C,nearZMultiplier:c,farZMultiplier:d}),Number.isFinite(u)&&(S.near=u),Number.isFinite(h)&&(S.far=h)}let T=(0,o.lf)({height:w,pitch:a,bearing:l,scale:P,altitude:x});if(m){T=(new r.y).translate([512*m,0,0]).multiplyLeft(T)}super({...e,width:b,height:w,viewMatrix:T,longitude:i,latitude:t,zoom:n,...S,fovy:C,focalDistance:x}),this.latitude=t,this.longitude=i,this.zoom=n,this.pitch=a,this.bearing=l,this.altitude=x,this.fovy=C,this.orthographic=p,this._subViewports=f?[]:null,this._pseudoMeters=_,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),i=Math.ceil((e[2]-180)/360);for(let n=t;n<=i;n++){const e=n?new l({...this,worldOffset:n}):this;this._subViewports.push(e)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,i]=this.projectFlat(e);return[t,i,(e[2]||0)*(0,o.NC)(e[1])]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,i]=this.unprojectFlat(e);return[t,i,(e[2]||0)/(0,o.NC)(i)]}addMetersToLngLat(e,t){return(0,o.eG)(e,t)}panByPosition(e,t){const i=(0,o.CT)(t,this.pixelUnprojectionMatrix),n=this.projectFlat(e),s=a.IH([],n,a.tk([],i)),r=a.IH([],this.center,s),[l,c]=this.unprojectFlat(r);return{longitude:l,latitude:c}}getBounds(e){void 0===e&&(e={});const t=(0,o.zX)(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t){void 0===t&&(t={});const{width:i,height:n}=this,{longitude:s,latitude:r,zoom:a}=(0,o.Xg)({width:i,height:n,bounds:e,...t});return new l({width:i,height:n,longitude:s,latitude:r,zoom:a})}}l.displayName="WebMercatorViewport"},38861:(e,t,i)=>{i.d(t,{Z:()=>r});var n=i(95004),o=i(83224),s=i(26123);class r extends n.Z{constructor(e){void 0===e&&(e={}),super(e)}get ViewportType(){return o.Z}get ControllerType(){return s.Z}}r.displayName="MapView"},95004:(e,t,i)=>{i.d(t,{Z:()=>a});const n=/([0-9]+\.?[0-9]*)(%|px)/;function o(e){switch(typeof e){case"number":return{position:e,relative:!1};case"string":const t=n.exec(e);if(t&&t.length>=3){const e="%"===t[2],i=parseFloat(t[1]);return{position:e?i/100:i,relative:e}}default:throw new Error("Could not parse position string "+e)}}function s(e,t){return e.relative?Math.round(e.position*t):e.position}var r=i(8557);class a{constructor(e){const{id:t,x:i=0,y:n=0,width:s="100%",height:r="100%",padding:a=null}=e;this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=o(i),this._y=o(n),this._width=o(s),this._height=o(r),this._padding=a&&{left:o(a.left||0),right:o(a.right||0),top:o(a.top||0),bottom:o(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e||this.ViewportType===e.ViewportType&&(0,r.v)(this.props,e.props,2)}makeViewport(e){let{width:t,height:i,viewState:n}=e;n=this.filterViewState(n);const o=this.getDimensions({width:t,height:i});return o.height&&o.width?new this.ViewportType({...n,...this.props,...o}):null}getViewStateId(){const{viewState:e}=this.props;return"string"==typeof e?e:(null==e?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&"object"==typeof this.props.viewState){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const e in this.props.viewState)"id"!==e&&(t[e]=this.props.viewState[e]);return t}return e}getDimensions(e){let{width:t,height:i}=e;const n={x:s(this._x,t),y:s(this._y,i),width:s(this._width,t),height:s(this._height,i)};return this._padding&&(n.padding={left:s(this._padding.left,t),top:s(this._padding.top,i),right:s(this._padding.right,t),bottom:s(this._padding.bottom,i)}),n}get controller(){const e=this.props.controller;return e?!0===e?{type:this.ControllerType}:"function"==typeof e?{type:e}:{type:this.ControllerType,...e}:null}}},80736:(e,t,i)=>{i.d(t,{Z:()=>d});var n=i(24217);const o={clipBounds:[0,0,1,1],clipByInstance:void 0},s="\nuniform vec4 clip_bounds;\nbool clip_isInBounds(vec2 position) {\nreturn position.x >= clip_bounds[0] && position.y >= clip_bounds[1] && position.x < clip_bounds[2] && position.y < clip_bounds[3];\n}\n",r={name:"clip-vs",vs:s},a={"vs:#decl":"\nout float clip_isVisible;\n","vs:DECKGL_FILTER_GL_POSITION":"\nclip_isVisible = float(clip_isInBounds(geometry.worldPosition.xy));\n","fs:#decl":"\nin float clip_isVisible;\n","fs:DECKGL_FILTER_COLOR":"\nif (clip_isVisible < 0.5) discard;\n"},l={name:"clip-fs",fs:s},c={"vs:#decl":"\nout vec2 clip_commonPosition;\n","vs:DECKGL_FILTER_GL_POSITION":"\nclip_commonPosition = geometry.position.xy;\n","fs:#decl":"\nin vec2 clip_commonPosition;\n","fs:DECKGL_FILTER_COLOR":"\nif (!clip_isInBounds(clip_commonPosition)) discard;\n"};class d extends n.Z{getShaders(){let e="instancePositions"in this.getAttributeManager().attributes;return void 0!==this.props.clipByInstance&&(e=Boolean(this.props.clipByInstance)),this.state.clipByInstance=e,e?{modules:[r],inject:a}:{modules:[l],inject:c}}draw(e){let{uniforms:t}=e;const{clipBounds:i}=this.props;if(this.state.clipByInstance)t.clip_bounds=i;else{const e=this.projectPosition([i[0],i[1],0]),n=this.projectPosition([i[2],i[3],0]);t.clip_bounds=[Math.min(e[0],n[0]),Math.min(e[1],n[1]),Math.max(e[0],n[0]),Math.max(e[1],n[1])]}}}d.defaultProps=o,d.extensionName="ClipExtension"},72416:(e,t,i)=>{i.d(t,{Z:()=>r});var n=i(96677),o=i(75096);const s={...o.Z.defaultProps};class r extends n.Z{indexToBounds(){return null}renderLayers(){const{elevationScale:e,extruded:t,wireframe:i,filled:n,stroked:s,lineWidthUnits:r,lineWidthScale:a,lineWidthMinPixels:l,lineWidthMaxPixels:c,lineJointRounded:d,lineMiterLimit:u,lineDashJustified:h,getElevation:p,getFillColor:g,getLineColor:f,getLineWidth:m}=this.props,{updateTriggers:v,material:y,transitions:_}=this.props,b=this.getSubLayerClass("cell",o.Z),{updateTriggers:w,...x}=this.indexToBounds()||{};return new b({filled:n,wireframe:i,extruded:t,elevationScale:e,stroked:s,lineWidthUnits:r,lineWidthScale:a,lineWidthMinPixels:l,lineWidthMaxPixels:c,lineJointRounded:d,lineMiterLimit:u,lineDashJustified:h,material:y,transitions:_,getElevation:p,getFillColor:g,getLineColor:f,getLineWidth:m},this.getSubLayerProps({id:"cell",updateTriggers:v&&{...w,getElevation:v.getElevation,getFillColor:v.getFillColor,getLineColor:v.getLineColor,getLineWidth:v.getLineWidth}}),x)}}r.layerName="GeoCellLayer",r.defaultProps=s},8373:(e,t,i)=>{i.d(t,{Z:()=>u});var n=i(72416);const o="0123456789bcdefghjkmnpqrstuvwxyz",s={};for(let h=0;h<o.length;h++)s[o.charAt(h)]=h;const r=-90,a=90,l=-180,c=180;function d(e){const[t,i,n,o]=function(e){let t,i=!0,n=a,o=r,d=c,u=l,h=0;for(let r=0,a=e.length;r<a;r++){const a=e[r].toLowerCase();h=s[a];for(let e=4;e>=0;e--){const s=h>>e&1;i?(t=(d+u)/2,1===s?u=t:d=t):(t=(n+o)/2,1===s?o=t:n=t),i=!i}}return[o,u,n,d]}(e);return[o,n,o,t,i,t,i,n,o,n]}class u extends n.Z{indexToBounds(){const{data:e,getGeohash:t}=this.props;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(e,i)=>d(t(e,i))}}}u.layerName="GeohashLayer",u.defaultProps={getGeohash:{type:"accessor",value:e=>e.geohash}}},90157:(e,t,i)=>{i.d(t,{Z:()=>o});var n=i(36148);class o extends n.Z{}o.layerName="GreatCircleLayer",o.defaultProps={getHeight:{type:"accessor",value:0},greatCircle:!0}},15386:(e,t,i)=>{i.d(t,{Z:()=>l});var n=i(3305),o=i(55884),s=i(43850),r=i(72416),a=i(34540);class l extends r.Z{initializeState(){s.Z._checkH3Lib()}updateState(e){let{props:t,changeFlags:i}=e;if(i.dataChanged||i.updateTriggersChanged&&i.updateTriggersChanged.getHexagons){const{data:e,getHexagons:i}=t,s=[],{iterable:r,objectInfo:l}=(0,o.jB)(e);for(const t of r){l.index++;const e=i(t,l),o=(0,n.Wy)(e,!0);for(const i of o){for(const e of i)(0,a.aZ)(e);s.push(this.getSubLayerRow({polygon:i},t,l.index))}}this.setState({polygons:s})}}indexToBounds(){const{getElevation:e,getFillColor:t,getLineColor:i,getLineWidth:n}=this.props;return{data:this.state.polygons,getPolygon:e=>e.polygon,getElevation:this.getSubLayerAccessor(e),getFillColor:this.getSubLayerAccessor(t),getLineColor:this.getSubLayerAccessor(i),getLineWidth:this.getSubLayerAccessor(n)}}}l.layerName="H3ClusterLayer",l.defaultProps={getHexagons:{type:"accessor",value:e=>e.hexagons}}},43850:(e,t,i)=>{i.d(t,{Z:()=>d});var n=i(3305),o=i(96677),s=i(55884),r=i(75096),a=i(66918),l=i(34540);const c={...r.Z.defaultProps,highPrecision:"auto",coverage:{type:"number",min:0,max:1,value:1},centerHexagon:null,getHexagon:{type:"accessor",value:e=>e.hexagon},extruded:!0};class d extends o.Z{initializeState(){d._checkH3Lib(),this.state={edgeLengthKM:0,resolution:-1}}shouldUpdateState(e){let{changeFlags:t}=e;return this._shouldUseHighPrecision()?t.propsOrDataChanged:t.somethingChanged}updateState(e){let{props:t,changeFlags:i}=e;if(!0!==t.highPrecision&&(i.dataChanged||i.updateTriggersChanged&&i.updateTriggersChanged.getHexagon)){const e=this._calculateH3DataProps();this.setState(e)}this._updateVertices(this.context.viewport)}_calculateH3DataProps(){let e=-1,t=!1,i=!1;const{iterable:o,objectInfo:r}=(0,s.jB)(this.props.data);for(const s of o){r.index++;const o=this.props.getHexagon(s,r),a=(0,n.uG)(o);if(e<0){if(e=a,!this.props.highPrecision)break}else if(e!==a){i=!0;break}if((0,n.wN)(o)){t=!0;break}}return{resolution:e,edgeLengthKM:e>=0?(0,n.hv)(e,"km"):0,hasMultipleRes:i,hasPentagon:t}}_shouldUseHighPrecision(){if("auto"===this.props.highPrecision){const{resolution:e,hasPentagon:t,hasMultipleRes:i}=this.state,{viewport:n}=this.context;return Boolean(null==n?void 0:n.resolution)||i||t||e>=0&&e<=5}return this.props.highPrecision}_updateVertices(e){if(this._shouldUseHighPrecision())return;const{resolution:t,edgeLengthKM:i,centerHex:o}=this.state;if(t<0)return;const s=this.props.centerHexagon||(0,n.mD)(e.latitude,e.longitude,t);if(o===s)return;if(o)try{if((0,n.S1)(o,s)*i<10)return}catch{}const{unitsPerMeter:r}=e.distanceScales;let a=(0,l.VH)(s);const[c,d]=(0,n.rS)(s),[u,h]=e.projectFlat([d,c]);a=a.map((t=>{const i=e.projectFlat(t);return[(i[0]-u)/r[0],(i[1]-h)/r[1]]})),this.setState({centerHex:s,vertices:a})}renderLayers(){return this._shouldUseHighPrecision()?this._renderPolygonLayer():this._renderColumnLayer()}_getForwardProps(){const{elevationScale:e,material:t,coverage:i,extruded:n,wireframe:o,stroked:s,filled:r,lineWidthUnits:a,lineWidthScale:l,lineWidthMinPixels:c,lineWidthMaxPixels:d,getFillColor:u,getElevation:h,getLineColor:p,getLineWidth:g,transitions:f,updateTriggers:m}=this.props;return{elevationScale:e,extruded:n,coverage:i,wireframe:o,stroked:s,filled:r,lineWidthUnits:a,lineWidthScale:l,lineWidthMinPixels:c,lineWidthMaxPixels:d,material:t,getElevation:h,getFillColor:u,getLineColor:p,getLineWidth:g,transitions:f,updateTriggers:{getFillColor:m.getFillColor,getElevation:m.getElevation,getLineColor:m.getLineColor,getLineWidth:m.getLineWidth}}}_renderPolygonLayer(){const{data:e,getHexagon:t,updateTriggers:i,coverage:n}=this.props,o=this.getSubLayerClass("hexagon-cell-hifi",r.Z),s=this._getForwardProps();return s.updateTriggers.getPolygon=function(e,t){let i;return i=null==e?t:"object"==typeof e?{...e,coverage:t}:{getHexagon:e,coverage:t},i}(i.getHexagon,n),new o(s,this.getSubLayerProps({id:"hexagon-cell-hifi",updateTriggers:s.updateTriggers}),{data:e,_normalize:!1,_windingOrder:"CCW",positionFormat:"XY",getPolygon:(e,i)=>{const o=t(e,i);return(0,l.UQ)((0,l.VH)(o,n))}})}_renderColumnLayer(){const{data:e,getHexagon:t,updateTriggers:i}=this.props,n=this.getSubLayerClass("hexagon-cell",a.Z),o=this._getForwardProps();return o.updateTriggers.getPosition=i.getHexagon,new n(o,this.getSubLayerProps({id:"hexagon-cell",flatShading:!0,updateTriggers:o.updateTriggers}),{data:e,diskResolution:6,radius:1,vertices:this.state.vertices,getPosition:l.mA.bind(null,t)})}}d.defaultProps=c,d.layerName="H3HexagonLayer",d._checkH3Lib=()=>{}},34540:(e,t,i)=>{i.d(t,{UQ:()=>l,VH:()=>a,aZ:()=>s,mA:()=>r});var n=i(3305),o=i(55715);function s(e,t){t=void 0===t?e[0][0]:t;for(const i of e){const e=i[0]-t;e>180?i[0]-=360:e<-180&&(i[0]+=360)}}function r(e,t,i){const o=e(t,i),[s,r]=(0,n.rS)(o);return[r,s]}function a(e,t){void 0===t&&(t=1);const i=(0,n.jf)(e,!0);return 1!==t?function(e,t,i){const[r,a]=(0,n.rS)(e),l=t.length;s(t,a);const c=t[0]===t[l-1]?l-1:l;for(let n=0;n<c;n++)t[n][0]=(0,o.t7)(a,t[n][0],i),t[n][1]=(0,o.t7)(r,t[n][1],i)}(e,i,t):s(i),i}function l(e){const t=new Float64Array(2*e.length);let i=0;for(const n of e)t[i++]=n[0],t[i++]=n[1];return t}},85073:(e,t,i)=>{i.d(t,{Z:()=>x});var n=i(19845),o=i(70575),s=i(15788),r=i(80736),a=i(84900),l=i(73291),c=i(51416),d=i(55715);const u={Point:h,MultiPoint:function(e,t,i){return p(e,t,i)},LineString:g,MultiLineString:function(e,t,i){return e.map((e=>g(e,t,i)))},Polygon:f,MultiPolygon:function(e,t,i){return e.map((e=>f(e,t,i)))}};function h(e,t,i){let[n,o]=e,[s,r]=t;const a=(0,d.t7)(s[0],r[0],n),l=(0,d.t7)(s[1],r[1],o);return i.unprojectFlat([a,l])}function p(e,t,i){return e.map((e=>h(e,t,i)))}function g(e,t,i){return p(e,t,i)}function f(e,t,i){return e.map((e=>p(e,t,i)))}const m=["points","lines","polygons"];function v(e,t,i,n){const o=e.featureIds.value;if(!o.length)return-1;let s=0,r=o[o.length-1]+1;if(n){const t=function(e,t){if(!e.__layers){const t={},{properties:i}=e;for(let e=0;e<i.length;e++){const{layerName:n}=i[e];n&&(t[n]?t[n][1]=e:t[n]=[e,e])}e.__layers=t}return e.__layers[t]}(e,n);if(!t)return-1;s=t[0],r=t[1]+1}let a=-1;if(t in e.numericProps){const n=e.numericProps[t].value.findIndex(((e,t)=>e===i&&o[t]>=s&&o[t]<r));return n>=0?e.globalFeatureIds.value[n]:-1}return t?a=y(e.properties,(e=>e[t]===i),s,r):e.fields&&(a=y(e.fields,(e=>e.id===i),s,r)),a>=0?function(e,t){if(!e.__ids){const t=[],i=e.featureIds.value,n=e.globalFeatureIds.value;for(let e=0;e<i.length;e++)t[i[e]]=n[e];e.__ids=t}return e.__ids[t]}(e,a):-1}function y(e,t,i,n){for(let o=i;o<n;o++)if(t(e[o],o))return o;return-1}var _=i(54282),b=i(18188);const w={...s.Z.defaultProps,data:b.zc,onDataLoad:{type:"function",value:null,optional:!0,compare:!1},uniqueIdProperty:"",highlightedFeatureId:null,loaders:[l.D],binary:!0};class x extends _.Z{initializeState(){super.initializeState();const e=void 0===this.context.viewport.resolution&&this.props.binary;this.setState({binary:e,data:null,tileJSON:null,hoveredFeatureId:null,hoveredFeatureLayerName:null})}get isLoaded(){var e;return Boolean((null==(e=this.state)?void 0:e.data)&&super.isLoaded)}updateState(e){var t;let{props:i,oldProps:n,context:o,changeFlags:s}=e;s.dataChanged&&this._updateTileData(),null!=(t=this.state)&&t.data&&(super.updateState({props:i,oldProps:n,context:o,changeFlags:s}),this._setWGS84PropertyForTiles());const{highlightColor:r}=i;r!==n.highlightColor&&Array.isArray(r)&&this.setState({highlightColor:r})}async _updateTileData(){let e=this.props.data,t=null;if("string"!=typeof e||(0,b.Xj)(e))e&&"object"==typeof e&&"tilejson"in e&&(t=e);else{const{onDataLoad:n,fetch:o}=this.props;this.setState({data:null,tileJSON:null});try{t=await o(e,{propName:"data",layer:this,loaders:[]})}catch(i){this.raiseError(i,"loading TileJSON"),e=null}n&&n(t,{propName:"data",layer:this})}t&&(e=t.tiles),this.setState({data:e,tileJSON:t})}_getTilesetOptions(){const e=super._getTilesetOptions(),t=this.state.tileJSON,{minZoom:i,maxZoom:n}=this.props;return t&&(Number.isFinite(t.minzoom)&&t.minzoom>i&&(e.minZoom=t.minzoom),Number.isFinite(t.maxzoom)&&(!Number.isFinite(n)||t.maxzoom<n)&&(e.maxZoom=t.maxzoom)),e}renderLayers(){var e;return null!=(e=this.state)&&e.data?super.renderLayers():null}getTileData(e){var t;const{data:i,binary:n}=this.state,{index:o,signal:s}=e,r=(0,b.z0)(i,e);if(!r)return Promise.reject("Invalid URL");let a=this.getLoadOptions();const{fetch:l}=this.props;return a={...a,mimeType:"application/x-protobuf",mvt:{...null==(t=a)?void 0:t.mvt,coordinates:this.context.viewport.resolution?"wgs84":"local",tileIndex:o},gis:n?{format:"binary"}:{}},l(r,{propName:"data",layer:this,loadOptions:a,signal:s})}renderSubLayers(e){const{x:t,y:i,z:l}=e.tile.index,c=Math.pow(2,l),d=512/c,u=-d,h=512*t/c,p=512*(1-i/c),g=(new a.y).scale([d,u,1]);e.autoHighlight=!1,this.context.viewport.resolution||(e.modelMatrix=g,e.coordinateOrigin=[h,p,0],e.coordinateSystem=n.Df.CARTESIAN,e.extensions=[...e.extensions||[],new r.Z]);const f=super.renderSubLayers(e);return!this.state.binary||f instanceof s.Z||o.Z.warn("renderSubLayers() must return GeoJsonLayer when using binary:true")(),f}_updateAutoHighlight(e){const{uniqueIdProperty:t}=this.props,{hoveredFeatureId:i,hoveredFeatureLayerName:n}=this.state,o=e.object;let s=null,r=null;o&&(s=P(o,t),r=C(o));let{highlightColor:a}=this.props;"function"==typeof a&&(a=a(e)),i===s&&n===r||this.setState({highlightColor:a,hoveredFeatureId:s,hoveredFeatureLayerName:r})}_isWGS84(){return Boolean(this.context.viewport.resolution)}getPickingInfo(e){const t=super.getPickingInfo(e);if(this.state.binary&&-1!==t.index){const{data:i}=e.sourceLayer.props;t.object=(0,c.F)(i,{globalFeatureId:t.index})}return t.object&&!this._isWGS84()&&(t.object=T(t.object,t.tile.bbox,this.context.viewport)),t}getSubLayerPropsByTile(e){return{highlightedObjectIndex:this.getHighlightedObjectIndex(e),highlightColor:this.state.highlightColor}}getHighlightedObjectIndex(e){const{hoveredFeatureId:t,hoveredFeatureLayerName:i,binary:n}=this.state,{uniqueIdProperty:o,highlightedFeatureId:s}=this.props,r=e.content,a=S(s);if(!(S(t)||a))return-1;const l=a?s:t;return Array.isArray(r)?r.findIndex((e=>{const t=P(e,o)===l,n=a||C(e)===i;return t&&n})):r&&n?function(e,t,i,n){for(const o of m){const s=e[o]&&v(e[o],t,i,n);if(s>=0)return s}return-1}(r,o,l,a?"":i):-1}_pickObjects(e){const{deck:t,viewport:i}=this.context,n=i.width,o=i.height,s=i.x,r=i.y,a=[this.id];return t.pickObjects({x:s,y:r,width:n,height:o,layerIds:a,maxObjects:e})}getRenderedFeatures(e){void 0===e&&(e=null);const t=this._pickObjects(e),i=new Set,n=[];for(const o of t){const e=P(o.object,this.props.uniqueIdProperty);void 0===e?n.push(o.object):i.has(e)||(i.add(e),n.push(o.object))}return n}_setWGS84PropertyForTiles(){const e="dataInWGS84";this.state.tileset.selectedTiles.forEach((t=>{t.hasOwnProperty(e)||Object.defineProperty(t,e,{get:()=>{if(!t.content)return null;if(this.state.binary&&Array.isArray(t.content)&&!t.content.length)return[];const{bbox:e}=t;if(void 0===t._contentWGS84&&(0,b.ob)(e)){const i=this.state.binary?(0,c.F)(t.content):t.content;t._contentWGS84=i.map((t=>T(t,e,this.context.viewport)))}return t._contentWGS84}})}))}}function P(e,t){return e.properties&&t?e.properties[t]:"id"in e?e.id:void 0}function C(e){var t;return(null==(t=e.properties)?void 0:t.layerName)||null}function S(e){return null!=e&&""!==e}function T(e,t,i){const n={...e,geometry:{type:e.geometry.type}};return Object.defineProperty(n.geometry,"coordinates",{get:()=>{const n=function(e,t,i){const n=[i.projectFlat([t.west,t.north]),i.projectFlat([t.east,t.south])];return{...e,coordinates:u[e.type](e.coordinates,n,i)}}(e.geometry,t,i);return n.coordinates}}),n}x.layerName="MVTLayer",x.defaultProps=w},54319:(e,t,i)=>{i.d(t,{Z:()=>a});var n=i(72416),o=i(77394);const s=512;function r(e,t){void 0===t&&(t=1);const[i,n]=function(e,t){let i=0,n=0,o=1<<e.length;const r=o/s;for(let s=0;s<e.length;s++){o>>=1;const t=parseInt(e[s]);t%2&&(i|=o),t>1&&(n|=o)}return[[i/r,s-n/r],[(i+t)/r,s-(n+t)/r]]}(e,t),[r,a]=(0,o.es)(i),[l,c]=(0,o.es)(n);return[l,a,l,c,r,c,r,a,l,a]}class a extends n.Z{indexToBounds(){const{data:e,extruded:t,getQuadkey:i}=this.props,n=t?.99:1;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(e,t)=>r(i(e,t),n),updateTriggers:{getPolygon:n}}}}a.layerName="QuadkeyLayer",a.defaultProps={getQuadkey:{type:"accessor",value:e=>e.quadkey}}},2511:(e,t,i)=>{i.d(t,{Z:()=>v});var n=i(72416),o=i(26734);const s=3,r=61,a=180/Math.PI;function l(e,t,i){const n=1<<t;return[(e[0]+i[0])/n,(e[1]+i[1])/n]}function c(e){return e>=.5?1/3*(4*e*e-1):1/3*(1-4*(1-e)*(1-e))}function d(e){return[c(e[0]),c(e[1])]}function u(e,t){let[i,n]=t;switch(e){case 0:return[1,i,n];case 1:return[-i,1,n];case 2:return[-i,-n,1];case 3:return[-1,-n,-i];case 4:return[n,-1,-i];case 5:return[n,i,-1];default:throw new Error("Invalid face")}}function h(e){let[t,i,n]=e;const o=Math.atan2(n,Math.sqrt(t*t+i*i));return[Math.atan2(i,t)*a,o*a]}function p(e,t,i,n){if(0===n){1===i&&(t[0]=e-1-t[0],t[1]=e-1-t[1]);const n=t[0];t[0]=t[1],t[1]=n}}const g=100;function f(e){if("string"==typeof e){if(e.indexOf("/")>0)return e;e=function(e){const t=e.padEnd(16,"0");return o.fromString(t,16)}(e)}return function(e){let t=o.fromString(e,!0,10).toString(2);for(;t.length<s+r;)t="0"+t;const i=t.lastIndexOf("1"),n=t.substring(0,3),a=t.substring(3,i),l=a.length/2,c=o.fromString(n,!0,2).toString(10);let d=o.fromString(a,!0,2).toString(4);for(;d.length<l;)d="0"+d;return c+"/"+d}(e.toString())}function m(e){return function(e){let{face:t,ij:i,level:n}=e;const o=[[0,0],[0,1],[1,1],[1,0],[0,0]],s=Math.max(1,Math.ceil(g*Math.pow(2,-n))),r=new Float64Array(4*s*2+2);let a=0,c=0;for(let p=0;p<4;p++){const e=o[p].slice(0),g=o[p+1],f=(g[0]-e[0])/s,m=(g[1]-e[1])/s;for(let o=0;o<s;o++){e[0]+=f,e[1]+=m;const o=h(u(t,d(l(i,n,e))));Math.abs(o[1])>89.999&&(o[0]=c);const s=o[0]-c;o[0]+=s>180?-360:s<-180?360:0,r[a++]=o[0],r[a++]=o[1],c=o[0]}}return r[a++]=r[0],r[a++]=r[1],r}(function(e){const t=e.split("/"),i=parseInt(t[0],10),n=t[1],o=n.length,s=[0,0];let r;for(let a=o-1;a>=0;a--){r=o-a;const e=n[a];let t=0,i=0;"1"===e?i=1:"2"===e?(t=1,i=1):"3"===e&&(t=1);const l=Math.pow(2,r-1);p(l,s,t,i),s[0]+=l*t,s[1]+=l*i}if(i%2==1){const e=s[0];s[0]=s[1],s[1]=e}return{face:i,ij:s,level:r}}(f(e)))}class v extends n.Z{indexToBounds(){const{data:e,getS2Token:t}=this.props;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(e,i)=>m(t(e,i))}}}v.layerName="S2Layer",v.defaultProps={getS2Token:{type:"accessor",value:e=>e.token}}},54890:(e,t,i)=>{i.d(t,{Z:()=>p});var n=i(96677),o=i(70575),s=i(52030),r=i(19845),a=i(58176),l=i(54282),c=i(18188);const d=[1],u={...l.Z.defaultProps,elevationData:c.zc,texture:{...c.zc,optional:!0},meshMaxError:{type:"number",value:4},bounds:{type:"array",value:null,optional:!0,compare:!0},color:{type:"color",value:[255,255,255]},elevationDecoder:{type:"object",value:{rScaler:1,gScaler:0,bScaler:0,offset:0}},workerUrl:"",wireframe:!1,material:!0,loaders:[a.x]};function h(e){return Array.isArray(e)?e.join(";"):e||""}class p extends n.Z{updateState(e){let{props:t,oldProps:i}=e;const n=t.elevationData!==i.elevationData;if(n){const{elevationData:e}=t,i=e&&(Array.isArray(e)||e.includes("{x}")&&e.includes("{y}"));this.setState({isTiled:i})}const s=n||t.meshMaxError!==i.meshMaxError||t.elevationDecoder!==i.elevationDecoder||t.bounds!==i.bounds;if(!this.state.isTiled&&s){const e=this.loadTerrain(t);this.setState({terrain:e})}t.workerUrl&&o.Z.removed("workerUrl","loadOptions.terrain.workerUrl")()}loadTerrain(e){var t;let{elevationData:i,bounds:n,elevationDecoder:o,meshMaxError:s,signal:r}=e;if(!i)return null;let a=this.getLoadOptions();a={...a,terrain:{skirtHeight:this.state.isTiled?2*s:0,...null==(t=a)?void 0:t.terrain,bounds:n,meshMaxError:s,elevationDecoder:o}};const{fetch:l}=this.props;return l(i,{propName:"elevationData",layer:this,loadOptions:a,signal:r})}getTiledTerrainData(e){const{elevationData:t,fetch:i,texture:n,elevationDecoder:o,meshMaxError:s}=this.props,{viewport:r}=this.context,a=(0,c.z0)(t,e),l=n&&(0,c.z0)(n,e),{signal:d}=e;let u=[0,0],h=[0,0];if(r.isGeospatial){const t=e.bbox;u=r.projectFlat([t.west,t.south]),h=r.projectFlat([t.east,t.north])}else{const t=e.bbox;u=[t.left,t.bottom],h=[t.right,t.top]}const p=[u[0],u[1],h[0],h[1]],g=this.loadTerrain({elevationData:a,bounds:p,elevationDecoder:o,meshMaxError:s,signal:d}),f=l?i(l,{propName:"texture",layer:this,loaders:[],signal:d}).catch((e=>null)):Promise.resolve(null);return Promise.all([g,f])}renderSubLayers(e){const t=this.getSubLayerClass("mesh",s.Z),{color:i,wireframe:n,material:o}=this.props,{data:a}=e;if(!a)return null;const[l,c]=a;return new t(e,{data:d,mesh:l,texture:c,_instanced:!1,coordinateSystem:r.Df.CARTESIAN,getPosition:e=>[0,0,0],getColor:i,wireframe:n,material:o})}onViewportLoad(e){if(!e)return;const{zRange:t}=this.state,i=e.map((e=>e.content)).filter(Boolean).map((e=>e[0].header.boundingBox.map((e=>e[2]))));if(0===i.length)return;const n=Math.min(...i.map((e=>e[0]))),o=Math.max(...i.map((e=>e[1])));(!t||n<t[0]||o>t[1])&&this.setState({zRange:[n,o]})}renderLayers(){const{color:e,material:t,elevationData:i,texture:n,wireframe:o,meshMaxError:r,elevationDecoder:a,tileSize:c,maxZoom:u,minZoom:p,extent:g,maxRequests:f,onTileLoad:m,onTileUnload:v,onTileError:y,maxCacheSize:_,maxCacheByteSize:b,refinementStrategy:w}=this.props;if(this.state.isTiled)return new l.Z(this.getSubLayerProps({id:"tiles"}),{getTileData:this.getTiledTerrainData.bind(this),renderSubLayers:this.renderSubLayers.bind(this),updateTriggers:{getTileData:{elevationData:h(i),texture:h(n),meshMaxError:r,elevationDecoder:a}},onViewportLoad:this.onViewportLoad.bind(this),zRange:this.state.zRange||null,tileSize:c,maxZoom:u,minZoom:p,extent:g,maxRequests:f,onTileLoad:m,onTileUnload:v,onTileError:y,maxCacheSize:_,maxCacheByteSize:b,refinementStrategy:w});if(!i)return null;return new(this.getSubLayerClass("mesh",s.Z))(this.getSubLayerProps({id:"mesh"}),{data:d,mesh:this.state.terrain,texture:n,_instanced:!1,getPosition:e=>[0,0,0],getColor:e,material:t,wireframe:o})}}p.defaultProps=u,p.layerName="TerrainLayer"},54282:(e,t,i)=>{i.d(t,{Z:()=>c});var n=i(96677),o=i(63619),s=i(15788),r=i(42192),a=i(18188);const l={TilesetClass:r.Be,data:{type:"data",value:[]},dataComparator:a.zc.equal,renderSubLayers:{type:"function",value:e=>new s.Z(e)},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:e=>{}},onTileUnload:{type:"function",value:e=>{}},onTileError:{type:"function",value:e=>console.error(e)},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:r.cw,zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0};class c extends n.Z{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){var e,t;null==(e=this.state)||null==(t=e.tileset)||t.finalize()}get isLoaded(){var e,t,i;return Boolean(null==(e=this.state)||null==(t=e.tileset)||null==(i=t.selectedTiles)?void 0:i.every((e=>e.isLoaded&&e.layers&&e.layers.every((e=>e.isLoaded)))))}shouldUpdateState(e){let{changeFlags:t}=e;return t.somethingChanged}updateState(e){let{changeFlags:t}=e,{tileset:i}=this.state;const n=t.propsOrDataChanged||t.updateTriggersChanged,o=t.dataChanged||t.updateTriggersChanged&&(t.updateTriggersChanged.all||t.updateTriggersChanged.getTileData);i?n&&(i.setOptions(this._getTilesetOptions()),o?i.reloadAll():i.tiles.forEach((e=>{e.layers=null}))):(i=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:i})),this._updateTileset()}_getTilesetOptions(){const{tileSize:e,maxCacheSize:t,maxCacheByteSize:i,refinementStrategy:n,extent:o,maxZoom:s,minZoom:r,maxRequests:a,debounceTime:l,zoomOffset:c}=this.props;return{maxCacheSize:t,maxCacheByteSize:i,maxZoom:s,minZoom:r,tileSize:e,refinementStrategy:n,extent:o,maxRequests:a,debounceTime:l,zoomOffset:c,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){const e=this.state.tileset,{zRange:t,modelMatrix:i}=this.props,n=e.update(this.context.viewport,{zRange:t,modelMatrix:i}),{isLoaded:o}=e,s=this.state.isLoaded!==o,r=this.state.frameNumber!==n;o&&(s||r)&&this._onViewportLoad(),r&&this.setState({frameNumber:n}),this.state.isLoaded=o}_onViewportLoad(){const{tileset:e}=this.state,{onViewportLoad:t}=this.props;t&&t(e.selectedTiles)}_onTileLoad(e){this.props.onTileLoad(e),e.layers=null,this.setNeedsUpdate()}_onTileError(e,t){this.props.onTileError(e),t.layers=null,this.setNeedsUpdate()}_onTileUnload(e){this.props.onTileUnload(e)}getTileData(e){const{data:t,getTileData:i,fetch:n}=this.props,{signal:o}=e;return e.url="string"==typeof t||Array.isArray(t)?(0,a.z0)(t,e):null,i?i(e):n&&e.url?n(e.url,{propName:"data",layer:this,signal:o}):null}renderSubLayers(e){return this.props.renderSubLayers(e)}getSubLayerPropsByTile(e){return null}getPickingInfo(e){const t=e.sourceLayer,i=t.props.tile,n=e.info;return n.picked&&(n.tile=i),n.sourceTile=i,n.sourceTileSubLayer=t,n}_updateAutoHighlight(e){e.sourceTileSubLayer.updateAutoHighlight(e)}renderLayers(){return this.state.tileset.tiles.map((e=>{const t=this.getSubLayerPropsByTile(e);if(e.isLoaded||e.content)if(e.layers)t&&e.layers[0]&&Object.keys(t).some((i=>e.layers[0].props[i]!==t[i]))&&(e.layers=e.layers.map((e=>e.clone(t))));else{const i=this.renderSubLayers({...this.props,...this.getSubLayerProps({id:e.id,updateTriggers:this.props.updateTriggers}),data:e.content,_offset:0,tile:e});e.layers=(0,o.x)(i,Boolean).map((i=>i.clone({tile:e,...t})))}else;return e.layers}))}filterSubLayer(e){let{layer:t,cullRect:i}=e;const{tile:n}=t.props;return this.state.tileset.isTileVisible(n,i)}}c.defaultProps=l,c.layerName="TileLayer"},42827:(e,t,i)=>{i.d(t,{o:()=>n});class n{constructor(e){this.index=e,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get bbox(){return this._bbox}set bbox(e){this._bbox||(this._bbox=e,this.boundingBox="west"in e?[[e.west,e.south],[e.east,e.north]]:[[e.left,e.top],[e.right,e.bottom]])}get data(){return this.isLoading&&this._loader?this._loader.then((()=>this.data)):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return Boolean(this._loader)&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){const e=this.content?this.content.byteLength:0;return Number.isFinite(e)||console.error("byteLength not defined in tile data"),e}async _loadData(e){let{getData:t,requestScheduler:i,onLoad:n,onError:o}=e;const{index:s,id:r,bbox:a,userData:l,zoom:c}=this,d=this._loaderId;this._abortController=new AbortController;const{signal:u}=this._abortController,h=await i.scheduleRequest(this,(e=>e.isSelected?1:-1));if(!h)return void(this._isCancelled=!0);if(this._isCancelled)return void h.done();let p,g=null;try{g=await t({index:s,id:r,bbox:a,userData:l,zoom:c,signal:u})}catch(f){p=f||!0}finally{h.done()}d===this._loaderId&&(this._loader=void 0,this.content=g,!this._isCancelled||g?(this._isLoaded=!0,this._isCancelled=!1,p?o(p,this):n(this)):this._isLoaded=!1)}loadData(e){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(e),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){var e;this.isLoaded||(this._isCancelled=!0,null==(e=this._abortController)||e.abort())}}},42192:(e,t,i)=>{i.d(t,{cw:()=>u,Be:()=>g});var n=i(58853),o=i(84900),s=i(55715),r=i(42827),a=i(18188);function l(e,t){if(e===t)return!0;if(Array.isArray(e)){const i=e.length;if(!t||t.length!==i)return!1;for(let n=0;n<i;n++)if(e[n]!==t[n])return!1;return!0}return!1}const c=1,d=2,u="best-available",h={[u]:function(e){for(const t of e)t.state=0;for(const t of e)t.isSelected&&!f(t)&&m(t);for(const t of e)t.isVisible=Boolean(t.state&d)},"no-overlap":function(e){for(const i of e)i.state=0;for(const i of e)i.isSelected&&f(i);const t=Array.from(e).sort(((e,t)=>e.zoom-t.zoom));for(const i of t)if(i.isVisible=Boolean(i.state&d),i.children&&(i.isVisible||i.state&c))for(const e of i.children)e.state=c;else i.isSelected&&m(i)},never:()=>{}},p={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{}};class g{constructor(e){this._getCullBounds=function(e){let t,i={};return n=>{for(const o in n)if(!l(n[o],i[o])){t=e(n),i=n;break}return t}}(a.XT),this.opts={...p,...e},this.setOptions(this.opts),this.onTileLoad=e=>{var t,i;null==(t=(i=this.opts).onTileLoad)||t.call(i,e),this.opts.maxCacheByteSize&&(this._cacheByteSize+=e.byteLength,this._resizeCache())},this._requestScheduler=new n.Z({throttleRequests:this.opts.maxRequests>0||this.opts.debounceTime>0,maxRequests:this.opts.maxRequests,debounceTime:this.opts.debounceTime}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._zRange=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new o.y,this._modelMatrixInverse=new o.y}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return null!==this._selectedTiles&&this._selectedTiles.every((e=>e.isLoaded))}get needsReload(){return null!==this._selectedTiles&&this._selectedTiles.some((e=>e.needsReload))}setOptions(e){Object.assign(this.opts,e),Number.isFinite(e.maxZoom)&&(this._maxZoom=Math.floor(e.maxZoom)),Number.isFinite(e.minZoom)&&(this._minZoom=Math.ceil(e.minZoom))}finalize(){for(const e of this._cache.values())e.isLoading&&e.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(const e of this._cache.keys()){const t=this._cache.get(e);this._selectedTiles&&this._selectedTiles.includes(t)?t.setNeedsReload():this._cache.delete(e)}}update(e,t){let{zRange:i,modelMatrix:n}=void 0===t?{zRange:null,modelMatrix:null}:t;const r=n?new o.y(n):new o.y,a=!r.equals(this._modelMatrix);if(this._viewport&&e.equals(this._viewport)&&(0,s.fS)(this._zRange,i)&&!a)this.needsReload&&(this._selectedTiles=this._selectedTiles.map((e=>this._getTile(e.index,!0))));else{a&&(this._modelMatrixInverse=r.clone().invert(),this._modelMatrix=r),this._viewport=e,this._zRange=i;const t=this.getTileIndices({viewport:e,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:i,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=t.map((e=>this._getTile(e,!0))),this._dirty&&this._rebuildTree()}const l=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),l&&this._frameNumber++,this._frameNumber}isTileVisible(e,t){if(!e.isVisible)return!1;if(t&&this._viewport){const i=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:t}),{bbox:n}=e;for(const[e,t,o,s]of i){let i;if("west"in n)i=n.west<o&&n.east>e&&n.south<s&&n.north>t;else{const r=Math.min(n.top,n.bottom),a=Math.max(n.top,n.bottom);i=n.left<o&&n.right>e&&r<s&&a>t}if(i)return!0}return!1}return!0}getTileIndices(e){let{viewport:t,maxZoom:i,minZoom:n,zRange:o,modelMatrix:s,modelMatrixInverse:r}=e;const{tileSize:l,extent:c,zoomOffset:d}=this.opts;return(0,a.rJ)({viewport:t,maxZoom:i,minZoom:n,zRange:o,tileSize:l,extent:c,modelMatrix:s,modelMatrixInverse:r,zoomOffset:d})}getTileId(e){return e.x+"-"+e.y+"-"+e.z}getTileZoom(e){return e.z}getTileMetadata(e){const{tileSize:t}=this.opts;return{bbox:(0,a.z_)(this._viewport,e.x,e.y,e.z,t)}}getParentIndex(e){return{x:Math.floor(e.x/2),y:Math.floor(e.y/2),z:e.z-1}}updateTileStates(){const e=this.opts.refinementStrategy||u,t=new Array(this._cache.size);let i=0;for(const n of this._cache.values())t[i++]=n.isVisible,n.isSelected=!1,n.isVisible=!1;for(const n of this._selectedTiles)n.isSelected=!0,n.isVisible=!0;("function"==typeof e?e:h[e])(Array.from(this._cache.values())),i=0;for(const n of this._cache.values())if(t[i++]!==n.isVisible)return!0;return!1}_pruneRequests(){const{maxRequests:e=0}=this.opts,t=[];let i=0;for(const n of this._cache.values())n.isLoading&&(i++,n.isSelected||n.isVisible||t.push(n));for(;e>0&&i>e&&t.length>0;){t.shift().abort(),i--}}_rebuildTree(){const{_cache:e}=this;for(const t of e.values())t.parent=null,t.children&&(t.children.length=0);for(const t of e.values()){const e=this._getNearestAncestor(t);t.parent=e,null!=e&&e.children&&e.children.push(t)}}_resizeCache(){const{_cache:e,opts:t}=this,i=t.maxCacheSize||(t.maxCacheByteSize?1/0:5*this.selectedTiles.length),n=t.maxCacheByteSize||1/0;if(e.size>i||this._cacheByteSize>n){for(const[r,a]of e){var o,s;if(!a.isVisible&&!a.isSelected)this._cacheByteSize-=t.maxCacheByteSize?a.byteLength:0,e.delete(r),null==(o=(s=this.opts).onTileUnload)||o.call(s,a);if(e.size<=i&&this._cacheByteSize<=n)break}this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort(((e,t)=>e.zoom-t.zoom)),this._dirty=!1)}_getTile(e,t){const i=this.getTileId(e);let n=this._cache.get(i),o=!1;return!n&&t?(n=new r.o(e),Object.assign(n,this.getTileMetadata(n.index)),Object.assign(n,{id:i,zoom:this.getTileZoom(n.index)}),o=!0,this._cache.set(i,n),this._dirty=!0):n&&n.needsReload&&(o=!0),n&&o&&n.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),n}_getNearestAncestor(e){const{_minZoom:t=0}=this;let i=e.index;for(;this.getTileZoom(i)>t;){i=this.getParentIndex(i);const e=this._getTile(i);if(e)return e}return null}}function f(e){let t=e;for(;t;){if(t.isLoaded||t.content)return t.state|=d,!0;t=t.parent}return!1}function m(e){for(const t of e.children)t.isLoaded||t.content?t.state|=d:m(t)}},18188:(e,t,i)=>{i.d(t,{XT:()=>y,rJ:()=>S,z0:()=>v,ob:()=>L,Xj:()=>T,hG:()=>w,z_:()=>P,zc:()=>f});var n=i(30120),o=i(83224),s=i(5044),r=i(77394);const a=512,l=3,c=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],d=c.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),u=d.concat([[.25,.5],[.75,.5]]);class h{constructor(e,t,i){this.x=e,this.y=t,this.z=i}get children(){if(!this._children){const e=2*this.x,t=2*this.y,i=this.z+1;this._children=[new h(e,t,i),new h(e,t+1,i),new h(e+1,t,i),new h(e+1,t+1,i)]}return this._children}update(e){const{viewport:t,cullingVolume:i,elevationBounds:n,minZ:o,maxZ:s,bounds:r,offset:a,project:l}=e,c=this.getBoundingVolume(n,a,l);if(r&&!this.insideBounds(r))return!1;if(i.computeVisibility(c)<0)return!1;if(!this.childVisible){let{z:e}=this;if(e<s&&e>=o){const i=c.distanceTo(t.cameraPosition)*t.scale/t.height;e+=Math.floor(Math.log2(i))}if(e>=s)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(const d of this.children)d.update(e);return!0}getSelected(e){if(void 0===e&&(e=[]),this.selected&&e.push(this),this._children)for(const t of this._children)t.getSelected(e);return e}insideBounds(e){let[t,i,n,o]=e;const s=Math.pow(2,this.z),r=a/s;return this.x*r<n&&this.y*r<o&&(this.x+1)*r>t&&(this.y+1)*r>i}getBoundingVolume(e,t,i){if(i){const t=this.z<1?u:this.z<2?d:c,n=[];for(const o of t){const t=w(this.x+o[0],this.y+o[1],this.z);t[2]=e[0],n.push(i(t)),e[0]!==e[1]&&(t[2]=e[1],n.push(i(t)))}return(0,s.du)(n)}const n=Math.pow(2,this.z),o=a/n,r=this.x*o+t*a,l=a-(this.y+1)*o;return new s.Xx([r,l,e[0]],[r+o,l+o,e[1]])}}const p=512,g=[-1/0,-1/0,1/0,1/0],f={type:"object",value:null,validate:(e,t)=>t.optional&&null===e||"string"==typeof e||Array.isArray(e)&&e.every((e=>"string"==typeof e)),equal:(e,t)=>{if(e===t)return!0;if(!Array.isArray(e)||!Array.isArray(t))return!1;const i=e.length;if(i!==t.length)return!1;for(let n=0;n<i;n++)if(e[n]!==t[n])return!1;return!0}};function m(e,t){const i=[t.transformAsPoint([e[0],e[1]]),t.transformAsPoint([e[2],e[1]]),t.transformAsPoint([e[0],e[3]]),t.transformAsPoint([e[2],e[3]])];return[Math.min(...i.map((e=>e[0]))),Math.min(...i.map((e=>e[1]))),Math.max(...i.map((e=>e[0]))),Math.max(...i.map((e=>e[1])))]}function v(e,t){if(!e||!e.length)return null;const{index:i,id:n}=t;if(Array.isArray(e)){e=e[(o=n,Math.abs(o.split("").reduce(((e,t)=>(e<<5)-e+t.charCodeAt(0)|0),0))%e.length)]}var o;let s=e;for(const r of Object.keys(i)){const e=new RegExp("{"+r+"}","g");s=s.replace(e,String(i[r]))}return Number.isInteger(i.y)&&Number.isInteger(i.z)&&(s=s.replace(/\{-y\}/g,String(Math.pow(2,i.z)-i.y-1))),s}function y(e){let{viewport:t,z:i,cullRect:n}=e;return(t.subViewports||[t]).map((e=>_(e,i||0,n)))}function _(e,t,i){if(!Array.isArray(t)){const n=i.x-e.x,o=i.y-e.y,{width:s,height:r}=i,a={targetZ:t},l=e.unproject([n,o],a),c=e.unproject([n+s,o],a),d=e.unproject([n,o+r],a),u=e.unproject([n+s,o+r],a);return[Math.min(l[0],c[0],d[0],u[0]),Math.min(l[1],c[1],d[1],u[1]),Math.max(l[0],c[0],d[0],u[0]),Math.max(l[1],c[1],d[1],u[1])]}const n=_(e,t[0],i),o=_(e,t[1],i);return[Math.min(n[0],o[0]),Math.min(n[1],o[1]),Math.max(n[2],o[2]),Math.max(n[3],o[3])]}function b(e,t){return Math.pow(2,e)*p/t}function w(e,t,i){const n=b(i,p),o=e/n*360-180,s=Math.PI-2*Math.PI*t/n;return[o,180/Math.PI*Math.atan(.5*(Math.exp(s)-Math.exp(-s)))]}function x(e,t,i,n){const o=b(i,n);return[e/o*p,t/o*p]}function P(e,t,i,n,o){if(void 0===o&&(o=p),e.isGeospatial){const[e,o]=w(t,i,n),[s,r]=w(t+1,i+1,n);return{west:e,north:o,east:s,south:r}}const[s,r]=x(t,i,n,o),[a,l]=x(t+1,i+1,n,o);return{left:s,top:r,right:a,bottom:l}}function C(e,t,i,n,o){const s=function(e,t,i){let n;if(t&&2===t.length){const[i,o]=t,s=e.getBounds({z:i}),r=e.getBounds({z:o});n=[Math.min(s[0],r[0]),Math.min(s[1],r[1]),Math.max(s[2],r[2]),Math.max(s[3],r[3])]}else n=e.getBounds();return e.isGeospatial?[Math.max(n[0],i[0]),Math.max(n[1],i[1]),Math.min(n[2],i[2]),Math.min(n[3],i[3])]:[Math.max(Math.min(n[0],i[2]),i[0]),Math.max(Math.min(n[1],i[3]),i[1]),Math.min(Math.max(n[2],i[0]),i[2]),Math.min(Math.max(n[3],i[1]),i[3])]}(e,null,n),r=b(t,i),[a,l,c,d]=function(e,t,i){if(i)return m(e,i).map((e=>e*t/p));return e.map((e=>e*t/p))}(s,r,o),u=[];for(let h=Math.floor(a);h<c;h++)for(let e=Math.floor(l);e<d;e++)u.push({x:h,y:e,z:t});return u}function S(e){let{viewport:t,maxZoom:i,minZoom:c,zRange:d,extent:u,tileSize:f=p,modelMatrix:v,modelMatrixInverse:y,zoomOffset:_=0}=e,b=t.isGeospatial?Math.round(t.zoom+Math.log2(p/f))+_:Math.ceil(t.zoom)+_;if("number"==typeof c&&Number.isFinite(c)&&b<c){if(!u)return[];b=c}"number"==typeof i&&Number.isFinite(i)&&b>i&&(b=i);let w=u;return v&&y&&u&&!t.isGeospatial&&(w=m(u,v)),t.isGeospatial?function(e,t,i,c){const d=e instanceof n.Z&&e.resolution?e.projectPosition:null,u=Object.values(e.getFrustumPlanes()).map((e=>{let{normal:t,distance:i}=e;return new s.JO(t.clone().negate(),i)})),p=new s.Mh(u),g=e.distanceScales.unitsPerMeter[2],f=i&&i[0]*g||0,m=i&&i[1]*g||0,v=e instanceof o.Z&&e.pitch<=60?t:0;if(c){const[e,t,i,n]=c,o=(0,r.w5)([e,n]),s=(0,r.w5)([i,t]);c=[o[0],a-o[1],s[0],a-s[1]]}const y=new h(0,0,0),_={viewport:e,project:d,cullingVolume:p,elevationBounds:[f,m],minZ:v,maxZ:t,bounds:c,offset:0};if(y.update(_),e instanceof o.Z&&e.subViewports&&e.subViewports.length>1){for(_.offset=-1;y.update(_)&&!(--_.offset<-l););for(_.offset=1;y.update(_)&&!(++_.offset>l););}return y.getSelected()}(t,b,d,u):C(t,b,f,w||g,y)}function T(e){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)}function L(e){return Number.isFinite(e.west)&&Number.isFinite(e.north)&&Number.isFinite(e.east)&&Number.isFinite(e.south)}},5416:(e,t,i)=>{i.d(t,{Z:()=>o});var n=i(36723);class o extends n.Z{getShaders(){const e=super.getShaders();return e.inject={"vs:#decl":"uniform float trailLength;\nin float instanceTimestamps;\nin float instanceNextTimestamps;\nout float vTime;\n","vs:#main-end":"vTime = instanceTimestamps + (instanceNextTimestamps - instanceTimestamps) * vPathPosition.y / vPathLength;\n","fs:#decl":"uniform bool fadeTrail;\nuniform float trailLength;\nuniform float currentTime;\nin float vTime;\n","fs:#main-start":"if(vTime > currentTime || (fadeTrail && (vTime < currentTime - trailLength))) {\n  discard;\n}\n","fs:DECKGL_FILTER_COLOR":"if(fadeTrail) {\n  color.a *= 1.0 - (currentTime - vTime) / trailLength;\n}\n"},e}initializeState(){super.initializeState();this.getAttributeManager().addInstanced({timestamps:{size:1,accessor:"getTimestamps",shaderAttributes:{instanceTimestamps:{vertexOffset:0},instanceNextTimestamps:{vertexOffset:1}}}})}draw(e){const{fadeTrail:t,trailLength:i,currentTime:n}=this.props;e.uniforms={...e.uniforms,fadeTrail:t,trailLength:i,currentTime:n},super.draw(e)}}o.layerName="TripsLayer",o.defaultProps={fadeTrail:!0,trailLength:{type:"number",value:120,min:0},currentTime:{type:"number",value:0,min:0},getTimestamps:{type:"accessor",value:e=>e.timestamps}}},40043:(e,t,i)=>{i.d(t,{g:()=>p});var n=i(96677),o=i(8557),s=i(19845),r=i(39632),a=i(54787),l=i(98887),c=i(77394);const d=6378137*Math.PI;function u(e){const t=(0,c.w5)(e);return t[0]=(t[0]/256-1)*d,t[1]=(t[1]/256-1)*d,t}const h={id:"imagery-layer",data:"",serviceType:"auto",srs:"auto",layers:{type:"array",compare:!0,value:[]},onMetadataLoad:{type:"function",value:()=>{}},onMetadataLoadError:{type:"function",value:console.error},onImageLoadStart:{type:"function",value:()=>{}},onImageLoad:{type:"function",value:()=>{}},onImageLoadError:{type:"function",compare:!1,value:(e,t)=>console.error(t,e)}};class p extends n.Z{get isLoaded(){var e;return 0===(null==(e=this.state)?void 0:e.loadCounter)&&super.isLoaded}shouldUpdateState(){return!0}initializeState(){this.state._nextRequestId=0,this.state.lastRequestId=-1,this.state.loadCounter=0}updateState(e){let{changeFlags:t,props:i,oldProps:n}=e;const{viewport:s}=this.context;t.dataChanged||i.serviceType!==n.serviceType?(this.state.imageSource=this._createImageSource(i),this._loadMetadata(),this.debounce((()=>this.loadImage(s,"image source changed")),0)):(0,o.v)(i.layers,n.layers,1)?t.viewportChanged&&this.debounce((()=>this.loadImage(s,"viewport changed"))):this.debounce((()=>this.loadImage(s,"layers changed")),0)}finalizeState(){}renderLayers(){const{bounds:e,image:t,lastRequestParameters:i}=this.state;return t&&new r.Z({...this.getSubLayerProps({id:"bitmap"}),_imageCoordinateSystem:"EPSG:4326"===i.srs?s.Df.LNGLAT:s.Df.CARTESIAN,bounds:e,image:t})}async getFeatureInfoText(e,t){const{lastRequestParameters:i}=this.state;if(i){var n,o;return await(null==(n=(o=this.state.imageSource).getFeatureInfoText)?void 0:n.call(o,{...i,query_layers:i.layers,x:e,y:t,info_format:"application/vnd.ogc.gml"}))}return""}_createImageSource(e){if(e.data instanceof a.c)return e.data;if("string"==typeof e.data)return(0,l.m)({url:e.data,loadOptions:e.loadOptions,type:e.serviceType});throw new Error("invalid image source in props.data")}async _loadMetadata(){const{imageSource:e}=this.state;try{this.state.loadCounter++;const i=await e.getMetadata();var t;if(this.state.imageSource===e)null==(t=this.getCurrentLayer())||t.props.onMetadataLoad(i)}catch(n){var i;null==(i=this.getCurrentLayer())||i.props.onMetadataLoadError(n)}finally{this.state.loadCounter--}}async loadImage(e,t){const{layers:i,serviceType:n}=this.props;if("wms"===n&&0===i.length)return;const o=e.getBounds(),{width:s,height:r}=e,a=this.getRequestId();let{srs:l}=this.props;"auto"===l&&(l=e.resolution?"EPSG:4326":"EPSG:3857");const c={width:s,height:r,boundingBox:[[o[0],o[1]],[o[2],o[3]]],layers:i,crs:l};if("EPSG:3857"===l){const e=u([o[0],o[1]]),t=u([o[2],o[3]]);c.boundingBox=[e,t]}try{this.state.loadCounter++,this.props.onImageLoadStart(a);const e=await this.state.imageSource.getImage(c);var d;if(this.state.lastRequestId<a)null==(d=this.getCurrentLayer())||d.props.onImageLoad(a),this.setState({image:e,bounds:o,lastRequestParameters:c,lastRequestId:a})}catch(p){var h;this.raiseError(p,"Load image"),null==(h=this.getCurrentLayer())||h.props.onImageLoadError(a,p)}finally{this.state.loadCounter--}}getRequestId(){return this.state._nextRequestId++}debounce(e,t){void 0===t&&(t=500),clearTimeout(this.state._timeoutId),this.state._timeoutId=setTimeout((()=>e()),t)}}p.layerName="WMSLayer",p.defaultProps=h},36148:(e,t,i)=>{i.d(t,{Z:()=>u});var n=i(45286),o=i(81135),s=i(23064),r=i(19845),a=i(41708),l=i(14594);const c=[0,0,0,255],d={getSourcePosition:{type:"accessor",value:e=>e.sourcePosition},getTargetPosition:{type:"accessor",value:e=>e.targetPosition},getSourceColor:{type:"accessor",value:c},getTargetColor:{type:"accessor",value:c},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},greatCircle:!1,numSegments:{type:"number",value:50,min:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class u extends n.Z{getBounds(){var e;return null==(e=this.getAttributeManager())?void 0:e.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME arc-layer-vertex-shader\nin vec3 positions;\nin vec4 instanceSourceColors;\nin vec4 instanceTargetColors;\nin vec3 instanceSourcePositions;\nin vec3 instanceSourcePositions64Low;\nin vec3 instanceTargetPositions;\nin vec3 instanceTargetPositions64Low;\nin vec3 instancePickingColors;\nin float instanceWidths;\nin float instanceHeights;\nin float instanceTilts;\nuniform bool greatCircle;\nuniform bool useShortestPath;\nuniform float numSegments;\nuniform float opacity;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nuniform int widthUnits;\nout vec4 vColor;\nout vec2 uv;\nout float isValid;\nfloat paraboloid(float distance, float sourceZ, float targetZ, float ratio) {\nfloat deltaZ = targetZ - sourceZ;\nfloat dh = distance * instanceHeights;\nif (dh == 0.0) {\nreturn sourceZ + deltaZ * ratio;\n}\nfloat unitZ = deltaZ / dh;\nfloat p2 = unitZ * unitZ + 1.0;\nfloat dir = step(deltaZ, 0.0);\nfloat z0 = mix(sourceZ, targetZ, dir);\nfloat r = mix(ratio, 1.0 - ratio, dir);\nreturn sqrt(r * (p2 - r)) * dh + z0;\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {\nvec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nreturn dir_screenspace * offset_direction * width / 2.0;\n}\nfloat getSegmentRatio(float index) {\nreturn smoothstep(0.0, 1.0, index / (numSegments - 1.0));\n}\nvec3 interpolateFlat(vec3 source, vec3 target, float segmentRatio) {\nfloat distance = length(source.xy - target.xy);\nfloat z = paraboloid(distance, source.z, target.z, segmentRatio);\nfloat tiltAngle = radians(instanceTilts);\nvec2 tiltDirection = normalize(target.xy - source.xy);\nvec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);\nreturn vec3(\nmix(source.xy, target.xy, segmentRatio) + tilt,\nz * cos(tiltAngle)\n);\n}\nfloat getAngularDist (vec2 source, vec2 target) {\nvec2 sourceRadians = radians(source);\nvec2 targetRadians = radians(target);\nvec2 sin_half_delta = sin((sourceRadians - targetRadians) / 2.0);\nvec2 shd_sq = sin_half_delta * sin_half_delta;\nfloat a = shd_sq.y + cos(sourceRadians.y) * cos(targetRadians.y) * shd_sq.x;\nreturn 2.0 * asin(sqrt(a));\n}\nvec3 interpolateGreatCircle(vec3 source, vec3 target, vec3 source3D, vec3 target3D, float angularDist, float t) {\nvec2 lngLat;\nif(abs(angularDist - PI) < 0.001) {\nlngLat = (1.0 - t) * source.xy + t * target.xy;\n} else {\nfloat a = sin((1.0 - t) * angularDist);\nfloat b = sin(t * angularDist);\nvec3 p = source3D.yxz * a + target3D.yxz * b;\nlngLat = degrees(vec2(atan(p.y, -p.x), atan(p.z, length(p.xy))));\n}\nfloat z = paraboloid(angularDist * EARTH_RADIUS, source.z, target.z, t);\nreturn vec3(lngLat, z);\n}\nvoid main(void) {\ngeometry.worldPosition = instanceSourcePositions;\ngeometry.worldPositionAlt = instanceTargetPositions;\nfloat segmentIndex = positions.x;\nfloat segmentRatio = getSegmentRatio(segmentIndex);\nfloat prevSegmentRatio = getSegmentRatio(max(0.0, segmentIndex - 1.0));\nfloat nextSegmentRatio = getSegmentRatio(min(numSegments - 1.0, segmentIndex + 1.0));\nfloat indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\nisValid = 1.0;\nuv = vec2(segmentRatio, positions.y);\ngeometry.uv = uv;\ngeometry.pickingColor = instancePickingColors;\nvec4 curr;\nvec4 next;\nvec3 source;\nvec3 target;\nif ((greatCircle || project_uProjectionMode == PROJECTION_MODE_GLOBE) && project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\nsource = project_globe_(vec3(instanceSourcePositions.xy, 0.0));\ntarget = project_globe_(vec3(instanceTargetPositions.xy, 0.0));\nfloat angularDist = getAngularDist(instanceSourcePositions.xy, instanceTargetPositions.xy);\nvec3 prevPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, prevSegmentRatio);\nvec3 currPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, segmentRatio);\nvec3 nextPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, nextSegmentRatio);\nif (abs(currPos.x - prevPos.x) > 180.0) {\nindexDir = -1.0;\nisValid = 0.0;\n} else if (abs(currPos.x - nextPos.x) > 180.0) {\nindexDir = 1.0;\nisValid = 0.0;\n}\nnextPos = indexDir < 0.0 ? prevPos : nextPos;\nnextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;\nif (isValid == 0.0) {\nnextPos.x += nextPos.x > 0.0 ? -360.0 : 360.0;\nfloat t = ((currPos.x > 0.0 ? 180.0 : -180.0) - currPos.x) / (nextPos.x - currPos.x);\ncurrPos = mix(currPos, nextPos, t);\nsegmentRatio = mix(segmentRatio, nextSegmentRatio, t);\n}\nvec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);\nvec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);\ncurr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);\nnext = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));\n} else {\nvec3 source_world = instanceSourcePositions;\nvec3 target_world = instanceTargetPositions;\nif (useShortestPath) {\nsource_world.x = mod(source_world.x + 180., 360.0) - 180.;\ntarget_world.x = mod(target_world.x + 180., 360.0) - 180.;\nfloat deltaLng = target_world.x - source_world.x;\nif (deltaLng > 180.) target_world.x -= 360.;\nif (deltaLng < -180.) source_world.x -= 360.;\n}\nsource = project_position(source_world, instanceSourcePositions64Low);\ntarget = project_position(target_world, instanceTargetPositions64Low);\nfloat antiMeridianX = 0.0;\nif (useShortestPath) {\nif (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {\nantiMeridianX = -(project_uCoordinateOrigin.x + 180.) / 360. * TILE_SIZE;\n}\nfloat thresholdRatio = (antiMeridianX - source.x) / (target.x - source.x);\nif (prevSegmentRatio <= thresholdRatio && nextSegmentRatio > thresholdRatio) {\nisValid = 0.0;\nindexDir = sign(segmentRatio - thresholdRatio);\nsegmentRatio = thresholdRatio;\n}\n}\nnextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;\nvec3 currPos = interpolateFlat(source, target, segmentRatio);\nvec3 nextPos = interpolateFlat(source, target, nextSegmentRatio);\nif (useShortestPath) {\nif (nextPos.x < antiMeridianX) {\ncurrPos.x += TILE_SIZE;\nnextPos.x += TILE_SIZE;\n}\n}\ncurr = project_common_position_to_clipspace(vec4(currPos, 1.0));\nnext = project_common_position_to_clipspace(vec4(nextPos, 1.0));\ngeometry.position = vec4(currPos, 1.0);\n}\nfloat widthPixels = clamp(\nproject_size_to_pixel(instanceWidths * widthScale, widthUnits),\nwidthMinPixels, widthMaxPixels\n);\nvec3 offset = vec3(\ngetExtrusionOffset((next.xy - curr.xy) * indexDir, positions.y, widthPixels),\n0.0);\nDECKGL_FILTER_SIZE(offset, geometry);\nDECKGL_FILTER_GL_POSITION(curr, geometry);\ngl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);\nvec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);\nvColor = vec4(color.rgb, color.a * opacity);\nDECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME arc-layer-fragment-shader\nprecision highp float;\nin vec4 vColor;\nin vec2 uv;\nin float isValid;\nout vec4 fragColor;\nvoid main(void) {\nif (isValid == 0.0) {\ndiscard;\n}\nfragColor = vColor;\ngeometry.uv = uv;\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",modules:[o.Z,s.Z]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceSourceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getSourceColor",defaultValue:c},instanceTargetColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getTargetColor",defaultValue:c},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}updateState(e){super.updateState(e);const{props:t,oldProps:i,changeFlags:n}=e;var o;(n.extensionsChanged||t.numSegments!==i.numSegments)&&(null==(o=this.state.model)||o.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw(e){let{uniforms:t}=e;const{widthUnits:i,widthScale:n,widthMinPixels:o,widthMaxPixels:s,greatCircle:a,wrapLongitude:l}=this.props,c=this.state.model;c.setUniforms(t),c.setUniforms({greatCircle:a,widthUnits:r.iI[i],widthScale:n,widthMinPixels:o,widthMaxPixels:s,useShortestPath:l}),c.draw(this.context.renderPass)}_getModel(){const{numSegments:e}=this.props;let t=[];for(let n=0;n<e;n++)t=t.concat([n,1,0,n,-1,0]);const i=new l.H(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new a.Z({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(t)}}}),isInstanced:!0});return i.setUniforms({numSegments:e}),i}}u.layerName="ArcLayer",u.defaultProps=d},39632:(e,t,i)=>{i.d(t,{Z:()=>f});var n=i(19845),o=i(45286),s=i(81135),r=i(23064),a=i(14594),l=i(77394),c=i(55715);const d=new Uint32Array([0,2,1,0,3,2]),u=new Float32Array([0,1,0,0,1,0,1,1]);function h(e,t){if(!t)return function(e){const t=new Float64Array(12);for(let i=0;i<e.length;i++)t[3*i+0]=e[i][0],t[3*i+1]=e[i][1],t[3*i+2]=e[i][2]||0;return{vertexCount:6,positions:t,indices:d,texCoords:u}}(e);const i=Math.max(Math.abs(e[0][0]-e[3][0]),Math.abs(e[1][0]-e[2][0])),n=Math.max(Math.abs(e[1][1]-e[0][1]),Math.abs(e[2][1]-e[3][1])),o=Math.ceil(i/t)+1,s=Math.ceil(n/t)+1,r=(o-1)*(s-1)*6,a=new Uint32Array(r),l=new Float32Array(o*s*2),c=new Float64Array(o*s*3);let h=0,g=0;for(let d=0;d<o;d++){const t=d/(o-1);for(let i=0;i<s;i++){const n=i/(s-1),o=p(e,t,n);c[3*h+0]=o[0],c[3*h+1]=o[1],c[3*h+2]=o[2]||0,l[2*h+0]=t,l[2*h+1]=1-n,d>0&&i>0&&(a[g++]=h-s,a[g++]=h-s-1,a[g++]=h-1,a[g++]=h-s,a[g++]=h-1,a[g++]=h),h++}}return{vertexCount:r,positions:c,indices:a,texCoords:l}}function p(e,t,i){return(0,c.t7)((0,c.t7)(e[0],e[1],i),(0,c.t7)(e[3],e[2],i),t)}const g={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:n.Df.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]},textureParameters:{type:"object",ignore:!0,value:null}};class f extends o.Z{getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME bitmap-layer-vertex-shader\n\nin vec2 texCoords;\nin vec3 positions;\nin vec3 positions64Low;\n\nout vec2 vTexCoord;\nout vec2 vTexPos;\n\nuniform float coordinateConversion;\n\nconst vec3 pickingColor = vec3(1.0, 0.0, 0.0);\n\nvoid main(void) {\n  geometry.worldPosition = positions;\n  geometry.uv = texCoords;\n  geometry.pickingColor = pickingColor;\n\n  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  vTexCoord = texCoords;\n\n  if (coordinateConversion < -0.5) {\n    vTexPos = geometry.position.xy + project_uCommonOrigin.xy;\n  } else if (coordinateConversion > 0.5) {\n    vTexPos = geometry.worldPosition.xy;\n  }\n\n  vec4 color = vec4(0.0);\n  DECKGL_FILTER_COLOR(color, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME bitmap-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D bitmapTexture;\n\nin vec2 vTexCoord;\nin vec2 vTexPos;\n\nout vec4 fragColor;\n\nuniform float desaturate;\nuniform vec4 transparentColor;\nuniform vec3 tintColor;\nuniform float opacity;\n\nuniform float coordinateConversion;\nuniform vec4 bounds;\n\n/* projection utils */\nconst float TILE_SIZE = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE = TILE_SIZE / PI / 2.0;\n\n// from degrees to Web Mercator\nvec2 lnglat_to_mercator(vec2 lnglat) {\n  float x = lnglat.x;\n  float y = clamp(lnglat.y, -89.9, 89.9);\n  return vec2(\n    radians(x) + PI,\n    PI + log(tan(PI * 0.25 + radians(y) * 0.5))\n  ) * WORLD_SCALE;\n}\n\n// from Web Mercator to degrees\nvec2 mercator_to_lnglat(vec2 xy) {\n  xy /= WORLD_SCALE;\n  return degrees(vec2(\n    xy.x - PI,\n    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5\n  ));\n}\n/* End projection utils */\n\n// apply desaturation\nvec3 color_desaturate(vec3 color) {\n  float luminance = (color.r + color.g + color.b) * 0.333333333;\n  return mix(color, vec3(luminance), desaturate);\n}\n\n// apply tint\nvec3 color_tint(vec3 color) {\n  return color * tintColor;\n}\n\n// blend with background color\nvec4 apply_opacity(vec3 color, float alpha) {\n  if (transparentColor.a == 0.0) {\n    return vec4(color, alpha);\n  }\n  float blendedAlpha = alpha + transparentColor.a * (1.0 - alpha);\n  float highLightRatio = alpha / blendedAlpha;\n  vec3 blendedRGB = mix(transparentColor.rgb, color, highLightRatio);\n  return vec4(blendedRGB, blendedAlpha);\n}\n\nvec2 getUV(vec2 pos) {\n  return vec2(\n    (pos.x - bounds[0]) / (bounds[2] - bounds[0]),\n    (pos.y - bounds[3]) / (bounds[1] - bounds[3])\n  );\n}\n\n\nvec3 packUVsIntoRGB(vec2 uv) {\n  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction\n  vec2 uv8bit = floor(uv * 256.);\n\n  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits\n  // Scale and clamp to 0-1 range\n  vec2 uvFraction = fract(uv * 256.);\n  vec2 uvFraction4bit = floor(uvFraction * 16.);\n\n  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates\n  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;\n\n  return vec3(uv8bit, fractions) / 255.;\n}\n\n\nvoid main(void) {\n  vec2 uv = vTexCoord;\n  if (coordinateConversion < -0.5) {\n    vec2 lnglat = mercator_to_lnglat(vTexPos);\n    uv = getUV(lnglat);\n  } else if (coordinateConversion > 0.5) {\n    vec2 commonPos = lnglat_to_mercator(vTexPos);\n    uv = getUV(commonPos);\n  }\n  vec4 bitmapColor = texture(bitmapTexture, uv);\n\n  fragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * opacity);\n\n  geometry.uv = uv;\n  DECKGL_FILTER_COLOR(fragColor, geometry);\n\n  if (bool(picking.isActive) && !bool(picking.isAttribute)) {\n    // Since instance information is not used, we can use picking color for pixel index\n    fragColor.rgb = packUVsIntoRGB(uv);\n  }\n}\n",modules:[s.Z,r.Z]})}initializeState(){const e=this.getAttributeManager();e.remove(["instancePickingColors"]);const t=!0;e.add({indices:{size:1,isIndexed:!0,update:e=>e.value=this.state.mesh.indices,noAlloc:t},positions:{size:3,type:"float64",fp64:this.use64bitPositions(),update:e=>e.value=this.state.mesh.positions,noAlloc:t},texCoords:{size:2,update:e=>e.value=this.state.mesh.texCoords,noAlloc:t}})}updateState(e){let{props:t,oldProps:i,changeFlags:n}=e;const o=this.getAttributeManager();var s;n.extensionsChanged&&(null==(s=this.state.model)||s.destroy(),this.state.model=this._getModel(),o.invalidateAll());if(t.bounds!==i.bounds){const e=this.state.mesh,t=this._createMesh();this.state.model.setVertexCount(t.vertexCount);for(const i in t)e&&e[i]!==t[i]&&o.invalidate(i);this.setState({mesh:t,...this._getCoordinateUniforms()})}else t._imageCoordinateSystem!==i._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo(e){const{image:t}=this.props,i=e.info;if(!i.color||!t)return i.bitmap=null,i;const{width:n,height:o}=t;i.index=0;const s=function(e){const[t,i,n]=e;return[(t+(15&n)/16)/256,(i+(240&n)/256)/256]}(i.color);return i.bitmap={size:{width:n,height:o},uv:s,pixel:[Math.floor(s[0]*n),Math.floor(s[1]*o)]},i}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(e){super._updateAutoHighlight({...e,color:this.encodePickingColor(0)})}_createMesh(){const{bounds:e}=this.props;let t=e;return m(e)&&(t=[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]]]),h(t,this.context.viewport.resolution)}_getModel(){return new a.H(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-list",isInstanced:!1})}draw(e){const{uniforms:t,moduleParameters:i}=e,{model:n,coordinateConversion:o,bounds:s,disablePicking:r}=this.state,{image:a,desaturate:l,transparentColor:c,tintColor:d}=this.props;i.picking.isActive&&r||a&&n&&(n.setUniforms(t),n.setBindings({bitmapTexture:a}),n.setUniforms({desaturate:l,transparentColor:c.map((e=>e/255)),tintColor:d.slice(0,3).map((e=>e/255)),coordinateConversion:o,bounds:s}),n.draw(this.context.renderPass))}_getCoordinateUniforms(){const{LNGLAT:e,CARTESIAN:t,DEFAULT:i}=n.Df;let{_imageCoordinateSystem:o}=this.props;if(o!==i){const{bounds:i}=this.props;if(!m(i))throw new Error("_imageCoordinateSystem only supports rectangular bounds");const n=this.context.viewport.resolution?e:t;if(o=o===e?e:t,o===e&&n===t)return{coordinateConversion:-1,bounds:i};if(o===t&&n===e){const e=(0,l.w5)([i[0],i[1]]),t=(0,l.w5)([i[2],i[3]]);return{coordinateConversion:1,bounds:[e[0],e[1],t[0],t[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}}function m(e){return Number.isFinite(e[0])}f.layerName="BitmapLayer",f.defaultProps=g},66918:(e,t,i)=>{i.d(t,{Z:()=>f});var n=i(45286),o=i(81135),s=i(55098),r=i(23064),a=i(19845),l=i(14594),c=i(70575),d=i(41708),u=i(78064);class h extends d.Z{constructor(e){const{indices:t,attributes:i}=function(e){const{radius:t,height:i=1,nradial:n=10}=e;let{vertices:o}=e;o&&(c.Z.assert(o.length>=n),o=o.flatMap((e=>[e[0],e[1]])),(0,u.Ny)(o,u.wG.COUNTER_CLOCKWISE));const s=i>0,r=n+1,a=s?3*r+1:n,l=2*Math.PI/n,d=new Uint16Array(s?3*n*2:0),h=new Float32Array(3*a),p=new Float32Array(3*a);let g=0;if(s){for(let e=0;e<r;e++){const s=e*l,r=e%n,a=Math.sin(s),c=Math.cos(s);for(let e=0;e<2;e++)h[g+0]=o?o[2*r]:c*t,h[g+1]=o?o[2*r+1]:a*t,h[g+2]=(.5-e)*i,p[g+0]=o?o[2*r]:c,p[g+1]=o?o[2*r+1]:a,g+=3}h[g+0]=h[g-3],h[g+1]=h[g-2],h[g+2]=h[g-1],g+=3}for(let c=s?0:1;c<r;c++){const e=Math.floor(c/2)*Math.sign(.5-c%2),s=e*l,r=(e+n)%n,a=Math.sin(s),d=Math.cos(s);h[g+0]=o?o[2*r]:d*t,h[g+1]=o?o[2*r+1]:a*t,h[g+2]=i/2,p[g+2]=1,g+=3}if(s){let e=0;for(let t=0;t<n;t++)d[e++]=2*t+0,d[e++]=2*t+2,d[e++]=2*t+0,d[e++]=2*t+1,d[e++]=2*t+1,d[e++]=2*t+3}return{indices:d,attributes:{POSITION:{size:3,value:h},NORMAL:{size:3,value:p}}}}(e);super({...e,indices:t,attributes:i})}}const p=[0,0,0,255],g={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,flatShading:!1,getPosition:{type:"accessor",value:e=>e.position},getFillColor:{type:"accessor",value:p},getLineColor:{type:"accessor",value:p},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class f extends n.Z{getShaders(){const e={},{flatShading:t}=this.props;return t&&(e.FLAT_SHADING=1),super.getShaders({vs:"#version 300 es\n#define SHADER_NAME column-layer-vertex-shader\nin vec3 positions;\nin vec3 normals;\nin vec3 instancePositions;\nin float instanceElevations;\nin vec3 instancePositions64Low;\nin vec4 instanceFillColors;\nin vec4 instanceLineColors;\nin float instanceStrokeWidths;\nin vec3 instancePickingColors;\nuniform float opacity;\nuniform float radius;\nuniform float angle;\nuniform vec2 offset;\nuniform bool extruded;\nuniform bool stroked;\nuniform bool isStroke;\nuniform float coverage;\nuniform float elevationScale;\nuniform float edgeDistance;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nuniform int radiusUnits;\nuniform int widthUnits;\nout vec4 vColor;\n#ifdef FLAT_SHADING\nout vec4 position_commonspace;\n#endif\nvoid main(void) {\ngeometry.worldPosition = instancePositions;\nvec4 color = isStroke ? instanceLineColors : instanceFillColors;\nmat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));\nfloat elevation = 0.0;\nfloat strokeOffsetRatio = 1.0;\nif (extruded) {\nelevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;\n} else if (stroked) {\nfloat widthPixels = clamp(\nproject_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),\nwidthMinPixels, widthMaxPixels) / 2.0;\nfloat halfOffset = project_pixel_size(widthPixels) / project_size(edgeDistance * coverage * radius);\nif (isStroke) {\nstrokeOffsetRatio -= sign(positions.z) * halfOffset;\n} else {\nstrokeOffsetRatio -= halfOffset;\n}\n}\nfloat shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);\nfloat dotRadius = radius * coverage * shouldRender;\ngeometry.pickingColor = instancePickingColors;\nvec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);\nvec3 centroidPosition64Low = instancePositions64Low;\nvec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + offset) * dotRadius;\nif (radiusUnits == UNIT_METERS) {\noffset = project_size(offset);\n}\nvec3 pos = vec3(offset, 0.);\nDECKGL_FILTER_SIZE(pos, geometry);\ngl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);\ngeometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\nif (extruded && !isStroke) {\n#ifdef FLAT_SHADING\nposition_commonspace = geometry.position;\nvColor = vec4(color.rgb, color.a * opacity);\n#else\nvec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);\nvColor = vec4(lightColor, color.a * opacity);\n#endif\n} else {\nvColor = vec4(color.rgb, color.a * opacity);\n}\nDECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME column-layer-fragment-shader\nprecision highp float;\nuniform vec3 project_uCameraPosition;\nuniform bool extruded;\nuniform bool isStroke;\nout vec4 fragColor;\nin vec4 vColor;\n#ifdef FLAT_SHADING\nin vec4 position_commonspace;\n#endif\nvoid main(void) {\nfragColor = vColor;\ngeometry.uv = vec2(0.);\n#ifdef FLAT_SHADING\nif (extruded && !isStroke && !bool(picking.isActive)) {\nvec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));\nfragColor.rgb = lighting_getLightColor(vColor.rgb, project_uCameraPosition, position_commonspace.xyz, normal);\n}\n#endif\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",defines:e,modules:[o.Z,t?s.s:s.N,r.Z]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getFillColor",defaultValue:p},instanceLineColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getLineColor",defaultValue:p},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState(e){super.updateState(e);const{props:t,oldProps:i,changeFlags:n}=e,o=n.extensionsChanged||t.flatShading!==i.flatShading;var s;o&&(null==(s=this.state.models)||s.forEach((e=>e.destroy())),this.setState(this._getModels()),this.getAttributeManager().invalidateAll());const r=this.getNumInstances();this.state.fillModel.setInstanceCount(r),this.state.wireframeModel.setInstanceCount(r),(o||t.diskResolution!==i.diskResolution||t.vertices!==i.vertices||(t.extruded||t.stroked)!==(i.extruded||i.stroked))&&this._updateGeometry(t)}getGeometry(e,t,i){const n=new h({radius:1,height:i?2:0,vertices:t,nradial:e});let o=0;if(t)for(let s=0;s<e;s++){const i=t[s];o+=Math.sqrt(i[0]*i[0]+i[1]*i[1])/e}else o=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*o}),n}_getModels(){const e=this.getShaders(),t=this.getAttributeManager().getBufferLayouts(),i=new l.H(this.context.device,{...e,id:this.props.id+"-fill",bufferLayout:t,isInstanced:!0}),n=new l.H(this.context.device,{...e,id:this.props.id+"-wireframe",bufferLayout:t,isInstanced:!0});return{fillModel:i,wireframeModel:n,models:[n,i]}}_updateGeometry(e){let{diskResolution:t,vertices:i,extruded:n,stroked:o}=e;const s=this.getGeometry(t,i,n||o);this.setState({fillVertexCount:s.attributes.POSITION.value.length/3});const r=this.state.fillModel,a=this.state.wireframeModel;r.setGeometry(s),r.setTopology("triangle-strip"),r.setIndexBuffer(null),a.setGeometry(s),a.setTopology("line-list")}draw(e){let{uniforms:t}=e;const{lineWidthUnits:i,lineWidthScale:n,lineWidthMinPixels:o,lineWidthMaxPixels:s,radiusUnits:r,elevationScale:l,extruded:c,filled:d,stroked:u,wireframe:h,offset:p,coverage:g,radius:f,angle:m}=this.props,v=this.state.fillModel,y=this.state.wireframeModel,{fillVertexCount:_,edgeDistance:b}=this.state,w={...t,radius:f,angle:m/180*Math.PI,offset:p,extruded:c,stroked:u,coverage:g,elevationScale:l,edgeDistance:b,radiusUnits:a.iI[r],widthUnits:a.iI[i],widthScale:n,widthMinPixels:o,widthMaxPixels:s};c&&h&&(y.setUniforms(w),y.setUniforms({isStroke:!0}),y.draw(this.context.renderPass)),v.setUniforms(w),d&&(v.setVertexCount(_),v.setUniforms({isStroke:!1}),v.draw(this.context.renderPass)),!c&&u&&(v.setVertexCount(2*_/3),v.setUniforms({isStroke:!0}),v.draw(this.context.renderPass))}}f.layerName="ColumnLayer",f.defaultProps=g},15788:(e,t,i)=>{i.d(t,{Z:()=>P});var n=i(96677),o=i(3012);var s=i(87799),r=i(11041),a=i(48950),l=i(36723),c=i(88574);const d={circle:{type:r.Z,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:s.Z,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:a.Z,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},u={type:l.Z,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},h={type:c.Z,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function p(e){let{type:t,props:i}=e;const n={};for(const o in i)n[o]=t.defaultProps[i[o]];return n}function g(e,t){const{transitions:i,updateTriggers:n}=e.props,o={updateTriggers:{},transitions:i&&{getPosition:i.geometry}};for(const s in t){const r=t[s];let a=e.props[s];s.startsWith("get")&&(a=e.getSubLayerAccessor(a),o.updateTriggers[r]=n[s],i&&(o.transitions[r]=i[s])),o[r]=a}return o}var f=i(70575);function m(e,t,i){void 0===i&&(i={});const n={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:o=0,endRow:s=e.length}=i;for(let r=o;r<s;r++){const i=e[r],{geometry:o}=i;if(o)if("GeometryCollection"===o.type){f.Z.assert(Array.isArray(o.geometries),"GeoJSON does not have geometries array");const{geometries:e}=o;for(let o=0;o<e.length;o++){v(e[o],n,t,i,r)}}else v(o,n,t,i,r)}return n}function v(e,t,i,n,o){const{type:s,coordinates:r}=e,{pointFeatures:a,lineFeatures:l,polygonFeatures:c,polygonOutlineFeatures:d}=t;if(function(e,t){let i=y[e];f.Z.assert(i,"Unknown GeoJSON type "+e);for(;t&&--i>0;)t=t[0];return t&&Number.isFinite(t[0])}(s,r))switch(s){case"Point":a.push(i({geometry:e},n,o));break;case"MultiPoint":r.forEach((e=>{a.push(i({geometry:{type:"Point",coordinates:e}},n,o))}));break;case"LineString":l.push(i({geometry:e},n,o));break;case"MultiLineString":r.forEach((e=>{l.push(i({geometry:{type:"LineString",coordinates:e}},n,o))}));break;case"Polygon":c.push(i({geometry:e},n,o)),r.forEach((e=>{d.push(i({geometry:{type:"LineString",coordinates:e}},n,o))}));break;case"MultiPolygon":r.forEach((e=>{c.push(i({geometry:{type:"Polygon",coordinates:e}},n,o)),e.forEach((e=>{d.push(i({geometry:{type:"LineString",coordinates:e}},n,o))}))}))}else f.Z.warn(s+" coordinates are malformed")()}const y={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function _(e){return e.geometry.coordinates}function b(e,t){const i={points:{},lines:{},polygons:{},polygonsOutline:{}},{points:n,lines:o,polygons:s}=e,r=function(e,t){const i={points:null,lines:null,polygons:null};for(const n in i){const o=e[n].globalFeatureIds.value;i[n]=new Uint8ClampedArray(3*o.length);const s=[];for(let e=0;e<o.length;e++)t(o[e],s),i[n][3*e+0]=s[0],i[n][3*e+1]=s[1],i[n][3*e+2]=s[2]}return i}(e,t);return i.points.data={length:n.positions.value.length/n.positions.size,attributes:{...n.attributes,getPosition:n.positions,instancePickingColors:{size:3,value:r.points}},properties:n.properties,numericProps:n.numericProps,featureIds:n.featureIds},i.lines.data={length:o.pathIndices.value.length-1,startIndices:o.pathIndices.value,attributes:{...o.attributes,getPath:o.positions,instancePickingColors:{size:3,value:r.lines}},properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},i.lines._pathType="open",i.polygons.data={length:s.polygonIndices.value.length-1,startIndices:s.polygonIndices.value,attributes:{...s.attributes,getPolygon:s.positions,pickingColors:{size:3,value:r.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},i.polygons._normalize=!1,s.triangles&&(i.polygons.data.attributes.indices=s.triangles.value),i.polygonsOutline.data={length:s.primitivePolygonIndices.value.length-1,startIndices:s.primitivePolygonIndices.value,attributes:{...s.attributes,getPath:s.positions,instancePickingColors:{size:3,value:r.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},i.polygonsOutline._pathType="open",i}const w=["points","linestrings","polygons"],x={...p(d.circle),...p(d.icon),...p(d.text),...p(u),...p(h),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:e=>e.properties.icon},getText:{type:"accessor",value:e=>e.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class P extends n.Z{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState(e){let{props:t,changeFlags:i}=e;if(!i.dataChanged)return;const{data:n}=this.props,o=n&&"points"in n&&"polygons"in n&&"lines"in n;this.setState({binary:o}),o?this._updateStateBinary({props:t,changeFlags:i}):this._updateStateJSON({props:t,changeFlags:i})}_updateStateBinary(e){let{props:t,changeFlags:i}=e;const n=b(t.data,this.encodePickingColor);this.setState({layerProps:n})}_updateStateJSON(e){let{props:t,changeFlags:i}=e;const n=function(e){if(Array.isArray(e))return e;switch(f.Z.assert(e.type,"GeoJSON does not have type"),e.type){case"Feature":return[e];case"FeatureCollection":return f.Z.assert(Array.isArray(e.features),"GeoJSON does not have features array"),e.features;default:return[{geometry:e}]}}(t.data),s=this.getSubLayerRow.bind(this);let r={};const a={};if(Array.isArray(i.dataChanged)){const e=this.state.features;for(const t in e)r[t]=e[t].slice(),a[t]=[];for(const t of i.dataChanged){const i=m(n,s,t);for(const n in e)a[n].push((0,o.b)({data:r[n],getIndex:e=>e.__source.index,dataRange:t,replace:i[n]}))}}else r=m(n,s);const l=function(e,t){const i={points:{},lines:{},polygons:{},polygonsOutline:{}},{pointFeatures:n,lineFeatures:o,polygonFeatures:s,polygonOutlineFeatures:r}=e;return i.points.data=n,i.points._dataDiff=t.pointFeatures&&(()=>t.pointFeatures),i.points.getPosition=_,i.lines.data=o,i.lines._dataDiff=t.lineFeatures&&(()=>t.lineFeatures),i.lines.getPath=_,i.polygons.data=s,i.polygons._dataDiff=t.polygonFeatures&&(()=>t.polygonFeatures),i.polygons.getPolygon=_,i.polygonsOutline.data=r,i.polygonsOutline._dataDiff=t.polygonOutlineFeatures&&(()=>t.polygonOutlineFeatures),i.polygonsOutline.getPath=_,i}(r,a);this.setState({features:r,featuresDiff:a,layerProps:l})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:i,sourceLayer:n}=t;return t.featureType=w.find((e=>n.id.startsWith(this.id+"-"+e+"-"))),i>=0&&n.id.startsWith(this.id+"-points-text")&&this.state.binary&&(t.index=this.props.data.points.globalFeatureIds.value[i]),t}_updateAutoHighlight(e){const t=this.id+"-points-",i="points"===e.featureType;for(const n of this.getSubLayers())n.id.startsWith(t)===i&&n.updateAutoHighlight(e)}_renderPolygonLayer(){var e;const{extruded:t,wireframe:i}=this.props,{layerProps:n}=this.state,o="polygons-fill",s=this.shouldRenderSubLayer(o,null==(e=n.polygons)?void 0:e.data)&&this.getSubLayerClass(o,h.type);if(s){const e=g(this,h.props),r=t&&i;return r||delete e.getLineColor,e.updateTriggers.lineColors=r,new s(e,this.getSubLayerProps({id:o,updateTriggers:e.updateTriggers}),n.polygons)}return null}_renderLineLayers(){var e,t;const{extruded:i,stroked:n}=this.props,{layerProps:o}=this.state,s="polygons-stroke",r="linestrings",a=!i&&n&&this.shouldRenderSubLayer(s,null==(e=o.polygonsOutline)?void 0:e.data)&&this.getSubLayerClass(s,u.type),l=this.shouldRenderSubLayer(r,null==(t=o.lines)?void 0:t.data)&&this.getSubLayerClass(r,u.type);if(a||l){const e=g(this,u.props);return[a&&new a(e,this.getSubLayerProps({id:s,updateTriggers:e.updateTriggers}),o.polygonsOutline),l&&new l(e,this.getSubLayerProps({id:r,updateTriggers:e.updateTriggers}),o.lines)]}return null}_renderPointLayers(){const{pointType:e}=this.props,{layerProps:t,binary:i}=this.state;let{highlightedObjectIndex:n}=this.props;!i&&Number.isFinite(n)&&(n=t.points.data.findIndex((e=>e.__source.index===n)));const o=new Set(e.split("+")),s=[];for(const a of o){var r;const e="points-"+a,o=d[a],l=o&&this.shouldRenderSubLayer(e,null==(r=t.points)?void 0:r.data)&&this.getSubLayerClass(e,o.type);if(l){const r=g(this,o.props);let c=t.points;if("text"===a&&i){const{instancePickingColors:e,...t}=c.data.attributes;c={...c,data:{...c.data,attributes:t}}}s.push(new l(r,this.getSubLayerProps({id:e,updateTriggers:r.updateTriggers,highlightedObjectIndex:n}),c))}}return s}renderLayers(){const{extruded:e}=this.props,t=this._renderPolygonLayer();return[!e&&t,this._renderLineLayers(),this._renderPointLayers(),e&&t]}getSubLayerAccessor(e){const{binary:t}=this.state;return t&&"function"==typeof e?(t,i)=>{const{data:n,index:o}=i,s=function(e,t){if(!e)return null;const i="startIndices"in e?e.startIndices[t]:t,n=e.featureIds.value[i];return-1!==i?function(e,t,i){const n={properties:{...e.properties[t]}};for(const o in e.numericProps)n.properties[o]=e.numericProps[o].value[i];return n}(e,n,i):null}(n,o);return e(s,i)}:super.getSubLayerAccessor(e)}}P.layerName="GeoJsonLayer",P.defaultProps=x},87799:(e,t,i)=>{i.d(t,{Z:()=>w});var n=i(45286),o=i(81135),s=i(23064),r=i(19845),a=i(70575),l=i(14594),c=i(41708);var d=i(39470),u=i(55884);const h=()=>{},p={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},g={x:0,y:0,width:0,height:0};function f(e,t,i,n){const o=Math.min(i/t.width,n/t.height),s=Math.floor(t.width*o),r=Math.floor(t.height*o);return 1===o?{data:t,width:s,height:r}:(e.canvas.height=r,e.canvas.width=s,e.clearRect(0,0,s,r),e.drawImage(t,0,0,t.width,t.height,0,0,s,r),{data:e.canvas,width:s,height:r})}function m(e){return e&&(e.id||e.url)}function v(e,t,i){for(let n=0;n<t.length;n++){const{icon:o,xOffset:s}=t[n];e[m(o)]={...o,x:s,y:i}}}class y{constructor(e,t){let{onUpdate:i=h,onError:n=h}=t;this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._textureParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=4,this._canvasWidth=1024,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=i,this.onError=n}finalize(){var e;null==(e=this._texture)||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const t=this._autoPacking?m(e):e;return this._mapping[t]||g}setProps(e){let{loadOptions:t,autoPacking:i,iconAtlas:n,iconMapping:o,textureParameters:s}=e;var r;(t&&(this._loadOptions=t),void 0!==i&&(this._autoPacking=i),o&&(this._mapping=o),n)&&(null==(r=this._texture)||r.delete(),this._texture=null,this._externalTexture=n);s&&(this._textureParameters=s)}get isLoaded(){return 0===this._pendingCount}packIcons(e,t){if(!this._autoPacking||"undefined"==typeof document)return;const i=Object.values(function(e,t,i){if(!e||!t)return null;i=i||{};const n={},{iterable:o,objectInfo:s}=(0,u.jB)(e);for(const r of o){s.index++;const e=t(r,s),o=m(e);if(!e)throw new Error("Icon is missing.");if(!e.url)throw new Error("Icon url is missing.");n[o]||i[o]&&e.url===i[o].url||(n[o]={...e,source:r,sourceIndex:s.index})}return n}(e,t,this._mapping)||{});if(i.length>0){const{mapping:e,xOffset:t,yOffset:n,rowHeight:o,canvasHeight:s}=function(e){let{icons:t,buffer:i,mapping:n={},xOffset:o=0,yOffset:s=0,rowHeight:r=0,canvasWidth:a}=e,l=[];for(let d=0;d<t.length;d++){const e=t[d];if(!n[m(e)]){const{height:t,width:c}=e;o+c+i>a&&(v(n,l,s),o=0,s=r+s+i,r=0,l=[]),l.push({icon:e,xOffset:o}),o=o+c+i,r=Math.max(r,t)}}return l.length>0&&v(n,l,s),{mapping:n,rowHeight:r,xOffset:o,yOffset:s,canvasWidth:a,canvasHeight:(c=r+s+i,Math.pow(2,Math.ceil(Math.log2(c))))};var c}({icons:i,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=o,this._mapping=e,this._xOffset=t,this._yOffset=n,this._canvasHeight=s,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._textureParameters||p})),this._texture.height!==this._canvasHeight&&(this._texture=function(e,t,i,n){const{width:o,height:s,device:r}=e,a=r.createTexture({format:"rgba8unorm",width:t,height:i,sampler:n}),l=r.createCommandEncoder();return l.copyTextureToTexture({source:e,destination:a,width:o,height:s}),l.finish(),e.destroy(),a}(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||p)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(i)}}_loadIcons(e){const t=this._canvas.getContext("2d",{willReadFrequently:!0});for(const i of e)this._pendingCount++,(0,d.z)(i.url,this._loadOptions).then((e=>{const n=m(i),o=this._mapping[n],{x:s,y:r,width:a,height:l}=o,{data:c,width:d,height:u}=f(t,e,a,l);this._texture.setSubImageData({data:c,x:s+(a-d)/2,y:r+(l-u)/2,width:d,height:u}),o.width=d,o.height=u,this._texture.generateMipmap(),this.onUpdate()})).catch((e=>{this.onError({url:i.url,source:i.source,sourceIndex:i.sourceIndex,loadOptions:this._loadOptions,error:e})})).finally((()=>{this._pendingCount--}))}}const _=[0,0,0,255],b={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:e=>e.position},getIcon:{type:"accessor",value:e=>e.icon},getColor:{type:"accessor",value:_},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class w extends n.Z{getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME icon-layer-vertex-shader\nin vec2 positions;\nin vec3 instancePositions;\nin vec3 instancePositions64Low;\nin float instanceSizes;\nin float instanceAngles;\nin vec4 instanceColors;\nin vec3 instancePickingColors;\nin vec4 instanceIconFrames;\nin float instanceColorModes;\nin vec2 instanceOffsets;\nin vec2 instancePixelOffset;\nuniform float sizeScale;\nuniform vec2 iconsTextureDim;\nuniform float sizeMinPixels;\nuniform float sizeMaxPixels;\nuniform bool billboard;\nuniform int sizeUnits;\nout float vColorMode;\nout vec4 vColor;\nout vec2 vTextureCoords;\nout vec2 uv;\nvec2 rotate_by_angle(vec2 vertex, float angle) {\nfloat angle_radian = angle * PI / 180.0;\nfloat cos_angle = cos(angle_radian);\nfloat sin_angle = sin(angle_radian);\nmat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\nreturn rotationMatrix * vertex;\n}\nvoid main(void) {\ngeometry.worldPosition = instancePositions;\ngeometry.uv = positions;\ngeometry.pickingColor = instancePickingColors;\nuv = positions;\nvec2 iconSize = instanceIconFrames.zw;\nfloat sizePixels = clamp(\nproject_size_to_pixel(instanceSizes * sizeScale, sizeUnits),\nsizeMinPixels, sizeMaxPixels\n);\nfloat instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;\nvec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;\npixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;\npixelOffset += instancePixelOffset;\npixelOffset.y *= -1.0;\nif (billboard)  {\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\nvec3 offset = vec3(pixelOffset, 0.0);\nDECKGL_FILTER_SIZE(offset, geometry);\ngl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n} else {\nvec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);\nDECKGL_FILTER_SIZE(offset_common, geometry);\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n}\nvTextureCoords = mix(\ninstanceIconFrames.xy,\ninstanceIconFrames.xy + iconSize,\n(positions.xy + 1.0) / 2.0\n) / iconsTextureDim;\nvColor = instanceColors;\nDECKGL_FILTER_COLOR(vColor, geometry);\nvColorMode = instanceColorModes;\n}\n",fs:"#version 300 es\n#define SHADER_NAME icon-layer-fragment-shader\nprecision highp float;\nuniform float opacity;\nuniform sampler2D iconsTexture;\nuniform float alphaCutoff;\nin float vColorMode;\nin vec4 vColor;\nin vec2 vTextureCoords;\nin vec2 uv;\nout vec4 fragColor;\nvoid main(void) {\ngeometry.uv = uv;\nvec4 texColor = texture(iconsTexture, vTextureCoords);\nvec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);\nfloat a = texColor.a * opacity * vColor.a;\nif (a < alphaCutoff) {\ndiscard;\n}\nfragColor = vec4(color, a);\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",modules:[o.Z,s.Z]})}initializeState(){this.state={iconManager:new y(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})};this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:_},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);const{props:t,oldProps:i,changeFlags:n}=e,o=this.getAttributeManager(),{iconAtlas:s,iconMapping:r,data:a,getIcon:l,textureParameters:c}=t,{iconManager:d}=this.state;if("string"==typeof s)return;const u=s||this.internalState.isAsyncPropLoading("iconAtlas");var h;(d.setProps({loadOptions:t.loadOptions,autoPacking:!u,iconAtlas:s,iconMapping:u?r:null,textureParameters:c}),u?i.iconMapping!==t.iconMapping&&o.invalidate("getIcon"):(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getIcon))&&d.packIcons(a,l),n.extensionsChanged)&&(null==(h=this.state.model)||h.destroy(),this.state.model=this._getModel(),o.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw(e){let{uniforms:t}=e;const{sizeScale:i,sizeMinPixels:n,sizeMaxPixels:o,sizeUnits:s,billboard:a,alphaCutoff:l}=this.props,{iconManager:c}=this.state,d=c.getTexture();if(d){const e=this.state.model;e.setBindings({iconsTexture:d}),e.setUniforms(t),e.setUniforms({iconsTextureDim:[d.width,d.height],sizeUnits:r.iI[s],sizeScale:i,sizeMinPixels:n,sizeMaxPixels:o,billboard:a,alphaCutoff:l}),e.draw(this.context.renderPass)}}_getModel(){return new l.H(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new c.Z({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([-1,-1,1,-1,-1,1,1,1])}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var t;const i=null==(t=this.getCurrentLayer())?void 0:t.props.onIconError;i?i(e):a.Z.error(e.error.message)()}getInstanceOffset(e){const{width:t,height:i,anchorX:n=t/2,anchorY:o=i/2}=this.state.iconManager.getIconMapping(e);return[t/2-n,i/2-o]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:t,y:i,width:n,height:o}=this.state.iconManager.getIconMapping(e);return[t,i,n,o]}}w.defaultProps=b,w.layerName="IconLayer"},36723:(e,t,i)=>{i.d(t,{Z:()=>m});var n=i(45286),o=i(81135),s=i(23064),r=i(19845),a=i(41708),l=i(14594),c=i(80662),d=i(78064);class u extends c.Z{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?function(e,t,i,n){let o;if(Array.isArray(e[0])){const i=e.length*t;o=new Array(i);for(let n=0;n<e.length;n++)for(let i=0;i<t;i++)o[n*t+i]=e[n][i]||0}else o=e;return i?(0,d.dj)(o,{size:t,gridResolution:i}):n?(0,d.ct)(o,{size:t}):o}(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(h(e)){let t=0;for(const i of e)t+=this.getGeometrySize(i);return t}const t=this.getPathLength(e);return t<2?0:this.isClosed(e)?t<3?0:t+2:t}updateGeometryAttributes(e,t){if(0!==t.geometrySize)if(e&&h(e))for(const i of e){const e=this.getGeometrySize(i);t.geometrySize=e,this.updateGeometryAttributes(i,t),t.vertexStart+=e}else this._updateSegmentTypes(e,t),this._updatePositions(e,t)}_updateSegmentTypes(e,t){const i=this.attributes.segmentTypes,n=!!e&&this.isClosed(e),{vertexStart:o,geometrySize:s}=t;i.fill(0,o,o+s),n?(i[o]=4,i[o+s-2]=4):(i[o]+=1,i[o+s-2]+=2),i[o+s-1]=4}_updatePositions(e,t){const{positions:i}=this.attributes;if(!i||!e)return;const{vertexStart:n,geometrySize:o}=t,s=new Array(3);for(let r=n,a=0;a<o;r++,a++)this.getPointOnPath(e,a,s),i[3*r]=s[0],i[3*r+1]=s[1],i[3*r+2]=s[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,t,i){void 0===i&&(i=[]);const{positionSize:n}=this;t*n>=e.length&&(t+=1-e.length/n);const o=t*n;return i[0]=e[o],i[1]=e[o+1],i[2]=3===n&&e[o+2]||0,i}isClosed(e){if(!this.normalize)return Boolean(this.opts.loop);const{positionSize:t}=this,i=e.length-t;return e[0]===e[i]&&e[1]===e[i+1]&&(2===t||e[2]===e[i+2])}}function h(e){return Array.isArray(e[0])}const p=[0,0,0,255],g={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:e=>e.path},getColor:{type:"accessor",value:p},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},f={enter:(e,t)=>t.length?t.subarray(t.length-e.length):e};class m extends n.Z{getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME path-layer-vertex-shader\nin vec2 positions;\nin float instanceTypes;\nin vec3 instanceStartPositions;\nin vec3 instanceEndPositions;\nin vec3 instanceLeftPositions;\nin vec3 instanceRightPositions;\nin vec3 instanceLeftPositions64Low;\nin vec3 instanceStartPositions64Low;\nin vec3 instanceEndPositions64Low;\nin vec3 instanceRightPositions64Low;\nin float instanceStrokeWidths;\nin vec4 instanceColors;\nin vec3 instancePickingColors;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nuniform float jointType;\nuniform float capType;\nuniform float miterLimit;\nuniform bool billboard;\nuniform int widthUnits;\nuniform float opacity;\nout vec4 vColor;\nout vec2 vCornerOffset;\nout float vMiterLength;\nout vec2 vPathPosition;\nout float vPathLength;\nout float vJointType;\nconst float EPSILON = 0.001;\nconst vec3 ZERO_OFFSET = vec3(0.0);\nfloat flipIfTrue(bool flag) {\nreturn -(float(flag) * 2. - 1.);\n}\nvec3 getLineJoinOffset(\nvec3 prevPoint, vec3 currPoint, vec3 nextPoint,\nvec2 width\n) {\nbool isEnd = positions.x > 0.0;\nfloat sideOfPath = positions.y;\nfloat isJoint = float(sideOfPath == 0.0);\nvec3 deltaA3 = (currPoint - prevPoint);\nvec3 deltaB3 = (nextPoint - currPoint);\nmat3 rotationMatrix;\nbool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);\nif (needsRotation) {\ndeltaA3 = deltaA3 * rotationMatrix;\ndeltaB3 = deltaB3 * rotationMatrix;\n}\nvec2 deltaA = deltaA3.xy / width;\nvec2 deltaB = deltaB3.xy / width;\nfloat lenA = length(deltaA);\nfloat lenB = length(deltaB);\nvec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);\nvec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);\nvec2 perpA = vec2(-dirA.y, dirA.x);\nvec2 perpB = vec2(-dirB.y, dirB.x);\nvec2 tangent = dirA + dirB;\ntangent = length(tangent) > 0. ? normalize(tangent) : perpA;\nvec2 miterVec = vec2(-tangent.y, tangent.x);\nvec2 dir = isEnd ? dirA : dirB;\nvec2 perp = isEnd ? perpA : perpB;\nfloat L = isEnd ? lenA : lenB;\nfloat sinHalfA = abs(dot(miterVec, perp));\nfloat cosHalfA = abs(dot(dirA, miterVec));\nfloat turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);\nfloat cornerPosition = sideOfPath * turnDirection;\nfloat miterSize = 1.0 / max(sinHalfA, EPSILON);\nmiterSize = mix(\nmin(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),\nmiterSize,\nstep(0.0, cornerPosition)\n);\nvec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))\n* (sideOfPath + isJoint * turnDirection);\nbool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));\nbool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));\nbool isCap = isStartCap || isEndCap;\nif (isCap) {\noffsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);\nvJointType = capType;\n} else {\nvJointType = jointType;\n}\nvPathLength = L;\nvCornerOffset = offsetVec;\nvMiterLength = dot(vCornerOffset, miterVec * turnDirection);\nvMiterLength = isCap ? isJoint : vMiterLength;\nvec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);\nvPathPosition = vec2(\ndot(offsetFromStartOfPath, perp),\ndot(offsetFromStartOfPath, dir)\n);\ngeometry.uv = vPathPosition;\nfloat isValid = step(instanceTypes, 3.5);\nvec3 offset = vec3(offsetVec * width * isValid, 0.0);\nif (needsRotation) {\noffset = rotationMatrix * offset;\n}\nreturn offset;\n}\nvoid clipLine(inout vec4 position, vec4 refPosition) {\nif (position.w < EPSILON) {\nfloat r = (EPSILON - refPosition.w) / (position.w - refPosition.w);\nposition = refPosition + (position - refPosition) * r;\n}\n}\nvoid main() {\ngeometry.pickingColor = instancePickingColors;\nvColor = vec4(instanceColors.rgb, instanceColors.a * opacity);\nfloat isEnd = positions.x;\nvec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);\nvec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);\nvec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);\nvec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);\nvec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);\nvec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);\ngeometry.worldPosition = currPosition;\nvec2 widthPixels = vec2(clamp(\nproject_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),\nwidthMinPixels, widthMaxPixels) / 2.0);\nvec3 width;\nif (billboard) {\nvec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);\nvec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);\nvec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);\nclipLine(prevPositionScreen, currPositionScreen);\nclipLine(nextPositionScreen, currPositionScreen);\nclipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));\nwidth = vec3(widthPixels, 0.0);\nDECKGL_FILTER_SIZE(width, geometry);\nvec3 offset = getLineJoinOffset(\nprevPositionScreen.xyz / prevPositionScreen.w,\ncurrPositionScreen.xyz / currPositionScreen.w,\nnextPositionScreen.xyz / nextPositionScreen.w,\nproject_pixel_size_to_clipspace(width.xy)\n);\nDECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);\ngl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);\n} else {\nprevPosition = project_position(prevPosition, prevPosition64Low);\ncurrPosition = project_position(currPosition, currPosition64Low);\nnextPosition = project_position(nextPosition, nextPosition64Low);\nwidth = vec3(project_pixel_size(widthPixels), 0.0);\nDECKGL_FILTER_SIZE(width, geometry);\nvec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);\ngeometry.position = vec4(currPosition + offset, 1.0);\ngl_Position = project_common_position_to_clipspace(geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n}\nDECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME path-layer-fragment-shader\nprecision highp float;\nuniform float miterLimit;\nin vec4 vColor;\nin vec2 vCornerOffset;\nin float vMiterLength;\nin vec2 vPathPosition;\nin float vPathLength;\nin float vJointType;\nout vec4 fragColor;\nvoid main(void) {\ngeometry.uv = vPathPosition;\nif (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {\nif (vJointType > 0.5 && length(vCornerOffset) > 1.0) {\ndiscard;\n}\nif (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {\ndiscard;\n}\n}\nfragColor = vColor;\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",modules:[o.Z,s.Z]})}get wrapLongitude(){return!1}getBounds(){var e;return null==(e=this.getAttributeManager())?void 0:e.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:f,accessor:"getPath",update:this.calculatePositions,noAlloc:true,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:true},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:f,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:f,defaultValue:p},instancePickingColors:{size:4,type:"uint8",accessor:(e,t)=>{let{index:i,target:n}=t;return this.encodePickingColor(e&&e.__source?e.__source.index:i,n)}}}),this.setState({pathTesselator:new u({fp64:this.use64bitPositions()})})}updateState(e){super.updateState(e);const{props:t,changeFlags:i}=e,n=this.getAttributeManager();if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPath)){const{pathTesselator:e}=this.state,o=t.data.attributes||{};e.updateGeometry({data:t.data,geometryBuffer:o.getPath,buffers:o,normalize:!t._pathType,loop:"loop"===t._pathType,getGeometry:t.getPath,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:i.dataChanged}),this.setState({numInstances:e.instanceCount,startIndices:e.vertexStarts}),i.dataChanged||n.invalidateAll()}var o;i.extensionsChanged&&(null==(o=this.state.model)||o.destroy(),this.state.model=this._getModel(),n.invalidateAll())}getPickingInfo(e){const t=super.getPickingInfo(e),{index:i}=t,n=this.props.data;return n[0]&&n[0].__source&&(t.object=n.find((e=>e.__source.index===i))),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let i=0;i<t.length;i++)t[i].__source.index===e&&this._disablePickingIndex(i);else super.disablePickingIndex(e)}draw(e){let{uniforms:t}=e;const{jointRounded:i,capRounded:n,billboard:o,miterLimit:s,widthUnits:a,widthScale:l,widthMinPixels:c,widthMaxPixels:d}=this.props,u=this.state.model;u.setUniforms(t),u.setUniforms({jointType:Number(i),capType:Number(n),billboard:o,widthUnits:r.iI[a],widthScale:l,miterLimit:s,widthMinPixels:c,widthMaxPixels:d}),u.draw(this.context.renderPass)}_getModel(){return new l.H(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new a.Z({topology:"triangle-list",attributes:{indices:new Uint16Array([0,1,2,1,4,2,1,3,4,3,5,4]),positions:{value:new Float32Array([0,0,0,-1,0,1,1,-1,1,1,1,0]),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateSegmentTypes(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("segmentTypes")}}m.defaultProps=g,m.layerName="PathLayer"},75096:(e,t,i)=>{i.d(t,{Z:()=>h});var n=i(96677),o=i(70575),s=i(55884),r=i(88574),a=i(36723),l=i(18635),c=i(3012);const d=[0,0,0,255],u={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:e=>e.polygon},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:d},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class h extends n.Z{initializeState(){this.state={paths:[],pathsDiff:null},this.props.getLineDashArray&&o.Z.removed("getLineDashArray","PathStyleExtension")()}updateState(e){let{changeFlags:t}=e;const i=t.dataChanged||t.updateTriggersChanged&&(t.updateTriggersChanged.all||t.updateTriggersChanged.getPolygon);if(i&&Array.isArray(t.dataChanged)){const e=this.state.paths.slice(),i=t.dataChanged.map((t=>(0,c.b)({data:e,getIndex:e=>e.__source.index,dataRange:t,replace:this._getPaths(t)})));this.setState({paths:e,pathsDiff:i})}else i&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(e){void 0===e&&(e={});const{data:t,getPolygon:i,positionFormat:n,_normalize:o}=this.props,r=[],a="XY"===n?2:3,{startRow:c,endRow:d}=e,{iterable:u,objectInfo:h}=(0,s.jB)(t,c,d);for(const s of u){h.index++;let e=i(s,h);o&&(e=l.Fv(e,a));const{holeIndices:t}=e,n=e.positions||e;if(t)for(let i=0;i<=t.length;i++){const e=n.slice(t[i-1]||0,t[i]||n.length);r.push(this.getSubLayerRow({path:e},s,h.index))}else r.push(this.getSubLayerRow({path:n},s,h.index))}return r}renderLayers(){const{data:e,_dataDiff:t,stroked:i,filled:n,extruded:o,wireframe:s,_normalize:l,_windingOrder:c,elevationScale:u,transitions:h,positionFormat:p}=this.props,{lineWidthUnits:g,lineWidthScale:f,lineWidthMinPixels:m,lineWidthMaxPixels:v,lineJointRounded:y,lineMiterLimit:_,lineDashJustified:b}=this.props,{getFillColor:w,getLineColor:x,getLineWidth:P,getLineDashArray:C,getElevation:S,getPolygon:T,updateTriggers:L,material:M}=this.props,{paths:k,pathsDiff:E}=this.state,I=this.getSubLayerClass("fill",r.Z),A=this.getSubLayerClass("stroke",a.Z),z=this.shouldRenderSubLayer("fill",k)&&new I({_dataDiff:t,extruded:o,elevationScale:u,filled:n,wireframe:s,_normalize:l,_windingOrder:c,getElevation:S,getFillColor:w,getLineColor:o&&s?x:d,material:M,transitions:h},this.getSubLayerProps({id:"fill",updateTriggers:L&&{getPolygon:L.getPolygon,getElevation:L.getElevation,getFillColor:L.getFillColor,lineColors:o&&s,getLineColor:L.getLineColor}}),{data:e,positionFormat:p,getPolygon:T});return[!o&&z,!o&&i&&this.shouldRenderSubLayer("stroke",k)&&new A({_dataDiff:E&&(()=>E),widthUnits:g,widthScale:f,widthMinPixels:m,widthMaxPixels:v,jointRounded:y,miterLimit:_,dashJustified:b,_pathType:"loop",transitions:h&&{getWidth:h.getLineWidth,getColor:h.getLineColor,getPath:h.getPolygon},getColor:this.getSubLayerAccessor(x),getWidth:this.getSubLayerAccessor(P),getDashArray:this.getSubLayerAccessor(C)},this.getSubLayerProps({id:"stroke",updateTriggers:L&&{getWidth:L.getLineWidth,getColor:L.getLineColor,getDashArray:L.getLineDashArray}}),{data:k,positionFormat:p,getPath:e=>e.path}),o&&z]}}h.layerName="PolygonLayer",h.defaultProps=u},11041:(e,t,i)=>{i.d(t,{Z:()=>u});var n=i(45286),o=i(81135),s=i(23064),r=i(19845),a=i(41708),l=i(14594);const c=[0,0,0,255],d={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:e=>e.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:c},getLineColor:{type:"accessor",value:c},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class u extends n.Z{getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME scatterplot-layer-vertex-shader\nin vec3 positions;\nin vec3 instancePositions;\nin vec3 instancePositions64Low;\nin float instanceRadius;\nin float instanceLineWidths;\nin vec4 instanceFillColors;\nin vec4 instanceLineColors;\nin vec3 instancePickingColors;\nuniform float opacity;\nuniform float radiusScale;\nuniform float radiusMinPixels;\nuniform float radiusMaxPixels;\nuniform float lineWidthScale;\nuniform float lineWidthMinPixels;\nuniform float lineWidthMaxPixels;\nuniform float stroked;\nuniform bool filled;\nuniform bool antialiasing;\nuniform bool billboard;\nuniform int radiusUnits;\nuniform int lineWidthUnits;\nout vec4 vFillColor;\nout vec4 vLineColor;\nout vec2 unitPosition;\nout float innerUnitRadius;\nout float outerRadiusPixels;\nvoid main(void) {\ngeometry.worldPosition = instancePositions;\nouterRadiusPixels = clamp(\nproject_size_to_pixel(radiusScale * instanceRadius, radiusUnits),\nradiusMinPixels, radiusMaxPixels\n);\nfloat lineWidthPixels = clamp(\nproject_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),\nlineWidthMinPixels, lineWidthMaxPixels\n);\nouterRadiusPixels += stroked * lineWidthPixels / 2.0;\nfloat edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;\nunitPosition = edgePadding * positions.xy;\ngeometry.uv = unitPosition;\ngeometry.pickingColor = instancePickingColors;\ninnerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;\nif (billboard) {\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\nvec3 offset = edgePadding * positions * outerRadiusPixels;\nDECKGL_FILTER_SIZE(offset, geometry);\ngl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n} else {\nvec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);\nDECKGL_FILTER_SIZE(offset, geometry);\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n}\nvFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);\nDECKGL_FILTER_COLOR(vFillColor, geometry);\nvLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);\nDECKGL_FILTER_COLOR(vLineColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME scatterplot-layer-fragment-shader\nprecision highp float;\nuniform bool filled;\nuniform float stroked;\nuniform bool antialiasing;\nin vec4 vFillColor;\nin vec4 vLineColor;\nin vec2 unitPosition;\nin float innerUnitRadius;\nin float outerRadiusPixels;\nout vec4 fragColor;\nvoid main(void) {\ngeometry.uv = unitPosition;\nfloat distToCenter = length(unitPosition) * outerRadiusPixels;\nfloat inCircle = antialiasing ?\nsmoothedge(distToCenter, outerRadiusPixels) :\nstep(distToCenter, outerRadiusPixels);\nif (inCircle == 0.0) {\ndiscard;\n}\nif (stroked > 0.5) {\nfloat isLine = antialiasing ?\nsmoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :\nstep(innerUnitRadius * outerRadiusPixels, distToCenter);\nif (filled) {\nfragColor = mix(vFillColor, vLineColor, isLine);\n} else {\nif (isLine == 0.0) {\ndiscard;\n}\nfragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);\n}\n} else if (!filled) {\ndiscard;\n} else {\nfragColor = vFillColor;\n}\nfragColor.a *= inCircle;\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",modules:[o.Z,s.Z]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var t;(super.updateState(e),e.changeFlags.extensionsChanged)&&(null==(t=this.state.model)||t.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw(e){let{uniforms:t}=e;const{radiusUnits:i,radiusScale:n,radiusMinPixels:o,radiusMaxPixels:s,stroked:a,filled:l,billboard:c,antialiasing:d,lineWidthUnits:u,lineWidthScale:h,lineWidthMinPixels:p,lineWidthMaxPixels:g}=this.props,f=this.state.model;f.setUniforms(t),f.setUniforms({stroked:a?1:0,filled:l,billboard:c,antialiasing:d,radiusUnits:r.iI[i],radiusScale:n,radiusMinPixels:o,radiusMaxPixels:s,lineWidthUnits:r.iI[u],lineWidthScale:h,lineWidthMinPixels:p,lineWidthMaxPixels:g}),f.draw(this.context.renderPass)}_getModel(){return new l.H(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new a.Z({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0])}}}),isInstanced:!0})}}u.defaultProps=d,u.layerName="ScatterplotLayer"},18635:(e,t,i)=>{i.d(t,{Fv:()=>h,Gd:()=>c,k8:()=>l,mD:()=>f});var n=i(9187),o=i(78064);const s=o.wG.CLOCKWISE,r=o.wG.COUNTER_CLOCKWISE,a={isClosed:!0};function l(e){return"positions"in e?e.positions:e}function c(e){return"holeIndices"in e?e.holeIndices:null}function d(e,t,i,n,s){let r=t;const l=i.length;for(let o=0;o<l;o++)for(let t=0;t<n;t++)e[r++]=i[o][t]||0;if(!function(e){const t=e[0],i=e[e.length-1];return t[0]===i[0]&&t[1]===i[1]&&t[2]===i[2]}(i))for(let o=0;o<n;o++)e[r++]=i[0][o]||0;return a.start=t,a.end=r,a.size=n,(0,o.Ny)(e,s,a),r}function u(e,t,i,n,s,r,l){void 0===s&&(s=0);const c=(r=r||i.length)-s;if(c<=0)return t;let d=t;for(let o=0;o<c;o++)e[d++]=i[s+o];if(!function(e,t,i,n){for(let o=0;o<t;o++)if(e[i+o]!==e[n-t+o])return!1;return!0}(i,n,s,r))for(let o=0;o<n;o++)e[d++]=i[s+o];return a.start=t,a.end=d,a.size=n,(0,o.Ny)(e,l,a),d}function h(e,t){!function(e){if(e=e&&e.positions||e,!Array.isArray(e)&&!ArrayBuffer.isView(e))throw new Error("invalid polygon")}(e);const i=[],n=[];if("positions"in e){const{positions:o,holeIndices:a}=e;if(a){let e=0;for(let l=0;l<=a.length;l++)e=u(i,e,o,t,a[l-1],a[l],0===l?s:r),n.push(e);return n.pop(),{positions:i,holeIndices:n}}e=o}if(!function(e){return Array.isArray(e[0])}(e))return u(i,0,e,t,0,i.length,s),i;if(!function(e){return e.length>=1&&e[0].length>=2&&Number.isFinite(e[0][0])}(e)){let o=0;for(const[a,l]of e.entries())o=d(i,o,l,t,0===a?s:r),n.push(o);return n.pop(),{positions:i,holeIndices:n}}return d(i,0,e,t,s),i}function p(e,t,i){const n=e.length/3;let o=0;for(let s=0;s<n;s++){const r=(s+1)%n;o+=e[3*s+t]*e[3*r+i],o-=e[3*r+t]*e[3*s+i]}return Math.abs(o/2)}function g(e,t,i,n){const o=e.length/3;for(let s=0;s<o;s++){const o=3*s,r=e[o+0],a=e[o+1],l=e[o+2];e[o+t]=r,e[o+i]=a,e[o+n]=l}}function f(e,t,i,o){let s=c(e);s&&(s=s.map((e=>e/t)));let r=l(e);const a=o&&3===t;if(i){const e=r.length;r=r.slice();const n=[];for(let o=0;o<e;o+=t){n[0]=r[o],n[1]=r[o+1],a&&(n[2]=r[o+2]);const e=i(n);r[o]=e[0],r[o+1]=e[1],a&&(r[o+2]=e[2])}}if(a){const e=p(r,0,1),t=p(r,0,2),n=p(r,1,2);if(!e&&!t&&!n)return[];e>t&&e>n||(t>n?(i||(r=r.slice()),g(r,0,2,1)):(i||(r=r.slice()),g(r,2,0,1)))}return n(r,s,t)}},88574:(e,t,i)=>{i.d(t,{Z:()=>w});var n=i(45286),o=i(81135),s=i(55098),r=i(23064),a=i(19845),l=i(14594),c=i(41708),d=i(18635),u=i(80662),h=i(78064);class p extends u.Z{constructor(e){const{fp64:t,IndexType:i=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:t?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:i,size:1}}})}get(e){const{attributes:t}=this;return"indices"===e?t.indices&&t.indices.subarray(0,this.vertexCount):t[e]}updateGeometry(e){super.updateGeometry(e);const t=this.buffers.indices;if(t)this.vertexCount=(t.value||t).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const t=d.Fv(e,this.positionSize);return this.opts.resolution?(0,h.WZ)(d.k8(t),d.Gd(t),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?(0,h.GU)(d.k8(t),d.Gd(t),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):t}return e}getGeometrySize(e){if(g(e)){let t=0;for(const i of e)t+=this.getGeometrySize(i);return t}return d.k8(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,t){if(e&&g(e))for(const i of e){const e=this.getGeometrySize(i);t.geometrySize=e,this.updateGeometryAttributes(i,t),t.vertexStart+=e,t.indexStart=this.indexStarts[t.geometryIndex+1]}else{const i=e;this._updateIndices(i,t),this._updatePositions(i,t),this._updateVertexValid(i,t)}}_updateIndices(e,t){let{geometryIndex:i,vertexStart:n,indexStart:o}=t;const{attributes:s,indexStarts:r,typedArrayManager:a}=this;let l=s.indices;if(!l||!e)return;let c=o;const u=d.mD(e,this.positionSize,this.opts.preproject,this.opts.full3d);l=a.allocate(l,o+u.length,{copy:!0});for(let d=0;d<u.length;d++)l[c++]=u[d]+n;r[i+1]=o+u.length,s.indices=l}_updatePositions(e,t){let{vertexStart:i,geometrySize:n}=t;const{attributes:{positions:o},positionSize:s}=this;if(!o||!e)return;const r=d.k8(e);for(let a=i,l=0;l<n;a++,l++){const e=r[l*s],t=r[l*s+1],i=s>2?r[l*s+2]:0;o[3*a]=e,o[3*a+1]=t,o[3*a+2]=i}}_updateVertexValid(e,t){let{vertexStart:i,geometrySize:n}=t;const{positionSize:o}=this,s=this.attributes.vertexValid,r=e&&d.Gd(e);if(e&&e.edgeTypes?s.set(e.edgeTypes,i):s.fill(1,i,i+n),r)for(let a=0;a<r.length;a++)s[i+r[a]/o-1]=0;s[i+n-1]=0}}function g(e){return Array.isArray(e)&&e.length>0&&!Number.isFinite(e[0])}const f="uniform bool extruded;\nuniform bool isWireframe;\nuniform float elevationScale;\nuniform float opacity;\nin vec4 fillColors;\nin vec4 lineColors;\nin vec3 pickingColors;\nout vec4 vColor;\nstruct PolygonProps {\nvec3 positions;\nvec3 positions64Low;\nvec3 normal;\nfloat elevations;\n};\nvec3 project_offset_normal(vec3 vector) {\nif (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\nproject_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {\nreturn normalize(vector * project_uCommonUnitsPerWorldUnit);\n}\nreturn project_normal(vector);\n}\nvoid calculatePosition(PolygonProps props) {\nvec3 pos = props.positions;\nvec3 pos64Low = props.positions64Low;\nvec3 normal = props.normal;\nvec4 colors = isWireframe ? lineColors : fillColors;\ngeometry.worldPosition = props.positions;\ngeometry.pickingColor = pickingColors;\nif (extruded) {\npos.z += props.elevations * elevationScale;\n}\ngl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\nif (extruded) {\n#ifdef IS_SIDE_VERTEX\nnormal = project_offset_normal(normal);\n#else\nnormal = project_normal(normal);\n#endif\ngeometry.normal = normal;\nvec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);\nvColor = vec4(lightColor, colors.a * opacity);\n} else {\nvColor = vec4(colors.rgb, colors.a * opacity);\n}\nDECKGL_FILTER_COLOR(vColor, geometry);\n}\n",m="#version 300 es\n#define SHADER_NAME solid-polygon-layer-vertex-shader\nin vec3 vertexPositions;\nin vec3 vertexPositions64Low;\nin float elevations;\n"+f+"\nvoid main(void) {\nPolygonProps props;\nprops.positions = vertexPositions;\nprops.positions64Low = vertexPositions64Low;\nprops.elevations = elevations;\nprops.normal = vec3(0.0, 0.0, 1.0);\ncalculatePosition(props);\n}\n",v="#version 300 es\n#define SHADER_NAME solid-polygon-layer-vertex-shader-side\n#define IS_SIDE_VERTEX\nin vec2 positions;\nin vec3 vertexPositions;\nin vec3 nextVertexPositions;\nin vec3 vertexPositions64Low;\nin vec3 nextVertexPositions64Low;\nin float elevations;\nin float instanceVertexValid;\n"+f+"\nvoid main(void) {\nif(instanceVertexValid < 0.5){\ngl_Position = vec4(0.);\nreturn;\n}\nPolygonProps props;\nvec3 pos;\nvec3 pos64Low;\nvec3 nextPos;\nvec3 nextPos64Low;\n#if RING_WINDING_ORDER_CW == 1\npos = vertexPositions;\npos64Low = vertexPositions64Low;\nnextPos = nextVertexPositions;\nnextPos64Low = nextVertexPositions64Low;\n#else\npos = nextVertexPositions;\npos64Low = nextVertexPositions64Low;\nnextPos = vertexPositions;\nnextPos64Low = vertexPositions64Low;\n#endif\nprops.positions = mix(pos, nextPos, positions.x);\nprops.positions64Low = mix(pos64Low, nextPos64Low, positions.x);\nprops.normal = vec3(\npos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),\nnextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),\n0.0);\nprops.elevations = elevations * positions.y;\ncalculatePosition(props);\n}\n",y=[0,0,0,255],_={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:e=>e.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:y},getLineColor:{type:"accessor",value:y},material:!0},b={enter:(e,t)=>t.length?t.subarray(t.length-e.length):e};class w extends n.Z{getShaders(e){return super.getShaders({vs:"top"===e?m:v,fs:"#version 300 es\n#define SHADER_NAME solid-polygon-layer-fragment-shader\nprecision highp float;\nin vec4 vColor;\nout vec4 fragColor;\nvoid main(void) {\nfragColor = vColor;\ngeometry.uv = vec2(0.);\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",defines:{RING_WINDING_ORDER_CW:this.props._normalize||"CCW"!==this.props._windingOrder?1:0},modules:[o.Z,s.N,r.Z]})}get wrapLongitude(){return!1}getBounds(){var e;return null==(e=this.getAttributeManager())?void 0:e.getBounds(["vertexPositions"])}initializeState(){const{viewport:e}=this.context;let{coordinateSystem:t}=this.props;const{_full3d:i}=this.props;let n;e.isGeospatial&&t===a.Df.DEFAULT&&(t=a.Df.LNGLAT),t===a.Df.LNGLAT&&(n=i?e.projectPosition.bind(e):e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new p({preproject:n,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const o=this.getAttributeManager(),s=!0;o.remove(["instancePickingColors"]),o.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:s},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:b,accessor:"getPolygon",update:this.calculatePositions,noAlloc:s,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:s},elevations:{size:1,stepMode:"dynamic",transition:b,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:b,accessor:"getFillColor",defaultValue:y},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:b,accessor:"getLineColor",defaultValue:y},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(e,t)=>{let{index:i,target:n}=t;return this.encodePickingColor(e&&e.__source?e.__source.index:i,n)}}})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:i}=t,n=this.props.data;return n[0]&&n[0].__source&&(t.object=n.find((e=>e.__source.index===i))),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let i=0;i<t.length;i++)t[i].__source.index===e&&this._disablePickingIndex(i);else super.disablePickingIndex(e)}draw(e){let{uniforms:t}=e;const{extruded:i,filled:n,wireframe:o,elevationScale:s}=this.props,{topModel:r,sideModel:a,wireframeModel:l,polygonTesselator:c}=this.state,d={...t,extruded:Boolean(i),elevationScale:s};l&&o&&(l.setInstanceCount(c.instanceCount-1),l.setUniforms(d),l.draw(this.context.renderPass)),a&&n&&(a.setInstanceCount(c.instanceCount-1),a.setUniforms(d),a.draw(this.context.renderPass)),r&&n&&(r.setVertexCount(c.vertexCount),r.setUniforms(d),r.draw(this.context.renderPass))}updateState(e){super.updateState(e),this.updateGeometry(e);const{props:t,oldProps:i,changeFlags:n}=e,o=this.getAttributeManager();var s;(n.extensionsChanged||t.filled!==i.filled||t.extruded!==i.extruded)&&(null==(s=this.state.models)||s.forEach((e=>e.destroy())),this.setState(this._getModels()),o.invalidateAll())}updateGeometry(e){let{props:t,oldProps:i,changeFlags:n}=e;if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPolygon)){const{polygonTesselator:e}=this.state,i=t.data.attributes||{};e.updateGeometry({data:t.data,normalize:t._normalize,geometryBuffer:i.getPolygon,buffers:i,getGeometry:t.getPolygon,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:n.dataChanged,full3d:t._full3d}),this.setState({numInstances:e.instanceCount,startIndices:e.vertexStarts}),n.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:e,filled:t,extruded:i}=this.props;let n,o,s;if(t){const t=this.getShaders("top");t.defines.NON_INSTANCED_MODEL=1;const i=this.getAttributeManager().getBufferLayouts({isInstanced:!1});n=new l.H(this.context.device,{...t,id:e+"-top",topology:"triangle-list",uniforms:{isWireframe:!1},bufferLayout:i,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(i){const t=this.getAttributeManager().getBufferLayouts({isInstanced:!0});o=new l.H(this.context.device,{...this.getShaders("side"),id:e+"-side",bufferLayout:t,uniforms:{isWireframe:!1},geometry:new c.Z({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),s=new l.H(this.context.device,{...this.getShaders("side"),id:e+"-wireframe",bufferLayout:t,uniforms:{isWireframe:!0},geometry:new c.Z({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[o,s,n].filter(Boolean),topModel:n,sideModel:o,wireframeModel:s}}calculateIndices(e){const{polygonTesselator:t}=this.state;e.startIndices=t.indexStarts,e.value=t.get("indices")}calculatePositions(e){const{polygonTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}w.defaultProps=_,w.layerName="SolidPolygonLayer"},59743:(e,t,i)=>{i.d(t,{Z:()=>a});var n=i(70575),o=i(87799);const s=.75,r=[];class a extends o.Z{getShaders(){return{...super.getShaders(),fs:"#version 300 es\n#define SHADER_NAME multi-icon-layer-fragment-shader\nprecision highp float;\nuniform float opacity;\nuniform sampler2D iconsTexture;\nuniform float gamma;\nuniform bool sdf;\nuniform float alphaCutoff;\nuniform float sdfBuffer;\nuniform float outlineBuffer;\nuniform vec4 outlineColor;\nin vec4 vColor;\nin vec2 vTextureCoords;\nin vec2 uv;\nout vec4 fragColor;\nvoid main(void) {\ngeometry.uv = uv;\nif (!bool(picking.isActive)) {\nfloat alpha = texture(iconsTexture, vTextureCoords).a;\nvec4 color = vColor;\nif (sdf) {\nfloat distance = alpha;\nalpha = smoothstep(sdfBuffer - gamma, sdfBuffer + gamma, distance);\nif (outlineBuffer > 0.0) {\nfloat inFill = alpha;\nfloat inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);\ncolor = mix(outlineColor, vColor, inFill);\nalpha = inBorder;\n}\n}\nfloat a = alpha * color.a;\nif (a < alphaCutoff) {\ndiscard;\n}\nfragColor = vec4(color.rgb, a * opacity);\n}\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n"}}initializeState(){super.initializeState();this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(e,t)=>{let{index:i,target:n}=t;return this.encodePickingColor(i,n)}}})}updateState(e){super.updateState(e);const{props:t,oldProps:i}=e;let{outlineColor:o}=t;o!==i.outlineColor&&(o=o.map((e=>e/255)),o[3]=Number.isFinite(o[3])?o[3]:1,this.setState({outlineColor:o})),!t.sdf&&t.outlineWidth&&n.Z.warn(this.id+": fontSettings.sdf is required to render outline")()}draw(e){const{sdf:t,smoothing:i,outlineWidth:n}=this.props,{outlineColor:o}=this.state,r=n?Math.max(i,s*(1-n)):-1;if(e.uniforms={...e.uniforms,sdfBuffer:s,outlineBuffer:r,gamma:i,sdf:Boolean(t),outlineColor:o},super.draw(e),t&&n){const{iconManager:e}=this.state,t=e.getTexture(),i=this.state.model;t&&(i.setUniforms({outlineBuffer:s}),i.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap((e=>super.getInstanceOffset(e))):r}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap((e=>super.getInstanceIconFrame(e))):r}}a.defaultProps={getIconOffsets:{type:"accessor",value:e=>e.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}},a.layerName="MultiIconLayer"},71155:(e,t,i)=>{i.d(t,{Z:()=>d});var n=i(45286),o=i(81135),s=i(23064),r=i(19845),a=i(41708),l=i(14594);const c={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:e=>e.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class d extends n.Z{getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME text-background-layer-vertex-shader\nin vec2 positions;\nin vec3 instancePositions;\nin vec3 instancePositions64Low;\nin vec4 instanceRects;\nin float instanceSizes;\nin float instanceAngles;\nin vec2 instancePixelOffsets;\nin float instanceLineWidths;\nin vec4 instanceFillColors;\nin vec4 instanceLineColors;\nin vec3 instancePickingColors;\nuniform bool billboard;\nuniform float opacity;\nuniform float sizeScale;\nuniform float sizeMinPixels;\nuniform float sizeMaxPixels;\nuniform vec4 padding;\nuniform int sizeUnits;\nout vec4 vFillColor;\nout vec4 vLineColor;\nout float vLineWidth;\nout vec2 uv;\nout vec2 dimensions;\nvec2 rotate_by_angle(vec2 vertex, float angle) {\nfloat angle_radian = radians(angle);\nfloat cos_angle = cos(angle_radian);\nfloat sin_angle = sin(angle_radian);\nmat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\nreturn rotationMatrix * vertex;\n}\nvoid main(void) {\ngeometry.worldPosition = instancePositions;\ngeometry.uv = positions;\ngeometry.pickingColor = instancePickingColors;\nuv = positions;\nvLineWidth = instanceLineWidths;\nfloat sizePixels = clamp(\nproject_size_to_pixel(instanceSizes * sizeScale, sizeUnits),\nsizeMinPixels, sizeMaxPixels\n);\ndimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;\nvec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);\npixelOffset = rotate_by_angle(pixelOffset, instanceAngles);\npixelOffset += instancePixelOffsets;\npixelOffset.y *= -1.0;\nif (billboard)  {\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\nvec3 offset = vec3(pixelOffset, 0.0);\nDECKGL_FILTER_SIZE(offset, geometry);\ngl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n} else {\nvec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);\nDECKGL_FILTER_SIZE(offset_common, geometry);\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n}\nvFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);\nDECKGL_FILTER_COLOR(vFillColor, geometry);\nvLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);\nDECKGL_FILTER_COLOR(vLineColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME text-background-layer-fragment-shader\nprecision highp float;\nuniform bool stroked;\nin vec4 vFillColor;\nin vec4 vLineColor;\nin float vLineWidth;\nin vec2 uv;\nin vec2 dimensions;\nout vec4 fragColor;\nvoid main(void) {\ngeometry.uv = uv;\nvec2 pixelPosition = uv * dimensions;\nif (stroked) {\nfloat distToEdge = min(\nmin(pixelPosition.x, dimensions.x - pixelPosition.x),\nmin(pixelPosition.y, dimensions.y - pixelPosition.y)\n);\nfloat isBorder = smoothedge(distToEdge, vLineWidth);\nfragColor = mix(vFillColor, vLineColor, isBorder);\n} else {\nfragColor = vFillColor;\n}\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",modules:[o.Z,s.Z]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e);const{changeFlags:t}=e;var i;t.extensionsChanged&&(null==(i=this.state.model)||i.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw(e){let{uniforms:t}=e;const{billboard:i,sizeScale:n,sizeUnits:o,sizeMinPixels:s,sizeMaxPixels:a,getLineWidth:l}=this.props;let{padding:c}=this.props;c.length<4&&(c=[c[0],c[1],c[0],c[1]]);const d=this.state.model;d.setUniforms(t),d.setUniforms({billboard:i,stroked:Boolean(l),padding:c,sizeUnits:r.iI[o],sizeScale:n,sizeMinPixels:s,sizeMaxPixels:a}),d.draw(this.context.renderPass)}_getModel(){return new l.H(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new a.Z({topology:"triangle-fan-webgl",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array([0,0,1,0,1,1,0,1])}}}),isInstanced:!0})}}d.defaultProps=c,d.layerName="TextBackgroundLayer"},48950:(e,t,i)=>{i.d(t,{Z:()=>T});var n=i(96677),o=i(70575),s=i(55884),r=i(59743),a=i(39875);const l=32,c=[];function d(e,t,i,n){let o=0;for(let r=t;r<i;r++){var s;o+=(null==(s=n[e[r]])?void 0:s.layoutWidth)||0}return o}function u(e,t,i,n,o,s){let r=t,a=0;for(let l=t;l<i;l++){const t=d(e,l,l+1,o);a+t>n&&(r<l&&s.push(l),r=l,a=0),a+=t}return a}function h(e,t,i,n,o,s){void 0===o&&(o=0),void 0===s&&(s=e.length);const r=[];return"break-all"===t?u(e,o,s,i,n,r):function(e,t,i,n,o,s){let r=t,a=t,l=t,c=0;for(let h=t;h<i;h++)if(" "===e[h]?l=h+1:" "!==e[h+1]&&h+1!==i||(l=h+1),l>a){let t=d(e,a,l,o);c+t>n&&(r<a&&(s.push(a),r=a,c=0),t>n&&(t=u(e,a,l,n,o,s),r=s[s.length-1])),a=l,c+=t}}(e,o,s,i,n,r),r}function p(e,t,i,n,s,r){let a=0,c=0;for(let d=t;d<i;d++){const t=e[d],i=n[t];i?(c||(c=i.layoutHeight),s[d]=a+i.layoutWidth/2,a+=i.layoutWidth):(o.Z.warn("Missing character: "+t+" ("+t.codePointAt(0)+")")(),s[d]=a,a+=l)}r[0]=a,r[1]=c}class g{constructor(e){void 0===e&&(e=5),this._cache={},this._order=[],this.limit=e}get(e){const t=this._cache[e];return t&&(this._deleteOrder(e),this._appendOrder(e)),t}set(e,t){this._cache[e]?(this.delete(e),this._cache[e]=t,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=t,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const t=this._order.indexOf(e);t>=0&&this._order.splice(t,1)}_appendOrder(e){this._order.push(e)}}const f={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:function(){const e=[];for(let t=32;t<128;t++)e.push(String.fromCharCode(t));return e}(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},m=3;let v=new g(m);function y(e,t){for(let i=0;i<e.length;i++)t.data[4*i+3]=e[i]}function _(e,t,i,n){e.font=n+" "+i+"px "+t,e.fillStyle="#000",e.textBaseline="alphabetic",e.textAlign="left"}class b{constructor(){this.props={...f}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:t}=this.props;return(1.2*e+2*t)/e}setProps(e){void 0===e&&(e={}),Object.assign(this.props,e),this._key=this._getKey();const t=function(e,t){let i;i="string"==typeof t?new Set(Array.from(t)):new Set(t);const n=v.get(e);if(!n)return i;for(const o in n.mapping)i.has(o)&&i.delete(o);return i}(this._key,this.props.characterSet),i=v.get(this._key);if(i&&0===t.size)return void(this._atlas!==i&&(this._atlas=i));const n=this._generateFontAtlas(t,i);this._atlas=n,v.set(this._key,n)}_generateFontAtlas(e,t){const{fontFamily:i,fontWeight:n,fontSize:o,buffer:s,sdf:r,radius:l,cutoff:c}=this.props;let d=t&&t.data;d||(d=document.createElement("canvas"),d.width=1024);const u=d.getContext("2d",{willReadFrequently:!0});_(u,i,o,n);const{mapping:h,canvasHeight:p,xOffset:g,yOffset:f}=function(e){let{characterSet:t,getFontWidth:i,fontHeight:n,buffer:o,maxCanvasWidth:s,mapping:r={},xOffset:a=0,yOffset:l=0}=e,c=0,d=a;const u=n+2*o;for(const p of t)if(!r[p]){const e=i(p);d+e+2*o>s&&(d=0,c++),r[p]={x:d+o,y:l+c*u+o,width:e,height:u,layoutWidth:e,layoutHeight:n},d+=e+2*o}return{mapping:r,xOffset:d,yOffset:l+c*u,canvasHeight:(h=l+(c+1)*u,Math.pow(2,Math.ceil(Math.log2(h))))};var h}({getFontWidth:e=>u.measureText(e).width,fontHeight:1.2*o,buffer:s,characterSet:e,maxCanvasWidth:1024,...t&&{mapping:t.mapping,xOffset:t.xOffset,yOffset:t.yOffset}});if(d.height!==p){const e=u.getImageData(0,0,d.width,d.height);d.height=p,u.putImageData(e,0,0)}if(_(u,i,o,n),r){const t=new a.Z({fontSize:o,buffer:s,radius:l,cutoff:c,fontFamily:i,fontWeight:""+n});for(const i of e){const{data:e,width:n,height:s,glyphTop:r}=t.draw(i);h[i].width=n,h[i].layoutOffsetY=.9*o-r;const a=u.createImageData(n,s);y(e,a),u.putImageData(a,h[i].x,h[i].y)}}else for(const a of e)u.fillText(a,h[a].x,h[a].y+s+.9*o);return{xOffset:g,yOffset:f,mapping:h,data:d,width:d.width,height:d.height}}_getKey(){const{fontFamily:e,fontWeight:t,fontSize:i,buffer:n,sdf:o,radius:s,cutoff:r}=this.props;return o?e+" "+t+" "+i+" "+n+" "+s+" "+r:e+" "+t+" "+i+" "+n}}var w=i(71155);const x={start:1,middle:0,end:-1},P={top:1,center:0,bottom:-1},C=[0,0,0,255],S={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:C},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:f.characterSet},fontFamily:f.fontFamily,fontWeight:f.fontWeight,lineHeight:1,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:C},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:e=>e.text},getPosition:{type:"accessor",value:e=>e.position},getColor:{type:"accessor",value:C},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class T extends n.Z{constructor(){super(...arguments),this.getBoundingRect=(e,t)=>{let{size:[i,n]}=this.transformParagraph(e,t);const{fontSize:o}=this.state.fontAtlasManager.props;i/=o,n/=o;const{getTextAnchor:s,getAlignmentBaseline:r}=this.props;return[(x["function"==typeof s?s(e,t):s]-1)*i/2,(P["function"==typeof r?r(e,t):r]-1)*n/2,i,n]},this.getIconOffsets=(e,t)=>{const{getTextAnchor:i,getAlignmentBaseline:n}=this.props,{x:o,y:s,rowWidth:r,size:[a,l]}=this.transformParagraph(e,t),c=x["function"==typeof i?i(e,t):i],d=P["function"==typeof n?n(e,t):n],u=o.length,h=new Array(2*u);let p=0;for(let g=0;g<u;g++){const e=(1-c)*(a-r[g])/2;h[p++]=(c-1)*a/2+e+o[g],h[p++]=(d-1)*l/2+s[g]}return h}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new b},this.props.maxWidth>0&&o.Z.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:t,oldProps:i,changeFlags:n}=e;(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getText))&&this._updateText();(this._updateFontAtlas()||t.lineHeight!==i.lineHeight||t.wordBreak!==i.wordBreak||t.maxWidth!==i.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo(e){let{info:t}=e;return t.object=t.index>=0?this.props.data[t.index]:null,t}_updateFontAtlas(){const{fontSettings:e,fontFamily:t,fontWeight:i}=this.props,{fontAtlasManager:n,characterSet:o}=this.state,s={...e,characterSet:o,fontFamily:t,fontWeight:i};if(!n.mapping)return n.setProps(s),!0;for(const r in s)if(s[r]!==n.props[r])return n.setProps(s),!0;return!1}_updateText(){var e;const{data:t,characterSet:i}=this.props,n=null==(e=t.attributes)?void 0:e.getText;let o,{getText:r}=this.props,a=t.startIndices;const l="auto"===i&&new Set;if(n&&a){const{texts:e,characterCount:i}=function(e){let{value:t,length:i,stride:n,offset:o,startIndices:s,characterSet:r}=e;const a=t.BYTES_PER_ELEMENT,l=n?n/a:1,c=o?o/a:0,d=s[i]||Math.ceil((t.length-c)/l),u=r&&new Set,h=new Array(i);let p=t;if(l>1||c>0){p=new(0,t.constructor)(d);for(let e=0;e<d;e++)p[e]=t[e*l+c]}for(let g=0;g<i;g++){const e=s[g],t=s[g+1]||d,i=p.subarray(e,t);h[g]=String.fromCodePoint.apply(null,i),u&&i.forEach(u.add,u)}if(u)for(const g of u)r.add(String.fromCodePoint(g));return{texts:h,characterCount:d}}({...ArrayBuffer.isView(n)?{value:n}:n,length:t.length,startIndices:a,characterSet:l});o=i,r=(t,i)=>{let{index:n}=i;return e[n]}}else{const{iterable:e,objectInfo:i}=(0,s.jB)(t);a=[0],o=0;for(const t of e){i.index++;const e=Array.from(r(t,i)||"");l&&e.forEach(l.add,l),o+=e.length,a.push(o)}}this.setState({getText:r,startIndices:a,numInstances:o,characterSet:l||i})}transformParagraph(e,t){const{fontAtlasManager:i}=this.state,n=i.mapping,o=this.state.getText,{wordBreak:s,lineHeight:r,maxWidth:a}=this.props;return function(e,t,i,n,o){const s=Array.from(e),r=s.length,a=new Array(r),l=new Array(r),d=new Array(r),u=("break-word"===i||"break-all"===i)&&isFinite(n)&&n>0,g=[0,0],f=[0,0];let m=0,v=0,y=0;for(let b=0;b<=r;b++){const e=s[b];if("\n"!==e&&b!==r||(y=b),y>v){const e=u?h(s,i,n,o,v,y):c;for(let i=0;i<=e.length;i++){const n=0===i?v:e[i-1],r=i<e.length?e[i]:y;p(s,n,r,o,a,f);for(let e=n;e<r;e++){var _;const t=(null==(_=o[s[e]])?void 0:_.layoutOffsetY)||0;l[e]=m+f[1]/2+t,d[e]=f[0]}m+=f[1]*t,g[0]=Math.max(g[0],f[0])}v=y}"\n"===e&&(a[v]=0,l[v]=0,d[v]=0,v++)}return g[1]=m,{x:a,y:l,rowWidth:d,size:g}}(o(e,t)||"",r,s,a*i.props.fontSize,n)}renderLayers(){const{startIndices:e,numInstances:t,getText:i,fontAtlasManager:{scale:n,atlas:o,mapping:s},styleVersion:a}=this.state,{data:l,_dataDiff:c,getPosition:d,getColor:u,getSize:h,getAngle:p,getPixelOffset:g,getBackgroundColor:m,getBorderColor:v,getBorderWidth:y,backgroundPadding:_,background:b,billboard:x,fontSettings:P,outlineWidth:C,outlineColor:S,sizeScale:T,sizeUnits:L,sizeMinPixels:M,sizeMaxPixels:k,transitions:E,updateTriggers:I}=this.props,A=this.getSubLayerClass("characters",r.Z),z=this.getSubLayerClass("background",w.Z);return[b&&new z({getFillColor:m,getLineColor:v,getLineWidth:y,padding:_,getPosition:d,getSize:h,getAngle:p,getPixelOffset:g,billboard:x,sizeScale:T,sizeUnits:L,sizeMinPixels:M,sizeMaxPixels:k,transitions:E&&{getPosition:E.getPosition,getAngle:E.getAngle,getSize:E.getSize,getFillColor:E.getBackgroundColor,getLineColor:E.getBorderColor,getLineWidth:E.getBorderWidth,getPixelOffset:E.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:I.getPosition,getAngle:I.getAngle,getSize:I.getSize,getFillColor:I.getBackgroundColor,getLineColor:I.getBorderColor,getLineWidth:I.getBorderWidth,getPixelOffset:I.getPixelOffset,getBoundingRect:{getText:I.getText,getTextAnchor:I.getTextAnchor,getAlignmentBaseline:I.getAlignmentBaseline,styleVersion:a}}}),{data:l.attributes&&l.attributes.background?{length:l.length,attributes:l.attributes.background}:l,_dataDiff:c,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new A({sdf:P.sdf,smoothing:Number.isFinite(P.smoothing)?P.smoothing:f.smoothing,outlineWidth:C/(P.radius||f.radius),outlineColor:S,iconAtlas:o,iconMapping:s,getPosition:d,getColor:u,getSize:h,getAngle:p,getPixelOffset:g,billboard:x,sizeScale:T*n,sizeUnits:L,sizeMinPixels:M*n,sizeMaxPixels:k*n,transitions:E&&{getPosition:E.getPosition,getAngle:E.getAngle,getColor:E.getColor,getSize:E.getSize,getPixelOffset:E.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:I.getText,getPosition:I.getPosition,getAngle:I.getAngle,getColor:I.getColor,getSize:I.getSize,getPixelOffset:I.getPixelOffset,getIconOffsets:{getTextAnchor:I.getTextAnchor,getAlignmentBaseline:I.getAlignmentBaseline,styleVersion:a}}}),{data:l,_dataDiff:c,startIndices:e,numInstances:t,getIconOffsets:this.getIconOffsets,getIcon:i})]}static set fontAtlasCacheLimit(e){!function(e){o.Z.assert(Number.isFinite(e)&&e>=m,"Invalid cache limit"),v=new g(e)}(e)}}T.defaultProps=S,T.layerName="TextLayer"},3012:(e,t,i)=>{function n(e){let{data:t,getIndex:i,dataRange:n,replace:o}=e;const{startRow:s=0,endRow:r=1/0}=n,a=t.length;let l=a,c=a;for(let h=0;h<a;h++){const e=i(t[h]);if(l>h&&e>=s&&(l=h),e>=r){c=h;break}}let d=l;const u=c-l!==o.length?t.slice(c):void 0;for(let h=0;h<o.length;h++)t[d++]=o[h];if(u){for(let e=0;e<u.length;e++)t[d++]=u[e];t.length=d}return{startRow:l,endRow:l+o.length}}i.d(t,{b:()=>n})},52030:(e,t,i)=>{i.d(t,{Z:()=>m});var n=i(70575),o=i(45286),s=i(81135),r=i(55098),a=i(23064),l=i(45956),c=i(41708),d=i(14594),u=i(49624);var h=i(78542);function p(e){const t=e.positions||e.POSITION;n.Z.assert(t,'no "postions" or "POSITION" attribute in mesh');const i=t.value.length/t.size;let o=e.COLOR_0||e.colors;o||(o={size:3,value:new Float32Array(3*i).fill(1)});let s=e.NORMAL||e.normals;s||(s={size:3,value:new Float32Array(3*i).fill(0)});let r=e.TEXCOORD_0||e.texCoords;return r||(r={size:2,value:new Float32Array(2*i).fill(0)}),{positions:t,colors:o,normals:s,texCoords:r}}function g(e){return e instanceof c.Z?(e.attributes=p(e.attributes),e):e.attributes?new c.Z({...e,topology:"triangle-list",attributes:p(e.attributes)}):new c.Z({topology:"triangle-list",attributes:p(e)})}const f={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:e=>e.position},getColor:{type:"accessor",value:[0,0,0,255]},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0,value:null}};class m extends o.Z{getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME simple-mesh-layer-vs\nuniform float sizeScale;\nuniform bool composeModelMatrix;\nin vec3 positions;\nin vec3 normals;\nin vec3 colors;\nin vec2 texCoords;\nin vec3 instancePositions;\nin vec3 instancePositions64Low;\nin vec4 instanceColors;\nin vec3 instancePickingColors;\nin vec3 instanceModelMatrixCol0;\nin vec3 instanceModelMatrixCol1;\nin vec3 instanceModelMatrixCol2;\nin vec3 instanceTranslation;\nout vec2 vTexCoord;\nout vec3 cameraPosition;\nout vec3 normals_commonspace;\nout vec4 position_commonspace;\nout vec4 vColor;\nvoid main(void) {\ngeometry.worldPosition = instancePositions;\ngeometry.uv = texCoords;\ngeometry.pickingColor = instancePickingColors;\nvTexCoord = texCoords;\ncameraPosition = project_uCameraPosition;\nvColor = vec4(colors * instanceColors.rgb, instanceColors.a);\nmat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);\nvec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;\nif (composeModelMatrix) {\nDECKGL_FILTER_SIZE(pos, geometry);\nnormals_commonspace = project_normal(instanceModelMatrix * normals);\ngeometry.worldPosition += pos;\ngl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);\ngeometry.position = position_commonspace;\n}\nelse {\npos = project_size(pos);\nDECKGL_FILTER_SIZE(pos, geometry);\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);\ngeometry.position = position_commonspace;\nnormals_commonspace = project_normal(instanceModelMatrix * normals);\n}\ngeometry.normal = normals_commonspace;\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\nDECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME simple-mesh-layer-fs\nprecision highp float;\nuniform bool hasTexture;\nuniform sampler2D sampler;\nuniform bool flatShading;\nuniform float opacity;\nin vec2 vTexCoord;\nin vec3 cameraPosition;\nin vec3 normals_commonspace;\nin vec4 position_commonspace;\nin vec4 vColor;\nout vec4 fragColor;\nvoid main(void) {\ngeometry.uv = vTexCoord;\nvec3 normal;\nif (flatShading) {\nnormal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));\n} else {\nnormal = normals_commonspace;\n}\nvec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;\nDECKGL_FILTER_COLOR(color, geometry);\nvec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);\nfragColor = vec4(lightColor, color.a * opacity);\n}\n",modules:[s.Z,r.s,a.Z]})}getBounds(){var e;if(this.props._instanced)return super.getBounds();let t=this.state.positionBounds;if(t)return t;const{mesh:i}=this.props;if(!i)return null;if(t=null==(e=i.header)?void 0:e.boundingBox,!t){const{attributes:e}=g(i);e.POSITION=e.POSITION||e.positions,t=(0,h.v)(e)}return this.state.positionBounds=t,t}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:"float64",fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:"unorm8",transition:!0,size:this.props.colorFormat.length,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:u.P}),this.setState({emptyTexture:this.context.device.createTexture({data:new Uint8Array(4),width:1,height:1})})}updateState(e){super.updateState(e);const{props:t,oldProps:i,changeFlags:n}=e;if(t.mesh!==i.mesh||n.extensionsChanged){var o;if(this.state.positionBounds=null,null==(o=this.state.model)||o.destroy(),t.mesh){this.state.model=this.getModel(t.mesh);const e=t.mesh.attributes||t.mesh;this.setState({hasNormals:Boolean(e.NORMAL||e.normals)})}this.getAttributeManager().invalidateAll()}t.texture!==i.texture&&t.texture instanceof l.x&&this.setTexture(t.texture),this.state.model&&this.state.model.setTopology(this.props.wireframe?"line-strip":"triangle-list")}finalizeState(e){super.finalizeState(e),this.state.emptyTexture.delete()}draw(e){let{uniforms:t}=e;const{model:i}=this.state;if(!i)return;const{viewport:n,renderPass:o}=this.context,{sizeScale:s,coordinateSystem:r,_instanced:a}=this.props;i.setUniforms(t),i.setUniforms({sizeScale:s,composeModelMatrix:!a||(0,u.X)(n,r),flatShading:!this.state.hasNormals}),i.draw(o)}get isLoaded(){var e;return Boolean((null==(e=this.state)?void 0:e.model)&&super.isLoaded)}getModel(e){const t=new d.H(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:g(e),isInstanced:!0}),{texture:i}=this.props,{emptyTexture:n}=this.state;return t.setBindings({sampler:i||n}),t.setUniforms({hasTexture:Boolean(i)}),t}setTexture(e){const{emptyTexture:t,model:i}=this.state;i&&(i.setBindings({sampler:e||t}),i.setUniforms({hasTexture:Boolean(e)}))}}m.defaultProps=f,m.layerName="SimpleMeshLayer"},49624:(e,t,i)=>{i.d(t,{P:()=>d,X:()=>u});var n=i(55884),o=i(19845);const s=Math.PI/180,r=new Float32Array(16),a=new Float32Array(12);function l(e,t,i){const n=t[0]*s,o=t[1]*s,r=t[2]*s,a=Math.sin(r),l=Math.sin(n),c=Math.sin(o),d=Math.cos(r),u=Math.cos(n),h=Math.cos(o),p=i[0],g=i[1],f=i[2];e[0]=p*h*u,e[1]=p*c*u,e[2]=p*-l,e[3]=g*(-c*d+h*l*a),e[4]=g*(h*d+c*l*a),e[5]=g*u*a,e[6]=f*(c*a+h*l*d),e[7]=f*(-h*a+c*l*d),e[8]=f*u*d}function c(e){return e[0]=e[0],e[1]=e[1],e[2]=e[2],e[3]=e[4],e[4]=e[5],e[5]=e[6],e[6]=e[8],e[7]=e[9],e[8]=e[10],e[9]=e[12],e[10]=e[13],e[11]=e[14],e.subarray(0,12)}const d={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrixCol0:{size:3,elementOffset:0},instanceModelMatrixCol1:{size:3,elementOffset:3},instanceModelMatrixCol2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(e,t){let{startRow:i,endRow:o}=t;const{data:s,getOrientation:d,getScale:u,getTranslation:h,getTransformMatrix:p}=this.props,g=Array.isArray(p),f=g&&16===p.length,m=Array.isArray(u),v=Array.isArray(d),y=Array.isArray(h),_=f||!g&&Boolean(p(s[0]));e.constant=_?f:v&&m&&y;const b=e.value;if(e.constant){let t;if(_)r.set(p),t=c(r);else{t=a;l(t,d,u),t.set(h,9)}e.value=new Float32Array(t)}else{let t=i*e.size;const{iterable:g,objectInfo:w}=(0,n.jB)(s,i,o);for(const e of g){let i;if(w.index++,_)r.set(f?p:p(e,w)),i=c(r);else{i=a;l(i,v?d:d(e,w),m?u:u(e,w)),i.set(y?h:h(e,w),9)}b[t++]=i[0],b[t++]=i[1],b[t++]=i[2],b[t++]=i[3],b[t++]=i[4],b[t++]=i[5],b[t++]=i[6],b[t++]=i[7],b[t++]=i[8],b[t++]=i[9],b[t++]=i[10],b[t++]=i[11]}}}};function u(e,t){return t===o.Df.CARTESIAN||t===o.Df.METER_OFFSETS||t===o.Df.DEFAULT&&!e.isGeospatial}},50920:(e,t,i)=>{i.d(t,{Z:()=>m});var n=i(67294),o=i(47968);const s="undefined"!=typeof window?n.useLayoutEffect:n.useEffect;function r(e,t){for(;e;){if(e===t)return!0;e=Object.getPrototypeOf(e)}return!1}var a=i(95004),l=i(45286);const c={position:"absolute",zIndex:-1};function d(e,t){if("function"==typeof e)return e(t);if(Array.isArray(e))return e.map((e=>d(e,t)));if(u(e)){if(null==(i=e.props)?void 0:i.mapStyle)return t.style=c,(0,n.cloneElement)(e,t);if(function(e){const t=e.type;return t&&t.deckGLViewProps}(e))return(0,n.cloneElement)(e,t)}var i;return e}function u(e){return e&&"object"==typeof e&&"type"in e||!1}function h(e){if("function"==typeof e)return(0,n.createElement)(a.Z,{},e);if(Array.isArray(e))return e.map(h);if(u(e)){if(e.type===n.Fragment)return h(e.props.children);if(r(e.type,a.Z))return e}return e}const p={mixBlendMode:null};function g(e){e.redrawReason&&(e.deck._drawLayers(e.redrawReason),e.redrawReason=null)}function f(e,t){const[i,c]=(0,n.useState)(0),f=(0,n.useRef)({control:null,version:i,forceUpdate:()=>c((e=>e+1))}).current,m=(0,n.useRef)(null),v=(0,n.useRef)(null),y=(0,n.useMemo)((()=>function(e){let{children:t,layers:i=[],views:o=null}=e;const s=[],c=[],d={};return n.Children.forEach(h(t),(e=>{if(u(e)){const t=e.type;if(r(t,l.Z)){const i=function(e,t){const i={},n=e.defaultProps||{};for(const o in t)n[o]!==t[o]&&(i[o]=t[o]);return new e(i)}(t,e.props);c.push(i)}else s.push(e);if(r(t,a.Z)&&t!==a.Z&&e.props.id){const i=new t(e.props);d[i.id]=i}}else e&&s.push(e)})),Object.keys(d).length>0&&(Array.isArray(o)?o.forEach((e=>{d[e.id]=e})):o&&(d[o.id]=o),o=Object.values(d)),i=c.length>0?[...c,...i]:i,{layers:i,children:s,views:o}}(e)),[e.layers,e.views,e.children]);let _=!0;const b=t=>_&&e.viewState?(f.viewStateUpdateRequested=t,null):(f.viewStateUpdateRequested=null,null==e.onViewStateChange?void 0:e.onViewStateChange(t)),w=t=>{_?f.interactionStateUpdateRequested=t:(f.interactionStateUpdateRequested=null,null==e.onInteractionStateChange||e.onInteractionStateChange(t))},x=(0,n.useMemo)((()=>{const t={...e,style:null,width:"100%",height:"100%",parent:m.current,canvas:v.current,layers:y.layers,views:y.views,onViewStateChange:b,onInteractionStateChange:w};return delete t._customRender,f.deck&&f.deck.setProps(t),t}),[e]);(0,n.useEffect)((()=>{const t=e.Deck||o.Z;return f.deck=function(e,t,i){const n=new t({...i,_customRender:t=>{e.redrawReason=t;const i=n.getViewports();e.lastRenderedViewports!==i?e.forceUpdate():g(e)}});return n}(f,t,{...x,parent:m.current,canvas:v.current}),()=>{var e;return null==(e=f.deck)?void 0:e.finalize()}}),[]),s((()=>{g(f);const{viewStateUpdateRequested:e,interactionStateUpdateRequested:t}=f;e&&b(e),t&&w(t)})),(0,n.useImperativeHandle)(t,(()=>function(e){return{get deck(){return e.deck},pickObject:t=>e.deck.pickObject(t),pickMultipleObjects:t=>e.deck.pickMultipleObjects(t),pickObjects:t=>e.deck.pickObjects(t)}}(f)),[]);const P=f.deck&&f.deck.isInitialized?f.deck.getViewports():void 0,{ContextProvider:C,width:S="100%",height:T="100%",id:L,style:M}=e,{containerStyle:k,canvasStyle:E}=(0,n.useMemo)((()=>function(e){let{width:t,height:i,style:n}=e;const o={position:"absolute",zIndex:0,left:0,top:0,width:t,height:i},s={left:0,top:0};if(n)for(const r in n)r in p?s[r]=n[r]:o[r]=n[r];return{containerStyle:o,canvasStyle:s}}({width:S,height:T,style:M})),[S,T,M]);if(!f.viewStateUpdateRequested&&f.lastRenderedViewports===P||f.version!==i){f.lastRenderedViewports=P,f.version=i;const e=function(e){let{children:t,deck:i,ContextProvider:o}=e;const{viewManager:s}=i||{};if(!s||!s.views.length)return[];const l={},c=s.views[0].id;for(const n of t){let e=c,t=n;u(n)&&r(n.type,a.Z)&&(e=n.props.id||c,t=n.props.children);const i=s.getViewport(e),o=s.getViewState(e);if(i){o.padding=i.padding;const{x:n,y:s,width:r,height:a}=i;t=d(t,{x:n,y:s,width:r,height:a,viewport:i,viewState:o}),l[e]||(l[e]={viewport:i,children:[]}),l[e].children.push(t)}}return Object.keys(l).map((e=>{const{viewport:t,children:s}=l[e],{x:r,y:a,width:c,height:d}=t,u={position:"absolute",left:r,top:a,width:c,height:d},h="view-"+e,p=(0,n.createElement)("div",{key:h,id:h,style:u},...s);if(o){const s={viewport:t,container:i.canvas.offsetParent,eventManager:i.eventManager,onViewStateChange:t=>{t.viewId=e,i._onViewStateChange(t)}};return(0,n.createElement)(o,{key:h,value:s},p)}return p}))}({children:y.children,deck:f.deck,ContextProvider:C}),t=(0,n.createElement)("canvas",{key:"canvas",id:L||"deckgl-overlay",ref:v,style:E});f.control=(0,n.createElement)("div",{id:(L||"deckgl")+"-wrapper",ref:m,style:k},[t,e])}return _=!1,f.control}const m=n.forwardRef(f)}}]);