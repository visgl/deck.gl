"use strict";(self.webpackChunkproject_website=self.webpackChunkproject_website||[]).push([[2149],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>g});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=p(n),u=r,g=d["".concat(l,".").concat(u)]||d[u]||m[u]||i;return n?a.createElement(g,o(o({ref:t},c),{},{components:n})):a.createElement(g,o({ref:t},c))}));function g(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[d]="string"==typeof e?e:r,o[1]=s;for(var p=2;p<i;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},4391:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>m,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var a=n(83117),r=(n(67294),n(3905));const i={},o="Using deck.gl with React",s={unversionedId:"get-started/using-with-react",id:"get-started/using-with-react",title:"Using deck.gl with React",description:"While not directly based on React, deck.gl is designed from ground up to work with React based applications. deck.gl layers fit naturally into React's component render flow and flux/redux based applications. deck.gl layers will be performantly rerendered whenever you rerender your normal JSX or React components.",source:"@site/../docs/get-started/using-with-react.md",sourceDirName:"get-started",slug:"/get-started/using-with-react",permalink:"/docs/get-started/using-with-react",draft:!1,editUrl:"https://github.com/visgl/deck.gl/tree/master/website/../docs/get-started/using-with-react.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Using deck.gl Standalone",permalink:"/docs/get-started/using-standalone"},next:{title:"Using deck.gl with TypeScript",permalink:"/docs/get-started/using-with-typescript"}},l={},p=[{value:"The DeckGL React Component",id:"the-deckgl-react-component",level:2},{value:"Adding a Base Map",id:"adding-a-base-map",level:2},{value:"Using JSX Layers and Views",id:"using-jsx-layers-and-views",level:2},{value:"Performance Remarks",id:"performance-remarks",level:2},{value:"Using deck.gl with SSR",id:"using-deckgl-with-ssr",level:2}],c={toc:p},d="wrapper";function m(e){let{components:t,...n}=e;return(0,r.kt)(d,(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"using-deckgl-with-react"},"Using deck.gl with React"),(0,r.kt)("p",null,"While not directly based on React, deck.gl is designed from ground up to work with ",(0,r.kt)("a",{parentName:"p",href:"https://facebook.github.io/react/"},"React")," based applications. deck.gl layers fit naturally into React's component render flow and flux/redux based applications. deck.gl layers will be performantly rerendered whenever you rerender your normal JSX or React components."),(0,r.kt)("h2",{id:"the-deckgl-react-component"},"The DeckGL React Component"),(0,r.kt)("p",null,"To use deck.gl with React, simply import the ",(0,r.kt)("inlineCode",{parentName:"p"},"DeckGL")," React component and render it as a child of another component, passing in your list of deck.gl layers as a property."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"import React from 'react';\nimport DeckGL from '@deck.gl/react';\nimport {MapViewState} from '@deck.gl/core';\nimport {LineLayer} from '@deck.gl/layers';\n\nconst INITIAL_VIEW_STATE: MapViewState = {\n  longitude: -122.41669,\n  latitude: 37.7853,\n  zoom: 13\n};\n\ntype DataType = {\n  from: [longitude: number, latitude: number];\n  to: [longitude: number, latitude: number];\n};\n\nfunction App() {\n  const layers = [\n    new LineLayer<DataType>({\n      id: 'line-layer',\n      data: '/path/to/data.json',\n      getSourcePosition: (d: DataType) => d.from,\n      getTargetPosition: (d: DataType) => d.to,\n    });\n  ];\n\n  return <DeckGL\n      initialViewState={INITIAL_VIEW_STATE}\n      controller\n      layers={layers} />;\n}\n\n")),(0,r.kt)("h2",{id:"adding-a-base-map"},"Adding a Base Map"),(0,r.kt)("p",null,"The vis.gl community maintains two React libraries that seamlessly work with deck.gl."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"react-map-gl")," - a React wrapper for ",(0,r.kt)("a",{parentName:"li",href:"https://docs.mapbox.com/mapbox-gl-js/guides"},"Mapbox GL JS")," and ",(0,r.kt)("a",{parentName:"li",href:"https://maplibre.org/maplibre-gl-js/docs/"},"MapLibre GL JS"),". Several integration options are discussed in ",(0,r.kt)("a",{parentName:"li",href:"/docs/developer-guide/base-maps/using-with-mapbox"},"using with Mapbox"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"@vis.gl/react-google-maps")," - a React wrapper for ",(0,r.kt)("a",{parentName:"li",href:"https://developers.google.com/maps/documentation/javascript"},"Google Maps JavaScript API"),". See ",(0,r.kt)("a",{parentName:"li",href:"/docs/developer-guide/base-maps/using-with-google-maps"},"using with Google Maps"),".")),(0,r.kt)("h2",{id:"using-jsx-layers-and-views"},"Using JSX Layers and Views"),(0,r.kt)("p",null,"It is possible to use JSX syntax to create deck.gl layers and views as React children of the ",(0,r.kt)("inlineCode",{parentName:"p"},"DeckGL")," React components, instead of providing them as ES6 class instances to the ",(0,r.kt)("inlineCode",{parentName:"p"},"layers")," prop. There are no performance advantages to this syntax but it can allow for a more consistent, React-like coding style."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},'import React from \'react\';\nimport DeckGL from \'@deck.gl/react\';\nimport {MapViewState} from \'@deck.gl/core\';\nimport {LineLayer} from \'@deck.gl/layers\';\nimport {Map} from \'react-map-gl\';\n\nconst INITIAL_VIEW_STATE: MapViewState = {\n  longitude: -122.41669,\n  latitude: 37.7853,\n  zoom: 13\n};\n\nfunction App() {\n  return (\n    <DeckGL\n      initialViewState={INITIAL_VIEW_STATE}\n      controller\n    >\n      <LineLayer\n        id="line-layer"\n        data="/path/to/data.json"\n        getSourcePosition={d => d.from}\n        getTargetPosition={d => d.to} />\n\n      <MapView id="map" width="50%" controller >\n        <Map mapStyle="mapbox://styles/mapbox/light-v9" />\n      </MapView>\n\n      <FirstPersonView width="50%" x="50%" fovy={50} />\n    </DeckGL>\n  );\n}\n')),(0,r.kt)("p",null,"For more information on this syntax and its limitations, see ",(0,r.kt)("a",{parentName:"p",href:"/docs/api-reference/react/deckgl"},"DeckGL API"),"."),(0,r.kt)("h2",{id:"performance-remarks"},"Performance Remarks"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Comparing to the ",(0,r.kt)("inlineCode",{parentName:"p"},"Deck")," class in vanilla JavaScript, the ",(0,r.kt)("inlineCode",{parentName:"p"},"DeckGL")," React component is a thin wrapper and in itself does not add any significant performance overhead. However, applications should be mindful that callbacks such as ",(0,r.kt)("inlineCode",{parentName:"p"},"onHover"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"onViewStateChange")," etc. could potentially be invoked on every animation frame, and updating app states within these callbacks will trigger React to rerender (at least part of) the component tree. Therefore, apps should be diligent in following React best practices in general, such as avoiding expensive recalculation with ",(0,r.kt)("inlineCode",{parentName:"p"},"useMemo")," hooks.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"When the component containing ",(0,r.kt)("inlineCode",{parentName:"p"},"DeckGL")," indeed needs to rerender, there is no performance concern in recreating the deck.gl layer instances, even if their props are not changed. When deck.gl receives new layer instances, it compares them with the existing layers, and only updates GPU resources when needed, just like React does for DOM components. Learn more about how it works in this ",(0,r.kt)("a",{parentName:"p",href:"/docs/developer-guide/using-layers#should-i-be-creating-new-layers-on-every-render"},"FAQ"),"."))),(0,r.kt)("h2",{id:"using-deckgl-with-ssr"},"Using deck.gl with SSR"),(0,r.kt)("p",null,"Frameworks such as ",(0,r.kt)("inlineCode",{parentName:"p"},"Next.js")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"Gatsby")," leverage Server Side Rendering to improve page loading performance. As of v9.0, deck.gl is fully ",(0,r.kt)("a",{parentName:"p",href:"https://nodejs.org/api/packages.html"},"ES module")," compliant with support for both ESM-style ",(0,r.kt)("inlineCode",{parentName:"p"},"import")," and CommonJS-style ",(0,r.kt)("inlineCode",{parentName:"p"},"require()"),". Depending on your project settings and the server-side bundler, everything likely would just work."),(0,r.kt)("p",null,"For some projects, SSR may fail with an error message ",(0,r.kt)("inlineCode",{parentName:"p"},"Error: require() of ES Module 'xxx'"),". This is because some of deck.gl's upstream dependencies, such as ",(0,r.kt)("inlineCode",{parentName:"p"},"d3"),", have opted to become ESM-only and no longer support ",(0,r.kt)("inlineCode",{parentName:"p"},"require()"),". Possible mitigations are:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Add ",(0,r.kt)("inlineCode",{parentName:"li"},'type: "module"')," to the project's package.json. This will require other CommonJS-style scripts in the project be updated, as detailed in ",(0,r.kt)("a",{parentName:"li",href:"https://nodejs.org/api/esm.html#enabling"},"Node.js documentation"),". Or,"),(0,r.kt)("li",{parentName:"ul"},"Isolate the deck.gl imports and exclude them from SSR. Since deck.gl renders into a WebGL2/WebGPU context, it wouldn't benefit from SSR to begin with. Below is a minimal sample for ",(0,r.kt)("inlineCode",{parentName:"li"},"Next.js"),":")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="/src/components/map.js"',title:'"/src/components/map.js"'},"import DeckGL from '@deck.gl/react';\nimport {TextLayer} from '@deck.gl/layers';\n\nexport default function Map() {\n  const layers = [\n    new TextLayer({...})\n  ];\n\n  return <DeckGL layers={layers} />\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="/src/pages/app.js"',title:'"/src/pages/app.js"'},"import dynamic from 'next/dynamic';\nconst Map = dynamic(() => import('../components/map'), {ssr: false});\n\nexport default function App() {\n  return <Map />;\n}\n")),(0,r.kt)("p",null,"More examples are discussed in ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/visgl/deck.gl/issues/7735"},"this issue"),"."))}m.isMDXComponent=!0}}]);