function _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }

import seer from 'seer';

/**
 * Recursively set a nested property of an object given a properties array and a value
 */
var recursiveSet = function recursiveSet(obj, path, value) {
  if (!obj) {
    return;
  }

  if (path.length > 1) {
    recursiveSet(obj[path[0]], path.slice(1), value);
  } else {
    obj[path[0]] = value;
  }
};

var overrides = new Map();

/**
 * Create an override on the specify layer, indexed by a valuePath array.
 * Do nothing in case Seer as not been initialized to prevent any preformance drawback.
 */
export var setPropOverrides = function setPropOverrides(id, valuePath, value) {
  if (!seer.isReady()) {
    return;
  }

  if (!overrides.has(id)) {
    overrides.set(id, new Map());
  }

  var props = overrides.get(id);
  props.set(valuePath, value);
};

/**
 * Get the props overrides of a specific layer if Seer as been initialized
 * Invalidates the data to be sure new ones are always picked up.
 */
export var applyPropOverrides = function applyPropOverrides(props) {
  if (!seer.isReady() || !props.id) {
    return;
  }

  var overs = overrides.get(props.id);
  if (!overs) {
    return;
  }

  overs.forEach(function (value, valuePath) {
    recursiveSet(props, valuePath, value);
    // Invalidate data array if we have a data override
    if (valuePath[0] === 'data') {
      props.data = [].concat(_toConsumableArray(props.data));
    }
  });
};

/**
 * Listen for deck.gl edit events
 */
export var layerEditListener = function layerEditListener(cb) {
  if (!seer.isReady()) {
    return;
  }

  seer.listenFor('deck.gl', cb);
};

/**
 * Listen for seer init events to resend data
 */
export var seerInitListener = function seerInitListener(cb) {
  if (!seer.isReady()) {
    return;
  }

  seer.listenFor('init', cb);
};

export var initLayerInSeer = function initLayerInSeer(layer) {
  if (!seer.isReady() || !layer) {
    return;
  }

  var badges = [layer.constructor.layerName];

  seer.listItem('deck.gl', layer.id, {
    badges: badges,
    // TODO: Seer currently only handles single model layers
    links: layer.state && layer.state.model ? ['luma.gl:' + layer.state.model.id] : undefined,
    parent: layer.parentLayer ? layer.parentLayer.id : undefined
  });
};

/**
 * Log layer's properties to Seer
 */
export var updateLayerInSeer = function updateLayerInSeer(layer) {
  if (!seer.isReady() || seer.throttle('deck.gl:' + layer.id, 1E3)) {
    return;
  }

  var data = logPayload(layer);
  seer.multiUpdate('deck.gl', layer.id, data);
};

/**
 * On finalize of a specify layer, remove it from seer
 */
export var removeLayerInSeer = function removeLayerInSeer(id) {
  if (!seer.isReady() || !id) {
    return;
  }

  seer.deleteItem('deck.gl', id);
};

function logPayload(layer) {
  var data = [{ path: 'objects.props', data: layer.props }];

  var badges = [layer.constructor.layerName];

  if (layer.state) {
    if (layer.state.attributeManager) {
      var attrs = layer.state.attributeManager.getAttributes();
      data.push({ path: 'objects.attributes', data: attrs });
      badges.push(layer.state.attributeManager.stats.getTimeString());
    }
    // TODO: Seer currently only handles single model layers
    if (layer.state.model) {
      layer.state.model.timerQueryEnabled = true;
      var lastFrameTime = layer.state.model.stats.lastFrameTime;

      if (lastFrameTime) {
        badges.push((lastFrameTime * 1000).toFixed(0) + '\u03BCs');
      }
    }
  }

  data.push({ path: 'badges', data: badges });

  return data;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb3JlL2xpYi9zZWVyLWludGVncmF0aW9uLmpzIl0sIm5hbWVzIjpbInNlZXIiLCJyZWN1cnNpdmVTZXQiLCJvYmoiLCJwYXRoIiwidmFsdWUiLCJsZW5ndGgiLCJzbGljZSIsIm92ZXJyaWRlcyIsIk1hcCIsInNldFByb3BPdmVycmlkZXMiLCJpZCIsInZhbHVlUGF0aCIsImlzUmVhZHkiLCJoYXMiLCJzZXQiLCJwcm9wcyIsImdldCIsImFwcGx5UHJvcE92ZXJyaWRlcyIsIm92ZXJzIiwiZm9yRWFjaCIsImRhdGEiLCJsYXllckVkaXRMaXN0ZW5lciIsImxpc3RlbkZvciIsImNiIiwic2VlckluaXRMaXN0ZW5lciIsImluaXRMYXllckluU2VlciIsImxheWVyIiwiYmFkZ2VzIiwiY29uc3RydWN0b3IiLCJsYXllck5hbWUiLCJsaXN0SXRlbSIsImxpbmtzIiwic3RhdGUiLCJtb2RlbCIsInVuZGVmaW5lZCIsInBhcmVudCIsInBhcmVudExheWVyIiwidXBkYXRlTGF5ZXJJblNlZXIiLCJ0aHJvdHRsZSIsImxvZ1BheWxvYWQiLCJtdWx0aVVwZGF0ZSIsInJlbW92ZUxheWVySW5TZWVyIiwiZGVsZXRlSXRlbSIsImF0dHJpYnV0ZU1hbmFnZXIiLCJhdHRycyIsImdldEF0dHJpYnV0ZXMiLCJwdXNoIiwic3RhdHMiLCJnZXRUaW1lU3RyaW5nIiwidGltZXJRdWVyeUVuYWJsZWQiLCJsYXN0RnJhbWVUaW1lIiwidG9GaXhlZCJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxPQUFPQSxJQUFQLE1BQWlCLE1BQWpCOztBQUVBOzs7QUFHQSxJQUFNQyxlQUFlLFNBQWZBLFlBQWUsQ0FBQ0MsR0FBRCxFQUFNQyxJQUFOLEVBQVlDLEtBQVosRUFBc0I7QUFDekMsTUFBSSxDQUFDRixHQUFMLEVBQVU7QUFDUjtBQUNEOztBQUVELE1BQUlDLEtBQUtFLE1BQUwsR0FBYyxDQUFsQixFQUFxQjtBQUNuQkosaUJBQWFDLElBQUlDLEtBQUssQ0FBTCxDQUFK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QVosQ0FBa0JjLEtBRnJCLENBRWRHLGFBRmM7O0FBR3JCLFVBQUlBLGFBQUosRUFBbUI7QUFDakJ2QixlQUFPbUIsSUFBUCxDQUFlLENBQUNJLGdCQUFnQixJQUFqQixFQUF1QkMsT0FBdkIsQ0FBK0IsQ0FBL0IsQ0FBZjtBQUNEO0FBQ0Y7QUFDRjs7QUFFRC9CLE9BQUswQixJQUFMLENBQVUsRUFBQzNDLE1BQU0sUUFBUCxFQUFpQmlCLE1BQU1PLE1BQXZCLEVBQVY7O0FBRUEsU0FBT1AsSUFBUDtBQUNEIiwiZmlsZSI6InNlZXItaW50ZWdyYXRpb24uanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgc2VlciBmcm9tICdzZWVyJztcblxuLyoqXG4gKiBSZWN1cnNpdmVseSBzZXQgYSBuZXN0ZWQgcHJvcGVydHkgb2YgYW4gb2JqZWN0IGdpdmVuIGEgcHJvcGVydGllcyBhcnJheSBhbmQgYSB2YWx1ZVxuICovXG5jb25zdCByZWN1cnNpdmVTZXQgPSAob2JqLCBwYXRoLCB2YWx1ZSkgPT4ge1xuICBpZiAoIW9iaikge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmIChwYXRoLmxlbmd0aCA+IDEpIHtcbiAgICByZWN1cnNpdmVTZXQob2JqW3BhdGhbMF1dLCBwYXRoLnNsaWNlKDEpLCB2YWx1ZSk7XG4gIH0gZWxzZSB7XG4gICAgb2JqW3BhdGhbMF1dID0gdmFsdWU7XG4gIH1cbn07XG5cbmNvbnN0IG92ZXJyaWRlcyA9IG5ldyBNYXAoKTtcblxuLyoqXG4gKiBDcmVhdGUgYW4gb3ZlcnJpZGUgb24gdGhlIHNwZWNpZnkgbGF5ZXIsIGluZGV4ZWQgYnkgYSB2YWx1ZVBhdGggYXJyYXkuXG4gKiBEbyBub3RoaW5nIGluIGNhc2UgU2VlciBhcyBub3QgYmVlbiBpbml0aWFsaXplZCB0byBwcmV2ZW50IGFueSBwcmVmb3JtYW5jZSBkcmF3YmFjay5cbiAqL1xuZXhwb3J0IGNvbnN0IHNldFByb3BPdmVycmlkZXMgPSAoaWQsIHZhbHVlUGF0aCwgdmFsdWUpID0+IHtcbiAgaWYgKCFzZWVyLmlzUmVhZHkoKSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmICghb3ZlcnJpZGVzLmhhcyhpZCkpIHtcbiAgICBvdmVycmlkZXMuc2V0KGlkLCBuZXcgTWFwKCkpO1xuICB9XG5cbiAgY29uc3QgcHJvcHMgPSBvdmVycmlkZXMuZ2V0KGlkKTtcbiAgcHJvcHMuc2V0KHZhbHVlUGF0aCwgdmFsdWUpO1xufTtcblxuLyoqXG4gKiBHZXQgdGhlIHByb3BzIG92ZXJyaWRlcyBvZiBhIHNwZWNpZmljIGxheWVyIGlmIFNlZXIgYXMgYmVlbiBpbml0aWFsaXplZFxuICogSW52YWxpZGF0ZXMgdGhlIGRhdGEgdG8gYmUgc3VyZSBuZXcgb25lcyBhcmUgYWx3YXlzIHBpY2tlZCB1cC5cbiAqL1xuZXhwb3J0IGNvbnN0IGFwcGx5UHJvcE92ZXJyaWRlcyA9IHByb3BzID0+IHtcbiAgaWYgKCFzZWVyLmlzUmVhZHkoKSB8fCAhcHJvcHMuaWQpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBvdmVycyA9IG92ZXJyaWRlcy5nZXQocHJvcHMuaWQpO1xuICBpZiAoIW92ZXJzKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgb3ZlcnMuZm9yRWFjaCgodmFsdWUsIHZhbHVlUGF0aCkgPT4ge1xuICAgIHJlY3Vyc2l2ZVNldChwcm9wcywgdmFsdWVQYXRoLCB2YWx1ZSk7XG4gICAgLy8gSW52YWxpZGF0ZSBkYXRhIGFycmF5IGlmIHdlIGhhdmUgYSBkYXRhIG92ZXJyaWRlXG4gICAgaWYgKHZhbHVlUGF0aFswXSA9PT0gJ2RhdGEnKSB7XG4gICAgICBwcm9wcy5kYXRhID0gWy4uLnByb3BzLmRhdGFdO1xuICAgIH1cbiAgfSk7XG59O1xuXG4vKipcbiAqIExpc3RlbiBmb3IgZGVjay5nbCBlZGl0IGV2ZW50c1xuICovXG5leHBvcnQgY29uc3QgbGF5ZXJFZGl0TGlzdGVuZXIgPSBjYiA9PiB7XG4gIGlmICghc2Vlci5pc1JlYWR5KCkpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBzZWVyLmxpc3RlbkZvcignZGVjay5nbCcsIGNiKTtcbn07XG5cbi8qKlxuICogTGlzdGVuIGZvciBzZWVyIGluaXQgZXZlbnRzIHRvIHJlc2VuZCBkYXRhXG4gKi9cbmV4cG9ydCBjb25zdCBzZWVySW5pdExpc3RlbmVyID0gY2IgPT4ge1xuICBpZiAoIXNlZXIuaXNSZWFkeSgpKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgc2Vlci5saXN0ZW5Gb3IoJ2luaXQnLCBjYik7XG59O1xuXG5leHBvcnQgY29uc3QgaW5pdExheWVySW5TZWVyID0gbGF5ZXIgPT4ge1xuICBpZiAoIXNlZXIuaXNSZWFkeSgpIHx8ICFsYXllcikge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IGJhZGdlcyA9IFtsYXllci5jb25zdHJ1Y3Rvci5sYXllck5hbWVdO1xuXG4gIHNlZXIubGlzdEl0ZW0oJ2RlY2suZ2wnLCBsYXllci5pZCwge1xuICAgIGJhZGdlcyxcbiAgICAvLyBUT0RPOiBTZWVyIGN1cnJlbnRseSBvbmx5IGhhbmRsZXMgc2luZ2xlIG1vZGVsIGxheWVyc1xuICAgIGxpbmtzOiBsYXllci5zdGF0ZSAmJiBsYXllci5zdGF0ZS5tb2RlbCA/IFtgbHVtYS5nbDoke2xheWVyLnN0YXRlLm1vZGVsLmlkfWBdIDogdW5kZWZpbmVkLFxuICAgIHBhcmVudDogbGF5ZXIucGFyZW50TGF5ZXIgPyBsYXllci5wYXJlbnRMYXllci5pZCA6IHVuZGVmaW5lZFxuICB9KTtcbn07XG5cbi8qKlxuICogTG9nIGxheWVyJ3MgcHJvcGVydGllcyB0byBTZWVyXG4gKi9cbmV4cG9ydCBjb25zdCB1cGRhdGVMYXllckluU2VlciA9IGxheWVyID0+IHtcbiAgaWYgKCFzZWVyLmlzUmVhZHkoKSB8fCBzZWVyLnRocm90dGxlKGBkZWNrLmdsOiR7bGF5ZXIuaWR9YCwgMUUzKSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IGRhdGEgPSBsb2dQYXlsb2FkKGxheWVyKTtcbiAgc2Vlci5tdWx0aVVwZGF0ZSgnZGVjay5nbCcsIGxheWVyLmlkLCBkYXRhKTtcbn07XG5cbi8qKlxuICogT24gZmluYWxpemUgb2YgYSBzcGVjaWZ5IGxheWVyLCByZW1vdmUgaXQgZnJvbSBzZWVyXG4gKi9cbmV4cG9ydCBjb25zdCByZW1vdmVMYXllckluU2VlciA9IGlkID0+IHtcbiAgaWYgKCFzZWVyLmlzUmVhZHkoKSB8fCAhaWQpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBzZWVyLmRlbGV0ZUl0ZW0oJ2RlY2suZ2wnLCBpZCk7XG59O1xuXG5mdW5jdGlvbiBsb2dQYXlsb2FkKGxheWVyKSB7XG4gIGNvbnN0IGRhdGEgPSBbXG4gICAge3BhdGg6ICdvYmplY3RzLnByb3BzJywgZGF0YTogbGF5ZXIucHJvcHN9XG4gIF07XG5cbiAgY29uc3QgYmFkZ2VzID0gW2xheWVyLmNvbnN0cnVjdG9yLmxheWVyTmFtZV07XG5cbiAgaWYgKGxheWVyLnN0YXRlKSB7XG4gICAgaWYgKGxheWVyLnN0YXRlLmF0dHJpYnV0ZU1hbmFnZXIpIHtcbiAgICAgIGNvbnN0IGF0dHJzID0gbGF5ZXIuc3RhdGUuYXR0cmlidXRlTWFuYWdlci5nZXRBdHRyaWJ1dGVzKCk7XG4gICAgICBkYXRhLnB1c2goe3BhdGg6ICdvYmplY3RzLmF0dHJpYnV0ZXMnLCBkYXRhOiBhdHRyc30pO1xuICAgICAgYmFkZ2VzLnB1c2gobGF5ZXIuc3RhdGUuYXR0cmlidXRlTWFuYWdlci5zdGF0cy5nZXRUaW1lU3RyaW5nKCkpO1xuICAgIH1cbiAgICAvLyBUT0RPOiBTZWVyIGN1cnJlbnRseSBvbmx5IGhhbmRsZXMgc2luZ2xlIG1vZGVsIGxheWVyc1xuICAgIGlmIChsYXllci5zdGF0ZS5tb2RlbCkge1xuICAgICAgbGF5ZXIuc3RhdGUubW9kZWwudGltZXJRdWVyeUVuYWJsZWQgPSB0cnVlO1xuICAgICAgY29uc3Qge2xhc3RGcmFtZVRpbWV9ID0gbGF5ZXIuc3RhdGUubW9kZWwuc3RhdHM7XG4gICAgICBpZiAobGFzdEZyYW1lVGltZSkge1xuICAgICAgICBiYWRnZXMucHVzaChgJHsobGFzdEZyYW1lVGltZSAqIDEwMDApLnRvRml4ZWQoMCl9zrxzYCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZGF0YS5wdXNoKHtwYXRoOiAnYmFkZ2VzJywgZGF0YTogYmFkZ2VzfSk7XG5cbiAgcmV0dXJuIGRhdGE7XG59XG4iXX0=