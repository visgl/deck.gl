<!DOCTYPE html>
<html>

<head>
  <style type="text/css">
    body {
      padding: 0;
      margin: 0;
      background: white;
    }

    #app {
      width: 100vw;
      height: 100vh;
      overflow: hidden;
    }
  </style>
</head>

<body>
  <div id="app"></div>
  <script type="text/javascript" src="/modules/jupyter-widget/dist/standalone-html-bundle.js"></script>
  <script type="text/javascript">
    let currentDeck;
    if (currentDeck) {
      currentDeck.finalize();
      const previousCanvas = document.querySelector('#deckgl-overlay');
      previousCanvas.remove();
    }

    window.onmessage = evt => {
      if (evt.data.json) {

        createDeck({
          mapboxApiKey: 'NO_API_KEY',
          container: document.getElementById('app'),
          jsonInput: evt.data.json,
          useTooltip: true,
          onComplete: ({ deckgl }) => {
            currentDeck = deckgl;
            deckgl.setProps({
              onAfterRender: () => {
                window.top.postMessage('done')
              }
            });
          }
        });
      }
    };
  </script>
</body>

</html>
